<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0073)http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" manifest="smooth.manifest">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link rel="stylesheet" href="./Smooth CoffeeScript_files/SmoothCoffeeScript.css" type="text/css" media="all">
<title>Smooth CoffeeScript</title>
</head>
<body>
<!--
<div class="menu">
<div class="rdbWrapper" data-show-read="1" data-show-send-to-kindle="1" data-show-print="1" data-show-email="1" data-orientation="0" data-version="1" data-bg-color="#fffce6"><div id="readabilityEmbedContainer" name="readabilityEmbedContainer" style="height: 35px; padding: 0; margin: 0; z-index: 50000"> <iframe id="readabilityEmbedIFrame-0" name="readabilityEmbedIFrame-0" scrolling="no" frameborder="0" style="height: 35px; overflow: hidden; border-width: 0; white-space: nowrap; width: 100%;" src="./Smooth CoffeeScript_files/embed.html"></iframe> </div></div><script type="text/javascript" async="" src="./Smooth CoffeeScript_files/embed.js"></script><script type="text/javascript">(function() {var s = document.getElementsByTagName("script")[0],rdb = document.createElement("script"); rdb.type = "text/javascript"; rdb.async = true; rdb.src = document.location.protocol + "//www.readability.com/embed.js"; s.parentNode.insertBefore(rdb, s); })();</script>
<input class="field" type="button" onclick="document.getElementById(&#39;globalWrapper&#39;).style.maxWidth = document.getElementById(&#39;globalWrapper&#39;).style.maxWidth===&#39;&#39;?&#39;600px&#39;:&#39;&#39;" value="Adjust Width">
<input class="field" type="button" onclick="window.open(&#39;https://github.com/autotelicum/Smooth-CoffeeScript/archives/master&#39;)" value="Download Source">
<a href="http://github.com/autotelicum/Smooth-CoffeeScript/" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="./Smooth CoffeeScript_files/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub"></a>
</div>
-->
<div id="globalWrapper" onclick="void(0)">
<div class="center"><img class="embedded" src="./Smooth CoffeeScript_files/SmoothCoverWithSolutions.jpg" alt="figure img/SmoothCoverWithSolutions.jpg" style="width: 70%; height: auto;"></div>

<h1 class="title">
<span class="sans"><span class="large">Smooth CoffeeScript</span></span>
</h1>
<div class="center">
<div class="author">
E.&nbsp;Hoigaard
</div>
<div class="Publishers">
<span class="large"><a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript">http://autotelicum.github.com/Smooth-CoffeeScript</a></span>
</div>
<div class="Dedication">
An introduction to CoffeeScript programming with<br>
an emphasis on clarity, abstraction and verification.<span class="large"><br>
<div class="vspace" style="height: 25pheight%;">
</div>
<br>
</span>The book is <a class="URL" href="http://creativecommons.org/licenses/by/3.0/">freely</a> available, and may be used (as a whole or in parts)<br>
in any way you see fit, as long as credit is given to the original author.<br>
<a class="URL" href="http://eloquentjavascript.net/">Based on Eloquent JavaScript by Marijn Haverbeke</a>.<span class="large"><br>
<div class="vspace" style="height: 25pheight%;">

</div>
<br>
1<sup>st</sup> edition, 3<sup>rd</sup> revision &amp; illustrations © 2554 <a class="URL" href="http://www.accesstoinsight.org/history.html#fn-1">BE</a> / 2011 <a class="URL" href="http://www.accesstoinsight.org/history.html#fn-2">CE</a>.<br>
<a class="URL" href="http://www.publicdomainpictures.net/view-image.php?image=11133&picture=ostriches-look">Public domain cover photo</a>.
</span></div></div>
<div class="fulltoc">
<div class="tocheader">
Table of Contents
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Part-I">Part I: Preface</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-1">Chapter: Software</a>
</div>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Part-II">Part II: Language</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-2">Chapter: <span class="sans">Introduction</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-3">Chapter: <span class="sans">Basic CoffeeScript</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-4">Chapter: <span class="sans">Functions</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-5">Chapter: <span class="sans">Data Structures</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-6">Chapter: <span class="sans">Error Handling</span></a>
</div>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Part-III">Part III: Paradigm</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-7">Chapter: <span class="sans">Functional Programming</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-8">Chapter: <span class="sans">Searching</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-9">Chapter: <span class="sans">Object Orientation</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-10">Chapter: <span class="sans">Regular Expressions</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Chapter-11">Chapter: <span class="sans">Modularity</span></a>
</div>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Part-IV">Part IV: Appendix</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Appendix-A">Appendix: <span class="sans">Language Extras</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Appendix-B">Appendix: <span class="sans">Binary Heaps</span></a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Appendix-C">Appendix: Performance</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Appendix-D">Appendix: Command Line Utility</a>
</div>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Part-V">Part V: Reference and Index</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Appendix-E">Appendix: Reference</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Section--1">Section: Language Reference</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--1">Subsection: General</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--2">Subsection: Embedded JavaScript</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--3">Subsection: Functions</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--4">Subsection: Objects and arrays</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--5">Subsection: Lexical Scoping and Variable Safety</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--6">Subsection: If, Else, Unless, and Conditional Assignment</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--7">Subsection: Splats</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--8">Subsection: Loops and Comprehensions</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--9">Subsection: Array Slicing and Splicing with Ranges</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--10">Subsection: Everything is an Expression</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--11">Subsection: Operators and Aliases</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--12">Subsection: Existential Operator</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--13">Subsection: Classes, Inheritance, and Super</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--14">Subsection: Destructuring Assignment</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--15">Subsection: Function binding</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--16">Subsection: Switch/When/Else</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--17">Subsection: Try/Catch/Finally</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--18">Subsection: String Interpolation, Heredocs, and Block Comments</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--19">Subsection: Chained Comparisons</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--20">Subsection: Extended Regular Expressions</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--21">Subsection: Reserved Words</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--22">Subsection: Underscore</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--23">Subsection: qc.js</a>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#toc-Subsection--24">Subsection: Additional Words</a>
</div>
</div>
</div>
</div>
<div class="toc">
<a class="Link" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#Index">Index</a>
</div>

</div>
<h1 class="Part">
<a class="toc" name="toc-Part-I">Part I.</a> Preface
</h1>
<div class="Addchap">
Foreword<a class="Label" name="chap:Foreword"> </a>
</div>
<div class="Standard">
CoffeeScript is a lucid evolution of JavaScript created by Jeremy Ashkenas. This book attempts to be an evolution of “Eloquent JavaScript” by Marijn Haverbeke. Apart from the major change in explaining CoffeeScript instead of JavaScript, numerous other changes have been made and sections have been added, edited or removed.
</div>
<div class="Standard">
Everything that is expressed in this book is therefore solely the responsibility of the editor. In the sense of open source software, this book is a <a class="URL" href="http://en.wikipedia.org/wiki/Fork_(software_development)">fork</a>. To read the excellent original JavaScript work as it was intended by its author refer to <a class="URL" href="http://eloquentjavascript.net/">Eloquent JavaScript by Marijn Haverbeke</a>.
</div>
<div class="Standard">
You do not need to know JavaScript but after reading <span class="sans">Smooth CoffeeScript</span> you can in <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/js-intro.html">JavaScript Basics</a> by Rebecca Murphey find an overview that can be helpful when debugging or using JavaScript libraries.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The program examples in this book use a prelude file in addition to the CoffeeScript environment. It includes the Underscore functional library, the Coffeekup <span class="versalitas"><span class="small">HTML</span></span><span class="default"> markup, <tt>ws</tt> server-side WebSockets and <tt>qc</tt>, a QuickCheck based testing library. These libraries extend CoffeeScript with useful abstractions and testing tools to keep focus on the task at hand instead of distracting boilerplate code.</span>
</div>
<div class="Standard">
While it is possible to express programs from a very small set of language primitives, it quickly becomes tedious and error prone to do so. The approach taken here is to include a broader set of functional building blocks as if they were a native part of the programming language. By thinking in terms of these higher level constructs more complex problems can be handled with less effort.
</div>
<div class="Standard">
To ensure correctness testing is required. This is especially true when developing reusable algorithms in a dynamic and untyped language. By integrating QuickCheck style test cases as soon as functions are introduced, it is intended that writing tests and declaring assumptions become a seamless part of writing software.
</div>
<div class="Standard">
<p><br>
</p>

</div>
<div class="Standard">
CoffeeScript is available in browsers and environments where JavaScript is available. The screenshots below show CoffeeScript running the same web server and client application on Mac OS X, Windows and iOS.
</div>
<div class="Standard">
<div class="medskip"> </div>
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/TadaOnMacOSX.png" alt="figure img/TadaOnMacOSX.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/TadaOnWin7.png" alt="figure img/TadaOnWin7.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/TadaOnIOS.png" alt="figure img/TadaOnIOS.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
The CoffeeScript below shows the brevity of the self-contained application from the screenshots. It contains an <span class="versalitas"><span class="small">HTML</span></span><span class="default"> 5 web page in Coffeekup markup and its own <span class="versalitas"></span></span><span class="small">HTTP</span><span class="default"> web server. The page has a Canvas element with a drawing of the ‘Seed of Life’. Coffeekup is a few hundred lines of CoffeeScript. No frameworks. No JavaScript. Pure and smooth.</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">require ’./prelude’
​
webpage = kup.render -&gt; 
  doctype 5
  html -&gt;
    head -&gt;
      meta charset: ’utf-8’
      title ’My drawing | My awesome website’
      style ’’’
        body {font-family: sans-serif}
        header, nav, section, footer {display: block}
      ’’’
      coffeescript -&gt;
        draw = (ctx, x, y) -&gt;
          circle = (ctx, x, y) -&gt;
            ctx.beginPath()
            ctx.arc x, y, 100, 0, 2*Math.PI, false
            ctx.stroke()
          ctx.strokeStyle = ’rgba(255,40,20,0.7)’
          circle ctx, x, y
          for angle in [0...2*Math.PI] by 1/3*Math.PI
            circle ctx, x+100*Math.cos(angle),
                        y+100*Math.sin(angle)
        window.onload = -&gt;
          canvas = document.getElementById ’drawCanvas’
          context = canvas.getContext ’2d’
          draw context, 300, 200
    body -&gt;
      header -&gt; h1 ’Seed of Life’
      canvas id: ’drawCanvas’, width: 600, height: 400
​
http = require ’http’
server = http.createServer (req, res) -&gt;
  show "#{req.client.remoteAddress} #{req.method} #{req.url}"
  res.writeHead 200, ’Content-Type’: ’text/html’
  res.write webpage
  res.end()
server.listen 3389
show ’Server running at’
show  server.address()
</pre>
</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-1"></a>Software
</h1>
<div class="Standard">
<span class="sans">Smooth CoffeeScript</span> is about the CoffeeScript language, see <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/install-notes.html">Quick CoffeeScript Install</a> or refer to the websites for further installation information. This should get you started:
</div>
<div class="Standard">
<div class="medskip"> </div>
</div>
<ul>
<li>
The CoffeeScript language (1.1.3 / MIT) from <a class="URL" href="http://www.coffeescript.org/">Jeremy Ashkenas</a>
</li>
<li>
The Underscore library (1.1.0.FIX / MIT) included in <a class="URL" href="http://jashkenas.github.com/coffee-script/documentation/docs/underscore.html">CoffeeScript</a>
</li>
<li>
The Coffeekup library (0.3.1 / MIT) from <a class="URL" href="http://coffeekup.org/">Maurice Machado</a>
</li>
<li>
Translated <tt>ws</tt> WebSockets (MIT) from <a class="URL" href="https://github.com/ncr/node.ws.js">Jacek Becela</a>
</li>
<li>
The <tt>qc</tt> testing library<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [A] </span><span class="HoverFoot"><span class="SupFootMarker"> [A] </span>This library is only used to test functionality. The CoffeeScript applications in <span class="sans">Smooth CoffeeScript</span> do not depend on it. CoffeeScript is a new language and tools like <tt>qc</tt> depend on legacy code written in JavaScript.</span></span> (2009 / BSD) from <a class="URL" href="https://bitbucket.org/darrint/qc.js/">Darrin Thompson</a>
</li>

</ul>
<div class="Standard">
<div class="medskip"> </div>
</div>
<div class="Standard">
The required libraries have been adapted for standard CoffeeScript and are included in the <div class="listing">
<pre class="listing">src/prelude
</pre>
</div>
 directory. Underscore, <tt>ws</tt> and Coffeekup are written in CoffeeScript and they are small enough to read and understand in a short time — at least after you have read this book.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
To set up your own working environment follow the steps described <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/install-notes.html">here</a> or at <a class="URL" href="http://jashkenas.github.com/coffee-script/#installation">coffeescript.org</a><span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [B] </span><span class="HoverFoot"><span class="SupFootMarker"> [B] </span>The CoffeeScript examples have been tested on Mac OS X 10.6 and on Windows 7 with the prebuilt node installers.</span></span>. If you use Windows then you can adapt the prelude to default to your preferred web browser. You can also find instructions there for how to enable WebSockets if your browser requires it.
</div>
<div class="Standard">
Then set up your text editor to support CoffeeScript, you can find several on the <a class="URL" href="https://github.com/jashkenas/coffee-script/wiki/Text-editor-plugins">CoffeeScript wiki</a>. For example to use the <a class="URL" href="https://github.com/jashkenas/coffee-script-tmbundle">TextMate bundle</a> with the cross-platform <a class="URL" href="http://www.sublimetext.com/2">Sublime Text 2 editor</a>, unpack the bundle in a CoffeeScript directory under Packages. This setup gives you syntax highlighting, code snippets, and code completion.
</div>
<div class="Standard">
You can add a build file to get execution of CoffeeScript with the press of a button. Name the file CoffeeScript.sublime-build and change the path according to you operating system and install location. Something like:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">{
	"cmd": ["/Users/username/bin/coffee", "$file"],
	"file_regex": "^Error: In (...*?),
                  Parse error on line ([0-9]*):?",
	"selector": "source.coffee"
} 
</pre>
</div>

</div>
<div class="Standard">
Finally open a command-line in a terminal and type (again adjust for your platform)
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">cd path-to-smooth-coffeescript/src
coffee -r ./prelude
</pre>
</div>

</div>
<div class="Standard">
Then you have a CoffeeScript Read-Eval-Print-Loop (REPL) at your disposal. Read the <a class="URL" href="http://jashkenas.github.com/coffee-script/#installation">usage section</a> for more information on the CoffeeScript compiler. You can run samples with <div class="listing">
<pre class="listing">coffee filename.coffee
</pre>
</div>
. 
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<span class="sans">Smooth CoffeeScript</span> comes in two editions; with and without solutions. Complete by chapter source code files are in the src directory. A copy of all files are in src-no-solutions, these files have stops where you can insert your own solutions.
</div>
<div class="Standard">
To get the most out of the book: Start your text editor and in src-no-solutions open the source code file for the chapter you are reading. If you have a wide-screen display then arrange your windows so the book is on one side and the text editor on the other. Then you can read and run the samples, see the results, experiment with the code and solve the exercises.
</div>
<div class="Standard">
If you make copies of the files you work on then you can easily undo experiments. If you get stuck with an exercise then copy my solution from the file in the src directory and study it a bit before moving on. Note that in some of the source files you have to indent your solutions to match the surrounding code.
</div>
<div class="Standard">
Both editions and accompanying source files can be downloaded from: <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/">http://autotelicum.github.com/Smooth-CoffeeScript/</a>
</div>
<h1 class="Part">
<a class="toc" name="toc-Part-II">Part II.</a> Language
</h1>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-2"></a>Introduction <a class="Label" name="chap:Introduction"> </a>
</h1>
<div class="Standard">
When personal computers were first introduced, most of them came equipped with a simple programming language, usually a variant of <span class="versalitas">BASIC</span>. Interacting with the computer was closely integrated with this language, and thus every computer-user, whether he wanted to or not, would get a taste of it. Now that computers have become plentiful and cheap, typical users do not get much further than clicking things with a mouse. For most people, this works very well. But for those of us with a natural inclination towards technological tinkering, the removal of programming from every-day computer use presents something of a barrier.
</div>
<div class="Standard">
Fortunately, as an effect of developments in the World Wide Web, it so happens that every computer equipped with a modern web-browser also has an environment for programming JavaScript which can easily be adapted to an environment for CoffeeScript. In today’s spirit of not bothering the user with technical details, it is kept well hidden, but a web-page can make it accessible, and use it as a platform for learning to program. You can find such an environment in the menu on <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/coffeescript.org">coffeescript.org</a> select ‘Try CoffeeScript’ or use the ‘load’ button below the examples.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<div class="vspace" style="height: -3pt;">

</div>

</div>
<blockquote class="Quote">
<i>I do not enlighten those who are not eager to learn, nor arouse those who are not anxious to give an explanation themselves. If I have presented one corner of the square and they cannot come back to me with the other three, I should not go over the points again.</i>
</blockquote>
<div class="Dictum">
<span class="sans"><span class="footnotesize">Confucius</span></span>
</div>
<div class="Standard">
<div class="bigskip"> </div>
</div>
<div class="Standard">
Besides explaining CoffeeScript, this book tries to be an introduction to the basic principles of programming. Programming, it turns out, is hard. The fundamental rules are, most of the time, simple and clear. But programs, while built on top of these basic rules, tend to become complex enough to introduce their own rules, their own complexity. Because of this, programming is rarely simple or predictable. As Donald Knuth, who is something of a founding father of the field, says, it is an <i>art</i>.
</div>
<div class="Standard">
To get something out of this book, more than just passive reading is required. Try to stay sharp, make an effort to solve the exercises, and only continue on when you are reasonably sure you understand the material that came before.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<div class="vspace" style="height: -3pt;">

</div>

</div>
<blockquote class="Quote">
<i>The computer programmer is a creator of universes for which he alone is responsible. Universes of virtually unlimited complexity can be created in the form of computer programs.</i>
</blockquote>
<div class="Dictum">
<span class="sans"><span class="footnotesize">Joseph Weizenbaum, <i>Computer Power and Human Reason</i></span></span><br>
</div>
<div class="Standard">
<div class="bigskip"> </div>
</div>
<div class="Standard">
A program is many things. It is a piece of text typed by a programmer, it is the directing force that makes the computer do what it does, it is data in the computer’s memory, yet it controls the actions performed on this same memory. Analogies that try to compare programs to objects we are familiar with tend to fall short, but a superficially fitting one is that of a machine. The gears of a mechanical watch fit together ingeniously, and if the watchmaker was any good, it will accurately show the time for many years. The elements of a program fit together in a similar way, and if the programmer knows what he is doing, the program will run without crashing.
</div>
<div class="Standard">
A computer is a machine built to act as a host for these immaterial machines. Computers themselves can only do stupidly straightforward things. The reason they are so useful is that they do these things at an incredibly high speed. A program can, by ingeniously combining many of these simple actions, do very complicated things.
</div>
<div class="Standard">
To some of us, writing computer programs is a fascinating game. A program is a building of thought. It is costless to build, weightless, growing easily under our typing hands. If we get carried away, its size and complexity will grow out of control, confusing even the one who created it. This is the main problem of programming. It is why so much of today’s software tends to crash, fail, screw up.
</div>
<div class="Standard">
When a program works, it is beautiful. The art of programming is the skill of controlling complexity. The great program is subdued, made simple in its complexity.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Today, many programmers believe that this complexity is best managed by using only a small set of well-understood techniques in their programs. They have composed strict rules about the form programs should have, and the more zealous among them will denounce those who break these rules as <i>bad</i> programmers.
</div>
<div class="Standard">
What hostility to the richness of programming! To try to reduce it to something straightforward and predictable, to place a taboo on all the weird and beautiful programs. The landscape of programming techniques is enormous, fascinating in its diversity, still largely unexplored.
</div>
<div class="Standard">
It is certainly littered with traps and snares, luring the inexperienced programmer into all kinds of horrible mistakes, but that only means you should proceed with caution, keep your wits about you. As you learn, there will always be new challenges, new territory to explore. The programmer who refuses to keep exploring will surely stagnate, forget his joy, lose the will to program (and become a manager).
</div>
<div class="Standard">
As far as I am concerned, the definite criterion for a program is whether it is correct. Efficiency, clarity, and size are also important, but how to balance these against each other is always a matter of judgement, a judgement that each programmer must make for himself. Rules of thumb are useful, but one should never be afraid to break them.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In the beginning, at the birth of computing, there were no programming languages. Programs looked something like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">00110001 00000000 00000000 00110001 00000001 00000001
00110011 00000001 00000010 01010001 00001011 00000010
00100010 00000010 00001000 01000011 00000001 00000000
01000001 00000001 00000001 00010000 00000010 00000000
01100010 00000000 00000000
</pre>
</div>

</div>
<div class="Standard">
That is a program to add the numbers from one to ten together, and print out the result (1 + 2 + … + 10 = 55). It could run on a very simple kind of computer. To program early computers, it was necessary to set large arrays of switches in the right position, or punch holes in strips of cardboard and feed them to the computer. You can imagine how this was a tedious, error-prone procedure. Even the writing of simple programs required much cleverness and discipline, complex ones were nearly inconceivable.
</div>
<div class="Standard">
Of course, manually entering these arcane patterns of bits (which is what the 1s and 0s above are generally called) did give the programmer a profound sense of being a mighty wizard. And that has to be worth something, in terms of job satisfaction.
</div>
<div class="Standard">
Each line of the program contains a single instruction. It could be written in English like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"><span class="number-left">1</span>Store the number 0 in memory location 0
<span class="number-left">2</span>Store the number 1 in memory location 1
<span class="number-left">3</span>Store the value of memory location 1 in location 2
<span class="number-left">4</span>Subtract the number 11 from the value in location 2
<span class="number-left">5</span>If the value in memory location 2 is the number 0,
<span class="number-left"> </span>  continue with instruction 9
<span class="number-left">6</span>Add the value of memory location 1 to location 0
<span class="number-left">7</span>Add the number 1 to the value of memory location 1
<span class="number-left">8</span>Continue with instruction 3
<span class="number-left">9</span>Output the value of memory location 0
</pre>
</div>

</div>
<div class="Standard">
While that is more readable than the binary soup, it is still rather unpleasant. It might help to use names instead of numbers for the instructions and memory locations:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Set ’total’ to 0
Set ’count’ to 1
[loop]
Set ’compare’ to ’count’
Subtract 11 from ’compare’
If ’compare’ is zero, continue at [end]
Add ’count’ to ’total’
Add 1 to ’count’
Continue at [loop]
[end]
Output ’total’
</pre>
</div>

</div>
<div class="Standard">
At this point it is not too hard to see how the program works. Can you? The first two lines give two memory locations their starting values: <div class="listing">
<pre class="listing">total
</pre>
</div>
 will be used to build up the result of the program, and <div class="listing">
<pre class="listing">count
</pre>
</div>
 keeps track of the number that we are currently looking at. The lines using <div class="listing">
<pre class="listing">compare
</pre>
</div>
 are probably the weirdest ones. What the program wants to do is see if <div class="listing">
<pre class="listing">count
</pre>
</div>
 is equal to 11, in order to decide whether it can stop yet. Because the machine is so primitive, it can only test whether a number is zero, and make a decision (jump) based on that. So it uses the memory location labelled <div class="listing">
<pre class="listing">compare
</pre>
</div>
 to compute the value of <div class="listing">
<pre class="listing">count - 11
</pre>
</div>
, and makes a decision based on that value. The next two lines add the value of <div class="listing">
<pre class="listing">count
</pre>
</div>
 to the result, and increment <div class="listing">
<pre class="listing">count
</pre>
</div>
 by one every time the program has decided that it is not 11 yet. Here is the same program in CoffeeScript:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">total = 0
count = 1
while count &lt;= 10
  total += count
  count += 1
show total
</pre>
</div>

</div>
<div class="Standard">
This gives us a few more improvements. Most importantly, there is no need to specify the way we want the program to jump back and forth anymore. The magic word <div class="listing">
<pre class="listing">while
</pre>
</div>
 takes care of that. It continues executing the lines indented below it as long as the condition it was given holds: <div class="listing">
<pre class="listing">count &lt;= 10
</pre>
</div>
, which means ‘<div class="listing">
<pre class="listing">count
</pre>
</div>
 is less than or equal to <div class="listing">
<pre class="listing">10
</pre>
</div>
’. Apparently, there is no need anymore to create a temporary value and compare that to zero. This was a stupid little detail, and the power of programming languages is that they take care of stupid little details for us.
</div>
<div class="Standard">
This can also be expressed in a shorter form in CoffeeScript:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">total = 0
total += count for count in [1..10]
show total
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">for
</pre>
</div>
 and <div class="listing">
<pre class="listing">in
</pre>
</div>
 words goes through the range of numbers from 1 to 10 <div class="listing">
<pre class="listing">[1..10]
</pre>
</div>
, assigning each number in turn to <div class="listing">
<pre class="listing">count
</pre>
</div>
. Each value in <div class="listing">
<pre class="listing">count
</pre>
</div>
 is then added to <div class="listing">
<pre class="listing">total
</pre>
</div>
.
</div>
<div class="Standard">
Finally, here is what the program could look like if we happened to have the convenient operation <div class="listing">
<pre class="listing">sum
</pre>
</div>
 available, which computes the sum of a collection of numbers similar to the mathematical notation <span class="formula"><span class="limits"><span class="limit">∑</span></span><span class="scripts"><sup class="script">10</sup><sub class="script"><i>n</i> = 1</sub></span><i>n</i></span>:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show sum [1..10]
</pre>
</div>

</div>
<div class="Standard">
Another possibility is to have functions attached to datatypes. Here a sum function is attached to an array, giving the sum of the elements in the array. 
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show [1..10].sum()
</pre>
</div>

</div>
<div class="Standard">
The moral of this story, then, is that the same program can be expressed in long and short, unreadable and readable ways. The first version of the program was extremely obscure, while the last ones are almost English: <div class="listing">
<pre class="listing">show
</pre>
</div>
 the <div class="listing">
<pre class="listing">sum
</pre>
</div>
 of the numbers from <div class="listing">
<pre class="listing">1
</pre>
</div>
 to <div class="listing">
<pre class="listing">10
</pre>
</div>
. (We will see in later chapters how to build things like <div class="listing">
<pre class="listing">sum
</pre>
</div>
.)
</div>
<div class="Standard">
A good programming language helps the programmer by providing a more abstract way to express himself. It hides uninteresting details, provides convenient building blocks (such as the <div class="listing">
<pre class="listing">while
</pre>
</div>
 construct), and, most of the time, allows the programmer to add building blocks himself (such as the <div class="listing">
<pre class="listing">sum
</pre>
</div>
 operation).
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
JavaScript is the language that is, at the moment, mostly being used to do all kinds of clever and horrible things with pages on the World Wide Web. JavaScript is also used for scripting in <a class="URL" href="http://en.wikipedia.org/wiki/JavaScript#Uses_outside_web_pages">a variety of applications and operating systems</a>. Of special note is server-side JavaScript (SSJS), where the server portion of a web application is written in JavaScript, so a full application can be expressed in one programming language. CoffeeScript generates standard JavaScript code and can therefore be used in environments where standard JavaScript is accepted. It means that both browser portions and server portions can be written in CoffeeScript.
</div>
<div class="Standard">
CoffeeScript is a new language so it remains to be seen how popular it becomes for general application development, but if you are interested in programming, CoffeeScript is definitely a useful language to learn. Even if you do not end up doing much web programming, the mind-bending programs in this book will always stay with you, haunt you, and influence the programs you write in other languages.
</div>
<div class="Standard">
There are those who will say <i>terrible</i> things about JavaScript. Many of these things are true. When I was for the first time required to write something in JavaScript, I quickly came to despise the language. It would accept almost anything I typed, but interpret it in a way that was completely different from what I meant. This had a lot to do with the fact that I did not have a clue what I was doing, but there is also a real issue here: JavaScript is ridiculously liberal in what it allows. The idea behind this design was that it would make programming in JavaScript easier for beginners. In actuality, it mostly makes finding problems in your programs harder, because the system will not point them out to you.
</div>
<div class="Standard">
However, the flexibility of the language is also an advantage. It leaves space for a lot of techniques that are impossible in more rigid languages, and it can be used to overcome some of JavaScript’s shortcomings. After learning it properly, and working with it for a while, I have really learned to <i>like</i> this language. CoffeeScript repairs many of the confusing and cumbersome aspects of JavaScript, while keeping its underlying flexibility and beauty. It is <i>doubleplusgood</i>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Most chapters in this book contain quite a lot of code<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [C] </span><span class="HoverFoot"><span class="SupFootMarker"> [C] </span>‘Code’ is the substance that programs are made of. Every piece of a program, whether it is a single line or the whole thing, can be referred to as ‘code’.</span></span>. In my experience, reading and writing code is an important part of learning to program. Try to not just glance over these examples, but read them attentively and understand them. This can be slow and confusing at first, but you will quickly get the hang of it. The same goes for the exercises. Do not assume you understand them until you have actually written a working solution.
</div>
<div class="Standard">
Because of the way the web works, it is always possible to look at the JavaScript programs that people put in their web-pages. This can be a good way to learn how some things are done. Because most web programmers are not ‘professional’ programmers, or consider JavaScript programming so uninteresting that they never properly learned it, a lot of the code you can find like this is of a <i>very</i> bad quality. When learning from ugly or incorrect code, the ugliness and confusion will propagate into your own code, so be careful who you learn from. Another source of programs are CoffeeScript projects hosted on open source services such as <a class="URL" href="https://github.com/">github</a>.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-3"></a>Basic CoffeeScript:<br>
values, variables, and control flow<a class="Label" name="chap:Basic-CoffeeScript"> </a>
</h1>
<div class="Standard">
Inside the computer’s world, there is only data. That which is not data, does not exist. Although all data is in essence just a sequence of bits<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [D] </span><span class="HoverFoot"><span class="SupFootMarker"> [D] </span>Bits are any kinds of two-valued things, usually described as <div class="listing">
<pre class="listing">0
</pre>
</div>
s and <div class="listing">
<pre class="listing">1
</pre>
</div>
s. Inside the computer, they take forms like a high or low electrical charge, a strong or weak signal, a shiny or dull spot on the surface of a CD.</span></span>, and is thus fundamentally alike, every piece of data plays its own role. In CoffeeScript’s system, most of this data is neatly separated into things called value<a class="IndexReference" name="entry-value-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-value">↓</a>s. Every value has a type, which determines the kind of role it can play. There are six basic types of values: Numbers, strings, booleans, objects, functions, and undefined values.
</div>
<div class="Standard">
To create a value, one must merely invoke its name. This is very convenient. You do not have to gather building material for your values, or pay for them, you just call for one and <i>woosh</i>, you have it. They are not created from thin air, of course. Every value has to be stored somewhere, and if you want to use a gigantic amount of them at the same time you might run out of computer memory. Fortunately, this is only a problem if you need them all simultaneously. As soon as you no longer use a value, it will dissipate, leaving behind only a few bits. These bits are recycled to make the next generation of values.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Values of the type number<a class="IndexReference" name="entry-number-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-number">↓</a> are, as you might have deduced, numeric values. They are written the way numbers are usually written:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">144
</pre>
</div>

</div>
<div class="Standard">
Enter that in the console, and the same thing is printed in the output window. The text you typed in gave rise to a number value, and the console took this number and wrote it out to the screen again. In a case like this, that was a rather pointless exercise, but soon we will be producing values in less straightforward ways, and it can be useful to ‘try them out’ on the console to see what they produce.
</div>
<div class="Standard">
This is what <div class="listing">
<pre class="listing">144
</pre>
</div>
 looks like in bits<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [E] </span><span class="HoverFoot"><span class="SupFootMarker"> [E] </span>If you were expecting something like <div class="listing">
<pre class="listing">10010000
</pre>
</div>
 here — good call, but read on. CoffeeScript’s numbers are not stored as integers.</span></span>: <div class="listing">
<pre class="listing">01000000 01100010 00000000 00000000 00000000 00000000 00000000 00000000
</pre>
</div>

</div>
<div class="Standard">
The number above has 64 bits. Numbers in CoffeeScript always do. This has one important repercussion: There is a limited amount of different numbers that can be expressed. With three decimal digits, only the numbers 0 to 999 can be written, which is 10<sup>3</sup> = 1000 different numbers. With 64 binary digits, 2<sup>64</sup> different numbers can be written. This is a lot, more than 10<sup>19</sup> (a one with nineteen zeroes).
</div>
<div class="Standard">
Not all whole numbers below 10<sup>19</sup> fit in a CoffeeScript number though. For one, there are also negative numbers, so one of the bits has to be used to store the sign of the number. A bigger issue is that non-whole numbers must also be represented. To do this, 11 bits are used to store the position of the decimal dot within the number.
</div>
<div class="Standard">
That leaves 52 bits<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [F] </span><span class="HoverFoot"><span class="SupFootMarker"> [F] </span>Actually, 53, because of a trick that can be used to get one bit for free. Look up the ‘IEEE 754’ format if you are curious about the details.</span></span>. Any whole number less than 2<sup>52</sup>, which is over 10<sup>15</sup>, will safely fit in a CoffeeScript number. In most cases, the numbers we are using stay well below that, so we do not have to concern ourselves with bits at all. Which is good. I have nothing in particular against bits, but you <i>do</i> need a terrible lot of them to get anything done. When at all possible, it is more pleasant to deal with bigger things.
</div>
<div class="Standard">
Fractional numbers are written by using a dot.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">9.81
</pre>
</div>

</div>
<div class="Standard">
For very big or very small numbers, one can also use ‘scientific’ notation by adding an <div class="listing">
<pre class="listing">e
</pre>
</div>
, followed by the exponent of the number:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">2.998e8
</pre>
</div>

</div>
<div class="Standard">
Which is 2.998 <span class="default"><span class="formula">⋅</span>10<sup>8</sup> = 299</span> <span class="default">800</span> <span class="default">000. </span>
</div>
<div class="Standard">
Calculations with whole numbers (also called integers) that fit in 52 bits are guaranteed to always be precise. Unfortunately, calculations with fractional numbers are generally not. Like <span class="formula"><i>π</i></span> (pi) can not be precisely expressed by a finite amount of decimal digits, many numbers lose some precision when only 64 bits are available to store them. This is a shame, but it only causes practical problems in very specific situations<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [G] </span><span class="HoverFoot"><span class="SupFootMarker"> [G] </span>An example of this, if <div class="listing">
<pre class="listing">p = 1/3
</pre>
</div>
 then <div class="listing">
<pre class="listing">6*p
</pre>
</div>
 is equal to <div class="listing">
<pre class="listing">2
</pre>
</div>
. However <div class="listing">
<pre class="listing">p+p+p+p+p+p
</pre>
</div>
 is not equal to <div class="listing">
<pre class="listing">2
</pre>
</div>
 because the minute rounding errors increase for every addition. This happens in the <div class="listing">
<pre class="listing">for
</pre>
</div>
 loop shown in the <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Foreword">Preface↑</a>. It is a general issue with floating point approximations and not a bug in CoffeeScript. A way of dealing with it is to test if a number is inside a narrow interval instead of testing for an exact match.</span></span>. The important thing is to be aware of it, and treat fractional digital numbers as approximations, not as precise values.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The main thing to do with numbers is arithmetic. Arithmetic operations such as addition or multiplication take two number values and produce a new number from them. Here is what they look like in CoffeeScript: <div class="listing">
<pre class="listing">100 + 4 * 11
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">+
</pre>
</div>
 and <div class="listing">
<pre class="listing">*
</pre>
</div>
 symbols are called operators. The first stands for addition, and the second for multiplication. Putting an operator between two values will apply<a class="IndexReference" name="entry-applying-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-applying">↓</a> it to those values, and produce a new value.
</div>
<div class="Standard">
Does the example mean ‘add 4 and 100, and multiply the result by 11’, or is the multiplication done before the adding? As you might have guessed, the multiplication happens first. But, as in mathematics, this can be changed by wrapping the addition in parentheses<a class="IndexReference" name="entry-()-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-()">↓</a>:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">(100 + 4) * 11
</pre>
</div>

</div>
<div class="Standard">
For subtraction, there is the <div class="listing">
<pre class="listing">-
</pre>
</div>
 operator, and division can be done with <div class="listing">
<pre class="listing">/
</pre>
</div>
. When operators appear together without parentheses, the order in which they are applied is determined by the precedence<a class="IndexReference" name="entry-precedence-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-precedence">↓</a> of the operators. The first example shows that multiplication has a higher precedence than addition. Division and multiplication always come before subtraction and addition. When multiple operators with the same precedence appear next to each other (<div class="listing">
<pre class="listing">1 - 1 + 1
</pre>
</div>
) they are applied left-to-right.
</div>
<div class="Standard">
Try to figure out what value this produces, and then run it to see if you were correct…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">115 * 4 - 4 + 88 / 2
</pre>
</div>
These rules of precedence are not something you should worry about. When in doubt, just add parentheses.
</div>
<div class="Standard">
There is one more arithmetic operator which is probably less familiar to you. The <div class="listing">
<pre class="listing">%
</pre>
</div>
 symbol is used to represent the modulo<a class="IndexReference" name="entry-modulo-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-modulo">↓</a> operation. <div class="listing">
<pre class="listing">X
</pre>
</div>
 modulo <div class="listing">
<pre class="listing">Y
</pre>
</div>
 is the remainder of dividing <div class="listing">
<pre class="listing">X
</pre>
</div>
 by <div class="listing">
<pre class="listing">Y
</pre>
</div>
. For example <div class="listing">
<pre class="listing">314 % 100
</pre>
</div>
 is <div class="listing">
<pre class="listing">14
</pre>
</div>
, <div class="listing">
<pre class="listing">10 % 3
</pre>
</div>
 is <div class="listing">
<pre class="listing">1
</pre>
</div>
, and <div class="listing">
<pre class="listing">144 % 12
</pre>
</div>
 is <div class="listing">
<pre class="listing">0
</pre>
</div>
. Modulo has the same precedence as multiplication and division.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The next data type is the string<a class="IndexReference" name="entry-string-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-string">↓</a>. Its use is not as evident from its name as with numbers, but it also fulfills a very basic role. Strings are used to represent text, the name supposedly derives from the fact that it strings together a bunch of characters. Strings are written by enclosing their content in quotes:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’Patch my boat with chewing gum.’
</pre>
</div>

</div>
<div class="Standard">
Almost anything can be put between quotes, and CoffeeScript will make a string value out of it. But a few characters are tricky. You can imagine how putting quotes between quotes might be hard.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’The programmer pondered: "0x2b or not 0x2b"’
</pre>
</div>

</div>
<div class="Standard">
CoffeeScript implements both single quoted and double quoted strings, which can be handy when you have only one kind of quote in a string.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">"Aha! It’s 43 if I’m not a bit off"
</pre>
</div>

</div>
<div class="Standard">
Double quoted strings can contain interpolated values, small snippets of CoffeeScript code between <div class="listing">
<pre class="listing">#{
</pre>
</div>
 and <div class="listing">
<pre class="listing">}
</pre>
</div>
. The code is evaluated and inserted into the string.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">"2 + 2 gives #{2 + 2}"
</pre>
</div>

</div>
<div class="Standard">
Newlines, the things you get when you press enter, can not be put between quotes in the normal form of strings. A string can span multiple lines to help avoid overly long lines in the program but the line breaks are not shown in the output.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’Imagine if this was a
 very long line of text’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
CoffeeScript has triple-quoted strings aka heredocs<a class="IndexReference" name="entry-heredocs-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-heredocs">↓</a> to make it easy to have strings that span multiple lines where the line breaks are preserved in the output. Indentation before the quotes are ignored so the following lines can be aligned nicely.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’’’First comes A
   then comes B’’’
</pre>
</div>

</div>
<div class="Standard">
The triple double quoted variant allows for interpolated values.
</div>
<div class="Standard"><div class="listing">
<pre class="listing">"""  1
   + 1
   —
     #{1 + 1}"""
</pre>
</div>

</div>
<div class="Standard">
Still to be able to have special characters in a string, the following trick is used: Whenever a backslash (‘<div class="listing">
<pre class="listing">\
</pre>
</div>
’) is found inside quoted text, it indicates that the character after it has a special meaning. A quote that is preceded by a backslash will not end the string, but be part of it. When an ‘<div class="listing">
<pre class="listing">n
</pre>
</div>
’ character occurs after a backslash, it is interpreted as a newline<a class="IndexReference" name="entry-newline-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-newline">↓</a>. Similarly, a ‘<div class="listing">
<pre class="listing">t
</pre>
</div>
’ after a backslash means a tab character.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’This is the first line\nAnd this is the second’
</pre>
</div>

</div>
<div class="Standard">
There are of course situations where you want a backslash in a string to be just a backslash, not a special code. If two backslashes follow each other, they will collapse right into each other, and only one will be left in the resulting string value:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’A newline character is written like \"\\n\".’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Strings can not be divided, multiplied, or subtracted. The <div class="listing">
<pre class="listing">+
</pre>
</div>
 operator <i>can</i> be used on them. It does not add, but it concatenates, it glues two strings together.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’con’ + ’cat’ + ’e’ + ’nate’
</pre>
</div>

</div>
<div class="Standard">
There are more ways of manipulating strings, but these are discussed later.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Not all operators are symbols, some are written as words. For example, the <div class="listing">
<pre class="listing">typeof
</pre>
</div>
 operator, which produces a string value naming the type of the value you give it.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">typeof 4.5
</pre>
</div>

</div>
<div class="Standard">
The other operators we saw all operated on two values, <div class="listing">
<pre class="listing">typeof
</pre>
</div>
 takes only one. Operators that use two values are called binary operators<a class="IndexReference" name="entry-binary-operator-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-binary-operator">↓</a>, while those that take one are called unary operators<a class="IndexReference" name="entry-unary-operator-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-unary-operator">↓</a>. The minus<a class="IndexReference" name="entry---0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index--">↓</a> operator can be used both as a binary and a unary operator<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [H] </span><span class="HoverFoot"><span class="SupFootMarker"> [H] </span>Note that there is no space between the unary minus and the value.</span></span>:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">-(10 - 2)
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Then there are values of the boolean<a class="IndexReference" name="entry-boolean-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-boolean">↓</a> type. There are two of these: <div class="listing">
<pre class="listing">true
</pre>
</div>
 and <div class="listing">
<pre class="listing">false
</pre>
</div>
. CoffeeScript has some aliases for them: <div class="listing">
<pre class="listing">true
</pre>
</div>
 can be written as <div class="listing">
<pre class="listing">yes
</pre>
</div>
 or <div class="listing">
<pre class="listing">on
</pre>
</div>
. <div class="listing">
<pre class="listing">false
</pre>
</div>
 as <div class="listing">
<pre class="listing">no
</pre>
</div>
 or <div class="listing">
<pre class="listing">off
</pre>
</div>
. These alternatives can in some cases make a program easier to read. Here is one way to produce a <div class="listing">
<pre class="listing">true
</pre>
</div>
 value:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">3 &gt; 2
</pre>
</div>

</div>
<div class="Standard">
And <div class="listing">
<pre class="listing">false
</pre>
</div>
 can be produced like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">3 &lt; 2
</pre>
</div>
I hope you have seen the <div class="listing">
<pre class="listing">&gt;
</pre>
</div>
 and <div class="listing">
<pre class="listing">&lt;
</pre>
</div>
 signs before. They mean, respectively, ‘is greater than’ and ‘is less than’. They are binary operators, and the result of applying them is a boolean value that indicates whether they hold in this case. You can chain comparisons<a class="IndexReference" name="entry-chained-comparison-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-chained-comparison">↓</a> to test if something is within an interval. These comparisons give respectively <div class="listing">
<pre class="listing">true
</pre>
</div>
 and <div class="listing">
<pre class="listing">false
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">100 &lt; 115 &lt; 200
100 &lt; 315 &lt; 200
</pre>
</div>
</div>
<div class="Standard">
Strings can be compared in the same way:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’Aardvark’ &lt; ’Zoroaster’
</pre>
</div>

</div>
<div class="Standard">
The way strings are ordered is more or less alphabetic. More or less… Uppercase letters are always ‘less’ than lowercase ones, so <div class="listing">
<pre class="listing">’Z’ &lt; ’a’
</pre>
</div>
 is <div class="listing">
<pre class="listing">true
</pre>
</div>
, and non-alphabetic characters (‘<div class="listing">
<pre class="listing">!
</pre>
</div>
’, ‘<div class="listing">
<pre class="listing">@
</pre>
</div>
’, etc) are also included in the ordering. The actual way in which the comparison is done is based on the Unicode<a class="IndexReference" name="entry-Unicode-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Unicode">↓</a> standard. This standard assigns a number to virtually every character one would ever need, including characters from Greek, Arabic, Japanese, Tamil, and so on. Having such numbers is practical for storing strings inside a computer — you can represent them as a list of numbers. When comparing strings, CoffeeScript just compares the numbers of the characters inside the string, from left to right.
</div>
<div class="Standard">
Other similar operators are <div class="listing">
<pre class="listing">&gt;=
</pre>
</div>
 (‘is greater than or equal to’), <div class="listing">
<pre class="listing">&lt;=
</pre>
</div>
 (‘is less than or equal to’), <div class="listing">
<pre class="listing">==
</pre>
</div>
 (‘is equal to’), and <div class="listing">
<pre class="listing">!=
</pre>
</div>
 (‘is not equal to’). Equal to can also be written in text as <div class="listing">
<pre class="listing">is
</pre>
</div>
 and not equal to as <div class="listing">
<pre class="listing">isnt
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’Itchy’ isnt ’Scratchy’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There are also some useful operations that can be applied to boolean values themselves. CoffeeScript supports three logical operators: <div class="listing">
<pre class="listing">and
</pre>
</div>
, <div class="listing">
<pre class="listing">or
</pre>
</div>
, and <div class="listing">
<pre class="listing">not
</pre>
</div>
. These can be used to ‘reason’ about booleans.
</div>
<div class="Standard">
The logical <div class="listing">
<pre class="listing">and
</pre>
</div>
 operator can also be written as <div class="listing">
<pre class="listing">&amp;&amp;
</pre>
</div>
. It is a binary operator, and its result is only <div class="listing">
<pre class="listing">true
</pre>
</div>
 if both of the values given to it are <div class="listing">
<pre class="listing">true
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">true and false
</pre>
</div>

</div>
<div class="Standard">
Logical <div class="listing">
<pre class="listing">or
</pre>
</div>
 with alias <div class="listing">
<pre class="listing">||
</pre>
</div>
, is <div class="listing">
<pre class="listing">true
</pre>
</div>
 if either of the values given to it is <div class="listing">
<pre class="listing">true
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">true or false
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">not
</pre>
</div>
 can be written as an exclamation mark, <div class="listing">
<pre class="listing">!
</pre>
</div>
, it is a unary operator that flips the value given to it, <div class="listing">
<pre class="listing">!true
</pre>
</div>
 is <div class="listing">
<pre class="listing">false
</pre>
</div>
, and <div class="listing">
<pre class="listing">not false
</pre>
</div>
 is <div class="listing">
<pre class="listing">true
</pre>
</div>
.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 1</i></span></span><br><span class="default"><div class="listing">
<pre class="listing">((4 &gt;= 6) || (’grass’ != ’green’)) &amp;&amp;
!(((12 * 2) == 144) &amp;&amp; true)
</pre>
</div>
</span><div class="PlainVisible">
Is this true? For readability, there are a lot of unnecessary parentheses in there. This simple version means the same thing:
</div>
<div class="listing">
<pre class="listing">(4 &gt;= 6 or ’grass’ isnt ’green’) and
not(12 * 2 is 144 and true)
</pre>
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="PlainVisible">
Yes, it is <div class="listing">
<pre class="listing">true
</pre>
</div>
. You can reduce it step by step like this:
</div>
<div class="listing">
<pre class="listing">(false or true) and not(false and true)
true and not false
true
</pre>
</div>
<div class="Standard">
I hope you noticed that <div class="listing">
<pre class="listing">’grass’  != ’green’
</pre>
</div>
 is <div class="listing">
<pre class="listing">true
</pre>
</div>
. Grass may be green, but it is not equal to green.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
It is not always obvious when parentheses are needed. In practice, one can usually get by with knowing that of the operators we have seen so far, <div class="listing">
<pre class="listing">or
</pre>
</div>
 has the lowest precedence, then comes <div class="listing">
<pre class="listing">and
</pre>
</div>
, then the comparison operators (<div class="listing">
<pre class="listing">&gt;
</pre>
</div>
, <div class="listing">
<pre class="listing">==
</pre>
</div>
, etcetera), and then the rest. This has been chosen in such a way that, in simple cases, as few parentheses as possible are necessary.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
All the examples so far have used the language like you would use a pocket calculator. Make some values and apply operators to them to get new values. Creating values like this is an essential part of every CoffeeScript program, but it is only a part. A piece of code that produces a value is called an expression<a class="IndexReference" name="entry-expression-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-expression">↓</a>. Every value that is written directly (such as <div class="listing">
<pre class="listing">22
</pre>
</div>
 or <div class="listing">
<pre class="listing">’psychoanalysis’
</pre>
</div>
) is an expression. An expression between parentheses is also an expression. And a binary operator applied to two expressions, or a unary operator applied to one, is also an expression.
</div>
<div class="Standard">
There are a few more ways of building expressions, which will be revealed when the time is ripe.
</div>
<div class="Standard">
There exists a unit that is bigger than an expression. It is called a statement<a class="IndexReference" name="entry-statement-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-statement">↓</a>. A program is built as a list of statements. Most statements end with a newline, although a statement can stretch over many lines. Statements can also end with a semicolon<a class="IndexReference" name="entry-semicolon-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-semicolon">↓</a> (<div class="listing">
<pre class="listing">;
</pre>
</div>
). In CoffeeScript semicolon is mostly used if you want to place multiple statements on the same line. The simplest kind of statement is an expression with a semicolon after it. This is a program:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">1; !false
</pre>
</div>

</div>
<div class="Standard">
It is a useless program. An expression can be content to just produce a value, but a statement only amounts to something if it somehow changes the world. It could print something to the screen — that counts as changing the world — or it could change the internal state of the program in a way that will affect the statements that come after it. These changes are called ‘side effects<a class="IndexReference" name="entry-side-effect-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-side-effect">↓</a>’. The statements in the example above just produce the values <div class="listing">
<pre class="listing">1
</pre>
</div>
 and <div class="listing">
<pre class="listing">true
</pre>
</div>
, and then immediately throw them into the bit bucket<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [I] </span><span class="HoverFoot"><span class="SupFootMarker"> [I] </span>The bit bucket is supposedly the place where old bits are kept. On some systems, the programmer has to manually empty it now and then. Fortunately, CoffeeScript comes with a fully-automatic bit-recycling system.</span></span>. This leaves no impression on the world at all, and is not a side effect.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
How does a program keep an internal state? How does it remember things? We have seen how to produce new values from old values, but this does not change the old values, and the new value has to be immediately used or it will dissipate again. To catch and hold values, CoffeeScript provides a thing called a variable<a class="IndexReference" name="entry-variable-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-variable">↓</a>.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">caught = 5 * 5
</pre>
</div>

</div>
<div class="Standard">
A variable always has a name, and it can point at a value, holding on to it. The statement above creates a variable called <div class="listing">
<pre class="listing">caught
</pre>
</div>
 and uses it to grab hold of the number that is produced by multiplying <div class="listing">
<pre class="listing">5
</pre>
</div>
 by <div class="listing">
<pre class="listing">5
</pre>
</div>
.
</div>
<div class="Standard">
After running the above program, you can type the word <div class="listing">
<pre class="listing">caught
</pre>
</div>
 into the console, and it will retrieve the value <div class="listing">
<pre class="listing">25
</pre>
</div>
 for you. The name of a variable is used to fetch its value. <div class="listing">
<pre class="listing">caught + 1
</pre>
</div>
 also works. A variable name can be used as an expression, and thus can be part of bigger expressions.
</div>
<div class="Standard">
Assigning a value to a new variable name with the <div class="listing">
<pre class="listing">=
</pre>
</div>
 operator, creates the new variable. Variable names can be almost every word, but they may not include spaces. Digits can be part of variable names, <div class="listing">
<pre class="listing">catch22
</pre>
</div>
 is a valid name, but the name must not start with one. The characters ‘<div class="listing">
<pre class="listing">$
</pre>
</div>
’ and ‘<div class="listing">
<pre class="listing">_
</pre>
</div>
’ can be used in names as if they were letters, so <div class="listing">
<pre class="listing">$_$
</pre>
</div>
 is a correct variable name.
</div>
<div class="Standard">
When a variable points at a value, that does not mean it is tied to that value forever. At any time, the <div class="listing">
<pre class="listing">=
</pre>
</div>
 operator can be used on existing variables to yank them away from their current value and make them point to a new one.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">caught = 4 * 4
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
You should imagine variables as tentacles, rather than boxes. They do not <i>contain</i> values, they <i>grasp</i> them — two variables can refer to the same value. Only the values that the program still has a hold on can be accessed by it. When you need to remember something, you grow a tentacle to hold on to it, or re-attach one of your existing tentacles to a new value: To remember the amount of dollars that Luigi still owes you, you could do…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">luigiDebt = 140
</pre>
</div>

</div>
<div class="Standard">
Then, every time Luigi pays something back, this amount can be decremented by giving the variable a new number:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">luigiDebt = luigiDebt - 35
</pre>
</div>

</div>
<div class="Standard">
The collection of variables and their values that exist at a given time is called the environment<a class="IndexReference" name="entry-environment-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-environment">↓</a>. When a program starts up, this environment is not empty. It always contains a number of standard variables. When you use <div class="listing">
<pre class="listing">coffee
</pre>
</div>
 to execute a CoffeeScript program or run the interactive environment with <div class="listing">
<pre class="listing">coffee -r ./prelude
</pre>
</div>
 then the environment is called <div class="listing">
<pre class="listing">global
</pre>
</div>
. You can view it by typing: <span class="formula"> →∣</span> / ‘Tab’. When your browser loads a page, it creates a new environment called <div class="listing">
<pre class="listing">window
</pre>
</div>
 and attaches these standard values to it. The variables created and modified by programs on that page survive until the browser goes to a new page.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A lot of the values provided by the standard environment have the type ‘function’<a class="IndexReference" name="entry-function-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-function">↓</a>. A function is a piece of program wrapped in a value. Generally, this piece of program does something useful, which can be evoked using the function value that contains it. In the development environment, the variable <div class="listing">
<pre class="listing">show
</pre>
</div>
<a class="IndexReference" name="entry-show-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-show">↓</a> holds a function that shows a message in the terminal or command line window. You can use it like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show ’Also, your hair is on fire.’
</pre>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-()-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-()">↓</a>Executing the code in a function is called invoking<a class="IndexReference" name="entry-invoking-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-invoking">↓</a> or applying<a class="IndexReference" name="entry-applying-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-applying">↓</a> it. The notation for doing this is the function name followed by parentheses or a comma separated list of values. Every expression that produces a function value can be invoked by putting parentheses after it. The parentheses can be left out when values are passed. The string value is given to the function, which uses it as the text to show in the console window. Values given to functions are called parameters<a class="IndexReference" name="entry-parameter-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-parameter">↓</a> or arguments<a class="IndexReference" name="entry-argument-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-argument">↓</a>. <div class="listing">
<pre class="listing">show
</pre>
</div>
 needs only one of them, but other functions might need a different number.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Showing a message is a side effect. A lot of functions are useful because of the side effects they produce. It is also possible for a function to produce a value, in which case it does not need to have a side effect to be useful. For example, there is a function <div class="listing">
<pre class="listing">Math.max
</pre>
</div>
<a class="IndexReference" name="entry-Math.max-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.max">↓</a>, which takes two arguments and gives back the biggest of the two:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show Math.max 2, 4
</pre>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-Math.max-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.max">↓</a>When a function produces a value, it is said to return<a class="IndexReference" name="entry-return-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-return">↓</a> it. Because things that produce values are always expressions in CoffeeScript, function calls can be used as a part of bigger expressions:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show 100 + Math.max 7, 4
show Math.max(7, 4) + 100
show Math.max(7, 4 + 100)
show Math.max 7, 4 + 100
</pre>
</div>

</div>
<div class="Standard">
When parentheses are left out from a function call then CoffeeScript implicitly inserts them stretching to the end of the line. In the example above it means that the first two lines gives the answer <div class="listing">
<pre class="listing">107
</pre>
</div>
 and the last two <div class="listing">
<pre class="listing">104
</pre>
</div>
. So depending on your intention you may have to use parentheses to get the result you want. <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functions"><span class="sans">Functions</span>↓</a> discusses writing your own functions.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
As the previous examples illustrated, <div class="listing">
<pre class="listing">show
</pre>
</div>
 can be useful for showing the result of an expression. <div class="listing">
<pre class="listing">show
</pre>
</div>
 is not a standard CoffeeScript function, browsers do not provide it for you, it is made available by the <span class="sans">Smooth CoffeeScript</span> prelude. When you are working in a web browser, you have a different environment and can instead use <div class="listing">
<pre class="listing">alert
</pre>
</div>
 to pop up a dialog with a message.
</div>
<div class="Standard">
We will continue in the CoffeeScript environment. <div class="listing">
<pre class="listing">show
</pre>
</div>
<a class="IndexReference" name="entry-show-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-show">↓</a> tries to display its argument the way it would look in a program, which can give more information about the type of a value. In an interactive console, started with <div class="listing">
<pre class="listing">coffee -r ./prelude
</pre>
</div>
, you can explore the environment:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show process
show console
show _
show show
</pre>
</div>

</div>
<div class="Standard">
What the output means is not so important for now. <div class="listing">
<pre class="listing">show
</pre>
</div>
 is a tool that can give you details on the things in your programs, which can be handy later, if something does not behave the way you had expected.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The environment provided by browsers contains a few more functions for popping up windows. You can ask the user an OK/Cancel question using <div class="listing">
<pre class="listing">confirm
</pre>
</div>
<a class="IndexReference" name="entry-confirm-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-confirm">↓</a>. This returns a boolean, <div class="listing">
<pre class="listing">true
</pre>
</div>
 if the user presses ‘OK’, and <div class="listing">
<pre class="listing">false
</pre>
</div>
 if he presses ‘Cancel’. The prelude has a similar <div class="listing">
<pre class="listing">confirm
</pre>
</div>
 function where the user is asked yes or no to the question.
</div>
<div class="Standard">
Since the CoffeeScript environment is optimized to run as a server, it does not wait for the user to reply. Instead it continues running the code following the function call. Eventually when the user has answered the question, then a function given as an argument is called with the answer. This piece of code involves a bit of magic, that will be explained in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functions"><span class="sans">Functions</span>↓</a>. While it is more complicated for this use, we will in later chapters see that it makes perfect sense for a web application with many users.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">confirm ’Shall we, then?’, (answer) -&gt; show answer
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prompt
</pre>
</div>
<a class="IndexReference" name="entry-prompt-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-prompt">↓</a><a class="Label" name="prompt"> </a> can be used to ask an ‘open’ question. The first argument is the question, the second one is the text that the user starts with. A line of text can be typed into the window, and the function will — in a browser — return this as a string. As with <div class="listing">
<pre class="listing">confirm
</pre>
</div>
 the prelude offers a similar function, that takes a third argument which will receive the answer.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prompt ’Tell us everything you know.’, ’...’,
  (answer) -&gt; show ’So you know: ’ + answer
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
It is possible to give almost every variable in the environment a new value. This can be useful, but also dangerous. If you give <div class="listing">
<pre class="listing">show
</pre>
</div>
 the value <div class="listing">
<pre class="listing">8
</pre>
</div>
, you will not be able to show things anymore. Some functions like <div class="listing">
<pre class="listing">confirm
</pre>
</div>
 and <div class="listing">
<pre class="listing">prompt
</pre>
</div>
 works when you run your program from a file, but interact poorly with the interactive environment. Fortunately, you can stop a program with <div class="listing">
<pre class="listing">CTRL-C
</pre>
</div>
 and pick up where you left off.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
One-line programs are not very interesting. When you put more than one statement into a program, the statements are, predictably, executed one at a time, from top to bottom.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prompt ’Pick a number’, ’’, (answer) -&gt;
  theNumber = Number answer
  show ’Your number is the square root of ’ +
    (theNumber * theNumber)
</pre>
</div>

</div>
<div class="Standard">
The function <div class="listing">
<pre class="listing">Number
</pre>
</div>
<a class="IndexReference" name="entry-Number-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Number">↓</a> converts a value to a number, which is needed in this case because the answer from <div class="listing">
<pre class="listing">prompt
</pre>
</div>
 is a string value. There are similar functions called <div class="listing">
<pre class="listing">String
</pre>
</div>
<a class="IndexReference" name="entry-String-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-String">↓</a> and <div class="listing">
<pre class="listing">Boolean
</pre>
</div>
<a class="IndexReference" name="entry-Boolean-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Boolean">↓</a> which convert values to those types.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Consider a program that prints out all even numbers from 0 to 12. One way to write this is:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show 0
show 2
show 4
show 6
show 8
show 10
show 12
</pre>
</div>

</div>
<div class="Standard">
That works, but the idea of writing a program is to make something <i>less</i> work, not more. If we needed all even numbers below 1000, the above would be unworkable. What we need is a way to automatically repeat some code.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">currentNumber = 0
while currentNumber &lt;= 12
  show currentNumber
  currentNumber = currentNumber + 2
</pre>
</div>

</div>
<div class="Standard">
You may have seen <div class="listing">
<pre class="listing">while
</pre>
</div>
<a class="IndexReference" name="entry-while-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-while">↓</a> in the <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Introduction"><span class="sans">Introduction</span>↑</a> chapter. A statement starting with the word <div class="listing">
<pre class="listing">while
</pre>
</div>
 creates a loop<a class="IndexReference" name="entry-loop-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-loop">↓</a>. A loop is a disturbance in the sequence of statements, it may cause the program to repeat some statements multiple times. In this case, the word <div class="listing">
<pre class="listing">while
</pre>
</div>
 is followed by an expression, which is used to determine whether the loop will loop or finish. As long as the boolean value produced by this expression is <div class="listing">
<pre class="listing">true
</pre>
</div>
, the code in the loop is repeated. As soon as it is false, the program goes to the bottom of the loop and continues as normal.
</div>
<div class="Standard">
The variable <div class="listing">
<pre class="listing">currentNumber
</pre>
</div>
 demonstrates the way a variable can track the progress of a program. Every time the loop repeats, it is incremented by <div class="listing">
<pre class="listing">2
</pre>
</div>
, and at the beginning of every repetition, it is compared with the number <div class="listing">
<pre class="listing">12
</pre>
</div>
 to decide whether to keep on looping.
</div>
<div class="Standard">
The third part of a <div class="listing">
<pre class="listing">while
</pre>
</div>
 statement is another statement. This is the body<a class="IndexReference" name="entry-body-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-body">↓</a> of the loop, the action or actions that must take place multiple times. Indentation<a class="IndexReference" name="entry-indentation-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-indentation">↓</a> is used to group statements into blocks<a class="IndexReference" name="entry-block-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-block">↓</a>. To the world outside the block, a block counts as a single statement. In the example, this is used to include in the loop both the call to <div class="listing">
<pre class="listing">show
</pre>
</div>
 and the statement that updates <div class="listing">
<pre class="listing">currentNumber
</pre>
</div>
.
</div>
<div class="Standard">
If we did not have to print the numbers, the program could have been:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">counter = 0
​
while counter &lt;= 12 then counter = counter + 2
</pre>
</div>

</div>
<div class="Standard">
Here, <div class="listing">
<pre class="listing">counter = counter + 2
</pre>
</div>
 is the statement that forms the body of the loop. The <div class="listing">
<pre class="listing">then
</pre>
</div>
 keyword separates the boolean from the body, so both can be on the same line.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 2</i></span></span><br><span class="default"><a class="Label" name="sub:Exercisepower2"> </a></span><div class="PlainVisible">
Use the techniques shown so far to write a program that calculates and shows the value of 2<sup>10</sup> (2 to the 10th power). You are, obviously, not allowed to use a cheap trick like just writing <div class="listing">
<pre class="listing">2 * 2 * ...
</pre>
</div>

</div>
<div class="PlainVisible">
If you are having trouble with this, try to see it in terms of the even-numbers example. The program must perform an action a certain amount of times. A counter variable with a <div class="listing">
<pre class="listing">while
</pre>
</div>
 loop can be used for that. Instead of printing the counter, the program must multiply something by 2. This something should be another variable, in which the result value is built up.
</div>
<div class="PlainVisible">
Do not worry if you do not quite see how this would work yet. Even if you perfectly understand all the techniques this chapter covers, it can be hard to apply them to a specific problem. Reading and writing code will help develop a feeling for this, so study the solution, and try the next exercise.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><span class="default"><div class="listing">
<pre class="listing">result = 1
counter = 0
while counter &lt; 10
  result = result * 2
  counter = counter + 1
show result
</pre>
</div>
</span><div class="PlainVisible">
The counter could also start at <div class="listing">
<pre class="listing">1
</pre>
</div>
 and check for <div class="listing">
<pre class="listing">&lt;= 10
</pre>
</div>
, but, for reasons that will become apparent later on, it is a good idea to get used to counting from 0.
</div>
<div class="PlainVisible">
Obviously, your own solutions are not required to be precisely the same as mine. They should work. And if they are very different, make sure you also understand my solution.
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 3</i></span></span><br><div class="PlainVisible">
With some slight modifications, the solution to the previous exercise can be made to draw a triangle. And when I say ‘draw a triangle’ I mean ‘print out some text that almost looks like a triangle when you squint’.
</div>
<div class="PlainVisible">
Print out ten lines. On the first line there is one ‘#’ character. On the second there are two. And so on.
</div>
<div class="PlainVisible">
How does one get a string with X ‘#’ characters in it? One way is to build it every time it is needed with an ‘inner loop’ — a loop inside a loop. A simpler way is to reuse the string that the previous iteration of the loop used, and add one character to it.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><span class="default"><div class="listing">
<pre class="listing">line = ’’
counter = 0
while counter &lt; 10
  line = line + ’#’
  show line
  counter = counter + 1
</pre>
</div>
</span>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
You will have noticed the spaces I put in front of some statements. These are required: The level of indentation decides which block a line belongs to. The role of the indentation<a class="IndexReference" name="entry-indentation-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-indentation">↓</a> inside blocks is to make the structure of the code clearer to a reader. Because new blocks can be opened inside other blocks, it can become hard to see where one block ends and another begins if they were not indented. When lines are indented, the visual shape of a program corresponds to the shape of the blocks inside it. I like to use two spaces for every open block, but tastes differ. If a line becomes too long, then you can split it between two words or place a <div class="listing">
<pre class="listing">\
</pre>
</div>
 at the end of the line and continue on the next.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The uses of <div class="listing">
<pre class="listing">while
</pre>
</div>
 we have seen so far all show the same pattern. First, a ‘counter’ variable is created. This variable tracks the progress of the loop. The <div class="listing">
<pre class="listing">while
</pre>
</div>
 itself contains a check, usually to see whether the counter has reached some boundary yet. Then, at the end of the loop body, the counter is updated.
</div>
<div class="Standard">
A lot of loops fall into this pattern. For this reason, CoffeeScript, and similar languages, also provide a slightly shorter and more comprehensive form:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for number in [0..12] by 2 then show number
</pre>
</div>

</div>
<div class="Standard">
This program is exactly equivalent to the earlier even-number-printing example. The only change is that all the statements that are related to the ‘state’ of the loop are now on one line. The numbers in square brackets are a range<a class="IndexReference" name="entry-range-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-range">↓</a> <div class="listing">
<pre class="listing">[4..7]
</pre>
</div>
, a list of numbers starting from the first number and going up one by one to the last. A range with two dots includes the last number in the list <div class="listing">
<pre class="listing">(4,5,6,7)
</pre>
</div>
, with three dots <div class="listing">
<pre class="listing">[4...7]
</pre>
</div>
 the last number is excluded <div class="listing">
<pre class="listing">(4,5,6)
</pre>
</div>
. The amount of each step can be changed with the <div class="listing">
<pre class="listing">by
</pre>
</div>
 keyword. So <div class="listing">
<pre class="listing">[2..6] by 2
</pre>
</div>
 gives the list <div class="listing">
<pre class="listing">(2,4,6)
</pre>
</div>
. Ranges can also decrement if the first number is largest, or involve negative numbers or floating point numbers.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">number
</pre>
</div>
 in the <div class="listing">
<pre class="listing">for
</pre>
</div>
<a class="IndexReference" name="entry-for-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-for">↓</a> comprehension take on each successive value from the range during each turn through the loop. The <div class="listing">
<pre class="listing">number
</pre>
</div>
 value is then available in the loop body where it can be used in computations or as here in <div class="listing">
<pre class="listing">show number
</pre>
</div>
. In most cases this is shorter and clearer than a <div class="listing">
<pre class="listing">while
</pre>
</div>
 construction.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">for
</pre>
</div>
 comprehension can take on other forms as well. One is that the body of the loop can be given before the for statement.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># For with indented body
for number in [0..12] by 2
  show number
​
# For with prepended body
show number for number in [0..12] by 2
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The lines that starts with ‘#’ in the previous example might have looked a bit suspicious to you. It is often useful to include extra text in a program. The most common use for this is adding some explanations in human language to a program.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># The variable counter, which is about to be defined,
# is going to start with a value of 0, which is zero.
counter = 0
# Now, we are going to loop, hold on to your hat.
while  counter &lt; 100 # counter is less than one hundred
  ###
  Every time we loop, we INCREMENT the value of counter
  Seriously, we just add one to it.
  ###
  counter++
# And then, we are done.
</pre>
</div>

</div>
<div class="Standard">
This kind of text is called a comment<a class="IndexReference" name="entry-comment-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-comment">↓</a>. The rules are like this: ‘<div class="listing">
<pre class="listing">#
</pre>
</div>
’ starts a comment, which goes on until the end of the line. ‘<div class="listing">
<pre class="listing">###
</pre>
</div>
’ starts another kind of comment that goes on until a ‘<div class="listing">
<pre class="listing">###
</pre>
</div>
’ is found so it can stretch over multiple lines.
</div>
<div class="Standard">
As you can see, even the simplest programs can be made to look big, ugly, and complicated by simply adding a lot of comments to them.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
I have been using some rather odd capitalisation<a class="IndexReference" name="entry-capitalisation-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-capitalisation">↓</a> in some variable names. Because you can not have spaces in these names — the computer would read them as two separate variables — your choices for a name that is made of several words are more or less limited to the following:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">  fuzzylittleturtle                 FuzzyLittleTurtle
  fuzzy_little_turtle               fuzzyLittleTurtle
</pre>
</div>

</div>
<div class="Standard">
The first one is hard to read. Personally, I like the one with the underscores, though it is a little painful to type. However, since CoffeeScript evolved from JavaScript, most CoffeeScript programmers follow the JavaScript convention with the last one. Its the one used by the standard JavaScript functions. It is not hard to get used to little things like that, so I will just follow the crowd and capitalise the first letter of every word after the first.
</div>
<div class="Standard">
In a few cases, such as the <div class="listing">
<pre class="listing">Number
</pre>
</div>
 function, the first letter of a variable is also capitalised. This was done to mark this function as a constructor. What a constructor is will become clear in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>. For now, the important thing is not to be bothered by this apparent lack of consistency.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Note that names that have a special meaning, such as <div class="listing">
<pre class="listing">while
</pre>
</div>
, and <div class="listing">
<pre class="listing">for
</pre>
</div>
 may not be used as variable names. These are called keywords<a class="IndexReference" name="entry-keyword-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-keyword">↓</a>. There are also a number of <a class="IndexReference" name="entry-reserved-words-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-reserved-words">↓</a>words which are ‘reserved for use’ in future versions of JavaScript and CoffeeScript. These are also officially not allowed to be used as variable names, though some environments do allow them. The full list in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#sub:Reserved-Words">Reserved Words↓</a> is rather long.
</div>
<div class="Standard">
Do not worry about memorising these for now, but remember that this might be the problem when something does not work as expected. In my experience, <div class="listing">
<pre class="listing">char
</pre>
</div>
 (to store a one-character string) and <div class="listing">
<pre class="listing">class
</pre>
</div>
<a class="IndexReference" name="entry-class-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-class">↓</a> are the most common names to accidentally use.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 4</i></span></span><br><div class="PlainVisible">
Rewrite the solutions of the previous two exercises to use <div class="listing">
<pre class="listing">for
</pre>
</div>
 instead of <div class="listing">
<pre class="listing">while
</pre>
</div>
.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">result = 1
for counter in [0...10]
  result = result * 2
show result
</pre>
</div>
<div class="Standard">
Note the use of the exclusive range and that — as required by CoffeeScript — the statement in the loop is indented two spaces which make it clear that it ‘belongs’ to the line above it.<div class="listing">
<pre class="listing">line = ’’
for counter in [0...10]
  line = line + ’#’
  show line
</pre>
</div>
</div>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-+=-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-+=">↓</a><a class="IndexReference" name="entry--=-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index--=">↓</a><a class="IndexReference" name="entry-/=-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-/=">↓</a><a class="IndexReference" name="entry-*=-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-*=">↓</a>A program often needs to ‘update’ a variable with a value that is based on its previous value. For example <div class="listing">
<pre class="listing">counter = counter + 1
</pre>
</div>
. CoffeeScript provides a shortcut for this: <div class="listing">
<pre class="listing">counter += 1
</pre>
</div>
. This also works for many other operators, for example <div class="listing">
<pre class="listing">result *= 2
</pre>
</div>
 to double the value of <div class="listing">
<pre class="listing">result
</pre>
</div>
, or <div class="listing">
<pre class="listing">counter -= 1
</pre>
</div>
 to count downwards. <div class="listing">
<pre class="listing">counter++
</pre>
</div>
 and <div class="listing">
<pre class="listing">counter--
</pre>
</div>
 <a class="IndexReference" name="entry-++-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-++">↓</a><a class="IndexReference" name="entry---0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index--">↓</a> are shorter versions of <div class="listing">
<pre class="listing">counter += 1
</pre>
</div>
 and <div class="listing">
<pre class="listing">counter -= 1
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Loops are said to affect the control flow<a class="IndexReference" name="entry-control-flow-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-control-flow">↓</a> of a program. They change the order in which statements are executed. In many cases, another kind of flow is useful: skipping statements.
</div>
<div class="Standard">
We want to show all numbers between 0 and 20 which are divisible both by 3 and by 4.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for counter in [0..20]
  if counter % 3 == 0 and counter % 4 == 0
    show counter
</pre>
</div>

</div>
<div class="Standard">
The keyword <div class="listing">
<pre class="listing">if
</pre>
</div>
<a class="IndexReference" name="entry-if-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-if">↓</a> is not too different from the keyword <div class="listing">
<pre class="listing">while
</pre>
</div>
: It checks the condition it is given, and executes the statement after it based on this condition. But it does this only once, so that the statement is executed zero or one time.
</div>
<div class="Standard">
The trick with the modulo (<div class="listing">
<pre class="listing">%
</pre>
</div>
<a class="IndexReference" name="entry-%-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-%">↓</a>) operator is an easy way to test whether a number is divisible by another number. If it is, the remainder of their division, which is what modulo gives you, is zero.
</div>
<div class="Standard">
If we wanted to print all of the numbers between 0 and 20, but put parentheses around the ones that are not divisible by 4, we can do it like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for counter in [0..20]
  if counter % 4 == 0
    show counter
  if counter % 4 != 0
    show ’(’ + counter + ’)’
</pre>
</div>

</div>
<div class="Standard">
But now the program has to determine whether <div class="listing">
<pre class="listing">counter
</pre>
</div>
 is divisible by <div class="listing">
<pre class="listing">4
</pre>
</div>
 two times. The same effect can be gotten by appending an <div class="listing">
<pre class="listing">else
</pre>
</div>
 part after an <div class="listing">
<pre class="listing">if
</pre>
</div>
 statement. The <div class="listing">
<pre class="listing">else
</pre>
</div>
<a class="IndexReference" name="entry-else-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-else">↓</a> statement is executed only when the <div class="listing">
<pre class="listing">if
</pre>
</div>
’s condition is false.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for counter in [0..20]
  if counter % 4 == 0
    show counter
  else
    show ’(’ + counter + ’)’
</pre>
</div>

</div>
<div class="Standard">
To stretch this trivial example a bit further, we now want to print these same numbers, but add two stars after them when they are greater than 15, one star when they are greater than 10 (but not greater than 15), and no stars otherwise.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for counter in [0..20]
  if counter &gt; 15
    show counter + ’**’
  else if counter &gt; 10
    show counter + ’*’
  else
    show counter
</pre>
</div>

</div>
<div class="Standard">
This demonstrates that you can chain <div class="listing">
<pre class="listing">if
</pre>
</div>
 statements together. In this case, the program first looks if <div class="listing">
<pre class="listing">counter
</pre>
</div>
 is greater than <div class="listing">
<pre class="listing">15
</pre>
</div>
. If it is, the two stars are printed and the other tests are skipped. If it is not, we continue to check if <div class="listing">
<pre class="listing">counter
</pre>
</div>
 is greater than <div class="listing">
<pre class="listing">10
</pre>
</div>
. Only if <div class="listing">
<pre class="listing">counter
</pre>
</div>
 is also not greater than <div class="listing">
<pre class="listing">10
</pre>
</div>
 does it arrive at the last <div class="listing">
<pre class="listing">show
</pre>
</div>
 statement.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 5</i></span></span><br><div class="PlainVisible">
Write a program to ask yourself, using <div class="listing">
<pre class="listing">prompt
</pre>
</div>
, what the value of 2 + 2 is. If the answer is ‘4’, use <div class="listing">
<pre class="listing">show
</pre>
</div>
 to say something praising. If it is ‘3’ or ‘5’, say ‘Almost!’. In other cases, say something mean. Refer back to page <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#prompt">1↑</a> for the little bit of magic needed with <div class="listing">
<pre class="listing">prompt
</pre>
</div>
.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">prompt ’You! What is the value of 2 + 2?’, ’’,
  (answer) -&gt;
    if answer == ’4’
      show ’You must be a genius or something.’
    else if answer == ’3’ || answer == ’5’
      show ’Almost!’
    else
      show ’You are an embarrassment.’
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
The logic tests in a program can become complicated. To help write conditions clearly CoffeeScript provides a couple of variations on the <div class="listing">
<pre class="listing">if
</pre>
</div>
 statement: The body of an <div class="listing">
<pre class="listing">if
</pre>
</div>
 statement can be placed before the condition. And an <div class="listing">
<pre class="listing">if not
</pre>
</div>
 can be written as <div class="listing">
<pre class="listing">unless
</pre>
</div>
 <a class="IndexReference" name="entry-unless-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-unless">↓</a>. 
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">fun = on
show ’The show is on!’ unless fun is off
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When a loop does not always have to go all the way through to its end, the <div class="listing">
<pre class="listing">break
</pre>
</div>
<a class="IndexReference" name="entry-break-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-break">↓</a> keyword can be useful. It immediately jumps out of the current loop, continuing after it. This program finds the first number that is greater than 20 and divisible by 7:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">current = 20
loop
  if current % 7 == 0
    break
  current++
show current
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">loop
</pre>
</div>
<a class="IndexReference" name="entry-loop-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-loop">↓</a> construct does not have a part that checks for the end of the loop. It is the same as <div class="listing">
<pre class="listing">while true
</pre>
</div>
. This means that it is dependant on the <div class="listing">
<pre class="listing">break
</pre>
</div>
 statement inside it to ever stop. The same program could also have been written as simply…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">current = 20
current++ until current % 7 == 0
show current
</pre>
</div>

</div>
<div class="Standard">
In this case, the body of the loop comes before the loop test. The <div class="listing">
<pre class="listing">until
</pre>
</div>
<a class="IndexReference" name="entry-until-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-until">↓</a> keyword is similar to the <div class="listing">
<pre class="listing">unless
</pre>
</div>
 keyword, but translates into <div class="listing">
<pre class="listing">while not
</pre>
</div>
. The only effect of the loop is to increment the variable <div class="listing">
<pre class="listing">current
</pre>
</div>
 to its desired value. But I needed an example that uses <div class="listing">
<pre class="listing">break
</pre>
</div>
, so pay attention to the first version too.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 6</i></span></span><br><div class="PlainVisible">
Pick a lucky number from 1 to 6 then keep rolling a simulated die, until your lucky number comes up. Count the number of rolls. Use a loop and optionally a <div class="listing">
<pre class="listing">break
</pre>
</div>
. Casting a die can be simulated with: <div class="listing">
<pre class="listing">roll = Math.floor Math.random() * 6 + 1
</pre>
</div>

</div>
<div class="PlainVisible">
Note that <div class="listing">
<pre class="listing">loop
</pre>
</div>
 is the same as <div class="listing">
<pre class="listing">while true
</pre>
</div>
 and both can be used to create a loop that does not end on its own account. Writing <div class="listing">
<pre class="listing">while true
</pre>
</div>
 is a useful trick but a bit silly, you ask the program to loop as long as <div class="listing">
<pre class="listing">true
</pre>
</div>
 is <div class="listing">
<pre class="listing">true
</pre>
</div>
, so the preferred way is to write <div class="listing">
<pre class="listing">loop
</pre>
</div>
.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">luckyNumber = 5 # Choose from 1 to 6
show "Your lucky number is #{luckyNumber}"
count = 0
loop
  show roll = Math.floor Math.random() * 6 + 1
  count++
  if roll is luckyNumber then break
show "Luck took #{count} roll(s)"
</pre>
</div>
<div class="Standard">
Another solution, arguably nicer, without <div class="listing">
<pre class="listing">break
</pre>
</div>
 but abusing statistics:</div><div class="listing">
<pre class="listing">luckyNumber = 3 # Choose from 1 to 6
show ’Your lucky number is ’ + luckyNumber
count = 0
until roll is luckyNumber
  show roll = Math.floor Math.random() * 6 + 1
  count++
show ’You are lucky ’ +
    Math.floor(100/count) + ’% of the time’
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
In the second solution to the previous exercise <div class="listing">
<pre class="listing">roll
</pre>
</div>
 has not been set to a value the first time through the loop. It is only assigned a value in the next statement. What happens when you take the value of this variable?
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show mysteryVariable
mysteryVariable = ’nothing’
</pre>
</div>

</div>
<div class="Standard">
In terms of tentacles, this variable ends in thin air, it has nothing to grasp. When you ask for the value of an empty place, you get a special value named <div class="listing">
<pre class="listing">undefined
</pre>
</div>
<a class="IndexReference" name="entry-undefined-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-undefined">↓</a>. Functions which do not return an interesting value, such as the built-in function <div class="listing">
<pre class="listing">console.log
</pre>
</div>
 also return an <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 value. Most things in CoffeeScript return a value, even most statements. The prelude function <div class="listing">
<pre class="listing">show
</pre>
</div>
 return the value it is given, so it can be used within expressions.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show console.log ’I am a side effect.’
</pre>
</div>

</div>
<div class="Standard">
There is also a similar value, <div class="listing">
<pre class="listing">null
</pre>
</div>
<a class="IndexReference" name="entry-null-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-null">↓</a>, whose meaning is ‘this variable is defined, but it does not have a value’. The difference in meaning between <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 and <div class="listing">
<pre class="listing">null
</pre>
</div>
 is mostly academic, and usually not very interesting. In practical programs, it is often necessary to check whether something ‘has a value’. In these cases, the expression <div class="listing">
<pre class="listing">something?
</pre>
</div>
 may be used, the <div class="listing">
<pre class="listing">?
</pre>
</div>
<a class="IndexReference" name="entry-?-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-?">↓</a> is called the existential operator<a class="IndexReference" name="entry-existential-operator-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-existential-operator">↓</a>. It returns <div class="listing">
<pre class="listing">true
</pre>
</div>
 unless something is <div class="listing">
<pre class="listing">null
</pre>
</div>
 or <div class="listing">
<pre class="listing">undefined
</pre>
</div>
. It also comes in an existential assignment form <div class="listing">
<pre class="listing">?=
</pre>
</div>
 which will only assign to a variable that is either <div class="listing">
<pre class="listing">null
</pre>
</div>
 or <div class="listing">
<pre class="listing">undefined
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show iam ? undefined
iam ?= ’I want to be’
show iam
iam ?= ’I am already’
show iam if iam?
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Which brings us to another subject… If you have been exposed to JavaScript then you know that comparisons of different types can be tricky. 
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show false == 0
show ’’ == 0
show ’5’ == 5
</pre>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-type-conversion-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-type-conversion">↓</a>In JavaScript all these give the value <div class="listing">
<pre class="listing">true
</pre>
</div>
 — not so in CoffeeScript where they are all <div class="listing">
<pre class="listing">false
</pre>
</div>
. When comparing values that have different types, you have to convert them into compatible types first. We saw this earlier with <div class="listing">
<pre class="listing">Number
</pre>
</div>
 so <div class="listing">
<pre class="listing">Number(’5’) == 5
</pre>
</div>
 gives <div class="listing">
<pre class="listing">true
</pre>
</div>
. The behaviour of <div class="listing">
<pre class="listing">==
</pre>
</div>
 in CoffeeScript is the same as <div class="listing">
<pre class="listing">===
</pre>
</div>
 in JavaScript.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show `null === undefined`
show `false === 0`
show `’’ === 0`
show `’5’ === 5`
</pre>
</div>

</div>
<div class="Standard">
All these are <div class="listing">
<pre class="listing">false
</pre>
</div>
. You can embed JavaScript<a class="IndexReference" name="entry-embedded-JavaScript-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-embedded-JavaScript">↓</a> in CoffeeScript by surrounding the JavaScript code with backquotes<a class="IndexReference" name="entry-backquotes-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-backquotes">↓</a>. Using JavaScript when you have CoffeeScript is similar to embedding assembly language in a high-level language. It should be something you very rarely need to do.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There are some other situations that cause automatic type conversions<a class="IndexReference" name="entry-type-conversion-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-type-conversion">↓</a> to happen. If you add a non-string value to a string, the value is automatically converted to a string before it is concatenated. If you multiply a number and a string, CoffeeScript tries to make a number out of the string.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show ’Apollo’ + 5
show null + ’ify’
show ’5’ * 5
show ’strawberry’ * 5
</pre>
</div>

</div>
<div class="Standard">
The last statement prints <div class="listing">
<pre class="listing">NaN
</pre>
</div>
<a class="IndexReference" name="entry-NaN-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-NaN">↓</a>, which is a special value. It stands for ‘not a number’, and is of type number (which might sound a little contradictory). In this case, it refers to the fact that a strawberry is not a number. All arithmetic operations on the value <div class="listing">
<pre class="listing">NaN
</pre>
</div>
 result in <div class="listing">
<pre class="listing">NaN
</pre>
</div>
, which is why multiplying it by <div class="listing">
<pre class="listing">5
</pre>
</div>
, as in the example, still gives a <div class="listing">
<pre class="listing">NaN
</pre>
</div>
 value. Also, and this can be disorienting at times, <div class="listing">
<pre class="listing">NaN == NaN
</pre>
</div>
 equals <div class="listing">
<pre class="listing">false
</pre>
</div>
, checking whether a value is <div class="listing">
<pre class="listing">NaN
</pre>
</div>
 can be done with the <div class="listing">
<pre class="listing">isNaN
</pre>
</div>
<a class="IndexReference" name="entry-isNaN-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-isNaN">↓</a> function.
</div>
<div class="Standard">
These automatic conversions can be very convenient, but they are also rather weird and error prone. Even though <div class="listing">
<pre class="listing">+
</pre>
</div>
 and <div class="listing">
<pre class="listing">*
</pre>
</div>
 are both arithmetic operators, they behave completely different in the example. In my own code, I use <div class="listing">
<pre class="listing">+
</pre>
</div>
 on non-strings a lot, but make it a point not to use <div class="listing">
<pre class="listing">*
</pre>
</div>
 and the other numeric operators on string values.
</div>
<div class="Standard">
Converting a number to a string is always possible and straightforward, but converting a string to a number may not even work (as in the last line of the example). We can use <div class="listing">
<pre class="listing">Number
</pre>
</div>
 to explicitly convert the string to a number, making it clear that we might run the risk of getting a <div class="listing">
<pre class="listing">NaN
</pre>
</div>
 value.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show Number(’5’) * 5
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When we discussed the boolean operators <div class="listing">
<pre class="listing">&amp;&amp;
</pre>
</div>
 and <div class="listing">
<pre class="listing">||
</pre>
</div>
 earlier, I claimed they produced boolean values. This turns out to be a bit of an oversimplification. If you apply them to boolean values, they will indeed return booleans. But they can also be applied to other kinds of values, in which case they will return one of their arguments.
</div>
<div class="Standard">
What <div class="listing">
<pre class="listing">||
</pre>
</div>
<a class="IndexReference" name="entry----0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index---">↓</a> really does is this: It looks at the value to the left of it first. If converting this value to a boolean would produce <div class="listing">
<pre class="listing">true
</pre>
</div>
, it returns this left value, and otherwise it returns the one on its right. Check for yourself that this does the correct thing when the arguments are booleans. Why does it work like that? It turns out this is very practical. Consider this example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prompt ’What is your name?’, ’’,
  (input) -&gt;
    show ’Well hello ’ + (input || ’dear’)
</pre>
</div>

</div>
<div class="Standard">
If the user presses <span class="formula">↩</span> / ‘Enter’ without giving a name, the variable <div class="listing">
<pre class="listing">input
</pre>
</div>
 will hold the value <div class="listing">
<pre class="listing">’’
</pre>
</div>
. This would give <div class="listing">
<pre class="listing">false
</pre>
</div>
 when converted to a boolean. The expression <div class="listing">
<pre class="listing">input || ’dear’
</pre>
</div>
 can in this case be read as ‘the value of the variable <div class="listing">
<pre class="listing">input
</pre>
</div>
, or else the string <div class="listing">
<pre class="listing">’dear’
</pre>
</div>
’. It is an easy way to provide a ‘fallback’ value.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">&amp;&amp;
</pre>
</div>
<a class="IndexReference" name="entry-&amp;&amp;-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-&&">↓</a> operator works similarly, but the other way around. When the value to its left is something that would give <div class="listing">
<pre class="listing">false
</pre>
</div>
 when converted to a boolean, it returns that value, and otherwise it returns the value on its right.
</div>
<div class="Standard">
Another property of these two operators is that the expression to their right is only evaluated when necessary. In the case of <div class="listing">
<pre class="listing">true || X
</pre>
</div>
, no matter what <div class="listing">
<pre class="listing">X
</pre>
</div>
 is, the result will be <div class="listing">
<pre class="listing">true
</pre>
</div>
, so <div class="listing">
<pre class="listing">X
</pre>
</div>
 is never evaluated, and if it has side effects they never happen. The same goes for <div class="listing">
<pre class="listing">false &amp;&amp; X
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">false || alert ’I am happening!’
true  || alert ’Not me.’
</pre>
</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-4"></a>Functions<a class="Label" name="chap:Functions"> </a>
</h1>
<div class="Standard">
A program often needs to do the same thing in different places. Repeating all the necessary statements every time is tedious and error-prone. It would be better to put them in one place, and have the program take a detour through there whenever necessary. This is what functions<a class="IndexReference" name="entry-function-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-function">↓</a> were invented for: They are canned code that a program can go through whenever it wants. Putting a string on the screen requires quite a few statements, but when we have a <div class="listing">
<pre class="listing">show
</pre>
</div>
 function we can just write <div class="listing">
<pre class="listing">show ’Aleph’
</pre>
</div>
 and be done with it.
</div>
<div class="Standard">
To view functions merely as canned chunks of code does not do them justice though. When needed, they can play the role of pure functions, algorithms, indirections, abstractions, decisions, modules, continuations, data structures, and more. Being able to effectively use functions is a necessary skill for any kind of serious programming. This chapter provides an introduction into the subject, <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↓</a> discusses the subtleties of functions in more depth.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-pure-function-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-pure-function">↓</a>Pure functions, for a start, are the things that were called functions in the mathematics classes that I hope you have been subjected to at some point in your life. Taking the cosine or the absolute value of a number is a pure function of one argument. Addition is a pure function of two arguments.
</div>
<div class="Standard">
The defining properties of pure functions are that they always return the same value when given the same arguments, and never have side effects. They take some arguments, return a value based on these arguments, and do not monkey around with anything else.
</div>
<div class="Standard">
In CoffeeScript, addition is an operator, but it could be wrapped in a function like this (and as pointless as this looks, we will come across situations where it is actually useful):
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">add = (a, b) -&gt; a + b
show add 2, 2
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">add
</pre>
</div>
 is the name of the function. <div class="listing">
<pre class="listing">a
</pre>
</div>
 and <div class="listing">
<pre class="listing">b
</pre>
</div>
 are the names of the two arguments. <div class="listing">
<pre class="listing">a + b
</pre>
</div>
 is the body of the function.
</div>
<div class="Standard">
<a class="IndexReference" name="entry--&gt;-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-->">↓</a>The construct <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
 is used when creating a new function. When it is assigned to a variable name, the resulting function will be stored under this name. Before the <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
 comes a list of argument<a class="IndexReference" name="entry-argument-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-argument">↓</a> names in parentheses. If a function does not take any arguments, then the parentheses are not needed. After the <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
 follows the body<a class="IndexReference" name="entry-body-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-body">↓</a> of the function. The body can follow the <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
 on the same line or indented on the following line. 
</div>
<div class="Standard">
<a class="IndexReference" name="entry-return-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-return">↓</a>The last statement in a function determines its value. The keyword <div class="listing">
<pre class="listing">return
</pre>
</div>
, followed by an expression, can also be used to determine the value the function returns. When control comes across a <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement, it immediately jumps out of the current function and gives the returned value to the code that called the function. A <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement without an expression after it will cause the function to return <div class="listing">
<pre class="listing">undefined
</pre>
</div>
.
</div>
<div class="Standard">
A body can, of course, have more than one statement in it. Here is a function for computing powers (with positive, integer exponents):
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">power = (base, exponent) -&gt;
  result = 1
  for count in [0...exponent]
    result *= base
  result
show power 2, 10
</pre>
</div>

</div>
<div class="Standard">
If you solved the exercise<a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#sub:Exercisepower2"> on page 1↑</a>, this technique for computing a power should look familiar. Creating a variable (<div class="listing">
<pre class="listing">result
</pre>
</div>
) and updating it are side effects. Did I not just say pure functions had no side effects? A variable created inside a function exists only inside the function. This is fortunate, or a programmer would have to come up with a different name for every variable he needs throughout a program. Because <div class="listing">
<pre class="listing">result
</pre>
</div>
 only exists inside <div class="listing">
<pre class="listing">power
</pre>
</div>
, the changes to it only last until the function returns, and from the perspective of code that calls it there are no side effects.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 7</i></span></span><br><div class="PlainVisible">
Write a function called <div class="listing">
<pre class="listing">absolute
</pre>
</div>
, which returns the absolute value of the number it is given as its argument. The absolute value of a negative number is the positive version of that same number, and the absolute value of a positive number (or zero) is that number itself.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">absolute = (number) -&gt;
  if number &lt; 0
    -number
  else
    number
show absolute -144
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Pure functions have two very nice properties. They are easy to think about, and they are easy to re-use.
</div>
<div class="Standard">
If a function is pure, a call to it can be seen as a thing in itself. When you are not sure that it is working correctly, you can test it by calling it directly from the console, which is simple because it does not depend on any context<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [J] </span><span class="HoverFoot"><span class="SupFootMarker"> [J] </span>Technically, a pure function can not use the value of any external variables. These values might change, and this could make the function return a different value for the same arguments. In practice, the programmer may consider some variables ‘constant’ — they are not expected to change — and consider functions that use only constant variables pure. Variables that contain a function value are often good examples of constant variables.</span></span>. It is easy to make these tests automatic — to write a program that tests a specific function. Non-pure functions might return different values based on all kinds of factors, and have side effects that might be hard to test and think about.
</div>
<div class="Standard">
Because pure functions are self-sufficient, they are likely to be useful and relevant in a wider range of situations than non-pure ones. Take <div class="listing">
<pre class="listing">show
</pre>
</div>
, for example. This function’s usefulness depends on the presence of a special place on the screen for printing output. If that place is not there, the function is useless. We can imagine a related function, let’s call it <div class="listing">
<pre class="listing">format
</pre>
</div>
, that takes a value as an argument and returns a string that represents this value. This function is useful in more situations than <div class="listing">
<pre class="listing">show
</pre>
</div>
.
</div>
<div class="Standard">
Of course, <div class="listing">
<pre class="listing">format
</pre>
</div>
 does not solve the same problem as <div class="listing">
<pre class="listing">show
</pre>
</div>
, and no pure function is going to be able to solve that problem, because it requires a side effect. In many cases, non-pure functions are precisely what you need. In other cases, a problem can be solved with a pure function but the non-pure variant is much more convenient or efficient.
</div>
<div class="Standard">
Thus, when something can easily be expressed as a pure function, write it that way. But never feel dirty for writing non-pure functions.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-testing-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-testing">↓</a>How do we make sure that a function gives the result that we expect? In the last exercise we tried with <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 <div class="listing">
<pre class="listing">-144
</pre>
</div>
 and got the answer we wanted. For a simple function that is likely enough, but functions quickly become much more complicated and it becomes difficult to predict the output just from reading the program text. To reassure ourselves that <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 actually works many more test cases are needed. But typing test case after test case very quickly becomes very boring — so there must be a better way…
</div>
<div class="Standard">
The exercise described the properties that the function should have as: ‘The absolute value of a negative number is the positive version of that same number, and the absolute value of a positive number (or zero) is that number itself.’ This description can be turned into properties that the computer can test for us.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">testAbsolute = (name, property) -&gt;
  qc.testPure absolute, [qc.arbInt], name, property
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">testAbsolute
</pre>
</div>
 function calls on testPure in <tt>qc</tt> — <tt>qc</tt> stands for quick check<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [K] </span><span class="HoverFoot"><span class="SupFootMarker"> [K] </span>Koen Claessen and John Hughes from Chalmers University of Technology created QuickCheck for Haskell and its ideas has since been reimplemented in many other programming languages. The <tt>qc</tt> library is an implementation for JavaScript by Darrin Thompson. A CoffeeScript compatible version is included in the prelude.</span></span> — and tells it in the first argument to test <div class="listing">
<pre class="listing">absolute
</pre>
</div>
. The next argument, <div class="listing">
<pre class="listing">arbInt
</pre>
</div>
, declare that <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 takes an arbitrary integer as its only argument. Don’t worry about the brackets and dots, they will be explained in the next chapters. Calling <div class="listing">
<pre class="listing">testAbsolute
</pre>
</div>
 with a descriptive name and a property is all that is needed to tell what to expect of <div class="listing">
<pre class="listing">absolute
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">testAbsolute ’returns positive integers’,
  (c, arg, result) -&gt; result &gt;= 0
</pre>
</div>

</div>
<div class="Standard">
First from the description of the function, clearly <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 should return a value larger than or equal to zero. That is what <div class="listing">
<pre class="listing">result &gt;= 0
</pre>
</div>
 in the property says. A property here is a function which is given three arguments; a test case (called <div class="listing">
<pre class="listing">c
</pre>
</div>
 since <div class="listing">
<pre class="listing">case
</pre>
</div>
 is a reserved word), the argument that <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 was called with and the <div class="listing">
<pre class="listing">result
</pre>
</div>
 it gave back. Based on these values the property then returns true or false depending on whether the function conformed to the property. 
</div>
<div class="Standard">
The description says: ‘the absolute value of a positive number (or zero) is that number itself.’ So this property only needs positive numbers, a call to <div class="listing">
<pre class="listing">guard
</pre>
</div>
 can to tell <tt>qc</tt> to disregard values that are not positive. The property then checks that the <div class="listing">
<pre class="listing">result
</pre>
</div>
 is the same as the argument. <div class="listing">
<pre class="listing">testAbsolute ’positive returns positive’,
  (c, arg, result) -&gt; c.guard arg &gt;= 0; result is arg
</pre>
</div>

</div>
<div class="Standard">
Almost the same goes for negative arguments, except we use unary minus in the property.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">testAbsolute ’negative returns positive’,
  (c, arg, result) -&gt; c.guard arg &lt; 0; result is -arg
</pre>
</div>

</div>
<div class="Standard">
So far only the desired properties of the function has been declared. No tests have been performed. Calling <div class="listing">
<pre class="listing">qc.test()
</pre>
</div>
 starts the testing process, <tt>qc</tt> then generates test data and checks the properties.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Pass: returns positive integers (pass=100, invalid=0)
Pass: positive returns positive (pass=100, invalid=103)
Pass: negative returns positive (pass=100, invalid=90)
</pre>
</div>

</div>
<div class="Standard">
That was nice. <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 has passed 300 test cases in the blink of an eye. The invalid counts comes from the <div class="listing">
<pre class="listing">guard
</pre>
</div>
 calls that throw away test cases. If you want to see the test values then you can insert a <div class="listing">
<pre class="listing">show c.args
</pre>
</div>
 in the property.
</div>
<div class="Standard">
So what does it look like if a test fails? The <div class="listing">
<pre class="listing">power
</pre>
</div>
 function from earlier in this chapter is a good candidate for a function that will fail to live up to expectations. We could reasonably expect that <div class="listing">
<pre class="listing">power
</pre>
</div>
 will behave the same as the standard <div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
 function — but only for integers of course.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">qc.testPure power, [qc.arbInt, qc.arbInt],
  ’power == Math.pow for integers’,
  (c, base, exponent, result) -&gt;
    result == c.note Math.pow base, exponent
</pre>
</div>

</div>
<div class="Standard">
Calling <div class="listing">
<pre class="listing">testPure
</pre>
</div>
 and describing <div class="listing">
<pre class="listing">power
</pre>
</div>
 as a function with two integer arguments does that. The property is then declaring that the <div class="listing">
<pre class="listing">result
</pre>
</div>
 from <div class="listing">
<pre class="listing">power
</pre>
</div>
 is the same as that from <div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
. To see the value that <div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
 returns, a call is made to <div class="listing">
<pre class="listing">c.note
</pre>
</div>
 which registers the value it is given.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">fail: power == Math.pow for integers
pass=9, invalid=0
shrinkedArgs=3,-2,9,0.1111111111111111
Failed case:
[ -9,
  -9,
  -387420489,
  -2.581174791713197e-9 ]
</pre>
</div>

</div>
<div class="Standard">
That failed and <tt>qc</tt> shows why. The <div class="listing">
<pre class="listing">-9
</pre>
</div>
 and <div class="listing">
<pre class="listing">-9
</pre>
</div>
 in the last lines refer to the arguments that <tt>qc</tt> generated for the test case. The <div class="listing">
<pre class="listing">-387420489
</pre>
</div>
 is the result from <div class="listing">
<pre class="listing">power
</pre>
</div>
. The last number is the value noted from <div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
, it is a close approximation of the correct answer <span class="formula"><span class="textrm">-</span>9<sup><span class="textrm"> -9</span></sup> = <span class="textrm">-</span><span class="fraction"><span class="ignored">(</span><span class="numerator">1</span><span class="ignored">)/(</span><span class="denominator">387420489</span><span class="ignored">)</span></span></span>.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">qc.testPure power, [qc.arbWholeNum, qc.arbWholeNum],
  ’power == Math.pow for positive integers’,
  (c, base, exponent, result) -&gt;
    result == c.note Math.pow base, exponent
</pre>
</div>

</div>
<div class="Standard">
The expectation that <div class="listing">
<pre class="listing">power
</pre>
</div>
 works for integers was too broad, but surely the functions will work the same for positive integers or what do you think? Instead of using guard to throw away test cases as before, the description of the arguments can be changed. Many different argument types are included in <tt>qc</tt> (ranges, strings, dates, lists, …) and there is also one for positive integers, <div class="listing">
<pre class="listing">arbWholeNum
</pre>
</div>
.<div class="listing">
<pre class="listing">fail: power == Math.pow for positive integers
pass=28, invalid=0
shrinkedArgs=9,18,150094635296999100,150094635296999140
Failed case:
[ 27,
  27,
  4.434264882430377e+38,
  4.434264882430378e+38 ]
</pre>
</div>

</div>
<div class="Standard">
Well it passed 28 tests before a test case for <span class="formula">27<sup>27</sup></span> gave a difference on the last digit<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [L] </span><span class="HoverFoot"><span class="SupFootMarker"> [L] </span>The ECMAScript standard allows these deviations for JavaScript and thus for CoffeeScript. If you should need unlimited precision integers then either use a third party library or a more mathematically inclined programming language such as Pure.</span></span>. Notice the line with <div class="listing">
<pre class="listing">shrinkedArgs
</pre>
</div>
. When a test fails then <tt>qc</tt> tries to find a simpler test that reproduces the problem. Simpler can mean shorter strings, lists or in this case smaller numbers. So <tt>qc</tt> found that there was a difference already for <span class="formula">9<sup>18</sup></span>. The result from <div class="listing">
<pre class="listing">power
</pre>
</div>
 ends with <div class="listing">
<pre class="listing">100
</pre>
</div>
 and from <div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
 with <div class="listing">
<pre class="listing">140
</pre>
</div>
. So which is correct? None of them<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [M] </span><span class="HoverFoot"><span class="SupFootMarker"> [M] </span>The LyX authoring environment used to create this book integrates with Maxima, the source of this result. Maxima is a computer algebra system that does symbolic and unlimited precision calculations. </span></span>: <span class="formula">9<sup>18</sup> = 150094635296999121</span>.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 8</i></span></span><br><div class="PlainVisible">
Copy the following program and modify the function <div class="listing">
<pre class="listing">intensify
</pre>
</div>
 until it passes the test properties. You can find descriptions of many <tt>qc</tt> definitions such as <div class="listing">
<pre class="listing">arbConst
</pre>
</div>
 in the <tt>qc</tt> reference <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#sub:qc.js"> on page 1↓</a>. From the prelude <div class="listing">
<pre class="listing">c.noteVerbose
</pre>
</div>
 can help by both recording a result if the test fails and displaying values as they are tested.
</div>
<div class="listing">
<pre class="listing">require ’./prelude’
​
intensify = (n) -&gt;
  2
​
qc.testPure intensify, [qc.arbInt],
  ’intensify grows by 2 when positive’,
  (c, arg, result) -&gt;
    c.guard arg &gt; 0
    arg + 2 == result
​
qc.testPure intensify, [qc.arbInt],
  ’intensify grows by 2 when negative’,
  (c, arg, result) -&gt;
    c.guard arg &lt; 0
    arg - 2 == result
​
qc.testPure intensify, [qc.arbConst(0)],
  ’only non-zero intensify grows’,
  (c, arg, result) -&gt;
    result is 0
​
qc.test()
</pre>
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">intensify = (n) -&gt;
  if n &gt; 0
    n + 2
  else if n &lt; 0
    n - 2
  else
    n
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Writing test declarations before writing a function can be a good way of specifying it. The test declarations in these examples are much larger than the functions they are testing. In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Binary-Heaps"><span class="sans">Binary Heaps</span>↓</a> is a more realistic example of a class and tests for it. Declarative testing is well suited to testing algorithms and reusable libraries. There are many other test tools that you can choose depending on your preference and task<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [N] </span><span class="HoverFoot"><span class="SupFootMarker"> [N] </span>Most JavaScript test tools are compatible with CoffeeScript or can easily be adapted.</span></span>. The main point here is that a reasonable level of testing is part of writing code.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Back to functions, they do not have to contain a <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement. If no <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement is encountered, the function returns the value of the last statement. The prelude function <div class="listing">
<pre class="listing">show
</pre>
</div>
 returns its argument so that it can be used inside expressions. If you want the function to return <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 then the last statement can be a <div class="listing">
<pre class="listing">return
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">yell = (message) -&gt;
  show message + ’!!’
  return
yell ’Yow’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The names of the arguments of a function are available as variables inside it. They will refer to the values of the arguments the function is being called with, and like normal variables created inside a function, they do not exist outside it. Aside from the top-level environment<a class="IndexReference" name="entry-top-level-environment-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-top-level-environment">↓</a>, there are smaller, local environments<a class="IndexReference" name="entry-local-environment-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-local-environment">↓</a> created by functions. When looking up a variable inside a function, the outer environment is checked first, and only if the variable does not exist there is it created in the local environment.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">dino = ’I am alive’
reptile = ’I am A-OK’
meteor = (reptile) -&gt;
  show reptile            # Argument
  dino = ’I am extinct’
  reptile = ’I survived’
  possum = ’I am new’
show dino                 # Outer
meteor ’What happened?’
show dino                 # Outer changed
show reptile              # Outer unchanged
try show possum catch e
  show e.message          # Error undefined
</pre>
</div>

</div>
<div class="Standard">
This makes it possible for arguments to a function to ‘shadow’<a class="IndexReference" name="entry-shadow-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-shadow">↓</a> outer level variables that have the same name. The easiest way to deal with variables is to use unique names for variables throughout a file. In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a> you will see that the top-level is not shared between files unless variables are specifically exported.
</div>
<div class="Standard">
<div class="defskip"> </div>
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/environments.png" alt="figure img/environments.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
So if the name of variable in an inner function exists in an outer environment then the variable is referring to the outer one, it is not a new definition. That is an expression like <div class="listing">
<pre class="listing">variable = ’something’
</pre>
</div>
 may be a definition of a new variable or it may be an assignment to a previously defined variable. As a matter of style, when you are using top-level variables then it makes sense to introduce them at the top of a file with a default value.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">variable = ’first’                    # Definition
​
showVariable = -&gt;
  show ’In showVariable, the variable holds: ’ +
        variable                      # second
​
test = -&gt;
  variable = ’second’                 # Assignment
  show ’In test, the variable holds ’ +
       variable + ’.’                 # second
  showVariable()
​
show ’The variable is: ’ + variable   # first
test()
show ’The variable is: ’ + variable   # second
</pre>
</div>

</div>
<div class="Standard">
The variables defined in the local environment are only visible to the code inside the function. If a function calls another function, the newly called function does not see the variables inside the first function.</div>
<div class="Standard"><div class="listing">
<pre class="listing">andHere = -&gt;
  try show aLocal                     # Not defined
  catch e then show e.message
isHere = -&gt;
  aLocal = ’aLocal is defined’
  andHere()
isHere()
</pre>
</div>

</div>
<div class="Standard">
However, and this is a subtle but extremely useful phenomenon, when a function is defined <i>inside</i> another function, its local environment will be based on the local environment that surrounds it.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">isHere = -&gt;
  andHere = -&gt;
    try show aLocal                   # Is defined
    catch e then show e.message
  aLocal = ’aLocal is defined’
  andHere()
isHere()
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Here is a special case that might surprise you:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">varWhich = ’top-level’
parentFunction = -&gt;
  varWhich = ’local’
  childFunction = -&gt;
    show varWhich
  childFunction
child = parentFunction()
child()
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">parentFunction
</pre>
</div>
 <i>returns</i> its internal function, and the code at the bottom calls this function. Even though <div class="listing">
<pre class="listing">parentFunction
</pre>
</div>
 has finished executing at this point, the local environment where <div class="listing">
<pre class="listing">variable
</pre>
</div>
 has the value <div class="listing">
<pre class="listing">’local’
</pre>
</div>
 still exists, and <div class="listing">
<pre class="listing">childFunction
</pre>
</div>
 still uses it. This phenomenon is called closure<a class="IndexReference" name="entry-closure-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-closure">↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
With scoping we can ‘synthesise’ functions. By using some of the variables from an enclosing function, an inner function can be made to do different things. Imagine we need a few different but similar functions, one that adds 2 to its argument, one that adds 5, and so on.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">makeAddFunction = (amount) -&gt;
  add = (number) -&gt; number + amount
​
addTwo = makeAddFunction 2
addFive = makeAddFunction 5
show addTwo(1) + addFive(1)
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
On top of the fact that different functions can contain variables of the same name without getting tangled up, these scoping rules also allow functions to call <i>themselves</i> without running into problems. A function that calls itself is called recursive. Recursion<a class="IndexReference" name="entry-recursion-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-recursion">↓</a> allows for some interesting definitions. When you define recursive functions the first thing you need is a stop condition, otherwise your recursive function becomes an elaborate but never ending loop. Look at this implementation of <div class="listing">
<pre class="listing">power
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">powerRec = (base, exponent) -&gt;
  if exponent == 0
    1
  else
    base * powerRec base, exponent - 1
show ’power 3, 3 = ’ + powerRec 3, 3
</pre>
</div>

</div>
<div class="Standard">
This is rather close to the way mathematicians define exponentiation, and to me it looks a lot nicer than the earlier version. It sort of loops, but there is no <div class="listing">
<pre class="listing">while
</pre>
</div>
, <div class="listing">
<pre class="listing">for
</pre>
</div>
, or even a local side effect to be seen. By calling itself, the function produces the same effect. The stop condition is when <div class="listing">
<pre class="listing">exponent
</pre>
</div>
 becomes <div class="listing">
<pre class="listing">0
</pre>
</div>
 and the <div class="listing">
<pre class="listing">exponent - 1
</pre>
</div>
 ensures that <div class="listing">
<pre class="listing">exponent
</pre>
</div>
 gets closer to <div class="listing">
<pre class="listing">0
</pre>
</div>
 for each call. Note the assumption that exponent is a positive integer, that should be clearly documented if <div class="listing">
<pre class="listing">powerRec
</pre>
</div>
 was a part of a reusable library.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Does this elegance affect performance? There is only one way to know for sure: measure it. The timings below are from my machine, you should not rely much on those. CPU’s, operating systems, compilers and interpreters in browsers all has an effect on performance, so measure in something that is as close to your target environment as possible.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">timeIt = (func) -&gt;
  start = new Date()
  for i in [0...1000000] then func()
  show "Timing: #{(new Date() - start)*0.001}s"
​
timeIt -&gt; p = add 9,18                # 0.042s
timeIt -&gt; p = Math.pow 9,18           # 0.049s
timeIt -&gt; p = power 9,18              # 0.464s
timeIt -&gt; p = powerRec 9,18           # 0.544s
</pre>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-efficiency-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-efficiency">↓</a>The dilemma of speed versus elegance<a class="IndexReference" name="entry-elegance-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-elegance">↓</a> is an interesting one. It not only occurs when deciding for or against recursion. In many situations, an elegant, intuitive, and often short solution can be replaced by a more convoluted but faster solution.
</div>
<div class="Standard">
In the case of the <div class="listing">
<pre class="listing">power
</pre>
</div>
 function above the un-elegant version is still sufficiently simple and easy to read. It does not make very much sense to replace it with the recursive version. Often, though, the concepts a program is dealing with get so complex that giving up some efficiency in order to make the program more straightforward becomes an attractive choice.
</div>
<div class="Standard">
The basic rule, which has been repeated by many programmers and with which I wholeheartedly agree, is to not worry about efficiency until your program is provably too slow. When it is, find out which parts are too slow, and start exchanging elegance for efficiency in those parts.
</div>
<div class="Standard">
Of course, the above rule does not mean one should start ignoring performance altogether. In many cases, like the <div class="listing">
<pre class="listing">power
</pre>
</div>
 function, not much simplicity is gained by the ‘elegant’ approach. In other cases, an experienced programmer can see right away that a simple approach is never going to be fast enough.
</div>
<div class="Standard">
The reason I am making a big deal out of this is that surprisingly many programmers focus fanatically on efficiency, even in the smallest details. The result is bigger, more complicated, and often less correct programs, which take longer to write than their more straightforward equivalents and often run only marginally faster.
</div>
<div class="Standard">
When you have a simple, correct implementation that is too slow, then you can use that as a reference implementation to test your improved version. The one thing you do need to consider up front is what kind of data structures and algorithms can handle the task at hand. There is a huge difference between searching in a list with ten items and searching in a list with millions of items. These kind of considerations are covered in more detail in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Searching"><span class="sans">Searching</span>↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
But I was talking about recursion. A concept closely related to recursion is a thing called the stack<a class="IndexReference" name="entry-stack-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-stack">↓</a>. When a function is called, control is given to the body of that function. When that body returns, the code that called the function is resumed. While the body is running, the computer must remember the context from which the function was called, so that it knows where to continue afterwards. The place where this context is stored is called the stack.
</div>
<div class="Standard">
The fact that it is called ‘stack’ has to do with the fact that, as we saw, a function body can again call a function. Every time a function is called, another context has to be stored. One can visualise this as a stack of contexts. Every time a function is called, the current context is thrown on top of the stack. When a function returns, the context on top is taken off the stack and resumed.
</div>
<div class="Standard">
This stack requires space in the computer’s memory to be stored. When the stack grows too big, the computer will give up with a message like “out of stack space” or “too much recursion”. This is something that has to be kept in mind when writing recursive functions.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">chicken = -&gt;
  show ’Lay an egg’
  egg()
egg     = -&gt;
  show ’Chick hatched’
  chicken()
try show chicken() + ’ came first.’
catch error then show error.message
</pre>
</div>

</div>
<div class="Standard">
In addition to demonstrating a very interesting way of writing a broken program, this example shows that a function does not have to call itself directly to be recursive. If it calls another function which (directly or indirectly) calls the first function again, it is still recursive. The <div class="listing">
<pre class="listing">try
</pre>
</div>
 and <div class="listing">
<pre class="listing">catch
</pre>
</div>
 parts are covered in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Error-Handling"><span class="sans">Error Handling</span>↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Recursion is not always just a less-efficient alternative to looping. Some problems are much easier to solve with recursion than with loops. Most often these are problems that require exploring or processing several ‘branches’, each of which might branch out again into more branches.
</div>
<div class="Standard">
Consider this puzzle: By starting from the number 1 and repeatedly either adding 5 or multiplying by 3, an infinite amount of new numbers can be produced. How would you write a function that, given a number, tries to find a sequence of additions and multiplications that produce that number?
</div>
<div class="Standard">
For example, the number 13 could be reached by first multiplying 1 by 3, and then adding 5 twice. The number 15 can not be reached at all.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">findSequence = (goal) -&gt;
  find = (start, history) -&gt;
    if start == goal
      history
    else if start &gt; goal
      null
    else
      find(start + 5, ’(’ + history + ’ + 5)’) ? \
      find(start * 3, ’(’ + history + ’ * 3)’)
  find 1, ’1’
show findSequence 24
</pre>
</div>

</div>
<div class="Standard">
Note that the solution does not necessarily find the <i>shortest</i> sequence of operations, it is satisfied when it finds any sequence at all.
</div>
<div class="Standard">
The inner <div class="listing">
<pre class="listing">find
</pre>
</div>
 function, by calling itself in two different ways, explores both the possibility of adding 5 to the current number and of multiplying it by 3. When it finds the number, it returns the <div class="listing">
<pre class="listing">history
</pre>
</div>
 string, which is used to record all the operators that were performed to get to this number. It also checks whether the current number is bigger than <div class="listing">
<pre class="listing">goal
</pre>
</div>
, because if it is, we should stop exploring this branch, it is not going to give us our number.
</div>
<div class="Standard">
The use of the existential <div class="listing">
<pre class="listing">?
</pre>
</div>
 operator in the example can be read as ‘return the solution found by adding 5 to <div class="listing">
<pre class="listing">start
</pre>
</div>
, and if that fails, return the solution found by multiplying <div class="listing">
<pre class="listing">start
</pre>
</div>
 by 3’.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Usually when you define a function you assign it to a name that you can use to refer to it later. That is not required and sometimes it is not worthwhile to give a function a name, then you can use an anonymous function<a class="IndexReference" name="entry-anonymous-function-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-anonymous-function">↓</a> instead.
</div>
<div class="Standard">
Like in the <div class="listing">
<pre class="listing">makeAddFunction
</pre>
</div>
 example we saw earlier:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">makeAddFunction = (amount) -&gt;
  (number) -&gt; number + amount
​
show makeAddFunction(11) 3
</pre>
</div>

</div>
<div class="Standard">
Since the function named <div class="listing">
<pre class="listing">add
</pre>
</div>
 in the first version of <div class="listing">
<pre class="listing">makeAddFunction
</pre>
</div>
 was referred to only once, the name does not serve any purpose and we might as well directly return the function value.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 9</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">greaterThan
</pre>
</div>
, which takes one argument, a number, and returns a function that represents a test. When this returned function is called with a single number as argument, it returns a boolean: <div class="listing">
<pre class="listing">true
</pre>
</div>
 if the given number is greater than the number that was used to create the test function, and <div class="listing">
<pre class="listing">false
</pre>
</div>
 otherwise.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">greaterThan = (x) -&gt;
  (y) -&gt; y &gt; x
​
greaterThanTen = greaterThan 10
show greaterThanTen 9
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Try the following:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">yell ’Hello’, ’Good Evening’, ’How do you do?’
</pre>
</div>

</div>
<div class="Standard">
The function <div class="listing">
<pre class="listing">yell
</pre>
</div>
 defined earlier in this chapter only accepts one argument. Yet when you call it like this, the computer does not complain at all, but just ignores the other arguments.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">yell()
</pre>
</div>

</div>
<div class="Standard">
You can, apparently, even get away with passing too few arguments. When an argument is not passed, its value inside the function is <div class="listing">
<pre class="listing">undefined
</pre>
</div>
.
</div>
<div class="Standard">
In the next chapter, we will see a way in which a function body can get at the exact list of arguments that were passed to it. This can be useful, as it makes it possible to have a function accept any number of arguments. <div class="listing">
<pre class="listing">console.log
</pre>
</div>
 makes use of this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">console.log ’R’, 2, ’D’, 2
</pre>
</div>

</div>
<div class="Standard">
Of course, the downside of this is that it is also possible to accidentally pass the wrong number of arguments to functions that expect a fixed amount of them and never be told about it.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-5"></a>Data Structures: Objects and Arrays<a class="Label" name="chap:Data-Structures"> </a>
</h1>
<div class="Standard">
This chapter will be devoted to solving a few simple problems. In the process, we will discuss two new types of values, arrays and objects, and look at some techniques related to them.
</div>
<div class="Standard">
Consider the following situation: Your crazy aunt Emily, who is rumoured to have over fifty cats living with her (you never managed to count them), regularly sends you e-mails to keep you up to date on her exploits. They usually look like this:
</div>
<blockquote class="Quote">
<i>Dear nephew,</i><br>
<i>Your mother told me you have taken up skydiving. Is this true? You watch yourself, young man! Remember what happened to my husband? And that was only from the second floor!</i><br>
<i>Anyway, things are very exciting here. I have spent all week trying to get the attention of Mr. Drake, the nice gentleman who moved in next door, but I think he is afraid of cats. Or allergic to them? I am going to try putting Fat Igor on his shoulder next time I see him, very curious what will happen.</i><br>
<i>Also, the scam I told you about is going better than expected. I have already gotten back five ‘payments’, and only one complaint. It is starting to make me feel a bit bad though. And you are right that it is probably illegal in some way.</i>
</blockquote>
<blockquote class="Quote">
<i>(</i>…<i> etc </i>…<i>)</i>
</blockquote>
<blockquote class="Quote">
<i>Much love,</i><br>
<i>Aunt Emily</i><br>
<i>died 27/04/2006: Black Leclère</i><br>
<i>born 05/04/2006 (mother Lady Penelope): Red Lion, Doctor Hobbles the 3rd, Little Iroquois</i>
</blockquote>
<div class="Standard">
To humour the old dear, you would like to keep track of the genealogy of her cats, so you can add things like “P.S. I hope Doctor Hobbles the 2nd enjoyed his birthday this Saturday!”, or “How is old Lady Penelope doing? She’s five years old now, isn’t she?”, preferably without accidentally asking about dead cats. You are in the possession of a large quantity of old e-mails from your aunt, and fortunately she is very consistent in always putting information about the cats’ births and deaths at the end of her mails in precisely the same format.
</div>
<div class="Standard">
You are hardly inclined to go through all those mails by hand. Fortunately, we were just in need of an example problem, so we will try to work out a program that does the work for us. For a start, we write a program that gives us a list of cats that are still alive after the last e-mail.
</div>
<div class="Standard">
Before you ask, at the start of the correspondence, aunt Emily had only a single cat: Spot. (She was still rather conventional in those days.)
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/eyes.jpg" alt="figure img/eyes.jpg" style="width: 30%; height: auto;">

</div>

</div>
<div class="Standard">
It usually pays to have some kind of clue what one’s program is going to do before starting to type. Here’s a plan:
</div>
<ol>
<li>
Start with a set of cat names that has only “Spot” in it.
</li>
<li>
Go over every e-mail in our archive, in chronological order.
</li>
<li>
Look for paragraphs that start with “born” or “died”.
</li>
<li>
Add the names from paragraphs that start with “born” to our set of names.
</li>
<li>
Remove the names from paragraphs that start with “died” from our set.
</li>

</ol>
<div class="Standard">
Where taking the names from a paragraph goes like this:
</div>
<ol>
<li>
Find the colon in the paragraph.
</li>
<li>
Take the part after this colon.
</li>
<li>
Split this part into separate names by looking for commas.
</li>

</ol>
<div class="Standard">
It may require some suspension of disbelief to accept that aunt Emily always used this exact format, and that she never forgot or misspelled a name, but that is just how your aunt is.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
First, let me tell you about properties<a class="IndexReference" name="entry-properties-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-properties">↓</a>. A lot of CoffeeScript values have other values associated with them. These associations are called properties. Every string has a property called <div class="listing">
<pre class="listing">length
</pre>
</div>
<a class="IndexReference" name="entry-length-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-length">↓</a>, which refers to a number, the amount of characters in that string.
</div>
<div class="Standard">
<a class="IndexReference" name="entry-[]-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-[]">↓</a>Properties can be accessed in two ways:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">text = ’purple haze’
show text[’length’]
show text.length
</pre>
</div>

</div>
<div class="Standard">
The second way is a shorthand for the first, and it only works when the name of the property would be a valid variable name — when it does not have any spaces or symbols in it and does not start with a digit character.
</div>
<div class="Standard">
Numbers, booleans, the value <div class="listing">
<pre class="listing">null
</pre>
</div>
, and the value <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 do not have any properties. Trying to read properties from such a value produces an error. Try the following code, if only to get an idea about the kind of error-message you get in such a case (which, for some browsers, can be rather cryptic).
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">nothing = null
show nothing.length
</pre>
</div>

</div>
<div class="Standard">
The properties of a string value can not be changed. There are quite a few more than just <div class="listing">
<pre class="listing">length
</pre>
</div>
, as we will see, but you are not allowed to add or remove any.
</div>
<div class="Standard">
This is different with values of the type object<a class="IndexReference" name="entry-object-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-object">↓</a>. Their main role is to hold other values. They have, you could say, their own set of tentacles in the form of properties. You are free to modify these, remove them, or add new ones.
</div>
<div class="Standard">
<a class="IndexReference" name="entry-{}-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-{}">↓</a>An object can be written like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">cat =
  colour: ’grey’
  name: ’Spot’
  size: 46
# Or: cat = {colour: ’grey’, name: ’Spot’, size: 46}
cat.size = 47
show cat.size
delete cat.size
show cat.size
show cat
</pre>
</div>

</div>
<div class="Standard">
Like variables, each property attached to an object is labelled by a string. The first statement creates an object in which the property <div class="listing">
<pre class="listing">’colour’
</pre>
</div>
 holds the string <div class="listing">
<pre class="listing">’grey’
</pre>
</div>
, the property <div class="listing">
<pre class="listing">’name’
</pre>
</div>
 is attached to the string <div class="listing">
<pre class="listing">’Spot’
</pre>
</div>
, and the property <div class="listing">
<pre class="listing">’size’
</pre>
</div>
 refers to the number <div class="listing">
<pre class="listing">46
</pre>
</div>
. The second statement gives the property named <div class="listing">
<pre class="listing">size
</pre>
</div>
 a new value, which is done in the same way as modifying a variable.
</div>
<div class="Standard">
The keyword <div class="listing">
<pre class="listing">delete
</pre>
</div>
<a class="IndexReference" name="entry-delete-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-delete">↓</a> cuts off properties. Trying to read a non-existent property gives the value <div class="listing">
<pre class="listing">undefined
</pre>
</div>
.
</div>
<div class="Standard">
If a property that does not yet exist is set with the <div class="listing">
<pre class="listing">=
</pre>
</div>
<a class="IndexReference" name="entry-=-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-=">↓</a> operator, it is added to the object.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">empty = {}
empty.notReally = 1000
show empty.notReally
</pre>
</div>

</div>
<div class="Standard">
Properties whose names are not valid variable names have to be quoted when creating the object, and approached using brackets:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">thing = {’gabba gabba’: ’hey’, ’5’: 10}
show thing[’5’]
thing[’5’] = 20
show thing[2 + 3]
delete thing[’gabba gabba’]
show thing
</pre>
</div>

</div>
<div class="Standard">
As you can see, the part between the brackets can be any expression. It is converted to a string to determine the property name it refers to. One can even use variables to name properties:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">propertyName = ’length’
text = ’mainline’
show text[propertyName]
</pre>
</div>

</div>
<div class="Standard">
The operator <div class="listing">
<pre class="listing">of
</pre>
</div>
<a class="IndexReference" name="entry-of-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-of">↓</a> can be used to test whether an object has a certain property. It produces a boolean.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">chineseBox = {}
chineseBox.content = chineseBox
show ’content’ of chineseBox
show ’content’ of chineseBox.content
show chineseBox
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When object values are shown in the console, only the first few layers of properties are shown. You can give an extra argument, <div class="listing">
<pre class="listing">depth
</pre>
</div>
, to <div class="listing">
<pre class="listing">show
</pre>
</div>
 to inspect more layers.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">abyss = {let:1, us:go:deep:down:7}
show abyss
show abyss, 5
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 10</i></span></span><br><div class="PlainVisible">
The solution for the cat problem talks about a ‘set’ of names. A set<a class="IndexReference" name="entry-set-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-set">↓</a> is a collection of values in which no value may occur more than once. If names are strings, can you think of a way to use an object to represent a set of names?
</div>
<div class="PlainVisible">
Show how a name can be added to this set, how one can be removed, and how you can check whether a name occurs in it.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="PlainVisible">
This can be done by storing the content of the set as the properties of an object. Adding a name is done by setting a property by that name to a value, any value. Removing a name is done by deleting this property. The <div class="listing">
<pre class="listing">of
</pre>
</div>
 operator can be used to determine whether a certain name is part of the set. There are a few subtle problems with this approach, which will be discussed and solved in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>. For this chapter, it works well enough.
</div>
<div class="listing">
<pre class="listing">set = {’Spot’: true}
# Add ’White Fang’ to the set
set[’White Fang’] = true
# Remove ’Spot’
delete set[’Spot’]
# See if ’Asoka’ is in the set
show ’Asoka’ of set
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-mutability-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-mutability">↓</a>Object values, apparently, can change. The types of values discussed in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Basic-CoffeeScript"><span class="sans">Basic CoffeeScript</span>↑</a> are all immutable, it is impossible to change an existing value of those types. You can combine them and derive new values from them, but when you take a specific string value, the text inside it can not change. With objects, on the other hand, the content of a value can be modified by changing its properties.
</div>
<div class="Standard">
When we have two numbers, <div class="listing">
<pre class="listing">120
</pre>
</div>
 and <div class="listing">
<pre class="listing">120
</pre>
</div>
, they can for all practical purposes be considered the precise same number. With objects, there is a difference between having two references to the same object and having two different objects that contain the same properties. Consider the following code:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">object1 = {value: 10}
object2 = object1
object3 = {value: 10}
​
show object1 == object2
show object1 == object3
​
object1.value = 15
show object2.value
show object3.value
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">object1
</pre>
</div>
 and <div class="listing">
<pre class="listing">object2
</pre>
</div>
 are two variables grasping the <i>same</i> value. There is only one actual object, which is why changing <div class="listing">
<pre class="listing">object1
</pre>
</div>
 also changes the value of <div class="listing">
<pre class="listing">object2
</pre>
</div>
. The variable <div class="listing">
<pre class="listing">object3
</pre>
</div>
 points to another object, which initially contains the same properties as <div class="listing">
<pre class="listing">object1
</pre>
</div>
, but lives a separate life.
</div>
<div class="Standard">
CoffeeScript’s <div class="listing">
<pre class="listing">==
</pre>
</div>
<a class="IndexReference" name="entry-==-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-==">↓</a> operator, when comparing objects, will only return <div class="listing">
<pre class="listing">true
</pre>
</div>
 if both values given to it are the precise same value. Comparing different object with identical contents will give <div class="listing">
<pre class="listing">false
</pre>
</div>
. This is useful in some situations, but unpractical in others<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [O] </span><span class="HoverFoot"><span class="SupFootMarker"> [O] </span>In the underscore library you can find a function <div class="listing">
<pre class="listing">isEqual
</pre>
</div>
 which compares two objects based on all layers of their contents.</span></span>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Object values can play a lot of different roles. Behaving like a set is only one of those. We will see a few other roles in this chapter, and <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a> shows another important way of using objects.
</div>
<div class="Standard">
In the plan for the cat problem — in fact, call it an <i>algorithm</i>, not a plan, that makes it sound like we know what we are talking about — in the algorithm, it talks about going over all the e-mails in an archive. What does this archive look like? And where does it come from?
</div>
<div class="Standard">
Do not worry about the second question for now. <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a> talks about some ways to import data into your programs, but for now you will find that the e-mails are just magically there. Some magic is really easy, inside computers.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The way in which the archive is stored is still an interesting question. It contains a number of e-mails. An e-mail can be a string, that should be obvious. The whole archive could be put into one huge string, but that is hardly practical. What we want is a collection of separate strings.
</div>
<div class="Standard">
Collections of things are what objects are used for. One could make an object like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mailArchive = {
  ’the first e-mail’: ’Dear nephew, ...’
  ’the second e-mail’: ’...’
  # and so on ...
}
</pre>
</div>

</div>
<div class="Standard">
But that makes it hard to go over the e-mails from start to end — how does the program guess the name of these properties? This can be solved by more predictable property names:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mailArchive = {
  0: ’Dear nephew, ... (mail number 1)’
  1: ’(mail number 2)’
  2: ’(mail number 3)’
}
​
for current of mailArchive
  show ’Processing e-mail #’ + current +
       ’: ’ + mailArchive[current]
</pre>
</div>

</div>
<div class="Standard">
Luck has it that there is a special kind of objects specifically for this kind of use. They are called arrays<a class="IndexReference" name="entry-array-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-array">↓</a>, and they provide some conveniences, such as a <div class="listing">
<pre class="listing">length
</pre>
</div>
<a class="IndexReference" name="entry-length-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-length">↓</a> property that contains the amount of values in the array, and a number of operations useful for this kind of collections.
</div>
<div class="Standard">
<a class="IndexReference" name="entry-[]-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-[]">↓</a>New arrays can be created using brackets (<div class="listing">
<pre class="listing">[
</pre>
</div>
 and <div class="listing">
<pre class="listing">]
</pre>
</div>
). As with properties, the commas between elements are optional when they are placed on separate lines. Ranges and for comprehensions also create arrays. 
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mailArchive = [’mail one’, ’mail two’, ’mail three’]
​
for current in [0...mailArchive.length]
  show ’Processing e-mail #’ + current +
       ’: ’ + mailArchive[current]
</pre>
</div>

</div>
<div class="Standard">
In this example, the numbers of the elements are not specified explicitly anymore. The first one automatically gets the number 0, the second the number 1, and so on.
</div>
<div class="Standard">
Why start at 0? People tend to start counting from 1. As unintuitive as it seems, numbering the elements in a collection from 0 is often more practical. Just go with it for now, it will grow on you.
</div>
<div class="Standard">
Starting at element 0 also means that in a collection with <div class="listing">
<pre class="listing">X
</pre>
</div>
 elements, the last element can be found at position <div class="listing">
<pre class="listing">X - 1
</pre>
</div>
. This is why the <div class="listing">
<pre class="listing">for
</pre>
</div>
 loop in the example uses an exclusive range <div class="listing">
<pre class="listing">0...mailArchive.length
</pre>
</div>
. There is no element at position <div class="listing">
<pre class="listing">mailArchive.length
</pre>
</div>
, so as soon as <div class="listing">
<pre class="listing">current
</pre>
</div>
 has that value, we stop looping.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 11</i></span></span><br><span class="default"><a class="Label" name="sub:Exerciserange"> </a></span><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">range
</pre>
</div>
 that takes one argument, a positive number, and returns an array containing all numbers from 0 up to and including the given number.
</div>
<div class="PlainVisible">
An empty array can be created by simply typing <div class="listing">
<pre class="listing">[]
</pre>
</div>
. Also remember that adding properties to an object, and thus also to an array, can be done by assigning them a value with the <div class="listing">
<pre class="listing">=
</pre>
</div>
 operator. The <div class="listing">
<pre class="listing">length
</pre>
</div>
 property is automatically updated when elements are added.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">range = (upto) -&gt;
  result = []
  i = 0
  while i &lt;= upto
    result[i] = i
    i++
  result
show range 4
</pre>
</div>
<div class="Standard">Instead of naming the loop variable <div class="listing">
<pre class="listing">counter
</pre>
</div>
 or <div class="listing">
<pre class="listing">current
</pre>
</div>
, as I have been doing so far, it is now called simply <div class="listing">
<pre class="listing">i
</pre>
</div>
. Using single letters, usually <div class="listing">
<pre class="listing">i
</pre>
</div>
, <div class="listing">
<pre class="listing">j
</pre>
</div>
, or <div class="listing">
<pre class="listing">k
</pre>
</div>
 for loop variables is a widely spread habit among programmers. It has its origin mostly in laziness: We’d rather type one character than seven, and names like <div class="listing">
<pre class="listing">counter
</pre>
</div>
 and <div class="listing">
<pre class="listing">current
</pre>
</div>
 do not really clarify the meaning of the variable much.<div class="PlainVisible">
If a program uses too many meaningless single-letter variables, it can become unbelievably confusing. In my own programs, I try to only do this in a few common cases. Small loops are one of these cases. If the loop contains another loop, and that one also uses a variable named <div class="listing">
<pre class="listing">i
</pre>
</div>
, the inner loop will modify the variable that the outer loop is using, and everything will break. One could use <div class="listing">
<pre class="listing">j
</pre>
</div>
 for the inner loop, but in general, when the body of a loop is big, you should come up with a variable name that has some clear meaning.
</div>
<div class="PlainVisible">
In CoffeeScript the solution can be written in much shorter forms using a for expression that collects the results or by using the built-in range. </div><div class="listing">
<pre class="listing">range = (upto) -&gt; i for i in [0..upto]
show range 4
range = (upto) -&gt; [0..upto]
show range 4
</pre>
</div>

</div>

</div>

</div>

</span></span></span>
 
</div>
<div class="Standard">
In CoffeeScript most statements can also be used as expressions. That means for example that the values from a for comprehension can be collected in a variable and used later.<div class="listing">
<pre class="listing">numbers = (number for number in [0..12] by 2)
show numbers
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Both string and array objects contain, in addition to the <div class="listing">
<pre class="listing">length
</pre>
</div>
 property, a number of properties that refer to function values.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">doh = ’Doh’
show typeof doh.toUpperCase
show doh.toUpperCase()
</pre>
</div>

</div>
<div class="Standard">
Every string has a <div class="listing">
<pre class="listing">toUpperCase
</pre>
</div>
<a class="IndexReference" name="entry-toUpperCase-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-toUpperCase">↓</a> property. When called, it will return a copy of the string, in which all letters have been converted to uppercase. There is also <div class="listing">
<pre class="listing">toLowerCase
</pre>
</div>
<a class="IndexReference" name="entry-toLowerCase-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-toLowerCase">↓</a>. Guess what that does.
</div>
<div class="Standard">
Notice that, even though the call to <div class="listing">
<pre class="listing">toUpperCase
</pre>
</div>
 does not pass any arguments, the function does somehow have access to the string <div class="listing">
<pre class="listing">’Doh’
</pre>
</div>
, the value of which it is a property. How this works precisely is described in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>.
</div>
<div class="Standard">
Properties that contain functions are generally called methods<a class="IndexReference" name="entry-method-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-method">↓</a>, for example ‘<div class="listing">
<pre class="listing">toUpperCase
</pre>
</div>
 is a method of a string object’.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mack = []
mack.push ’Mack’
mack.push ’the’
mack.push ’Knife’
show mack.join ’ ’
show mack.pop()
show mack
</pre>
</div>

</div>
<div class="Standard">
The method <div class="listing">
<pre class="listing">push
</pre>
</div>
<a class="IndexReference" name="entry-push-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-push">↓</a>, which is associated with arrays, can be used to add values to it. It could have been used in the last exercise, as an alternative to <div class="listing">
<pre class="listing">result[i] = i
</pre>
</div>
. Then there is <div class="listing">
<pre class="listing">pop
</pre>
</div>
<a class="IndexReference" name="entry-pop-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-pop">↓</a>, the opposite of <div class="listing">
<pre class="listing">push
</pre>
</div>
: it takes off and returns the last value in the array. <div class="listing">
<pre class="listing">join
</pre>
</div>
<a class="IndexReference" name="entry-join-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-join">↓</a> builds a single big string from an array of strings. The parameter it is given is pasted between the values in the array.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Coming back to those cats, we now know that an array would be a good way to store the archive of e-mails. In this book, the <div class="listing">
<pre class="listing">retrieveMails
</pre>
</div>
 after the <div class="listing">
<pre class="listing">require
</pre>
</div>
 can be used to (magically) get hold of this array. The magic will be dispelled in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a>. Going over them to process them one after another is no rocket science anymore either:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mailArchive = (require "./04-emails").retrieveMails() 
​
for email, i in mailArchive
  show "Processing e-mail ##{i} #{email[0..15]}..."
  # Do more things...
</pre>
</div>

</div>
<div class="Standard">
In a <div class="listing">
<pre class="listing">for ... in
</pre>
</div>
 statement we can get both the value and its index in the array. The <div class="listing">
<pre class="listing">email[0..15]
</pre>
</div>
 gets the first snippet of each email. We have also decided on a way to represent the set of cats that are alive. The next problem, then, is to find the paragraphs in an e-mail that start with <div class="listing">
<pre class="listing">’born’
</pre>
</div>
 or <div class="listing">
<pre class="listing">’died’
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The first question that comes up is what exactly a paragraph is. In this case, the string value itself can not help us much: CoffeeScript’s concept of text does not go any deeper than the ‘sequence of characters’ idea, so we must define paragraphs in those terms.
</div>
<div class="Standard">
Earlier, we saw that there is such a thing as a newline character. These are what most people use to split paragraphs. We consider a paragraph, then, to be a part of an e-mail that starts at a newline character or at the start of the content, and ends at the next newline character or at the end of the content.
</div>
<div class="Standard">
And we do not even have to write the algorithm for splitting a string into paragraphs ourselves. Strings already have a method named <div class="listing">
<pre class="listing">split
</pre>
</div>
<a class="IndexReference" name="entry-split-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-split">↓</a>, which is (almost) the opposite of the <div class="listing">
<pre class="listing">join
</pre>
</div>
 method of arrays. It splits a string into an array, using the string given as its argument to determine in which places to cut.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">words = ’Cities of the Interior’
show words.split ’ ’
</pre>
</div>

</div>
<div class="Standard">
Thus, cutting on newlines (<div class="listing">
<pre class="listing">’\n’
</pre>
</div>
), can be used to split an e-mail into paragraphs.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 12</i></span></span><br><div class="PlainVisible">
<div class="listing">
<pre class="listing">split
</pre>
</div>
 and <div class="listing">
<pre class="listing">join
</pre>
</div>
 are not precisely each other’s inverse. <div class="listing">
<pre class="listing">string.split(x).join(x)
</pre>
</div>
 always produces the original value, but <div class="listing">
<pre class="listing">array.join(x).split(x)
</pre>
</div>
 does not. Can you give an example of an array where <div class="listing">
<pre class="listing">.join(’ ’).split(’ ’)
</pre>
</div>
 produces a different value?
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">array = [’a’, ’b’, ’c d’]
show array.join(’ ’).split(’ ’)
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Paragraphs that do not start with either “born” or “died” can be ignored by the program. How do we test whether a string starts with a certain word? The method <div class="listing">
<pre class="listing">charAt
</pre>
</div>
<a class="IndexReference" name="entry-charAt-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-charAt">↓</a> can be used to get a specific character from a string. <div class="listing">
<pre class="listing">x.charAt(0)
</pre>
</div>
 gives the first character, <div class="listing">
<pre class="listing">1
</pre>
</div>
 is the second one, and so on. One way to check whether a string starts with “born” is:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">paragraph = ’born 15-11-2003 (mother Spot): White Fang’
show paragraph.charAt(0) == ’b’ &amp;&amp;
     paragraph.charAt(1) == ’o’ &amp;&amp;
     paragraph.charAt(2) == ’r’ &amp;&amp;
     paragraph.charAt(3) == ’n’
</pre>
</div>

</div>
<div class="Standard">
But that gets a bit clumsy — imagine checking for a word of ten characters. There is something to be learned here though: when a line gets ridiculously long, it can be spread over multiple lines. The result can be made easier to read by lining up the start of the new line with the first element on the original line that plays a similar role. You can also end a line with <div class="listing">
<pre class="listing">\
</pre>
</div>
 to indicate that it continues on the next line.
</div>
<div class="Standard">
Strings also have a method called <div class="listing">
<pre class="listing">slice
</pre>
</div>
<a class="IndexReference" name="entry-slice-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-slice">↓</a>. It copies out a piece of the string, starting from the character at the position given by the first argument, and ending before (not including) the character at the position given by the second one. It is the same as using a range as an index. This allows the check to be written in a shorter way.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show paragraph.slice(0, 4) == ’born’
show paragraph[0...4] == ’born’
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 13</i></span></span><br><div class="PlainVisible">
Write a function called <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 that takes two arguments, both strings. It returns <div class="listing">
<pre class="listing">true
</pre>
</div>
 when the first argument starts with the characters in the second argument, and <div class="listing">
<pre class="listing">false
</pre>
</div>
 otherwise.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">startsWith = (string, pattern) -&gt;
  string.slice(0, pattern.length) == pattern
# or
startsWith = (string, pattern) -&gt;
  string[0...pattern.length] == pattern
show startsWith ’rotation’, ’rot’
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
What happens when <div class="listing">
<pre class="listing">charAt
</pre>
</div>
, <div class="listing">
<pre class="listing">slice
</pre>
</div>
 or a range are used to take a piece of a string that does not exist? Will the <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 still work when the pattern is longer than the string it is matched against?
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show ’Pip’.charAt 250
show ’Nop’.slice 1, 10
show ’Pin’[1...10]
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">charAt
</pre>
</div>
 will return <div class="listing">
<pre class="listing">’’
</pre>
</div>
 when there is no character at the given position, and <div class="listing">
<pre class="listing">slice
</pre>
</div>
 or the range will simply leave out the part of the new string that does not exist.
</div>
<div class="Standard">
So yes, <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 should work. When <div class="listing">
<pre class="listing">startsWith(’Idiots’, ’Most honoured colleagues’)
</pre>
</div>
 is called, the call to <div class="listing">
<pre class="listing">slice
</pre>
</div>
 will, because <div class="listing">
<pre class="listing">string
</pre>
</div>
 does not have enough characters, always return a string that is shorter than <div class="listing">
<pre class="listing">pattern
</pre>
</div>
. Because of that, the comparison with <div class="listing">
<pre class="listing">==
</pre>
</div>
 will return <div class="listing">
<pre class="listing">false
</pre>
</div>
, which is correct.
</div>
<div class="Standard">
It helps to always take a moment to consider abnormal (but valid) inputs for a program. These are usually called corner cases<a class="IndexReference" name="entry-corner-case-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-corner-case">↓</a>, and it is very common for programs that work perfectly on all the ‘normal’ inputs to screw up on corner cases
<span class="branch">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [P] </span><span class="HoverFoot"><span class="SupFootMarker"> [P] </span>Some test cases for <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 are present in the source code file for this chapter.</span></span>
</span>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The only part of the cat-problem that is still unsolved is the extraction of names from a paragraph. The algorithm was this:
</div>
<ol>
<li>
Find the colon in the paragraph.
</li>
<li>
Take the part after this colon.
</li>
<li>
Split this part into separate names by looking for commas.
</li>

</ol>
<div class="Standard">
This has to happen both for paragraphs that start with <div class="listing">
<pre class="listing">’died’
</pre>
</div>
, and paragraphs that start with <div class="listing">
<pre class="listing">’born’
</pre>
</div>
. It would be a good idea to put it into a function, so that the two pieces of code that handle these different kinds of paragraphs can both use it.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 14</i></span></span><br><div class="PlainVisible">
Can you write a function <div class="listing">
<pre class="listing">catNames
</pre>
</div>
 that takes a paragraph as an argument and returns an array of names?
</div>
<div class="PlainVisible">
Strings have an <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
<a class="IndexReference" name="entry-indexOf-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-indexOf">↓</a> method that can be used to find the (first) position of a character or sub-string within that string. Also, when <div class="listing">
<pre class="listing">slice
</pre>
</div>
 is given only one argument, it will return the part of the string from the given position all the way to the end. With a range either the start or end can be left out: <div class="listing">
<pre class="listing">’shorthand’[...5]
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">’short’
</pre>
</div>
 and <div class="listing">
<pre class="listing">’shorthand’[5...]
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">’hand’
</pre>
</div>
.
</div>
<div class="PlainVisible">
It can be helpful to use CoffeeScript interactively to ‘explore’ functions. Try <div class="listing">
<pre class="listing">’foo: bar’.indexOf(’:’)
</pre>
</div>
 and see what you get.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">catNames = (paragraph) -&gt;
  colon = paragraph.indexOf ’:’
  paragraph[colon+2...].split ’, ’
​
show catNames ’born 20/09/2004 (mother Yellow Bess): ’ +
              ’Doctor Hobbles the 2nd, Noog’
</pre>
</div>
<div class="Standard">
The tricky part, which the original description of the algorithm ignored, is dealing with spaces after the colon and the commas. The <div class="listing">
<pre class="listing">+ 2
</pre>
</div>
 used when slicing the string is needed to leave out the colon itself and the space after it. The argument to <div class="listing">
<pre class="listing">split
</pre>
</div>
 contains both a comma and a space, because that is what the names are really separated by, rather than just a comma.<div class="PlainVisible">
This function does not do any checking for problems. We assume, in this case, that the input is always correct.
</div>
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
All that remains now is putting the pieces together. One way to do that looks like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">mailArchive = (require ’./04-emails’).retrieveMails()
livingCats = ’Spot’: true
​
for email, i in mailArchive
  paragraphs = email.split ’\n’
  for paragraph in paragraphs
    if startsWith paragraph, ’born’
      names = catNames paragraph
      for name in names
        livingCats[name] = true
    else if startsWith paragraph, ’died’
      names = catNames paragraph
      for name in names
        delete livingCats[name]
​
show livingCats
</pre>
</div>

</div>
<div class="Standard">
That is quite a big dense chunk of code. We will look into making it a bit lighter in a moment. But first let us look at our results. We know how to check whether a specific cat survives:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">if ’Spot’ in livingCats
  show ’Spot lives!’
else
  show ’Good old Spot, may she rest in peace.’
</pre>
</div>

</div>
<div class="Standard">
But how do we list all the cats that are alive? The <div class="listing">
<pre class="listing">of
</pre>
</div>
<a class="IndexReference" name="entry-of-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-of">↓</a> keyword is somewhat similar to the <div class="listing">
<pre class="listing">in
</pre>
</div>
 keyword when it is used together with <div class="listing">
<pre class="listing">for
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for cat of livingCats
  show cat
</pre>
</div>

</div>
<div class="Standard">
A loop like that will go over the names of the properties in an object, which allows us to enumerate all the names in our set.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Some pieces of code look like an impenetrable jungle. The example solution to the cat problem suffers from this. One way to make some light shine through it is to just add some strategic blank lines. This makes it look better, but does not really solve the problem.
</div>
<div class="Standard">
What is needed here is to break the code up. We already wrote two helper functions, <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 and <div class="listing">
<pre class="listing">catNames
</pre>
</div>
, which both take care of a small, understandable part of the problem. Let us continue doing this.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">addToSet = (set, values) -&gt;
  for i in [0..values.length]
    set[values[i]] = true
​
removeFromSet = (set, values) -&gt;
  for i in [0..values.length]
    delete set[values[i]]
</pre>
</div>

</div>
<div class="Standard">
These two functions take care of the adding and removing of names from the set. That already cuts out the two most inner loops from the solution:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">livingCats = ’Spot’: true
​
for email in mailArchive
  paragraphs = email.split ’\n’
  for paragraph in paragraphs
    if startsWith paragraph, ’born’
      addToSet livingCats, catNames paragraph
    else if startsWith paragraph, ’died’
      removeFromSet livingCats, catNames paragraph
​
show livingCats
</pre>
</div>

</div>
<div class="Standard">
Quite an improvement, if I may say so myself.
</div>
<div class="Standard">
Why do <div class="listing">
<pre class="listing">addToSet
</pre>
</div>
 and <div class="listing">
<pre class="listing">removeFromSet
</pre>
</div>
 take the set as an argument? They could use the variable <div class="listing">
<pre class="listing">livingCats
</pre>
</div>
 directly, if they wanted to. The reason is that this way they are not completely tied to our current problem. If <div class="listing">
<pre class="listing">addToSet
</pre>
</div>
 directly changed <div class="listing">
<pre class="listing">livingCats
</pre>
</div>
, it would have to be called <div class="listing">
<pre class="listing">addCatsToCatSet
</pre>
</div>
, or something similar. The way it is now, it is a more generally useful tool.
</div>
<div class="Standard">
Even if we are never going to use these functions for anything else, which is quite probable, it is useful to write them like this. Because they are ‘self sufficient’, they can be read and understood on their own, without needing to know about some external variable called <div class="listing">
<pre class="listing">livingCats
</pre>
</div>
.
</div>
<div class="Standard">
The functions are not pure: They change the object passed as their <div class="listing">
<pre class="listing">set
</pre>
</div>
 argument. This makes them slightly trickier than real pure functions, but still a lot less confusing than functions that run amok and change any value or variable they please.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
We continue breaking the algorithm into pieces:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">findLivingCats = -&gt;
  mailArchive = (require ’./04-emails’).retrieveMails()
  livingCats = ’Spot’: true
​
  handleParagraph = (paragraph) -&gt;
    if startsWith paragraph, ’born’
      addToSet livingCats, catNames paragraph
    else if startsWith paragraph, ’died’
      removeFromSet livingCats, catNames paragraph
​
  for email in mailArchive
    paragraphs = email.split ’\n’
    for paragraph in paragraphs
      handleParagraph paragraph
​
  livingCats
​
howMany = 0
for cat of findLivingCats()
  howMany++
show ’There are ’ + howMany + ’ cats.’
</pre>
</div>

</div>
<div class="Standard">
The whole algorithm is now encapsulated by a function. This means that it does not leave a mess after it runs: <div class="listing">
<pre class="listing">livingCats
</pre>
</div>
 is now a local variable in the function, instead of a top-level one, so it only exists while the function runs. The code that needs this set can call <div class="listing">
<pre class="listing">findLivingCats
</pre>
</div>
 and use the value it returns.
</div>
<div class="Standard">
It seemed to me that making <div class="listing">
<pre class="listing">handleParagraph
</pre>
</div>
 a separate function also cleared things up. But this one is so closely tied to the cat-algorithm that it is meaningless in any other situation. On top of that, it needs access to the <div class="listing">
<pre class="listing">livingCats
</pre>
</div>
 variable. Thus, it is a perfect candidate to be a function-inside-a-function. When it lives inside <div class="listing">
<pre class="listing">findLivingCats
</pre>
</div>
, it is clear that it is only relevant there, and it has access to the variables of its parent function.
</div>
<div class="Standard">
This solution is actually <i>bigger</i> than the previous one. Still, it is tidier and I hope you will agree that it is easier to read.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The program still ignores a lot of the information that is contained in the e-mails. There are birth-dates, dates of death, and the names of mothers in there.
</div>
<div class="Standard">
To start with the dates: What would be a good way to store a date? We could make an object with three properties, <div class="listing">
<pre class="listing">year
</pre>
</div>
, <div class="listing">
<pre class="listing">month
</pre>
</div>
, and <div class="listing">
<pre class="listing">day
</pre>
</div>
, and store numbers in them.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">whenWasIt = year: 1980, month: 2, day: 1
</pre>
</div>

</div>
<div class="Standard">
But CoffeeScript already provides a kind of object for this purpose. Such an object can be created by using the keyword <div class="listing">
<pre class="listing">new
</pre>
</div>
<a class="IndexReference" name="entry-new-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-new">↓</a>:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">whenWasIt = new Date 1980, 1, 1
show whenWasIt
</pre>
</div>

</div>
<div class="Standard">
Just like the notation with colons and optional braces we have already seen, <div class="listing">
<pre class="listing">new
</pre>
</div>
 is a way to create object values. Instead of specifying all the property names and values, a function is used to build up the object. This makes it possible to define a kind of standard procedure for creating objects. Functions like this are called constructors<a class="IndexReference" name="entry-constructor-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-constructor">↓</a>, and in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a> we will see how to write them.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">Date
</pre>
</div>
<a class="IndexReference" name="entry-Date-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Date">↓</a> constructor can be used in different ways.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show new Date
show new Date 1980, 1, 1
show new Date 2007, 2, 30, 8, 20, 30
</pre>
</div>

</div>
<div class="Standard">
As you can see, these objects can store a time of day as well as a date. When not given any arguments, an object representing the current time and date is created. Arguments can be given to ask for a specific date and time. The order of the arguments is year, month, day, hour, minute, second, milliseconds. These last four are optional, they become 0 when not given.
</div>
<div class="Standard">
The month numbers these objects use go from 0 to 11, which can be confusing. Especially since day numbers <i>do</i> start from 1.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The content of a <div class="listing">
<pre class="listing">Date
</pre>
</div>
 object can be inspected with a number of <div class="listing">
<pre class="listing">get...
</pre>
</div>
 methods.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">today = new Date();
show "Year: #{today.getFullYear()}
 month: #{today.getMonth()}
 day: #{today.getDate()}"
show "Hour: #{today.getHours()}
 minutes: #{today.getMinutes()}
 seconds: #{today.getSeconds()}"
show "Day of week: #{today.getDay()}"
</pre>
</div>

</div>
<div class="Standard">
All of these, except for <div class="listing">
<pre class="listing">getDay
</pre>
</div>
, also have a <div class="listing">
<pre class="listing">set...
</pre>
</div>
 variant that can be used to change the value of the date object.
</div>
<div class="Standard">
Inside the object, a date is represented by the amount of milliseconds it is away from January 1st 1970. You can imagine this is quite a large number.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">today = new Date()
show today.getTime()
</pre>
</div>

</div>
<div class="Standard">
A very useful thing to do with dates is comparing them.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">wallFall = new Date 1989, 10, 9
gulfWarOne = new Date 1990, 6, 2
show wallFall &lt; gulfWarOne
show wallFall == wallFall
# but
show wallFall == new Date 1989, 10, 9
</pre>
</div>

</div>
<div class="Standard">
Comparing dates with <div class="listing">
<pre class="listing">&lt;
</pre>
</div>
, <div class="listing">
<pre class="listing">&gt;
</pre>
</div>
, <div class="listing">
<pre class="listing">&lt;=
</pre>
</div>
, and <div class="listing">
<pre class="listing">&gt;=
</pre>
</div>
 does exactly what you would expect. When a date object is compared to itself with <div class="listing">
<pre class="listing">==
</pre>
</div>
 the result is <div class="listing">
<pre class="listing">true
</pre>
</div>
, which is also good. But when <div class="listing">
<pre class="listing">==
</pre>
</div>
<a class="IndexReference" name="entry-==-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-==">↓</a> is used to compare a date object to a different, equal date object, we get <div class="listing">
<pre class="listing">false
</pre>
</div>
. Huh?
</div>
<div class="Standard">
As mentioned earlier, <div class="listing">
<pre class="listing">==
</pre>
</div>
 will return <div class="listing">
<pre class="listing">false
</pre>
</div>
 when comparing two different objects, even if they contain the same properties. This is a bit clumsy and error-prone here, since one would expect <div class="listing">
<pre class="listing">&gt;=
</pre>
</div>
 and <div class="listing">
<pre class="listing">==
</pre>
</div>
 to behave in a more or less similar way. Testing whether two dates are equal can be done like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">wallFall1 = new Date 1989, 10, 9
wallFall2 = new Date 1989, 10, 9
show wallFall1.getTime() == wallFall2.getTime()
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In addition to a date and time, <div class="listing">
<pre class="listing">Date
</pre>
</div>
 objects also contain information about a timezone<a class="IndexReference" name="entry-timezone-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-timezone">↓</a>. When it is one o’clock in Amsterdam, it can, depending on the time of year, be noon in London, and seven in the morning in New York. Such times can only be compared when you take their time zones into account. The <div class="listing">
<pre class="listing">getTimezoneOffset
</pre>
</div>
<a class="IndexReference" name="entry-getTimezoneOffset-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-getTimezoneOffset">↓</a> function of a <div class="listing">
<pre class="listing">Date
</pre>
</div>
 can be used to find out how many minutes it differs from GMT (Greenwich Mean Time).
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">now = new Date()
show now.getTimezoneOffset()
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 15</i></span></span><br><div class="listing">
<pre class="listing">’died 27/04/2006: Black Leclère’
</pre>
</div>
The date part is always in the exact same place of a paragraph. How convenient. Write a function <div class="listing">
<pre class="listing">extractDate
</pre>
</div>
 that takes such a paragraph as its argument, extracts the date, and returns it as a date object.
</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">extractDate = (paragraph) -&gt;
  numberAt = (start, length) -&gt;
    Number paragraph[start...start + length]
  new Date numberAt(11, 4),     # Year
           numberAt( 8, 2) - 1, # Month
           numberAt( 5, 2)      # Day
​
show extractDate ’died 27-04-2006: Black Leclère’
</pre>
</div>
<div class="Standard">
It would work without the calls to <div class="listing">
<pre class="listing">Number
</pre>
</div>
, but as mentioned earlier, I prefer not to use strings as if they are numbers. The inner function was introduced to prevent having to repeat the <div class="listing">
<pre class="listing">Number
</pre>
</div>
 and <div class="listing">
<pre class="listing">slice
</pre>
</div>
 part three times.<div class="PlainVisible">
Note the <div class="listing">
<pre class="listing">-1
</pre>
</div>
 for the month number. Like most people, Aunt Emily counts her months from 1, so we have to adjust the value before giving it to the <div class="listing">
<pre class="listing">Date
</pre>
</div>
 constructor. (The day number does not have this problem, since <div class="listing">
<pre class="listing">Date
</pre>
</div>
 objects count days in the usual human way.)
</div>
<div class="PlainVisible">
In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Regular-Expressions"><span class="sans">Regular Expressions</span>↓</a> we will see a more practical and robust way of extracting pieces from strings that have a fixed structure.
</div>
</div>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Storing cats will work differently from now on. Instead of just putting the value <div class="listing">
<pre class="listing">true
</pre>
</div>
 into the set, we store an object with information about the cat. When a cat dies, we do not remove it from the set, we just add a property <div class="listing">
<pre class="listing">death
</pre>
</div>
 to the object to store the date on which the creature died.
</div>
<div class="Standard">
This means our <div class="listing">
<pre class="listing">addToSet
</pre>
</div>
 and <div class="listing">
<pre class="listing">removeFromSet
</pre>
</div>
 functions have become useless. Something similar is needed, but it must also store birth-dates and, later, the mother’s name.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">catRecord = (name, birthdate, mother) -&gt;
  name:   name
  birth:  birthdate
  mother: mother
​
addCats = (set, names, birthdate, mother) -&gt;
  for name in names
    set[name] = catRecord name, birthdate, mother
​
deadCats = (set, names, deathdate) -&gt;
  for name in names
    set[name].death = deathdate
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">catRecord
</pre>
</div>
 is a separate function for creating these storage objects. It might be useful in other situations, such as creating the object for Spot. ‘Record’ is a term often used for objects like this, which are used to group a limited number of values.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
So let us try to extract the names of the mother cats from the paragraphs.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">’born 15/11/2003 (mother Spot): White Fang’
</pre>
</div>

</div>
<div class="Standard">
One way to do this would be…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">extractMother = (paragraph) -&gt;
  start = paragraph.indexOf ’(mother ’
  start += ’(mother ’.length
  end = paragraph.indexOf ’)’
  paragraph[start...end]
​
show extractMother \
  ’born 15/11/2003 (mother Spot): White Fang’
</pre>
</div>

</div>
<div class="Standard">
Notice how the start position has to be adjusted for the length of the string <div class="listing">
<pre class="listing">’(mother ’
</pre>
</div>
, because <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
 returns the position of the start of the pattern, not its end.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 16</i></span></span><br><div class="PlainVisible">
The thing that <div class="listing">
<pre class="listing">extractMother
</pre>
</div>
 does can be expressed in a more general way. Write a function <div class="listing">
<pre class="listing">between
</pre>
</div>
 that takes three arguments, all of which are strings. It will return the part of the first argument that occurs between the patterns given by the second and the third arguments. That is:
</div>
<div class="PlainVisible">
<div class="listing">
<pre class="listing">between ’born 15/11/2003 (mother Spot): White Fang’,
</pre>
</div>
<br>
<div class="listing">
<pre class="listing">          ’(mother ’, ’)’
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">’Spot’
</pre>
</div>

</div>
<div class="PlainVisible">
<div class="listing">
<pre class="listing">between ’bu ] boo [ bah ] gzz’, ’[ ’, ’ ]’
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">’bah’
</pre>
</div>

</div>
<div class="PlainVisible">
To make that second test work, it can be useful to know that <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
 can be given a second, optional parameter that specifies at which point it should start searching.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">between = (string, start, end) -&gt;
  startAt = string.indexOf start
  startAt += start.length
  endAt = string.indexOf end, startAt
  string[startAt...endAt]
show between ’bu ] boo [ bah ] gzz’, ’[ ’, ’ ]’
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Having <div class="listing">
<pre class="listing">between
</pre>
</div>
 makes it possible to express extractMother in a simpler way:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">extractMother = (paragraph) -&gt;
  between paragraph, ’(mother ’, ’)’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The new, improved cat-algorithm looks like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">findCats = -&gt;
  mailArchive = (require ’./04-emails’).retrieveMails()
  cats = {’Spot’: catRecord ’Spot’,
    new Date(1997, 2, 5), ’unknown’}
​
  handleParagraph = (paragraph) -&gt;
    if startsWith paragraph, ’born’
      addCats cats, catNames(paragraph),
              extractDate(paragraph),
              extractMother(paragraph)
    else if startsWith paragraph, ’died’
      deadCats cats, catNames(paragraph),
               extractDate(paragraph)
​
  for email in mailArchive
    paragraphs = email.split ’\n’
    for paragraph in paragraphs
      handleParagraph paragraph
  cats
​
catData = findCats()
show catData
</pre>
</div>

</div>
<div class="Standard">
Having that extra data allows us to finally have a clue about the cats aunt Emily talks about. A function like this could be useful:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">formatDate = (date) -&gt; "#{date.getDate()}/" +
                       "#{date.getMonth() + 1}/" +
                       "#{date.getFullYear()}"
catInfo = (data, name) -&gt;
  unless name of data
    return "No cat by the name of #{name} is known."
  cat = data[name]
  message = "#{name}," +
            " born #{formatDate cat.birth}" +
            " from mother #{cat.mother}"
  if "death" of cat
    message += ", died #{formatDate cat.death}"
  "#{message}."
​
show catInfo catData, "Fat Igor"
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement in <div class="listing">
<pre class="listing">catInfo
</pre>
</div>
 is used as an escape hatch. If there is no data about the given cat, the rest of the function is meaningless, so we immediately return a value, which prevents the rest of the code from running.
</div>
<div class="Standard">
In the past, certain groups of programmers considered functions that contain multiple <div class="listing">
<pre class="listing">return
</pre>
</div>
 statements sinful. The idea was that this made it hard to see which code was executed and which code was not. Other techniques, which will be discussed in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Error-Handling"><span class="sans">Error Handling</span>↓</a>, have made the reasons behind this idea more or less obsolete, but you might still occasionally come across someone who will criticise the use of ‘shortcut’ return statements.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 17</i></span></span><br><div class="PlainVisible">
The <div class="listing">
<pre class="listing">formatDate
</pre>
</div>
 function used by <div class="listing">
<pre class="listing">catInfo
</pre>
</div>
 does not add a zero before the month and the day part when these are only one digit long. Write a new version that does this.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">formatDate = (date) -&gt;
  pad = (number) -&gt;
    if number &lt; 10
      "0" + number
    else
      number
  "#{pad date.getDate()}/" +
  "#{pad date.getMonth() + 1}/" +
  "#{date.getFullYear()}"
​
show formatDate new Date 2000, 0, 1
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-existential-accessor-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-existential-accessor">↓</a><a class="IndexReference" name="entry-?.-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-?.">↓</a>The property ‘dot’ accessor that we have been using comes in a handy form combined with the existential operator. Instead of <div class="listing">
<pre class="listing">object.element
</pre>
</div>
 we can write <div class="listing">
<pre class="listing">object?.element
</pre>
</div>
 if <div class="listing">
<pre class="listing">object
</pre>
</div>
 is defined then we get the value as before. But if it is <div class="listing">
<pre class="listing">null
</pre>
</div>
 then we get <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 instead of an error.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 18</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">oldestCat
</pre>
</div>
 which, given an object containing cats as its argument, returns the name of the oldest living cat.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">oldestCat = (data) -&gt;
  oldest = null
  for name of data
    cat = data[name]
    unless ’death’ of cat
      if oldest is null or oldest.birth &gt; cat.birth
        oldest = cat
  oldest?.name
show oldestCat catData
</pre>
</div>
<div class="Standard">
The conditions in the <div class="listing">
<pre class="listing">unless/if
</pre>
</div>
 statements might seem a little intimidating. It can be read as ‘only store the current cat in the variable <div class="listing">
<pre class="listing">oldest
</pre>
</div>
 if it is not dead, and <div class="listing">
<pre class="listing">oldest
</pre>
</div>
 is either <div class="listing">
<pre class="listing">null
</pre>
</div>
 or a cat that was born after the current cat’.</div>
<div class="listing">
<pre class="listing">for cat, info of catData # Test with dead cats
  delete catData[cat] unless ’death’ of info
show oldestCat catData
</pre>
</div>
<div class="Standard">
Note that this function returns <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 when there are no living cats in <div class="listing">
<pre class="listing">data
</pre>
</div>
. What does your solution do in that case?
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
Now that we are familiar with arrays, I can show you something related. Whenever a function is called, a special variable named <div class="listing">
<pre class="listing">arguments
</pre>
</div>
<a class="IndexReference" name="entry-arguments-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-arguments">↓</a> is added to the environment in which the function body runs. This variable refers to an object that resembles an array. It has a property <div class="listing">
<pre class="listing">0
</pre>
</div>
 for the first argument, <div class="listing">
<pre class="listing">1
</pre>
</div>
 for the second, and so on for every argument the function was given. It also has a <div class="listing">
<pre class="listing">length
</pre>
</div>
<a class="IndexReference" name="entry-length-2" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-length">↓</a> property.
</div>
<div class="Standard">
This object is not a real array though, it does not have methods like <div class="listing">
<pre class="listing">push
</pre>
</div>
, and it does not automatically update its <div class="listing">
<pre class="listing">length
</pre>
</div>
 property when you add something to it. Why not, I never really found out, but this is something one needs to be aware of.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">argumentCounter = -&gt;
  show "You gave me #{arguments.length} arguments."
​
argumentCounter "Death", "Famine", "Pestilence"
</pre>
</div>

</div>
<div class="Standard">
Some functions can take any number of arguments. These typically loop over the values in the <div class="listing">
<pre class="listing">arguments
</pre>
</div>
 object to do something with them. We can create a <div class="listing">
<pre class="listing">print
</pre>
</div>
 function that uses <div class="listing">
<pre class="listing">show
</pre>
</div>
 to print each of its arguments.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">print = -&gt; show arg for arg in arguments
​
print ’From here to’, 1/0
</pre>
</div>

</div>
<div class="Standard">
Others can take optional arguments which, when not given by the caller, get some sensible default value.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">add = (number, howmuch) -&gt;
  if  arguments.length &lt; 2
    howmuch = 1
  number + howmuch
​
show add 6
show add 6, 4
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 19</i></span></span><br><div class="PlainVisible">
Extend the <div class="listing">
<pre class="listing">range
</pre>
</div>
 function from the exercise <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#sub:Exerciserange"> on page 1↑</a> to take a second, optional argument. If only one argument is given, it behaves as earlier and produces a range from 0 to the given number. If two arguments are given, the first indicates the start of the range, the second the end.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">range = (start, end) -&gt;
  if arguments.length &lt; 2
    end = start
    start = 0
  result = []
  for i in [start..end]
    result.push i
  result
​
show range 4
show range 2, 4
</pre>
</div>
<div class="Standard">
The optional argument does not work precisely like the one in the <div class="listing">
<pre class="listing">add
</pre>
</div>
 example above. When it is not given, the first argument takes the role of <div class="listing">
<pre class="listing">end
</pre>
</div>
, and <div class="listing">
<pre class="listing">start
</pre>
</div>
 becomes <div class="listing">
<pre class="listing">0
</pre>
</div>
.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
CoffeeScript has a few of features that can make it simpler to work with arguments. You can set default values directly in the argument list. The <div class="listing">
<pre class="listing">show
</pre>
</div>
 function is defined like:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show = (obj, depth = 2, showHidden = false,
             colors = useColors) -&gt;
  # body
</pre>
</div>

</div>
<div class="Standard">
When the arguments starting from <div class="listing">
<pre class="listing">depth
</pre>
</div>
 are not present in a call, they get the value after the <div class="listing">
<pre class="listing">=
</pre>
</div>
. No checks are needed in the body where the arguments are used.
</div>
<div class="Standard">
For variable arguments you can use <div class="listing">
<pre class="listing">...
</pre>
</div>
 commonly called splats. The ellipsis can indicate extra arguments in a function definition or a call. Do you remember the testPure function? It was used with both <div class="listing">
<pre class="listing">absolute
</pre>
</div>
 which takes one argument and <div class="listing">
<pre class="listing">power
</pre>
</div>
 which takes two. In its definition <div class="listing">
<pre class="listing">(c, a...)
</pre>
</div>
 says that <div class="listing">
<pre class="listing">a...
</pre>
</div>
 is a variable argument list. The variable arguments are used two times, in the call to <div class="listing">
<pre class="listing">func
</pre>
</div>
 and in the call to <div class="listing">
<pre class="listing">property
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prelude.qc.testPure = (func, types, name, property) -&gt;
  prelude.qc.declare name, types, (c, a...) -&gt;
    c.assert property c, a..., c.note func a...
</pre>
</div>

</div>
<div class="Standard">
Finally the <div class="listing">
<pre class="listing">or=
</pre>
</div>
 operator can be used in <div class="listing">
<pre class="listing">options or= defaults
</pre>
</div>
 as shorthand for <div class="listing">
<pre class="listing">options || (options = defaults)
</pre>
</div>
.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<div class="PlainVisible">
<span class="sans"><span class="large"><i>Exercise 20</i></span></span><br><br>
You may remember this line of code from the introduction:
</div>
<div class="listing">
<pre class="listing">show sum [1..10]
</pre>
</div>
All we need to make this line work is a <div class="listing">
<pre class="listing">sum
</pre>
</div>
 function. This function takes an array of numbers, and returns their sum. Write it, it should be easy. Check that it also works with <div class="listing">
<pre class="listing">range
</pre>
</div>
.
</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">sum = (numbers) -&gt;
  total = 0
  for num in numbers
    total += num
  total
​
show sum [1..10]
show sum range 1, 10
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
The previous chapter showed the functions <div class="listing">
<pre class="listing">Math.max
</pre>
</div>
 and <div class="listing">
<pre class="listing">Math.min
</pre>
</div>
. With what you know now, you will notice that these are really the properties <div class="listing">
<pre class="listing">max
</pre>
</div>
 and <div class="listing">
<pre class="listing">min
</pre>
</div>
 of the object stored under the name <div class="listing">
<pre class="listing">Math
</pre>
</div>
<a class="IndexReference" name="entry-Math-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math">↓</a>. This is another role that objects can play: A warehouse holding a number of related values.
</div>
<div class="Standard">
There are quite a lot of values inside <div class="listing">
<pre class="listing">Math
</pre>
</div>
, if they would all have been placed directly into the global environment they would, as it is called, pollute it. The more names have been taken, the more likely one is to accidentally overwrite the value of some variable. For example, it is not a far shot to want to name something <div class="listing">
<pre class="listing">max
</pre>
</div>
.
</div>
<div class="Standard">
Most languages will stop you, or at least warn you, when you are defining a variable with a name that is already taken. Not JavaScript.
</div>
<div class="Standard">
In any case, one can find a whole outfit of mathematical functions and constants inside <div class="listing">
<pre class="listing">Math
</pre>
</div>
. All the trigonometric functions are there — <div class="listing">
<pre class="listing">cos
</pre>
</div>
, <div class="listing">
<pre class="listing">sin
</pre>
</div>
, <div class="listing">
<pre class="listing">tan
</pre>
</div>
, <div class="listing">
<pre class="listing">acos
</pre>
</div>
, <div class="listing">
<pre class="listing">asin
</pre>
</div>
, <div class="listing">
<pre class="listing">atan
</pre>
</div>
. <span class="formula"><i>π</i></span> and e, which are written with all capital letters (<div class="listing">
<pre class="listing">PI
</pre>
</div>
 and <div class="listing">
<pre class="listing">E
</pre>
</div>
), which was, at one time, a fashionable way to indicate something is a constant. <div class="listing">
<pre class="listing">pow
</pre>
</div>
 is a good replacement for the <div class="listing">
<pre class="listing">power
</pre>
</div>
 functions we have been writing, it also accepts negative and fractional exponents. <div class="listing">
<pre class="listing">sqrt
</pre>
</div>
 takes square roots. <div class="listing">
<pre class="listing">max
</pre>
</div>
 and <div class="listing">
<pre class="listing">min
</pre>
</div>
 can give the maximum or minimum of two values. <div class="listing">
<pre class="listing">round
</pre>
</div>
<a class="IndexReference" name="entry-Math.round-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.round">↓</a>, <div class="listing">
<pre class="listing">floor
</pre>
</div>
<a class="IndexReference" name="entry-Math.floor-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.floor">↓</a>, and <div class="listing">
<pre class="listing">ceil
</pre>
</div>
<a class="IndexReference" name="entry-Math.ceil-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.ceil">↓</a> will round numbers to the closest whole number, the whole number below it, and the whole number above it respectively.
</div>
<div class="Standard">
There are a number of other values in <div class="listing">
<pre class="listing">Math
</pre>
</div>
, but this text is an introduction, not a reference<a class="IndexReference" name="entry-reference-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-reference">↓</a>. References are what you look at when you suspect something exists in the language, but need to find out what it is called or how it worked exactly. A useful <a class="URL" href="https://developer.mozilla.org/en/JavaScript/Reference#Standard_global_objects_(by_category)">reference for predefined global objects</a> like the <div class="listing">
<pre class="listing">Math
</pre>
</div>
 object exist at the <a class="URL" href="https://developer.mozilla.org/en/Javascript">Mozilla Developer Network</a>.
</div>
<div class="Standard">
An interesting object is <div class="listing">
<pre class="listing">Array
</pre>
</div>
 when you look through its <a class="URL" href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array">reference</a> notice that many definitions for example <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 are marked <div class="Boxed" style="width: 22%;">
<span class="scriptsize">Requires JavaScript 1.6</span>
</div>
 or another version number. JavaScript 1.5 corresponds to <span class="small">ECMA-262 3<sup>rd</sup></span><span class="default"> Edition from December 1999.</span>
</div>
<div class="Standard">
More than a decade later this is still the standard that most JavaScript engines implement — including V8, the engine that via JavaScript compiles CoffeeScript to native machine code. It is fair to say that JavaScript is evolving at a glacial pace. Fortunately CoffeeScript and Underscore leapfrogs the JavaScript process and gives you language and library advances that you can use without waiting for existing browsers and engines to be upgraded.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Maybe you already thought of a way to find out what is available in the <div class="listing">
<pre class="listing">Math
</pre>
</div>
 object:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for name of Math
  show name
</pre>
</div>

</div>
<div class="Standard">
But alas, nothing appears. Similarly, when you do this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for name of [’Huey’, ’Dewey’, ’Loui’]
  show name
</pre>
</div>

</div>
<div class="Standard">
You only see <div class="listing">
<pre class="listing">0
</pre>
</div>
, <div class="listing">
<pre class="listing">1
</pre>
</div>
, and <div class="listing">
<pre class="listing">2
</pre>
</div>
, not <div class="listing">
<pre class="listing">length
</pre>
</div>
, or <div class="listing">
<pre class="listing">push
</pre>
</div>
, or <div class="listing">
<pre class="listing">join
</pre>
</div>
, which are definitely also in there. Apparently, some properties of objects are hidden<a class="IndexReference" name="entry-hidden-properties-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-hidden-properties">↓</a>. There is a good reason for this: All objects have a few methods, for example <div class="listing">
<pre class="listing">toString
</pre>
</div>
<a class="IndexReference" name="entry-toString-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-toString">↓</a>, which converts the object into some kind of relevant string, and you do not want to see those when you are, for example, looking for the cats that you stored in the object.
</div>
<div class="Standard">
Why the properties of <div class="listing">
<pre class="listing">Math
</pre>
</div>
 are hidden is unclear to me. Someone probably wanted it to be a mysterious kind of object. But you can peek under the hood with <div class="listing">
<pre class="listing">show
</pre>
</div>
 — see the prelude for details:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show Math, 2, true
show [’Huey’, ’Dewey’, ’Loui’], 2, true
</pre>
</div>

</div>
<div class="Standard">
All properties your programs add to objects are visible. There is no way to make them hidden, which is unfortunate because, as we will see in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>, it would be nice to be able to add methods to objects without having them show up in our <div class="listing">
<pre class="listing">for
</pre>
</div>
 / <div class="listing">
<pre class="listing">of
</pre>
</div>
 loops.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-read-only-properties-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-read-only-properties">↓</a>Some properties are read-only, you can get their value but not change it. For example, the properties of a string value are all read-only.
</div>
<div class="Standard">
<a class="IndexReference" name="entry-watched-properties-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-watched-properties">↓</a>Other properties can be ‘watched’. Changing them causes <i>things</i> to happen. For example, lowering the length of an array causes excess elements to be discarded:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">array = [’Heaven’, ’Earth’, ’Man’]
array.length = 2
show array
</pre>
</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-6"></a>Error Handling<a class="Label" name="chap:Error-Handling"> </a>
</h1>
<div class="Standard">
Writing programs that work when everything goes as expected is a good start. Making your programs behave properly when encountering unexpected conditions is where it really gets challenging.
</div>
<div class="Standard">
The problematic situations that a program can encounter fall into two categories: Programmer mistakes and genuine problems. If someone forgets to pass a required argument to a function, that is an example of the first kind of problem. On the other hand, if a program asks the user to enter a name and it gets back an empty string, that is something the programmer can not prevent.
</div>
<div class="Standard">
In general, one deals with programmer errors by finding and fixing them, and with genuine errors by having the code check for them and perform some suitable action to remedy them (for example, asking for the name again), or at least fail in a well-defined and clean way.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
It is important to decide into which of these categories a certain problem falls. For example, consider our old <div class="listing">
<pre class="listing">power
</pre>
</div>
 function:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">power = (base, exponent) -&gt;
  result = 1
  for count in [0..exponent]
    result *= base
  result
</pre>
</div>

</div>
<div class="Standard">
When some geek tries to call <div class="listing">
<pre class="listing">power ’Rabbit’, 4
</pre>
</div>
, that is quite obviously a programmer error, but how about <div class="listing">
<pre class="listing">power 9, 0.5
</pre>
</div>
? The function can not handle fractional exponents, but, mathematically speaking, raising a number to the ½ power is perfectly reasonable (<div class="listing">
<pre class="listing">Math.pow
</pre>
</div>
<a class="IndexReference" name="entry-Math.pow-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.pow">↓</a> can handle it). In situations where it is not entirely clear what kind of input a function accepts, it is often a good idea to explicitly state the kind of arguments that are acceptable in a comment.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
If a function encounters a problem that it can not solve itself, what should it do? In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> we wrote the function <div class="listing">
<pre class="listing">between
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">between = (string, start, end) -&gt;
  startAt = string.indexOf start
  startAt += start.length 
  endAt = string.indexOf end, startAt
  string[startAt...endAt]
</pre>
</div>

</div>
<div class="Standard">
If the given <div class="listing">
<pre class="listing">start
</pre>
</div>
 and <div class="listing">
<pre class="listing">end
</pre>
</div>
 do not occur in the string, <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
 will return <div class="listing">
<pre class="listing">-1
</pre>
</div>
 and this version of <div class="listing">
<pre class="listing">between
</pre>
</div>
 will return a lot of nonsense:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">between(’Your mother!’, ’{-’, ’-}’)
</pre>
</div>
 returns <div class="listing">
<pre class="listing">’our mother’
</pre>
</div>
.
</div>
<div class="Standard">
When the program is running, and the function is called like that, the code that called it will get a string value, as it expected, and happily continue doing something with it. But the value is wrong, so whatever it ends up doing with it will also be wrong. And if you are unlucky, this wrongness only causes a problem after having passed through twenty other functions. In cases like that, it is extremely hard to find out where the problem started.
</div>
<div class="Standard">
In some cases, you will be so unconcerned about these problems that you do not mind the function misbehaving when given incorrect input. For example, if you know for sure the function will only be called from a few places, and you can prove that these places give it decent input, it is generally not worth the trouble to make the function bigger and uglier so that it can handle problematic cases.
</div>
<div class="Standard">
But most of the time, functions that fail ‘silently’ are hard to use, and even dangerous. What if the code calling <div class="listing">
<pre class="listing">between
</pre>
</div>
 wants to know whether everything went well? At the moment, it can not tell, except by re-doing all the work that <div class="listing">
<pre class="listing">between
</pre>
</div>
 did and checking the result of <div class="listing">
<pre class="listing">between
</pre>
</div>
 with its own result. That is bad. One solution is to make <div class="listing">
<pre class="listing">between
</pre>
</div>
 return a special value, such as <div class="listing">
<pre class="listing">false
</pre>
</div>
 or <div class="listing">
<pre class="listing">undefined
</pre>
</div>
, when it fails.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">between = (string, start, end) -&gt;
  startAt = string.indexOf start
  if startAt == -1 then return
  startAt += start.length
  endAt = string.indexOf end, startAt
  if endAt == -1 then return
  string[startAt...endAt]
</pre>
</div>

</div>
<div class="Standard">
You can see that error checking does not generally make functions prettier. But now code that calls <div class="listing">
<pre class="listing">between
</pre>
</div>
 can do something like:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">prompt "Tell me something", "", (answer) -&gt;
  parenthesized = between answer, "(", ")"
  if parenthesized?
    show "You parenthesized ’#{parenthesized}’."
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In many cases returning a special value is a perfectly fine way to indicate an error. It does, however, have its downsides. Firstly, what if the function can already return every possible kind of value? For example, consider this function that gets the last element from an array:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">lastElement = (array) -&gt;
  if array.length &gt; 0
    array[array.length - 1]
  else
    undefined
show lastElement [1, 2, undefined]
</pre>
</div>

</div>
<div class="Standard">
So did the array have a last element? Looking at the value <div class="listing">
<pre class="listing">lastElement
</pre>
</div>
 returns, it is impossible to say.
</div>
<div class="Standard">
The second issue with returning special values is that it can sometimes lead to a whole lot of clutter. If a piece of code calls <div class="listing">
<pre class="listing">between
</pre>
</div>
 ten times, it has to check ten times whether <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 was returned. Also, if a function calls <div class="listing">
<pre class="listing">between
</pre>
</div>
 but does not have a strategy to recover from a failure, it will have to check the return value of <div class="listing">
<pre class="listing">between
</pre>
</div>
, and if it is <div class="listing">
<pre class="listing">undefined
</pre>
</div>
, this function can then return <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 or some other special value to its caller, who in turn also checks for this value.
</div>
<div class="Standard">
Sometimes, when something strange occurs, it would be practical to just stop doing what we are doing and immediately jump back to a place that knows how to handle the problem.
</div>
<div class="Standard">
Well, we are in luck, a lot of programming languages provide such a thing. Usually, it is called exception handling<a class="IndexReference" name="entry-exception-handling-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-exception-handling">↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The theory behind exception handling goes like this: It is possible for code to raise<a class="IndexReference" name="entry-raise-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-raise">↓</a> (or throw<a class="IndexReference" name="entry-throw-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-throw">↓</a>) an exception<a class="IndexReference" name="entry-exception-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-exception">↓</a>, which is a value. Raising an exception somewhat resembles a super-charged return from a function — it does not just jump out of the current function, but also out of its callers, all the way up to the top-level call that started the current execution. This is called unwinding the stack<a class="IndexReference" name="entry-unwinding-the-stack-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-unwinding-the-stack">↓</a>. You may remember the stack<a class="IndexReference" name="entry-stack-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-stack">↓</a> of function calls that was mentioned in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functions"><span class="sans">Functions</span>↑</a>. An exception zooms down this stack, throwing away all the call contexts it encounters.
</div>
<div class="Standard">
If they always zoomed right down to the base of the stack, exceptions would not be of much use, they would just provide a novel way to blow up your program. Fortunately, it is possible to set obstacles for exceptions along the stack. These ‘catch’<a class="IndexReference" name="entry-catch-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-catch">↓</a> the exception as it is zooming down, and can do something with it, after which the program continues running at the point where the exception was caught. An example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">lastElement = (array) -&gt;
  if array.length &gt; 0
    array[array.length - 1]
  else
    throw ’Can not take the last element’ +
          ’ of an empty array.’ 
​
lastElementPlusTen = (array) -&gt;
  lastElement(array) + 10
​
try
  show lastElementPlusTen []
catch error
  show ’Something went wrong: ’ + error
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">throw
</pre>
</div>
<a class="IndexReference" name="entry-throw-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-throw">↓</a> is the keyword that is used to raise an exception. The keyword <div class="listing">
<pre class="listing">try
</pre>
</div>
<a class="IndexReference" name="entry-try-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-try">↓</a> sets up an obstacle for exceptions: When the code in the block after it raises an exception, the <div class="listing">
<pre class="listing">catch
</pre>
</div>
<a class="IndexReference" name="entry-catch-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-catch">↓</a> block will be executed. The variable named in parentheses after the word <div class="listing">
<pre class="listing">catch
</pre>
</div>
 is the name given to the exception value inside this block.
</div>
<div class="Standard">
Note that the function <div class="listing">
<pre class="listing">lastElementPlusTen
</pre>
</div>
 completely ignores the possibility that <div class="listing">
<pre class="listing">lastElement
</pre>
</div>
 might go wrong. This is the big advantage of exceptions — error-handling code is only necessary at the point where the error occurs, and the point where it is handled. The functions in between can forget all about it. Well, almost.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Consider the following: A function <div class="listing">
<pre class="listing">processThing
</pre>
</div>
 wants to set a top-level variable <div class="listing">
<pre class="listing">currentThing
</pre>
</div>
 to point to a specific thing while its body executes, so that other functions can have access to that thing too. Normally you would of course just pass the thing as an argument, but assume for a moment that that is not practical. When the function finishes, <div class="listing">
<pre class="listing">currentThing
</pre>
</div>
 should be set back to <div class="listing">
<pre class="listing">null
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">currentThing = null
​
processThing = (thing) -&gt;
  if currentThing != null
    throw ’Oh no! We are already processing a thing!’
​
  currentThing = thing
  # do complicated processing...
  currentThing = null
</pre>
</div>

</div>
<div class="Standard">
But what if the complicated processing raises an exception? In that case the call to <div class="listing">
<pre class="listing">processThing
</pre>
</div>
 will be thrown off the stack by the exception, and <div class="listing">
<pre class="listing">currentThing
</pre>
</div>
 will never be reset to <div class="listing">
<pre class="listing">null
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">try
</pre>
</div>
 statements can also be followed by a <div class="listing">
<pre class="listing">finally
</pre>
</div>
<a class="IndexReference" name="entry-finally-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-finally">↓</a> keyword, which means ‘no matter <i>what</i> happens, run this code after trying to run the code in the <div class="listing">
<pre class="listing">try
</pre>
</div>
 block’. If a function has to clean something up, the cleanup code should usually be put into a <div class="listing">
<pre class="listing">finally
</pre>
</div>
 block:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">processThing = (thing) -&gt;
  if currentThing != null
    throw ’Oh no! We are already processing a thing!’
​
  currentThing = thing
  try
    # do complicated processing...
  finally
    currentThing = null
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A lot of errors in programs cause the CoffeeScript environment to raise an exception. For example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">try
  show Sasquatch
catch error
  show ’Caught: ’ + error.message
</pre>
</div>

</div>
<div class="Standard">
In cases like this, special error objects are raised. These always have a <div class="listing">
<pre class="listing">message
</pre>
</div>
 property containing a description of the problem. You can raise similar objects using the <div class="listing">
<pre class="listing">new
</pre>
</div>
 keyword and the <div class="listing">
<pre class="listing">Error
</pre>
</div>
<a class="IndexReference" name="entry-Error-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Error">↓</a> constructor:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">throw new Error ’Fire!’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When an exception goes all the way to the bottom of the stack without being caught, it gets handled by the environment. What this means differs between different browsers and engines, sometimes a description of the error is written to some kind of log, sometimes a window pops up describing the error.
</div>
<div class="Standard">
The errors produced by entering code in the CoffeeScript REPL are caught by the console, and displayed along with a stack trace.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Most programmers consider exceptions purely an error-handling mechanism. In essence, though, they are just another way of influencing the control flow of a program. For example, they can be used as a kind of <div class="listing">
<pre class="listing">break
</pre>
</div>
 statement in a recursive function. Here is a slightly strange function which determines whether an object, and the objects stored inside it, contain at least seven <div class="listing">
<pre class="listing">true
</pre>
</div>
 values:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">FoundSeven = {}
hasSevenTruths = (object) -&gt;
  counted = 0
  count = (object) -&gt;
    for name of object
      if object[name] == true
        if (++counted) == 7
          throw FoundSeven
      if typeof object[name] == ’object’
        count object[name]
  try
    count object
    return false
  catch exception
    if exception != FoundSeven
      throw exception
    return true
</pre>
</div>

</div>
<div class="Standard">
The inner function <div class="listing">
<pre class="listing">count
</pre>
</div>
 is recursively called for every object that is part of the argument. When the variable <div class="listing">
<pre class="listing">counted
</pre>
</div>
 reaches seven, there is no point in continuing to count, but just returning from the current call to <div class="listing">
<pre class="listing">count
</pre>
</div>
 will not necessarily stop the counting, since there might be more calls below it. So what we do is just throw a value, which will cause the control to jump right out of any calls to <div class="listing">
<pre class="listing">count
</pre>
</div>
, and land at the <div class="listing">
<pre class="listing">catch
</pre>
</div>
 block.
</div>
<div class="Standard">
But just returning <div class="listing">
<pre class="listing">true
</pre>
</div>
 in case of an exception is not correct. Something else might be going wrong, so we first check whether the exception is the object <div class="listing">
<pre class="listing">FoundSeven
</pre>
</div>
, created specifically for this purpose. If it is not, this <div class="listing">
<pre class="listing">catch
</pre>
</div>
 block does not know how to handle it, so it raises it again.
</div>
<div class="Standard">
This is a pattern that is also common when dealing with error conditions — you have to make sure that your <div class="listing">
<pre class="listing">catch
</pre>
</div>
 block only handles exceptions that it knows how to handle. Throwing string values, as some of the examples in this chapter do, is rarely a good idea, because it makes it hard to recognise the type of the exception. A better idea is to use unique values, such as the <div class="listing">
<pre class="listing">FoundSeven
</pre>
</div>
 object, or to introduce a new type of objects, as described in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>.
</div>
<h1 class="Part">
<a class="toc" name="toc-Part-III">Part III.</a> Paradigm
</h1>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-7"></a>Functional Programming<a class="Label" name="chap:Functional-Programming"> </a>
</h1>
<div class="Standard">
As programs get bigger, they also become more complex and harder to understand. We all think ourselves pretty clever, of course, but we are mere human beings, and even a moderate amount of chaos tends to baffle us. And then it all goes downhill. Working on something you do not really understand is a bit like cutting random wires on those time-activated bombs they always have in movies. If you are lucky, you might get the right one — especially if you are the hero of the movie and strike a suitably dramatic pose — but there is always the possibility of blowing everything up.
</div>
<div class="Standard">
Admittedly, in most cases, breaking a program does not cause any large explosions. But when a program, by someone’s ignorant tinkering, has degenerated into a ramshackle mass of errors, reshaping it into something sensible is a terrible labour — sometimes you might just as well start over.
</div>
<div class="Standard">
<a class="IndexReference" name="entry-abstraction-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-abstraction">↓</a>Thus, the programmer is always looking for ways to keep the complexity of his programs as low as possible. An important way to do this is to try and make code more abstract. When writing a program, it is easy to get sidetracked into small details at every point. You come across some little issue, and you deal with it, and then proceed to the next little problem, and so on. This makes the code read like a grandmother’s tale.
</div>
<blockquote class="Quote">
<i>Yes, dear, to make pea soup you will need split peas, the dry kind. And you have to soak them at least for a night, or you will have to cook them for hours and hours. I remember one time, when my dull son tried to make pea soup. Would you believe he hadn’t soaked the peas? We almost broke our teeth, all of us. Anyway, when you have soaked the peas, and you’ll want about a cup of them per person, and pay attention because they will expand a bit while they are soaking, so if you aren’t careful they will spill out of whatever you use to hold them, so also use plenty water to soak in, but as I said, about a cup of them, when they are dry, and after they are soaked you cook them in four cups of water per cup of dry peas. Let it simmer for two hours, which means you cover it and keep it barely cooking, and then add some diced onions, sliced celery stalk, and maybe a carrot or two and some ham. Let it all cook for a few minutes more, and it is ready to eat.</i>
</blockquote>
<div class="Standard">
Another way to describe this recipe:
</div>
<blockquote class="Quote">
<i>Per person: one cup dried split peas, half a chopped onion, half a carrot, a celery stalk, and optionally ham.</i><br>
<i>Soak peas overnight, simmer them for two hours in four cups of water (per person), add vegetables and ham, and cook for ten more minutes.</i>
</blockquote>
<div class="Standard">
This is shorter, but if you do not know how to soak peas you will surely screw up and put them in too little water. But how to soak peas can be looked up, and that is the trick. If you assume a certain basic knowledge in the audience, you can talk in a language that deals with bigger concepts, and express things in a much shorter and clearer way.
</div>
<div class="Standard">
This, more or less, is what abstraction is.
</div>
<div class="Standard">
How is this far-fetched recipe story relevant to programming? Well, obviously, the recipe is the program. Furthermore, the basic knowledge that the cook is supposed to have corresponds to the functions and other constructs that are available to the programmer. If you remember the introduction of this book, things like <div class="listing">
<pre class="listing">while
</pre>
</div>
 make it easier to build loops, and in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> we wrote some simple functions in order to make other functions shorter and more straightforward. Such tools, some of them made available by the language itself, others built by the programmer, are used to reduce the amount of uninteresting details in the rest of the program, and thus make that program easier to work with.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Functional programming<a class="IndexReference" name="entry-functional-programming-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-functional-programming">↓</a>, which is the subject of this chapter, produces abstraction through clever ways of combining functions. A programmer armed with a repertoire of fundamental functions and, more importantly, the knowledge on how to use them, is much more effective than one who starts from scratch. Unfortunately, a standard CoffeeScript environment comes with deplorably few essential functions, so we have to write them ourselves or, which is often preferable, make use of somebody else’s code (more on that in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a>).
</div>
<div class="Standard">
In this chapter we write a set of useful functions to understand how they work and solve problems with them to understand how to use them. In later chapters we will use the larger set of functions in the Underscore library that comes with CoffeeScript.
</div>
<div class="Standard">
There are other popular approaches to abstraction, most notably object-oriented programming, the subject of <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In programming a fundamental operation is performing an action on every element of an array. Many programming languages have borrowed their way of doing this from the C programming language:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">size_t i;
size_t N = sizeof(thing) / sizeof(thing[0]);
for (i = 0; i &lt; N; ++i) {
  do_something(thing[i]);
}
</pre>
</div>

</div>
<div class="Standard">
That is very ugly, an eyesore if you have any good taste at all. It has been improved somewhat in derived languages like C++ and JavaScript. Other programming languages can have very different approaches<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Q] </span><span class="HoverFoot"><span class="SupFootMarker"> [Q] </span>In <i>Mathematica</i> a function can be set as listable — eliminating the need for a loop:<div class="PlainVisible">
<span class="scriptsize"><div class="smallskip"> </div><div class="listing">
<pre class="listing">f[x_] := If[x &gt; 0, Sqrt[x], Sqrt[-x]]; SetAttributes[f, Listable];
</pre>
</div>
</span><br>
<span class="scriptsize"><div class="listing">
<pre class="listing">f[{3, 0, -2}]
</pre>
</div>
 <span class="formula"> ⇒ </span> <span class="formula"><span class="scriptstyle"><span class="symbol">{</span></span><span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root">3</span><span class="ignored">)</span></span>,  0,  <span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root">2</span><span class="ignored">)</span></span><span class="symbol">}</span></span></span>
</div>
</span></span>. In CoffeeScript it becomes the reasonably pleasant:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for i in [0...thing.length] then doSomething thing[i]
# or
for element in thing then doSomething element
</pre>
</div>
</div>
<div class="Standard">
Still do we have to do this over and over or can it be abstracted?
</div>
<div class="Standard">
The problem is that, whereas most functions just take some values, combine them, and return something, such a loop contains a piece of code that it must execute. It is easy to write a function that goes over an array and prints out every element:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">printArray = (array) -&gt;
  for element in array
    show element
  return
</pre>
</div>

</div>
<div class="Standard">
But what if we want to do something else than print? Since ‘doing something’ can be represented as a function, and functions are also values, we can pass our action as a function value:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">forEach = (array, action) -&gt;
  for element in array
    action element
  #return
forEach [’Wampeter’, ’Foma’, ’Granfalloon’], show
</pre>
</div>

</div>
<div class="Standard">
In CoffeeScript most statements are expressions that return a value, that is also the case with the <div class="listing">
<pre class="listing">for
</pre>
</div>
 statement. A <div class="listing">
<pre class="listing">return
</pre>
</div>
 statement at the end of <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 will make it return <div class="listing">
<pre class="listing">undefined
</pre>
</div>
. Here <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 is allowed to return its value, when we get to the <div class="listing">
<pre class="listing">map
</pre>
</div>
 function you will see why.
</div>
<div class="Standard">
By making use of an anonymous function, something just like a <div class="listing">
<pre class="listing">for
</pre>
</div>
 loop can be written as:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">sum = (numbers) -&gt;
  total = 0
  forEach numbers, (number) -&gt; total += number
  total
show sum [1, 10, 100]
</pre>
</div>

</div>
<div class="Standard">
Note that the variable <div class="listing">
<pre class="listing">total
</pre>
</div>
 is visible inside the anonymous function because of the scoping rules. Also note that this version is hardly shorter than the <div class="listing">
<pre class="listing">for
</pre>
</div>
 loop.
</div>
<div class="Standard">
You do get a variable bound to the current element in the array, <div class="listing">
<pre class="listing">number
</pre>
</div>
, so there is no need to use <div class="listing">
<pre class="listing">numbers[i]
</pre>
</div>
 anymore, and when this array is created by evaluating some expression, there is no need to store it in a variable, because it can be passed to <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 directly.
</div>
<div class="Standard">
The cat-code in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> contains a piece like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">paragraphs = email.split ’\n’
for paragraph in paragraphs
  handleParagraph paragraph
</pre>
</div>

</div>
<div class="Standard">
This can now be written as…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">forEach email.split(’\n’), handleParagraph
</pre>
</div>

</div>
<div class="Standard">
On the whole, using more abstract (or ‘higher level’) constructs results in more information and less noise: The code in <div class="listing">
<pre class="listing">sum
</pre>
</div>
 reads <i>‘for each number in numbers add that number to the total</i>’, instead of… ‘<i>there is this variable that starts at zero, and it counts upward to the length of the array called numbers, and for every value of this variable we look up the corresponding element in the array and add this to the total</i>’.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
What <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 does is take an algorithm, in this case ‘going over an array’, and abstract it. The ‘gaps’ in the algorithm, in this case, what to do for each of these elements, are filled by functions which are passed to the algorithm function.
</div>
<div class="Standard">
Functions that operate on other functions are called higher-order function<a class="IndexReference" name="entry-higher-order-function-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-higher-order-function">↓</a>s. By operating on functions, they can talk about actions on a whole new level. The <div class="listing">
<pre class="listing">makeAddFunction
</pre>
</div>
 function from <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functions"><span class="sans">Functions</span>↑</a> is also a higher-order function. Instead of taking a function value as an argument, it produces a new function.
</div>
<div class="Standard">
Higher-order functions can be used to generalise many algorithms that regular functions can not easily describe. When you have a repertoire of these functions at your disposal, it can help you think about your code in a clearer way: Instead of a messy set of variables and loops, you can decompose algorithms into a combination of a few fundamental algorithms, which are invoked by name, and do not have to be typed out again and again.
</div>
<div class="Standard">
Being able to write <i>what</i> we want to do instead of <i>how</i> we do it means we are working at a higher level of abstraction. In practice, this means shorter, clearer, and more pleasant code.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Another useful type of higher-order function <i>modifies</i> the function value it is given:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">negate = (func) -&gt;
  (x) -&gt; not func x
​
isNotNaN = negate isNaN
show isNotNaN NaN
</pre>
</div>

</div>
<div class="Standard">
The function returned by <div class="listing">
<pre class="listing">negate
</pre>
</div>
 feeds the argument it is given to the original function <div class="listing">
<pre class="listing">func
</pre>
</div>
, and then negates the result. But what if the function you want to negate takes more than one argument? You can get access to any arguments passed to a function with the <div class="listing">
<pre class="listing">arguments
</pre>
</div>
 array, but how do you call a function when you do not know how many arguments you have?
</div>
<div class="Standard">
Functions<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [R] </span><span class="HoverFoot"><span class="SupFootMarker"> [R] </span>Unfortunately, on at least older versions of the Internet Explorer browser a lot of built-in functions, such as <div class="listing">
<pre class="listing">alert
</pre>
</div>
, are not <i>really</i> functions… or something. They report their type as <div class="listing">
<pre class="listing">’object’
</pre>
</div>
 when given to the <div class="listing">
<pre class="listing">typeof
</pre>
</div>
 operator, and they do not have an <div class="listing">
<pre class="listing">apply
</pre>
</div>
 method. Your own functions do not suffer from this, they are always real functions.</span></span> have a method called <div class="listing">
<pre class="listing">apply
</pre>
</div>
<a class="IndexReference" name="entry-apply-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-apply">↓</a>, which is used for situations like this. It takes two arguments. The role of the first argument will be discussed in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>, for now we just use <div class="listing">
<pre class="listing">null
</pre>
</div>
 there. The second argument is an array containing the arguments that the function must be applied to. Now you know the underlying <div class="listing">
<pre class="listing">arguments
</pre>
</div>
 mechanism remember that you can also use splats…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show Math.min.apply null, [5, 6]
​
negate = (func) -&gt;
  -&gt; not func.apply null, arguments
​
negate = (func) -&gt;
  (args...) -&gt; not func args...
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Let us look at a few more basic algorithms related to arrays. The <div class="listing">
<pre class="listing">sum
</pre>
</div>
 function is really a variant of an algorithm which is usually called <div class="listing">
<pre class="listing">reduce
</pre>
</div>
<a class="IndexReference" name="entry-reduce-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-reduce">↓</a> or <div class="listing">
<pre class="listing">foldl
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">reduce = (array, combine, base) -&gt;
  forEach array, (element) -&gt;
    base = combine base, element
  base
​
add = (a, b) -&gt; a + b
sum = (numbers) -&gt; reduce numbers, add, 0
show sum [1, 10, 100]
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">reduce
</pre>
</div>
 combines an array into a single value by repeatedly using a function that combines an element of the array with a base value. This is exactly what <div class="listing">
<pre class="listing">sum
</pre>
</div>
 did, so it can be made shorter by using <div class="listing">
<pre class="listing">reduce
</pre>
</div>
… except that addition is an operator and not a function in CoffeeScript, so we first had to put it into a function.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 21</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">countZeroes
</pre>
</div>
, which takes an array of numbers as its argument and returns the amount of zeroes that occur in it. Use <div class="listing">
<pre class="listing">reduce
</pre>
</div>
.
</div>
<div class="PlainVisible">
Then, write the higher-order function <div class="listing">
<pre class="listing">count
</pre>
</div>
, which takes an array and a test function as arguments, and returns the amount of elements in the array for which the test function returned <div class="listing">
<pre class="listing">true
</pre>
</div>
. Re-implement <div class="listing">
<pre class="listing">countZeroes
</pre>
</div>
 using this function.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">countZeroes = (array) -&gt;
  counter = (total, element) -&gt;
    total++ if element is 0
    total
  reduce array, counter, 0
​
bits = [1, 0, 1, 0, 0, 1, 1, 1, 0]
show countZeroes bits
</pre>
</div>
<div class="Standard">
Here is the solution that uses a <div class="listing">
<pre class="listing">count
</pre>
</div>
 function, with a function that produces equality-testers included to make the final <div class="listing">
<pre class="listing">countZeroes
</pre>
</div>
 function even shorter:</div>
<div class="listing">
<pre class="listing">count = (test, array) -&gt;
  reduce array, ((total, element) -&gt;
    total + if test element then 1 else 0), 0
​
equals = (x) -&gt;
  (element) -&gt; x == element
​
countZeroes = (array) -&gt;
  count equals(0), array
​
show countZeroes bits
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
One other generally useful ‘fundamental algorithm’ related to arrays is called <div class="listing">
<pre class="listing">map
</pre>
</div>
<a class="IndexReference" name="entry-map-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-map">↓</a>. It goes over an array, applying a function to every element, just like <div class="listing">
<pre class="listing">forEach
</pre>
</div>
. But instead of discarding the values returned by function, it builds up a new array from these values.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">map = (array, func) -&gt;
  result = []
  forEach array, (element) -&gt;
    result.push func element
  result
​
show map [0.01, 2, 9.89, Math.PI], Math.round
</pre>
</div>

</div>
<div class="Standard">
Note that the last argument is called <div class="listing">
<pre class="listing">func
</pre>
</div>
, not <div class="listing">
<pre class="listing">function
</pre>
</div>
, this is because <div class="listing">
<pre class="listing">function
</pre>
</div>
 is a keyword and thus not a valid variable name. And then:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Leave out result since forEach already returns it
map = (array, func) -&gt;
  forEach array, (element) -&gt;
    func element
​
# Leave out func arguments
map = (array, func) -&gt;
  forEach array, func
​
# Leave out forEach arguments
map = forEach
</pre>
</div>

</div>
<div class="Standard">
The reduction shows how nicely functions and expressions can be used to shorten a function. If we were concerned with the performance of <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 then inserting a <div class="listing">
<pre class="listing">return
</pre>
</div>
 at the end of its definition would prevent it from collecting the results of the <div class="listing">
<pre class="listing">for
</pre>
</div>
 comprehension and we would have to provide an implementation in <div class="listing">
<pre class="listing">map
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There once was, living in the deep mountain forests of Transylvania, a recluse. Most of the time, he just wandered around his mountain, talking to trees and laughing with birds. But now and then, when the pouring rain trapped him in his little hut, and the howling wind made him feel unbearably small, the recluse felt an urge to write something, wanted to pour some thoughts out onto paper, where they could maybe grow bigger than he himself was.
</div>
<div class="Standard">
After failing miserably at poetry, fiction, and philosophy, the recluse finally decided to write a technical book. In his youth, he had done some computer programming, and he figured that if he could just write a good book about that, fame and recognition would surely follow.
</div>
<div class="Standard">
So he wrote. At first he used fragments of tree bark, but that turned out not to be very practical. He went down to the nearest village and bought himself a laptop computer. After a few chapters, he realised he wanted to put the book in <span class="versalitas"><span class="small">HTML</span></span><span class="default"> format, in order to put it on his web-page…</span>
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/html.png" alt="figure img/html.png" style="width: 100%; height: auto;">

</div>

</div>
<div class="Standard">
Are you familiar with <span class="versalitas"><span class="small">HTML</span></span><span class="default">? It is the method used to add mark-up to pages on the web, and we will be using it a few times in this book, so it would be nice if you know how it works, at least generally. If you are a good student, you could go search the web for a good introduction to <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> now, and come back here when you have read it. Most of you probably are lousy students, so I will just give a short explanation and hope it is enough.</span>
</div>
<div class="Standard">
<span class="versalitas"><span class="small">HTML</span></span><span class="default"><a class="IndexReference" name="entry-HTML-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-HTML">↓</a> stands for ‘HyperText Mark-up Language’. An <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> document is all text. Because it must be able to express the structure of this text, information about which text is a heading, which text is purple, and so on, a few characters have a special meaning, somewhat like backslashes in CoffeeScript strings. The ‘less than’ and ‘greater than’ characters are used to create ‘tag<a class="IndexReference" name="entry-tag-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-tag">↓</a>s’. A tag gives extra information about the text in the document. It can stand on its own, for example to mark the place where a picture should appear in the page, or it can contain text and other tags, for example when it marks the start and end of a paragraph.</span>
</div>
<div class="Standard">
Some tags are compulsory, a whole <span class="versalitas"><span class="small">HTML</span></span><span class="default"> document must always be contained in between <div class="listing">
<pre class="listing">html
</pre>
</div>
 tags. The <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> version is specified on the first line with the document type, <div class="listing">
<pre class="listing">DOCTYPE
</pre>
</div>
, so browsers can parse and render it correctly. Here is an example of an <span class="versalitas"></span></span><span class="small">HTML<sub><span class="versalitas"></span><span class="small">5</span></sub></span><span class="default"> document:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;title&gt;A quote&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;A quote&lt;/h1&gt;
    &lt;blockquote&gt;
      &lt;p&gt;The connection between the language in which we
      think/program and the problems and solutions we can
      imagine is very close. For this reason restricting
      language features with the intent of eliminating
      programmer errors is at best dangerous.&lt;/p&gt;
      &lt;p&gt;-- Bjarne Stroustrup&lt;/p&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;Mr. Stroustrup is the inventor of the C++
    programming language, but quite an insightful
    person nevertheless.&lt;/p&gt;
    &lt;p&gt;Also, here is a picture of an ostrich:&lt;/p&gt;
    &lt;img src="../img/ostrich.jpg"/&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>

</div>
<div class="Standard">
Elements that contain text or other tags are first opened with <div class="listing">
<pre class="listing">&lt;tagname&gt;
</pre>
</div>
, and afterwards finished with <div class="listing">
<pre class="listing">&lt;/tagname&gt;
</pre>
</div>
. The <div class="listing">
<pre class="listing">html
</pre>
</div>
 element always contains two children: <div class="listing">
<pre class="listing">head
</pre>
</div>
 and <div class="listing">
<pre class="listing">body
</pre>
</div>
. The first contains information <i>about</i> the document, the second contains the actual document.
</div>
<div class="Standard">
Most tag names are cryptic abbreviations. <div class="listing">
<pre class="listing">h1
</pre>
</div>
 stands for ‘heading 1’, the biggest kind of heading. There are also <div class="listing">
<pre class="listing">h2
</pre>
</div>
 to <div class="listing">
<pre class="listing">h6
</pre>
</div>
 for successively smaller headings. <div class="listing">
<pre class="listing">p
</pre>
</div>
 means ‘paragraph’, and <div class="listing">
<pre class="listing">img
</pre>
</div>
 stands for ‘image’. The <div class="listing">
<pre class="listing">img
</pre>
</div>
 element does not contain any text or other tags, but it does have some extra information, <div class="listing">
<pre class="listing">src="../img/ostrich.png"
</pre>
</div>
, which is called an ‘attribute’<a class="IndexReference" name="entry-attribute-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-attribute">↓</a>. In this case, it contains information about the image file that should be shown here.
</div>
<div class="Standard">
Because <div class="listing">
<pre class="listing">&lt;
</pre>
</div>
 and <div class="listing">
<pre class="listing">&gt;
</pre>
</div>
 have a special meaning in <span class="versalitas"><span class="small">HTML</span></span><span class="default"> documents, they can not be written directly in the text of the document. If you want to say ‘<div class="listing">
<pre class="listing">5 &lt; 10
</pre>
</div>
’ in an <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> document, you have to write ‘<div class="listing">
<pre class="listing">5 &amp;lt; 10
</pre>
</div>
’, where ‘<div class="listing">
<pre class="listing">lt
</pre>
</div>
’ stands for ‘less than’. ‘<div class="listing">
<pre class="listing">&amp;gt;
</pre>
</div>
’ is used for ‘<div class="listing">
<pre class="listing">&gt;
</pre>
</div>
’, and because these codes also give the ampersand character a special meaning, a plain ‘<div class="listing">
<pre class="listing">&amp;
</pre>
</div>
’ is written as ‘<div class="listing">
<pre class="listing">&amp;amp;
</pre>
</div>
’.</span>
</div>
<div class="Standard">
Now, those are only the bare basics of <span class="versalitas"><span class="small">HTML</span></span><span class="default">, but they should be enough to make it through this chapter, and later chapters that deal with <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> documents, without getting entirely confused.</span>
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The prelude has a function <div class="listing">
<pre class="listing">viewURL
</pre>
</div>
 that can be used to look at <span class="versalitas"><span class="small">HTML</span></span><span class="default"> documents. The example document above is stored in the file <div class="listing">
<pre class="listing">’06-Quote.html’
</pre>
</div>
, so you can view it by executing the following code:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">viewURL ’06-Quote.html’
</pre>
</div>

</div>
<div class="Standard">
You can also run a tiny server from your program or the interactive CoffeeScript environment (<span class="versalitas"><span class="small">REPL</span></span><span class="default">). It can serve a webpage either from a string variable or from a file. If you have created a web page in a string variable, say <div class="listing">
<pre class="listing">stroustrupQuote
</pre>
</div>
 then you can start the server with:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">viewServer stroustrupQuote
</pre>
</div>

</div>
<div class="Standard">
Or you could give it a filename as its argument. When you are done with the server then you can either type <div class="listing">
<pre class="listing">stopServer()
</pre>
</div>
 or <div class="listing">
<pre class="listing">CTRL-C
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
So, picking up the story again, the recluse wanted to have his book in <span class="versalitas"><span class="small">HTML</span></span><span class="default"> format. At first he just wrote all the tags directly into his manuscript, but typing all those less-than and greater-than signs made his fingers hurt, and he constantly forgot to write <div class="listing">
<pre class="listing">&amp;amp;
</pre>
</div>
 when he needed an <div class="listing">
<pre class="listing">&amp;
</pre>
</div>
. This gave him a headache. Next, he tried to write the book in Microsoft Word, and then save it as <span class="versalitas"></span></span><span class="small">HTML</span><span class="default">. But the <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> that came out of that was fifteen times bigger and more complicated than it had to be. And besides, Microsoft Word gave him a headache.</span>
</div>
<div class="Standard">
The solution that he eventually came up with was this: He would write the book as plain text, following some simple rules about the way paragraphs were separated and the way headings looked. Then, he would write a program to convert this text into precisely the <span class="versalitas"><span class="small">HTML</span></span><span class="default"> that he wanted.</span>
</div>
<div class="Standard">
The rules are this:
</div>
<ol>
<li>
Paragraphs are separated by blank lines.
</li>
<li>
A paragraph that starts with a ‘%’ symbol is a header. The more ‘%’ symbols, the smaller the header.
</li>
<li>
Inside paragraphs, pieces of text can be emphasised by putting them between asterisks.
</li>
<li>
Footnotes are written between braces.
</li>

</ol>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
After he had struggled painfully with his book for six months, the recluse had still only finished a few paragraphs. At this point, his hut was struck by lightning, killing him, and forever putting his writing ambitions to rest. From the charred remains of his laptop, I could recover the following file:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">% The Book of Programming
​
%% The Two Aspects
​
Below the surface of the machine, the program moves.
Without effort, it expands and contracts. In great harmony, 
electrons scatter and regroup. The forms on the monitor
are but ripples on the water. The essence stays invisibly
below.
​
When the creators built the machine, they put in the
processor and the memory. From these arise the two aspects
of the program.
​
The aspect of the processor is the active substance. It is
called Control. The aspect of the memory is the passive 
substance. It is called Data.
​
Data is made of merely bits, yet it takes complex forms.
Control consists only of simple instructions, yet it
performs difficult tasks. From the small and trivial, the
large and complex arise.
​
The program source is Data. Control arises from it. The
Control proceeds to create new Data. The one is born from
the other, the other is useless without the one. This is
the harmonious cycle of Data and Control.
​
Of themselves, Data and Control are without structure. The
programmers of old moulded their programs out of this raw
substance. Over time, the amorphous Data has crystallised
into data types, and the chaotic Control was restricted
into control structures and functions.
​
%% Short Sayings
​
When a student asked Fu-Tzu about the nature of the cycle
of Data and Control, Fu-Tzu replied ’Think of a compiler,
compiling itself.’
​
A student asked ’The programmers of old used only simple
machines and no programming languages, yet they made
beautiful programs. Why do we use complicated machines
and programming languages?’. Fu-Tzu replied ’The builders
of old used only sticks and clay, yet they made beautiful
huts.’
​
A hermit spent ten years writing a program. ’My program can
compute the motion of the stars on a 286-computer running
MS DOS’, he proudly announced. ’Nobody owns a 286-computer
or uses MS DOS anymore.’, Fu-Tzu responded.
​
Fu-Tzu had written a small program that was full of global
state and dubious shortcuts. Reading it, a student asked
’You warned us against these techniques, yet I find them in
your program. How can this be?’ Fu-Tzu said ’There is no
need to fetch a water hose when the house is not on fire.’
{This is not to be read as an encouragement of sloppy
programming, but rather as a warning against neurotic
adherence to rules of thumb.}
​
%% Wisdom
​
A student was complaining about digital numbers. ’When I
take the root of two and then square it again, the result
is already inaccurate!’. Overhearing him, Fu-Tzu laughed.
’Here is a sheet of paper. Write down the precise value of
the square root of two for me.’
​
Fu-Tzu said ’When you cut against the grain of the wood,
much strength is needed. When you program against the grain
of a problem, much code is needed.’
​
Tzu-li and Tzu-ssu were boasting about the size of their
latest programs. ’Two-hundred thousand lines’, said Tzu-li,
’not counting comments!’. ’Psah’, said Tzu-ssu, ’mine is
almost a *million* lines already.’ Fu-Tzu said ’My best
program has five hundred lines.’ Hearing this, Tzu-li and
Tzu-ssu were enlightened.
​
A student had been sitting motionless behind his computer
for hours, frowning darkly. He was trying to write a
beautiful solution to a difficult problem, but could not
find the right approach. Fu-Tzu hit him on the back of his
head and shouted ’*Type something!*’ The student started
writing an ugly solution. After he had finished, he
suddenly understood the beautiful solution.
​
%% Progression
​
A beginning programmer writes his programs like an ant
builds her hill, one piece at a time, without thought for
the bigger structure. His programs will be like loose sand.
They may stand for a while, but growing too big they fall
apart{Referring to the danger of internal inconsistency
and duplicated structure in unorganised code.}.
​
Realising this problem, the programmer will start to spend
a lot of time thinking about structure. His programs will
be rigidly structured, like rock sculptures. They are solid,
but when they must change, violence must be done to them
{Referring to the fact that structure tends to put
restrictions on the evolution of a program.}.
​
The master programmer knows when to apply structure and
when to leave things in their simple form. His programs
are like clay, solid yet malleable.
​
%% Language
​
When a programming language is created, it is given
syntax and semantics. The syntax describes the form of
the program, the semantics describe the function. When the
syntax is beautiful and the semantics are clear, the
program will be like a stately tree. When the syntax is
clumsy and the semantics confusing, the program will be
like a bramble bush.
​
Tzu-ssu was asked to write a program in the language
called  Java, which takes a very primitive approach to
functions. Every morning, as he sat down in front of his
computer, he started complaining. All day he cursed,
blaming the language for all that went wrong. Fu-Tzu
listened for a while, and then reproached him, saying
’Every language has its own way. Follow its form, do not
try to program as if you were using another language.’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<div class="medskip"> </div>
</div>
<div class="Standard">
To honour the memory of our good recluse, I would like to finish his HTML-generating program for him. A good approach to this problem goes like this:
</div>
<ol>
<li>
Split the file into paragraphs by cutting it at every empty line.
</li>
<li>
Remove the ‘%’ characters from header paragraphs and mark them as headers.
</li>
<li>
Process the text of the paragraphs themselves, splitting them into normal parts, emphasised parts, and footnotes.
</li>
<li>
Move all the footnotes to the bottom of the document, leaving numbers<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [S] </span><span class="HoverFoot"><span class="SupFootMarker"> [S] </span>Like this…</span></span> in their place.
</li>
<li>
Wrap each piece into the correct <span class="versalitas"><span class="small">HTML</span></span><span class="default"> tags.</span>
</li>
<li>
Combine everything into a single <span class="versalitas"><span class="small">HTML</span></span><span class="default"> document.</span>
</li>

</ol>
<div class="Standard">
This approach does not allow footnotes inside emphasised text, or vice versa. This is kind of arbitrary, but helps keep the example code simple. If, at the end of the chapter, you feel like an extra challenge, you can try to revise the program to support ‘nested’ mark-up.
</div>
<div class="Standard">
The whole manuscript is in <div class="listing">
<pre class="listing">’06-RecluseFile.text’
</pre>
</div>
. You can get it as a string value by calling the <div class="listing">
<pre class="listing">readTextFile
</pre>
</div>
 function in the prelude.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">recluseFile = readTextFile ’06-RecluseFile.text’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<div class="medskip"> </div>
</div>
<div class="Standard">
Step 1 of the algorithm is trivial. A blank line is what you get when you have two newlines in a row, and if you remember the <div class="listing">
<pre class="listing">split
</pre>
</div>
 method that strings have, which we saw in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a>, you will realise that this will do the trick:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">paragraphs = recluseFile.split "\n\n"
show "Found #{paragraphs.length} paragraphs."
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 22</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">processParagraph
</pre>
</div>
 that, when given a paragraph string as its argument, checks whether this paragraph is a header. If it is, it strips of the ‘%’ characters and counts their number. Then, it returns an object with two properties, <div class="listing">
<pre class="listing">content
</pre>
</div>
, which contains the text inside the paragraph, and <div class="listing">
<pre class="listing">type
</pre>
</div>
, which contains the tag that this paragraph must be wrapped in, <div class="listing">
<pre class="listing">’p’
</pre>
</div>
 for regular paragraphs, <div class="listing">
<pre class="listing">’h1’
</pre>
</div>
 for headers with one ‘%’, and <div class="listing">
<pre class="listing">’hX’
</pre>
</div>
 for headers with <div class="listing">
<pre class="listing">X
</pre>
</div>
 ‘%’ characters.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">processParagraph = (paragraph) -&gt;
  header = 0
  while paragraph[0] == ’%’
    paragraph = paragraph.slice 1
    header++
  type: if header == 0 then ’p’ else ’h’ + header,
  content: paragraph
​
show processParagraph paragraphs[0]
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
This is where we can try out the <div class="listing">
<pre class="listing">map
</pre>
</div>
 function we saw earlier.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">paragraphs = map recluseFile.split(’\n\n’),
                 processParagraph
show paragraphs[0..2]
</pre>
</div>

</div>
<div class="Standard">
And <i>bang</i>, we have an array of nicely categorised paragraph objects. We are getting ahead of ourselves though, we forgot step 3 of the algorithm:
</div>
<blockquote class="Quote">
<i>Process the text of the paragraphs themselves, splitting them into normal parts, emphasised parts, and footnotes.</i>
</blockquote>
<div class="Standard">
Which can be decomposed into:
</div>
<ol>
<li>
If the paragraph starts with an asterisk, take off the emphasised part and store it.
</li>
<li>
If the paragraph starts with an opening brace, take off the footnote and store it.
</li>
<li>
Otherwise, take off the part until the first emphasised part or footnote, or until the end of the string, and store it as normal text.
</li>
<li>
If there is anything left in the paragraph, start at 1 again.
</li>

</ol>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 23</i></span></span><br><div class="PlainVisible">
Build a function <div class="listing">
<pre class="listing">splitParagraph
</pre>
</div>
 which, given a paragraph string, returns an array of paragraph fragments. Think of a good way to represent the fragments, they need <div class="listing">
<pre class="listing">type
</pre>
</div>
 and <div class="listing">
<pre class="listing">content
</pre>
</div>
 properties.
</div>
<div class="PlainVisible">
The method <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
, which searches for a character or sub-string in a string and returns its position, or <div class="listing">
<pre class="listing">-1
</pre>
</div>
 if not found, will probably be useful in some way here.
</div>
<div class="PlainVisible">
This is a tricky algorithm, and there are many not-quite-correct or way-too-long ways to describe it. If you run into problems, just think about it for a minute. Try to write inner functions that perform the smaller actions that make up the algorithm.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<div class="PlainVisible">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><br>
Here is one possible solution:
</div>
<div class="listing">
<pre class="listing">splitParagraph = (text) -&gt;
  # Find character position or end of text
  indexOrEnd = (character) -&gt;
    index = text.indexOf character
    if index == -1 then text.length else index
​
  # Return and remove text upto next special
  # character or end of text
  takeNormal = -&gt;
    end = reduce map([’*’, ’{’], indexOrEnd),
                 Math.min, text.length
    part = text.slice 0, end
    text = text.slice end
    part
​
  # Return and remove text upto character
  takeUpTo = (character) -&gt;
    end = text.indexOf character, 1
    if end == -1
      throw new Error ’Missing closing ’ +
                      ’"’ + character + ’"’
    part = text.slice 1, end
    text = text.slice end + 1
    part
​
  fragments = [];
​
  while text != ’’
    if text[0] == ’*’
      fragments.push
        type: ’emphasised’,
        content: takeUpTo ’*’
    else if text[0] == ’{’
      fragments.push
        type: ’footnote’,
        content: takeUpTo ’}’
    else
      fragments.push
        type: ’normal’,
        content: takeNormal()
  fragments
</pre>
</div>
<div class="Standard">
Note the over-eager use of <div class="listing">
<pre class="listing">map
</pre>
</div>
 and <div class="listing">
<pre class="listing">reduce
</pre>
</div>
 in the <div class="listing">
<pre class="listing">takeNormal
</pre>
</div>
 function. This is a chapter about functional programming, so program functionally we will! Can you see how this works? The <div class="listing">
<pre class="listing">map
</pre>
</div>
 produces an array of positions where the given characters were found, or the end of the string if they were not found, and the <div class="listing">
<pre class="listing">reduce
</pre>
</div>
 takes the minimum of them, which is the next point in the string that we have to look at.<div class="PlainVisible">
If you’d write that out without mapping and reducing you’d get something like this:
</div>
</div>
<div class="listing">
<pre class="listing">takeNormalAlternative = -&gt;
  nextAsterisk = text.indexOf ’*’
  nextBrace = text.indexOf ’{’
  end = text.length
  if nextAsterisk != -1
    end = nextAsterisk
  if nextBrace != -1 and nextBrace &lt; end
    end = nextBrace
  part = text.slice 0, end
  text = text.slice end
  part
</pre>
</div>
<div class="Standard">
Which is even more hideous. Most of the time, when a decision has to be made based on a series of things, even if there are only two of them, writing it as array operations is nicer than handling every value in a separate <div class="listing">
<pre class="listing">if
</pre>
</div>
 statement. (Fortunately, <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Regular-Expressions"><span class="sans">Regular Expressions</span>↓</a> describes an easier way to ask for the first occurrence of ‘this or that character’ in a string.)<div class="PlainVisible">
If you wrote a <div class="listing">
<pre class="listing">splitParagraph
</pre>
</div>
 that stored fragments in a different way than the solution above, you might want to adjust it, because the functions in the rest of the chapter assume that fragments are objects with <div class="listing">
<pre class="listing">type
</pre>
</div>
 and <div class="listing">
<pre class="listing">content
</pre>
</div>
 properties.
</div>
</div>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
We can now wire <div class="listing">
<pre class="listing">processParagraph
</pre>
</div>
 to also split the text inside the paragraphs, my version can be modified like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">processParagraph = (paragraph) -&gt;
  header = 0
  while paragraph[0] == ’%’
    paragraph = paragraph.slice 1
    header++
  type: if header == 0 then ’p’ else ’h’ + header,
  content: splitParagraph paragraph
# Adhoc test
recluseFile = readTextFile ’06-RecluseFile.text’ 
paragraphs = map recluseFile.split(’\n\n’),
                 processParagraph
show paragraphs, 3
</pre>
</div>

</div>
<div class="Standard">
Mapping that over the array of paragraphs gives us an array of paragraph objects, which in turn contain arrays of fragment objects. The next thing to do is to take out the footnotes, and put references to them in their place. Something like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">extractFootnotes = (paragraphs) -&gt;
  footnotes = []
  currentNote = 0
  replaceFootnote = (fragment) -&gt;
    if fragment.type == ’footnote’
      ++currentNote
      footnotes.push fragment
      fragment.number = currentNote
      type: ’reference’, number: currentNote
    else
      fragment
​
  forEach paragraphs, (paragraph) -&gt;
    paragraph.content = map paragraph.content,
                            replaceFootnote
  footnotes
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">replaceFootnote
</pre>
</div>
 function is called on every fragment. When it gets a fragment that should stay where it is, it just returns it, but when it gets a footnote, it stores this footnote in the <div class="listing">
<pre class="listing">footnotes
</pre>
</div>
 array, and returns a reference to it instead. In the process, every footnote and reference is also numbered.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
That gives us enough tools to extract the information we need from the file. All that is left now is generating the correct <span class="versalitas"><span class="small">HTML</span></span><span class="default">.</span>
</div>
<div class="Standard">
A lot of people think that concatenating strings is a great way to produce <span class="versalitas"><span class="small">HTML</span></span><span class="default">. When they need a link to, for example, a site where you can play the game of Go, they will do:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">url = "http://www.gokgs.com/"
text = "Play Go!"
linkText = "&lt;a href=\"#{url}\"&gt;#{text}&lt;/a&gt;"
show linkText
</pre>
</div>

</div>
<div class="Standard">
(Where <div class="listing">
<pre class="listing">a
</pre>
</div>
 is the tag used to create links in <span class="versalitas"><span class="small">HTML</span></span><span class="default"> documents.) … Not only is this clumsy, but when the string <div class="listing">
<pre class="listing">text
</pre>
</div>
 happens to include an angular bracket or an ampersand, it is also wrong. Weird things will happen on your website, and you will look embarrassingly amateurish. We would not want that to happen. A few simple HTML-generating functions are easy to write. So let us write them.</span>
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The secret to successful <span class="versalitas"><span class="small">HTML</span></span><span class="default"> generation is to treat your <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> document as a data structure instead of a flat piece of text. CoffeeScript’s objects provide a very easy way to model this:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">linkObject =
  name: ’a’
  attributes:
    href: ’http://www.gokgs.com/’
  content: [’Play Go!’]
</pre>
</div>

</div>
<div class="Standard">
Each <span class="versalitas"><span class="small">HTML</span></span><span class="default"> element contains a <div class="listing">
<pre class="listing">name
</pre>
</div>
 property, giving the name of the tag it represents. When it has attributes, it also contains an <div class="listing">
<pre class="listing">attributes
</pre>
</div>
 property, which contains an object in which the attributes are stored. When it has content, there is a <div class="listing">
<pre class="listing">content
</pre>
</div>
 property, containing an array of other elements contained in this element. Strings play the role of pieces of text in our <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> document, so the array <div class="listing">
<pre class="listing">[’Play Go!’]
</pre>
</div>
 means that this link has only one element inside it, which is a simple piece of text.</span>
</div>
<div class="Standard">
Typing in these objects directly is clumsy, but we do not have to do that. We provide a shortcut function to do this for us:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">tag = (name, content, attributes) -&gt;
  name: name
  attributes: attributes
  content: content
</pre>
</div>

</div>
<div class="Standard">
Note that, since we allow the <div class="listing">
<pre class="listing">attributes
</pre>
</div>
 and <div class="listing">
<pre class="listing">content
</pre>
</div>
 of an element to be undefined if they are not applicable, the second and third argument to this function can be left off when they are not needed.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">tag
</pre>
</div>
 is still rather primitive, so we write shortcuts for common types of elements, such as links, or the outer structure of a simple document:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">link = (target, text) -&gt;
  tag "a", [text], href: target
​
show link "http://www.gokgs.com/", "Play Go!"
​
htmlDoc = (title, bodyContent) -&gt;
  tag "html", [tag("head", [tag "title", [title]]),
               tag "body", bodyContent]
​
show htmlDoc "Quote", "In his house at R’lyeh " +
                      "dead Cthulu waits dreaming."
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 24</i></span></span><br><div class="PlainVisible">
Looking back at the example <span class="versalitas"><span class="small">HTML</span></span><span class="default"> document if necessary, write an <div class="listing">
<pre class="listing">image
</pre>
</div>
 function which, when given the location of an image file, will create an <div class="listing">
<pre class="listing">img
</pre>
</div>
 <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> element.</span>
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">image = (src) -&gt;
  tag ’img’, [], src: src
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
When we have created a document, it will have to be reduced to a string. But building this string from the data structures we have been producing is very straightforward. The important thing is to remember to transform the special characters in the text of our document…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">escapeHTML = (text) -&gt;
  replacements = [[/&amp;/g, ’&amp;amp;’]
                  [/"/g, ’&amp;quot;’]
                  [/&lt;/g, ’&amp;lt;’]
                  [/&gt;/g, ’&amp;gt;’]]
  forEach replacements, (replace) -&gt;
    text = text.replace replace[0], replace[1]
  text
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">replace
</pre>
</div>
 method of strings creates a new string in which all occurrences of the pattern in the first argument are replaced by the second argument, so <div class="listing">
<pre class="listing">’Borobudur’.replace(/r/g, ’k’)
</pre>
</div>
 gives <div class="listing">
<pre class="listing">’Bokobuduk’
</pre>
</div>
. Do not worry about the pattern syntax here — we will get to that in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Regular-Expressions"><span class="sans">Regular Expressions</span>↓</a>. The <div class="listing">
<pre class="listing">escapeHTML
</pre>
</div>
 function puts the different replacements that have to be made into an array, so that it can loop over them and apply them to the argument one by one.
</div>
<div class="Standard">
Double quotes are also replaced, because we will also be using this function for the text inside the attributes of <span class="versalitas"><span class="small">HTML</span></span><span class="default"> tags. Those will be surrounded by double quotes, and thus must not have any double quotes inside of them.</span>
</div>
<div class="Standard">
Calling replace four times means the computer has to go over the whole string four times to check and replace its content. This is not very efficient. If we cared enough, we could write a more complex version of this function, something that resembles the <div class="listing">
<pre class="listing">splitParagraph
</pre>
</div>
 function we saw earlier, to go over it only once. For now, we are too lazy for this. Again, <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Regular-Expressions"><span class="sans">Regular Expressions</span>↓</a> shows a much better way to do this.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
To turn an <span class="versalitas"><span class="small">HTML</span></span><span class="default"> element object into a string, we can use a recursive function like this:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">renderHTML = (element) -&gt;
  pieces = []
​
  renderAttributes = (attributes) -&gt;
    result = []
    if attributes
      for name of attributes 
        result.push ’ ’ + name + ’="’ +
          escapeHTML(attributes[name]) + ’"’
    result.join ’’
​
  render = (element) -&gt;
    # Text node
    if typeof element is ’string’
      pieces.push escapeHTML element
    # Empty tag
    else if not element.content or
                element.content.length == 0
      pieces.push ’&lt;’ + element.name +
        renderAttributes(element.attributes) + ’/&gt;’
    # Tag with content
    else
      pieces.push ’&lt;’ + element.name +
        renderAttributes(element.attributes) + ’&gt;’
      forEach element.content, render
      pieces.push ’&lt;/’ + element.name + ’&gt;’
​
  render element
  pieces.join ’’
</pre>
</div>

</div>
<div class="Standard">
Note the <div class="listing">
<pre class="listing">of
</pre>
</div>
 loop that extracts the properties from a CoffeeScript object in order to make <span class="versalitas"><span class="small">HTML</span></span><span class="default"> tag attributes out of them. Also note that in two places, arrays are being used to accumulate strings, which are then joined into a single result string. Why did I not just start with an empty string and then add the content to it with the <div class="listing">
<pre class="listing">+=
</pre>
</div>
 operator?</span>
</div>
<div class="Standard">
It turns out that creating new strings, especially big strings, is quite a lot of work. Remember that CoffeeScript string values never change. If you concatenate something to them, a new string is created, the old ones stay intact. If we build up a big string by concatenating lots of little strings, new strings have to be created at every step, only to be thrown away when the next piece is concatenated to them. If, on the other hand, we store all the little strings in an array and then join them, only <i>one</i> big string has to be created.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
So, let us try out this <span class="versalitas"><span class="small">HTML</span></span><span class="default"> generating system…</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show renderHTML link ’http://www.nedroid.com’,
                     ’Drawings!’
</pre>
</div>

</div>
<div class="Standard">
That seems to work.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">body = [tag(’h1’, [’The Test’]),
        tag(’p’, [’Here is a paragraph ’ +
                  ’and an image...’]),
        image(’../img/ostrich.jpg’)]
doc = htmlDoc ’The Test’, body
show renderHTML doc
# Type ‘stopServer()‘ or Ctrl-C when done.
viewServer renderHTML doc
</pre>
</div>

</div>
<div class="Standard">
Now, I should probably warn you that this approach is not perfect. What it actually renders is <span class="versalitas"><span class="small">XML</span></span><span class="default"><a class="IndexReference" name="entry-XML-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-XML">↓</a>, which is similar to <span class="versalitas"></span></span><span class="small">HTML</span><span class="default">, but more structured. In simple cases, such as the above, this does not cause any problems. However, there are some things, which are correct <span class="versalitas"></span></span><span class="small">XML</span><span class="default">, but not proper <span class="versalitas"></span></span><span class="small">HTML</span><span class="default">, and these might confuse a browser that is trying to show the documents we create. For example, if you have an empty <div class="listing">
<pre class="listing">script
</pre>
</div>
 tag (used to put JavaScript into a page) in your document, browsers will not realise that it is empty and think that everything after it is JavaScript. (In this case, the problem can be fixed by putting a single space inside of the tag, so that it is no longer empty, and gets a proper closing tag.)</span>
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 25</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">renderFragment
</pre>
</div>
, and use that to implement another function <div class="listing">
<pre class="listing">renderParagraph
</pre>
</div>
, which takes a paragraph object (with the footnotes already filtered out), and produces the correct <span class="versalitas"><span class="small">HTML</span></span><span class="default"> element (which might be a paragraph or a header, depending on the <div class="listing">
<pre class="listing">type
</pre>
</div>
 property of the paragraph object).</span>
</div>
<div class="PlainVisible">
This function might come in useful for rendering the footnote references:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">footnote = (number) -&gt;
  tag ’sup’,
    [link ’#footnote’ + number, String number]
</pre>
</div>
</div>
<div class="Standard">
A <div class="listing">
<pre class="listing">sup
</pre>
</div>
 tag will show its content as ‘superscript’, which means it will be smaller and a little higher than other text. The target of the link will be something like <div class="listing">
<pre class="listing">’#footnote1’
</pre>
</div>
. Links that contain a ‘#’ character refer to ‘anchors’ within a page, and in this case we will use them to make it so that clicking on the footnote link will take the reader to the bottom of the page, where the footnotes live.<div class="PlainVisible">
The tag to render emphasised fragments with is <div class="listing">
<pre class="listing">em
</pre>
</div>
, and normal text can be rendered without any extra tags.
</div>
</div>
</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">renderFragment = (fragment) -&gt;
  if fragment.type == ’reference’
    footnote fragment.number
  else if fragment.type == ’emphasised’
    tag ’em’, [fragment.content]
  else if fragment.type == ’normal’
    fragment.content
​
renderParagraph = (paragraph) -&gt;
  tag paragraph.type,
    map paragraph.content, renderFragment
​
show renderParagraph paragraphs[7]
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
We are almost finished. The only thing that we do not have a rendering function for yet are the footnotes. To make the <div class="listing">
<pre class="listing">’#footnote1’
</pre>
</div>
 links work, an anchor must be included with every footnote. In <span class="versalitas"><span class="small">HTML</span></span><span class="default">, an anchor is specified with an <div class="listing">
<pre class="listing">a
</pre>
</div>
 element, which is also used for links. In this case, it needs a <div class="listing">
<pre class="listing">name
</pre>
</div>
 attribute, instead of an <div class="listing">
<pre class="listing">href
</pre>
</div>
.</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">renderFootnote = (footnote) -&gt;
  anchor = tag "a", [],
    name: "footnote" + footnote.number
  number = "[#{footnote.number}] "
  tag "p", [tag("small",
    [anchor, number, footnote.content])]
</pre>
</div>

</div>
<div class="Standard">
Here, then, is the function which, when given a file in the correct format and a document title, returns an <span class="versalitas"><span class="small">HTML</span></span><span class="default"> document:</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">renderFile = (file, title) -&gt;
  paragraphs = map file.split(’\n\n’),
                   processParagraph
  footnotes = map extractFootnotes(paragraphs),
                  renderFootnote
  body = map paragraphs,
             renderParagraph
  body = body.concat footnotes
  renderHTML htmlDoc title, body
​
​
page = renderFile recluseFile, ’The Book of Programming’
show page
# Type ‘stopServer()‘ or Ctrl-C when done.
viewServer page
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">concat
</pre>
</div>
<a class="IndexReference" name="entry-concat-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-concat">↓</a> method of an array can be used to concatenate another array to it, similar to what the <div class="listing">
<pre class="listing">+
</pre>
</div>
 operator does with strings.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In the chapters after this one, elementary higher-order functions like <div class="listing">
<pre class="listing">map
</pre>
</div>
 and <div class="listing">
<pre class="listing">reduce
</pre>
</div>
 will always be available from the Underscore library and will be used by code examples. Now and then, a new useful tool is explained and added to this. In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a>, we develop a more structured approach to this set of ‘basic’ functions.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In some functional programming languages operators are functions, for example in Pure you can write <div class="listing">
<pre class="listing">foldl (+) 0 (1..10);
</pre>
</div>
 the same in CoffeeScript is <div class="listing">
<pre class="listing">reduce [1..10], ((a, b) -&gt; a + b), 0
</pre>
</div>
. A way to shorten this is by defining an object that is indexed by an operator in a string:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">op = {
       ’+’:   (a, b) -&gt; a + b
       ’==’:  (a, b) -&gt; a == b
       ’!’:   (a)    -&gt; !a
       # and so on
     }
show reduce [1..10], op[’+’], 0
</pre>
</div>

</div>
<div class="Standard">
The list of operators is quite long, so it is questionable whether such a data structure improves readability compared to:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">add = (a, b) -&gt; a + b
show reduce [1..10], add, 0
</pre>
</div>

</div>
<div class="Standard">
And what if we need something like <div class="listing">
<pre class="listing">equals
</pre>
</div>
 or <div class="listing">
<pre class="listing">makeAddFunction
</pre>
</div>
, in which one of the arguments already has a value? In that case we are back to writing a new function again.
</div>
<div class="Standard">
For cases like that, something called ‘partial application’<a class="IndexReference" name="entry-partial-application-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-partial-application">↓</a> is useful. You want to create a new function that already knows some of its arguments, and treats any additional arguments it is passed as coming after these fixed arguments. A simple version of this could be:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">partial = (func, a...) -&gt;
  (b...) -&gt; func a..., b...
​
f = (a,b,c,d) -&gt; show "#{a} #{b} #{c} #{d}"
g = partial f, 1, 2
g 3, 4
</pre>
</div>

</div>
<div class="Standard">
The return value of <div class="listing">
<pre class="listing">partial
</pre>
</div>
 is a function where the <div class="listing">
<pre class="listing">a...
</pre>
</div>
 arguments have been applied. When the returned function is called the <div class="listing">
<pre class="listing">b...
</pre>
</div>
 arguments are appended to the arguments of <div class="listing">
<pre class="listing">func
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">equals10 = partial op[’==’], 10
show map [1, 10, 100], equals10
</pre>
</div>

</div>
<div class="Standard">
Unlike traditional functional definitions, Underscore defines the order of its arguments as array before action. That means we can not simply say:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">square = (x) -&gt; x * x
show map [[10, 100], [12, 16], [0, 1]],
         partial map, square # Incorrect
</pre>
</div>

</div>
<div class="Standard">
Since the square function needs to be the second argument of the inner map. But we can define another partial function that reverses its arguments:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">partialReverse = (func, a) -&gt; (b) -&gt; func b, a
​
mapSquared = partialReverse map, square
show map [[10, 100], [12, 16], [0, 1]], mapSquared
</pre>
</div>

</div>
<div class="Standard">
However it is again worthwhile to consider whether the intent of the program is clearer when the functions are defined directly:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show map [[10, 100], [12, 16], [0, 1]],
  (sublist) -&gt; map sublist, (x) -&gt; x * x
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A trick that can be useful when you want to combine functions is function composition<a class="IndexReference" name="entry-function-composition-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-function-composition">↓</a>. At the start of this chapter I showed a function <div class="listing">
<pre class="listing">negate
</pre>
</div>
, which applies the boolean <i>not</i> operator to the result of calling a function:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">negate = (func) -&gt;
  (args...) -&gt; not func args...
</pre>
</div>

</div>
<div class="Standard">
This is a special case of a general pattern: call function A, and then apply function B to the result. Composition is a common concept in mathematics. <a class="IndexReference" name="entry-compose-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-compose">↓</a>It can be caught in a higher-order function like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">compose = (func1, func2) -&gt;
  (args...) -&gt; func1 func2 args...
​
isUndefined = (value) -&gt; value is undefined
isDefined = compose ((v) -&gt; not v), isUndefined
show ’isDefined Math.PI  = ’ + isDefined Math.PI
show ’isDefined Math.PIE = ’ + isDefined Math.PIE
</pre>
</div>

</div>
<div class="Standard">
In <div class="listing">
<pre class="listing">isDefined
</pre>
</div>
 we are defining a new function without naming it. This can be useful when you need to create a simple function to give to, for example, <div class="listing">
<pre class="listing">map
</pre>
</div>
 or <div class="listing">
<pre class="listing">reduce
</pre>
</div>
. However, when a function becomes more complex than this example, it is usually shorter and clearer to define it by itself and name it.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-8"></a>Searching<a class="Label" name="chap:Searching"> </a>
</h1>
<div class="Standard">
This chapter introduces new functional programming concepts and their use in problem solving. We will go through the solution of two problems, discussing some interesting algorithms and techniques along the way. To make it pleasant to work with the functional abstractions, the functions in the Underscore library are made directly available for use in the examples.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">require ’./prelude’
globalize _
</pre>
</div>

</div>
<div class="Standard">
Using global functions is fine in an isolated environment, later when you build reusable libraries or work in a project you should however fully qualify all functions, this is explained in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Modularity"><span class="sans">Modularity</span>↓</a>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Let me introduce our first problem. Take a look at this map. It shows Hiva Oa, a small tropical island in the Pacific Ocean.
</div>
<div class="Standard">
<img class="embedded" src="./Smooth CoffeeScript_files/Hiva Oa.png" alt="figure img/Hiva Oa.png" style="width: 100%; height: auto;">

</div>
<div class="Standard">
The black lines are roads, and the numbers next to them are the lengths of these roads. Imagine we need a program that finds the shortest route between two points on Hiva Oa. How could we approach that? Think about this for a moment.
</div>
<div class="Standard">
No really. Do not just steamroll on to the next paragraph. Try to seriously think of some ways you could do this, and consider the issues you would come up against. When reading a technical book, it is way too easy to just zoom over the text, nod solemnly, and promptly forget what you have read. If you make a sincere effort to solve a problem, it becomes <i>your</i> problem, and its solution will be more meaningful.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The first aspect of this problem is, again, representing our data. The information in the picture does not mean much to our computer. We could try writing a program that looks at the map and extracts the information in it… but that can get complicated. If we had twenty-thousand maps to interpret, this would be a good idea, in this case we will do the interpretation ourself and transcribe the map into a more computer-friendly format.
</div>
<div class="Standard">
What does our program need to know? It has to be able to look up which locations are connected, and how long the roads between them are. The places and roads on the island form a graph<a class="IndexReference" name="entry-graph-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-graph">↓</a>, as mathematicians call it. There are many ways to store graphs. A simple possibility is to just store an array of road objects, each of which contains properties naming its two endpoints and its length…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">roads = [
  { point1: ’Point Kiukiu’, point2: ’Hanaiapa’, length: 19 }
  { point1: ’Point Kiukiu’, point2: ’Mt Feani’, length: 15 }
] # and so on
</pre>
</div>

</div>
<div class="Standard">
However, it turns out that the program, as it is working out a route, will very often need to get a list of all the roads that start at a certain location, like a person standing on a crossroads will look at a signpost and read “Hanaiapa: 19km, Mount Feani: 15km”. It would be nice if this was easy (and quick) to do.
</div>
<div class="Standard">
With the representation given above, we have to sift through the whole list of roads, picking out the relevant ones, every time we want this signpost list. A better approach would be to store this list directly. For example, use an object that associates place-names with signpost lists:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">roads =
  ’Point Kiukiu’: [ {to: ’Hanaiapa’, distance: 19}
                    {to: ’Mt Feani’, distance: 15}
                    {to: ’Taaoa’, distance: 15} ]
  ’Taaoa’:        [ ] # et cetera
</pre>
</div>

</div>
<div class="Standard">
When we have this object, getting the roads that leave from Point Kiukiu is just a matter of looking at <div class="listing">
<pre class="listing">roads[’Point Kiukiu’]
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
However, this new representation does contain duplicate information: The road between A and B is listed both under A and under B. The first representation was already a lot of work to type in, this one is even worse.
</div>
<div class="Standard">
Fortunately, we have at our command the computer’s talent for repetitive work. We can specify the roads once, and have the correct data structure be generated by the computer. First, initialise an empty object called <div class="listing">
<pre class="listing">roads
</pre>
</div>
, and write a function <div class="listing">
<pre class="listing">makeRoad
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">roads = {}
makeRoad = (from, to, length) -&gt;
  addRoad = (from, to) -&gt;
    roads[from] = [] if not (from of roads)
    roads[from].push to: to, distance: length
  addRoad from, to
  addRoad to, from
</pre>
</div>

</div>
<div class="Standard">
Nice, huh? Notice how the inner function, <div class="listing">
<pre class="listing">addRoad
</pre>
</div>
, uses the same names (<div class="listing">
<pre class="listing">from
</pre>
</div>
, <div class="listing">
<pre class="listing">to
</pre>
</div>
) for its parameters as the outer function. These will not interfere: inside <div class="listing">
<pre class="listing">addRoad
</pre>
</div>
 they refer to <div class="listing">
<pre class="listing">addRoad
</pre>
</div>
’s parameters, and outside it they refer to <div class="listing">
<pre class="listing">makeRoad
</pre>
</div>
’s parameters.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">if
</pre>
</div>
 statement in <div class="listing">
<pre class="listing">addRoad
</pre>
</div>
 makes sure that there is an array of destinations associated with the location named by <div class="listing">
<pre class="listing">from
</pre>
</div>
, if there is not one it puts in an empty array. This way, the next line can assume there is such an array and safely push the new road onto it.
</div>
<div class="Standard">
Now the map information looks like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">makeRoad ’Point Kiukiu’, ’Hanaiapa’, 19
makeRoad ’Point Kiukiu’, ’Mt Feani’, 15
makeRoad ’Point Kiukiu’, ’Taaoa’, 15
show roads
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 26</i></span></span><br><div class="PlainVisible">
In the above description, the string <div class="listing">
<pre class="listing">’Point Kiukiu’
</pre>
</div>
 still occurs three times in a row. We could make our description even more succinct by allowing multiple roads to be specified in one line.
</div>
<div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">makeRoads
</pre>
</div>
 that takes any uneven number of arguments. The first argument is always the starting point of the roads, and every pair of arguments after that gives an ending point and a distance.
</div>
<div class="PlainVisible">
Do not duplicate the functionality of <div class="listing">
<pre class="listing">makeRoad
</pre>
</div>
, but have <div class="listing">
<pre class="listing">makeRoads
</pre>
</div>
 call <div class="listing">
<pre class="listing">makeRoad
</pre>
</div>
 to do the actual road-making.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">makeRoads = (start) -&gt;
  for i in [1...arguments.length] by 2
    makeRoad start, arguments[i], arguments[i + 1]
</pre>
</div>
<div class="Standard">
This function uses one named parameter, <div class="listing">
<pre class="listing">start
</pre>
</div>
, and gets the other parameters from the <div class="listing">
<pre class="listing">arguments
</pre>
</div>
 (quasi-) array. <div class="listing">
<pre class="listing">i
</pre>
</div>
 starts at <div class="listing">
<pre class="listing">1
</pre>
</div>
 because it has to skip this first parameter. <div class="listing">
<pre class="listing">by 2
</pre>
</div>
 skips the distances.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
You can verify the solution with this code that builds a data structure matching the map of Hiva Oa.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">roads = {}
makeRoads ’Point Kiukiu’,
  ’Hanaiapa’, 19, ’Mt Feani’, 15, ’Taaoa’, 15
makeRoads ’Airport’,
  ’Hanaiapa’, 6, ’Mt Feani’, 5,
  ’Atuona’, 4, ’Mt Ootua’, 11
makeRoads ’Mt Temetiu’,
  ’Mt Feani’, 8, ’Taaoa’, 4
makeRoads ’Atuona’,
  ’Taaoa’, 3, ’Hanakee pearl lodge’, 1
makeRoads ’Cemetery’,
  ’Hanakee pearl lodge’, 6, ’Mt Ootua’, 5
makeRoads ’Hanapaoa’,
  ’Mt Ootua’, 3
makeRoads ’Puamua’,
  ’Mt Ootua’, 13, ’Point Teohotepapapa’, 14
show ’Roads from the Airport:’
show roads[’Airport’]
</pre>
</div>
</div>
<div class="Standard">
We managed to considerably shorten our description of the road information by defining some convenient operations. You could say we expressed the information more succinctly by expanding our vocabulary. <a class="IndexReference" name="entry-domain-specific-language-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-domain-specific-language">↓</a>Defining a ‘little language’ like this is often a very powerful technique — when, at any time, you find yourself writing repetitive or redundant code, stop and try to come up with a vocabulary that makes it shorter and denser.
</div>
<div class="Standard">
Redundant code is not only a bore to write, it is also error-prone, people pay less attention when doing something that does not require them to think. On top of that, repetitive code is hard to change, because structure that is repeated a hundred times has to be changed a hundred times when it turns out to be incorrect or suboptimal.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
If you ran all the pieces of code above, you should now have a variable named <div class="listing">
<pre class="listing">roads
</pre>
</div>
 that contains all the roads on the island. When we need the roads starting from a certain place, we could just do <div class="listing">
<pre class="listing">roads[place]
</pre>
</div>
. But then, when someone makes a typo in a place name, which is not unlikely with these names, he will get <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 instead of the array he expects, and strange errors will follow. Instead, we will use a function that retrieves the road arrays, and yells at us when we give it an unknown place name:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">roadsFrom = (place) -&gt;
  found = roads[place]
  return found if found?
  throw new Error "No place named ’#{place}’ found."
    
try
  show roadsFrom "Hanaiapa"
  show roadsFrom "Hanalapa"
catch error
  show "Oops #{error}"
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Here is a first stab at a path-finding algorithm, the gambler’s method:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">gamblerPath = (from, to) -&gt;
​
  randomInteger = (below) -&gt;
    Math.floor Math.random() * below
​
  randomDirection = (from) -&gt;
    options = roadsFrom from
    options[randomInteger(options.length)].to
​
  path = []
  loop
    path.push from
    break if from == to
    from = randomDirection from
  path
​
show gamblerPath ’Hanaiapa’, ’Mt Feani’
</pre>
</div>

</div>
<div class="Standard">
At every split in the road, the gambler rolls his dice to decide which road he shall take. If the dice sends him back the way he came, so be it. Sooner or later, he will arrive at his destination, since all places on the island are connected by roads.
</div>
<div class="Standard">
The most confusing line is probably the one containing <div class="listing">
<pre class="listing">Math.random
</pre>
</div>
<a class="IndexReference" name="entry-Math.random-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Math.random">↓</a>. This function returns a pseudo-random<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [T] </span><span class="HoverFoot"><span class="SupFootMarker"> [T] </span>Computers are deterministic machines: They always react in the same way to the input they receive, so they can not produce truly random values. Therefore, we have to make do with series of numbers that look random, but are in fact the result of some complicated deterministic computation.</span></span> number between 0 and 1. Try calling it a few times from the console, it will (most likely) give you a different number every time. The function <div class="listing">
<pre class="listing">randomInteger
</pre>
</div>
 multiplies this number by the argument it is given, and rounds the result down with <div class="listing">
<pre class="listing">Math.floor
</pre>
</div>
. Thus, for example, <div class="listing">
<pre class="listing">randomInteger 3
</pre>
</div>
 will produce the number <div class="listing">
<pre class="listing">0
</pre>
</div>
, <div class="listing">
<pre class="listing">1
</pre>
</div>
, or <div class="listing">
<pre class="listing">2
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The gambler’s method is the way to go for those who abhor structure and planning, who desperately search for adventure. We set out to write a program that could find the <i>shortest</i> route between places though, so something else will be needed.
</div>
<div class="Standard">
A very straightforward approach to solving such a problem is called ‘generate and test’<a class="IndexReference" name="entry-generate-and-test-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-generate-and-test">↓</a>. It goes like this:
</div>
<ol>
<li>
Generate all possible routes.
</li>
<li>
In this set, find the shortest one that actually connects the start point to the end point.
</li>

</ol>
<div class="Standard">
Step two is not hard. Step one is a little problematic. If you allow routes with circles in them, there is an infinite amount of routes. Of course, routes with circles in them are unlikely to be the shortest route to anywhere, and routes that do not start at the start point do not have to be considered either. For a small graph like Hiva Oa, it should be possible to generate all non-cyclic (circle-free) routes starting from a certain point.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
But first, we will need to expand our vocabulary so we can deal with the problem in a natural way. The words we need exist in CoffeeScript and in the Underscore library, but we will go through how they can be implemented, so it is clear how they function and what they do. The example implementations will be named with an underscore in front of their names to show they are internal and not used in the rest of the book. You can compare with the implementations in the Underscore library in <div class="listing">
<pre class="listing">src/prelude/underscore.coffee
</pre>
</div>
.
</div>
<div class="Standard">
The first is a function named <div class="listing">
<pre class="listing">_member
</pre>
</div>
, which is used to determine whether an element is found within an array. The route will be kept as an array of names, and when arriving at a new place, the algorithm could logically call <div class="listing">
<pre class="listing">_member
</pre>
</div>
 to check whether we have been at that place already. It could look like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_member = (array, value) -&gt;
  found = false
  array.forEach (element) -&gt;
    if element == value
      found = true
  found
show _member [6, 7, "Bordeaux"], 7
</pre>
</div>

</div>
<div class="Standard">
However, this will go over the whole array, even if the value is found immediately at the first position. What wastefulness. When using a <div class="listing">
<pre class="listing">for
</pre>
</div>
 loop, you can use the <div class="listing">
<pre class="listing">break
</pre>
</div>
 statement to jump out of it, but in a <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 construct this will not work, because the body of the loop is a function, and <div class="listing">
<pre class="listing">break
</pre>
</div>
 statements do not jump out of functions. One solution could be to adjust <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 to recognise a certain kind of exceptions as signalling a break. Something like <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
 here:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_break = toString: -&gt; "Break"
_forEach = (array, action) -&gt;
  try
    for element in array
      action element
  catch exception
    if exception != _break
      throw exception
show _forEach [1..3], (n) -&gt; n*n
# Which btw could in CoffeeScript be written as
show (i*i for i in [1..3])
</pre>
</div>

</div>
<div class="Standard">
Now, if the <div class="listing">
<pre class="listing">action
</pre>
</div>
 function throws <div class="listing">
<pre class="listing">_break
</pre>
</div>
, <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
 will absorb the exception and stop looping. The object stored in the variable <div class="listing">
<pre class="listing">_break
</pre>
</div>
 is used purely as a thing to compare with. The only reason I gave it a <div class="listing">
<pre class="listing">toString
</pre>
</div>
 property is that this might be useful to figure out what kind of strange value you are dealing with if you somehow end up with a <div class="listing">
<pre class="listing">_break
</pre>
</div>
 exception outside of a <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
. Now <div class="listing">
<pre class="listing">_member
</pre>
</div>
 can be defined as:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_member = (array, value) -&gt;
  found = false
  _forEach array, (element) -&gt;
    if element == value
      found = true
      throw _Break
  found
</pre>
</div>

</div>
<div class="Standard">
Of course we could also have defined <div class="listing">
<pre class="listing">_member
</pre>
</div>
 without using the <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_member = (array, value) -&gt;
  found = false
  for element in array
    if element == value
      found = true
      break
  found
</pre>
</div>

</div>
<div class="Standard">
This function exists in Underscore as <div class="listing">
<pre class="listing">include
</pre>
</div>
 aka <div class="listing">
<pre class="listing">contains
</pre>
</div>
. But it is such a common operation that it is in fact built into CoffeeScript with the <div class="listing">
<pre class="listing">in
</pre>
</div>
 operator (outside of a <div class="listing">
<pre class="listing">for
</pre>
</div>
 … <div class="listing">
<pre class="listing">in
</pre>
</div>
). Using <div class="listing">
<pre class="listing">in
</pre>
</div>
 is the preferred way to test for array membership.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show 7 in [6, 7, "Bordeaux"] 
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Having a way to break out of <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
 loops can be very useful, but in the case of the <div class="listing">
<pre class="listing">_member
</pre>
</div>
 function the result is still rather ugly, because you need to specifically store the result and later return it. We could add yet another kind of exception, <div class="listing">
<pre class="listing">_return
</pre>
</div>
, which can be given a <div class="listing">
<pre class="listing">value
</pre>
</div>
 property, and have <div class="listing">
<pre class="listing">_forEach
</pre>
</div>
 return this value when such an exception is thrown, but this would be terribly ad-hoc and messy. What we really need is a whole new higher-order function, called <div class="listing">
<pre class="listing">any
</pre>
</div>
<a class="IndexReference" name="entry-any-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-any">↓</a> (or sometimes <div class="listing">
<pre class="listing">some
</pre>
</div>
). It exists in Underscore under both names. A definition more or less looks like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_any = (array, test) -&gt;
  for element in array
    if test element
      return true
  false
​
# Using Underscore
show any [3, 4, 0, -3, 2, 1], (n) -&gt; n &lt; 0
​
# Redefining member with any
_member = (array, value) -&gt;
  partial = (func, a...) -&gt; (b...) -&gt; func a..., b...
  any array, partial ((a,b) -&gt; a == b), value
show _member ["Fear", "Loathing"], "Denial"
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">any
</pre>
</div>
 goes over the elements in an array, from left to right, and applies the test function to them. The first time this returns a true-ish value, it returns that value. If no true-ish value is found, <div class="listing">
<pre class="listing">false
</pre>
</div>
 is returned. Calling <div class="listing">
<pre class="listing">any(test, array)
</pre>
</div>
 is more or less equivalent to doing <div class="listing">
<pre class="listing">test(array[0]) ||
</pre>
</div>
 <div class="listing">
<pre class="listing">test(array[1]) || ...
</pre>
</div>
 etcetera.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Just like <div class="listing">
<pre class="listing">&amp;&amp;
</pre>
</div>
 is the companion of <div class="listing">
<pre class="listing">||
</pre>
</div>
, <div class="listing">
<pre class="listing">any
</pre>
</div>
 has a companion called <div class="listing">
<pre class="listing">every
</pre>
</div>
<a class="IndexReference" name="entry-every-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-every">↓</a>:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_every = (array, test) -&gt;
  for element in array
    if not test element
      return false
  true
show every [1, 2, -1], (n) -&gt; n != 0 # Using Underscore
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Another function we will need is <div class="listing">
<pre class="listing">flatten
</pre>
</div>
. This function takes an array of arrays, and puts the elements of the arrays together in one big array.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">_flatten = (array) -&gt;
  result = []
  for element in array
    if isArray element
      result = result.concat _flatten element
    else
      result.push element
  result
​
# Using Underscore
show flatten [[1], [2, [3, 4]], [5, 6]]
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 27</i></span></span><br><div class="PlainVisible">
Before starting to generate routes, we need one more higher-order function. This one is called <div class="listing">
<pre class="listing">filter
</pre>
</div>
<a class="IndexReference" name="entry-filter-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-filter">↓</a> (in Underscore it is also named <div class="listing">
<pre class="listing">select
</pre>
</div>
). Like <div class="listing">
<pre class="listing">map
</pre>
</div>
, it takes a function and an array as arguments, and produces a new array, but instead of putting the results of calling the function in the new array, it produces an array with only those values from the old array for which the given function returns a true-like value. Write a <div class="listing">
<pre class="listing">_filter
</pre>
</div>
 function that shows how it works.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">_filter = (array, test) -&gt;
  result = []
  for element in array
    if test element
      result.push element
  result
​
show _filter [0, 4, 8, 12], (n) -&gt; n &lt; 5
​
isOdd = (n) -&gt; n % 2 != 0
show filter [0..6], isOdd # Using Underscore
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Imagine what an algorithm to generate routes would look like — it starts at the starting location, and starts to generate a route for every road leaving there. At the end of each of these roads it continues to generate more routes. It does not run along one road, it branches out. Because of this, recursion<a class="IndexReference" name="entry-recursion-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-recursion">↓</a> is a natural way to model it.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">possibleRoutes = (from, to) -&gt;
  findRoutes = (route) -&gt;
    notVisited = (road) -&gt;
      not (road.to in route.places)
    continueRoute = (road) -&gt;
      findRoutes 
        places: route.places.concat([road.to]),
        length: route.length + road.distance
    end = route.places[route.places.length - 1]
    if end == to
      [route]
    else
      flatten map filter(roadsFrom(end), notVisited),
                  continueRoute
  findRoutes {places: [from], length: 0}
​
show (possibleRoutes ’Point Teohotepapapa’,
                     ’Point Kiukiu’).length
show possibleRoutes ’Hanapaoa’, ’Mt Ootua’ 
</pre>
</div>

</div>
<div class="Standard">
The function returns an array of route objects, each of which contains an array of places that the route passes, and a length. <div class="listing">
<pre class="listing">findRoutes
</pre>
</div>
 recursively continues a route, returning an array with every possible extension of that route. When the end of a route is the place where we want to go, it just returns that route, since continuing past that place would be pointless. If it is another place, we must go on. The <div class="listing">
<pre class="listing">flatten
</pre>
</div>
/<div class="listing">
<pre class="listing">map
</pre>
</div>
/<div class="listing">
<pre class="listing">filter
</pre>
</div>
 line is probably the hardest to read. This is what it says: ‘Take all the roads going from the current location, discard the ones that go to places that this route has already visited. Continue each of these roads, which will give an array of finished routes for each of them, then put all these routes into a single big array that we return.’
</div>
<div class="Standard">
That line does a lot. This is why good abstractions help: They allow you to say complicated things without typing pages of code.
</div>
<div class="Standard">
Does this not recurse forever, seeing how it calls itself (via <div class="listing">
<pre class="listing">continueRoute
</pre>
</div>
)? No, at some point, all outgoing roads will go to places that a route has already passed, and the result of <div class="listing">
<pre class="listing">filter
</pre>
</div>
 will be an empty array. Mapping over an empty array produces an empty array, and flattening that still gives an empty array. So calling <div class="listing">
<pre class="listing">findRoutes
</pre>
</div>
 on a dead end produces an empty array, meaning ‘there are no ways to continue this route’.
</div>
<div class="Standard">
Notice that places are appended to routes by using <div class="listing">
<pre class="listing">concat
</pre>
</div>
<a class="IndexReference" name="entry-concat-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-concat">↓</a>, not <div class="listing">
<pre class="listing">push
</pre>
</div>
<a class="IndexReference" name="entry-push-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-push">↓</a>. The <div class="listing">
<pre class="listing">concat
</pre>
</div>
 method creates a new array, while <div class="listing">
<pre class="listing">push
</pre>
</div>
 modifies the existing array. Because the function might branch off several routes from a single partial route, we must not modify the array that represents the original route, because it must be used several times.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 28</i></span></span><br><div class="PlainVisible">
Now that we have all possible routes, let us try to find the shortest one. Write a function <div class="listing">
<pre class="listing">shortestRoute
</pre>
</div>
 that, like <div class="listing">
<pre class="listing">possibleRoutes
</pre>
</div>
, takes the names of a starting and ending location as arguments. It returns a single route object, of the type that <div class="listing">
<pre class="listing">possibleRoutes
</pre>
</div>
 produces.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">shortestRoute = (from, to) -&gt;
  currentShortest = null
  forEach possibleRoutes(from, to), (route) -&gt;
    if not currentShortest or
       currentShortest.length &gt; route.length
      currentShortest = route 
  currentShortest
</pre>
</div>
<div class="Standard">
The tricky thing in ‘minimising’ or ‘maximising’ algorithms is to not screw up when given an empty array. In this case, we happen to know that there is at least one road between every two places, so we could just ignore it. But that would be a bit lame. What if the road from Puamua to Mount Ootua, which is steep and muddy, is washed away by a rainstorm? It would be a shame if this caused our function to break as well, so it takes care to return <div class="listing">
<pre class="listing">null
</pre>
</div>
 when no routes are found.<div class="PlainVisible">
Then, the very functional, abstract-everything-we-can approach:
</div>
</div>
<div class="listing">
<pre class="listing">minimise = (func, array) -&gt;
  minScore = null
  found = null
  forEach array, ( (element) -&gt;
    score = func element
    if minScore == null || score &lt; minScore
      minScore = score
      found = element )
  found
​
getProperty = (propName) -&gt;
  (object) -&gt; object[propName]
​
shortestRoute = (from, to) -&gt;
  minimise getProperty(’length’),
           possibleRoutes(from, to)
</pre>
</div>
<div class="Standard">
Unfortunately, it is two times longer than the other version. In programs where you need to minimise several things it might be a good idea to write the generic algorithm like this, so you can re-use it. In most cases the first version is probably good enough.<div class="PlainVisible">
Note the <div class="listing">
<pre class="listing">getProperty
</pre>
</div>
<a class="IndexReference" name="entry-getProperty-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-getProperty">↓</a> function though, it is often useful when doing functional programming with objects.
</div>
</div>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
Let us see what route our algorithm comes up with between Point Kiukiu and Point Teohotepapapa…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show (shortestRoute ’Point Kiukiu’,
  ’Point Teohotepapapa’).places
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
On a small island like Hiva Oa, it is not too much work to generate all possible routes. If you try to do that on a reasonably detailed map of, say, Belgium, it is going to take an absurdly long time, not to mention an absurd amount of memory. Still, you have probably seen those online route-planners. These give you a more or less optimal route through a gigantic maze of roads in just a few seconds. How do they do it?
</div>
<div class="Standard">
If you are paying attention, you may have noticed that it is not necessary to generate all routes all the way to the end. If we start comparing routes <i>while</i> we are building them, we can avoid building this big set of routes, and, as soon as we have found a single route to our destination, we can stop extending routes that are already longer than that route.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
To try this out, we will use a 20 by 20 grid as our map:
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/height.png" alt="figure img/height.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
What you see here is an elevation map of a mountain landscape. The yellowish spots are the peaks, and the dark spots the valleys. The area is divided into squares with a size of a hundred meters. We have at our disposal a function <div class="listing">
<pre class="listing">heightAt
</pre>
</div>
, which can give us the height, in meters, of any square on that map, where squares are represented by objects with <div class="listing">
<pre class="listing">x
</pre>
</div>
 and <div class="listing">
<pre class="listing">y
</pre>
</div>
 properties.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show heightAt x:  0, y:  0
show heightAt x: 11, y: 18
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
We want to cross this landscape, on foot, from the top left to the bottom right. A grid can be approached like a graph. Every square is a node, which is connected to the squares around it.
</div>
<div class="Standard">
We do not like wasting energy, so we would prefer to take the easiest route possible. Going uphill is heavier than going downhill, and going downhill is heavier than going level<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [U] </span><span class="HoverFoot"><span class="SupFootMarker"> [U] </span>No really, it is.</span></span>. This function calculates the amount of ‘weighted meters’, between two adjacent squares, which represents how tired you get from walking (or climbing) between them. Going uphill is counted as twice as heavy as going downhill.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">weightedDistance = (pointA, pointB) -&gt;
  heightDifference =
    heightAt(pointB) - heightAt(pointA)
  climbFactor = if heightDifference &lt; 0 then 1 else 2
  flatDistance =
    if pointA.x == pointB.x or pointA.y == pointB.y
      100
    else
      141
  flatDistance + climbFactor * Math.abs heightDifference
show weightedDistance (x: 0, y: 0), (x: 1, y: 1)
</pre>
</div>

</div>
<div class="Standard">
Note the <div class="listing">
<pre class="listing">flatDistance
</pre>
</div>
 calculation. If the two points are on the same row or column, they are right next to each other, and the distance between them is a hundred meters. Otherwise, they are assumed to be diagonally adjacent, and the diagonal distance between two squares of this size is a hundred times the square root of two, which is approximately <div class="listing">
<pre class="listing">141
</pre>
</div>
. One is not allowed to call this function for squares that are further than one step apart. (It could double-check this… but it is too lazy.)
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Points on the map are represented by objects containing <div class="listing">
<pre class="listing">x
</pre>
</div>
 and <div class="listing">
<pre class="listing">y
</pre>
</div>
 properties. These three functions are useful when working with such objects:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">point = (x, y) -&gt; {x, y} # Same as {x: x, y: y}
addPoints = (a, b) -&gt; point a.x + b.x, a.y + b.y
samePoint = (a, b) -&gt; a.x == b.x and a.y == b.y
​
show samePoint addPoints(point(10, 10), point(4, -2)),
                         point(14, 8)
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 29</i></span></span><br><div class="PlainVisible">
If we are going to find routes through this map, we will again need a function to create ‘signposts’, lists of directions that can be taken from a given point. Write a function <div class="listing">
<pre class="listing">possibleDirections
</pre>
</div>
, which takes a point object as argument and returns an array of nearby points. We can only move to adjacent points, both straight and diagonally, so squares have a maximum of eight neighbours. Take care not to return squares that lie outside of the map. For all we know the edge of the map might be the edge of the world.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">possibleDirections = (from) -&gt;
  mapSize = 20
  insideMap = (point) -&gt;
    point.x &gt;= 0 and point.x &lt; mapSize and
    point.y &gt;= 0 and point.y &lt; mapSize
  directions = [ point(-1,  0), point( 1,  0)
                 point( 0, -1), point( 0,  1)
                 point(-1, -1), point(-1,  1)
                 point( 1,  1), point( 1, -1)]
  partial = (func, a...) -&gt; (b...) -&gt; func a..., b...
  filter (map directions,
              partial addPoints, from), insideMap
​
show possibleDirections point 0, 0
</pre>
</div>
<div class="Standard">
I created a variable <div class="listing">
<pre class="listing">mapSize
</pre>
</div>
, for the sole purpose of not having to write <div class="listing">
<pre class="listing">20
</pre>
</div>
 two times. If, at some other time, we want to use this same function for another map, it would be clumsy if the code was full of <div class="listing">
<pre class="listing">20
</pre>
</div>
s, which all have to be changed. We could even go as far as making the <div class="listing">
<pre class="listing">mapSize
</pre>
</div>
 an argument to <div class="listing">
<pre class="listing">possibleDirections
</pre>
</div>
, so we can use the function for different maps without changing it. I judged that that was not necessary in this case, such things can be changed when the need arises. Then why did I not add a variable to hold the <div class="listing">
<pre class="listing">0
</pre>
</div>
, which also occurs two times? I assumed that maps always start at <div class="listing">
<pre class="listing">0
</pre>
</div>
, so this one is unlikely to ever change, and using a variable for it only adds noise.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
To find a route on this map without having our browser cut off the program because it takes too long to finish, we have to stop our amateurish attempts and implement a serious algorithm. A lot of work has gone into problems like this in the past, and many solutions have been designed (some brilliant, others useless). A very popular and efficient one is called A*<a class="IndexReference" name="entry-A*-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-A*">↓</a> (pronounced A-star). We will spend the rest of the chapter implementing an A* route-finding function for our map.
</div>
<div class="Standard">
Before I get to the algorithm itself, let me tell you a bit more about the problem it solves. The trouble with searching routes through graphs is that, in big graphs, there are an awful lot of them. Our Hiva Oa path-finder showed that, when the graph is small, all we needed to do was to make sure our paths did not revisit points they had already passed. On our new map, this is not enough anymore.
</div>
<div class="Standard">
The fundamental problem is that there is too much room for going in the wrong direction. Unless we somehow manage to steer our exploration of paths towards the goal, a choice we make for continuing a given path is more likely to go in the wrong direction than in the right direction. If you keep generating paths like that, you end up with an enormous amount of paths, and even if one of them accidentally reaches the end point, you do not know whether that is the shortest path.
</div>
<div class="Standard">
So what you want to do is explore directions that are likely to get you to the end point first. On a grid like our map, you can get a rough estimate of how good a path is by checking how long it is and how close its end is to the end point. By adding path length and an estimate of the distance it still has to go, you can get a rough idea of which paths are promising. If you extend promising paths first, you are less likely to waste time on useless ones.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
But that still is not enough. If our map was of a perfectly flat plane, the path that looked promising would almost always be the best one, and we could use the above method to walk right to our goal. But we have valleys and hillsides blocking our paths, so it is hard to tell in advance which direction will be the most efficient path. Because of this, we still end up having to explore way too many paths.
</div>
<div class="Standard">
To correct this, we can make clever use of the fact that we are constantly exploring the most promising path first. Once we have determined that path A is the best way to get to point X, we can remember that. When, later on, path B also gets to point X, we know that it is not the best route, so we do not have to explore it further. This can prevent our program from building a lot of pointless paths.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The algorithm, then, goes something like this…
</div>
<div class="Standard">
There are two pieces of data to keep track of. The first one is called the open list, it contains the partial routes that must still be explored. Each route has a score, which is calculated by adding its length to its estimated distance from the goal. This estimate must always be optimistic, it should never overestimate the distance. The second is a set of nodes that we have seen, together with the shortest partial route that got us there. This one we will call the reached list. We start by adding a route that contains only the starting node to the open list, and recording it in the reached list.
</div>
<div class="Standard">
Then, as long as there are any nodes in the open list, we take out the one that has the lowest (best) score, and find the ways in which it can be continued (by calling <div class="listing">
<pre class="listing">possibleDirections
</pre>
</div>
). For each of the nodes this returns, we create a new route by appending it to our original route, and adjusting the length of the route using <div class="listing">
<pre class="listing">weightedDistance
</pre>
</div>
. The endpoint of each of these new routes is then looked up in the reached list.
</div>
<div class="Standard">
If the node is not in the reached list yet, it means we have not seen it before, and we add the new route to the open list and record it in the reached list. If we <i>had</i> seen it before, we compare the score of the new route to the score of the route in the reached list. If the new route is shorter, we replace the existing route with the new one. Otherwise, we discard the new route, since we have already seen a better way to get to that point.
</div>
<div class="Standard">
We continue doing this until the route we fetch from the open list ends at the goal node, in which case we have found our route, or until the open list is empty, in which case we have found out that there is no route. In our case the map contains no unsurmountable obstacles, so there is always a route.
</div>
<div class="Standard">
How do we know that the first full route that we get from the open list is also the shortest one? This is a result of the fact that we only look at a route when it has the lowest score. The score of a route is its actual length plus an <i>optimistic</i> estimate of the remaining length. This means that if a route has the lowest score in the open list, it is always the best route to its current endpoint — it is impossible for another route to later find a better way to that point, because if it were better, its score would have been lower.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Try not to get frustrated when the fine points of why this works are still eluding you. When thinking about algorithms like this, having seen ‘something like it’ before helps a lot, it gives you a point of reference to compare the approach to. Beginning programmers have to do without such a point of reference, which makes it rather easy to get lost. Just realise that this is advanced stuff, globally read over the rest of the chapter, and come back to it later when you feel like a challenge.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
I am afraid that, for one aspect of the algorithm, I am going to have to invoke magic again. The open list needs to be able to hold a large amount of routes, and to quickly find the route with the lowest score among them. Storing them in a normal array, and searching through this array every time, is way too slow, so I give you a data structure called a binary heap<a class="IndexReference" name="entry-binary-heap-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-binary-heap">↓</a>. You create them with <div class="listing">
<pre class="listing">new
</pre>
</div>
, just like <div class="listing">
<pre class="listing">Date
</pre>
</div>
 objects, giving them a function that is used to ‘score’ its elements as argument. The resulting object has the methods <div class="listing">
<pre class="listing">push
</pre>
</div>
 and <div class="listing">
<pre class="listing">pop
</pre>
</div>
, just like an array, but <div class="listing">
<pre class="listing">pop
</pre>
</div>
 always gives you the element with the lowest score, instead of the one that was <div class="listing">
<pre class="listing">push
</pre>
</div>
ed last.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">bh = require ’./A2-BinaryHeap’
globalize bh
​
heap = new BinaryHeap()
forEach [2, 4, 5, 1, 6, 3], (number) -&gt;
  heap.push number
​
while heap.size() &gt; 0
  show heap.pop()
</pre>
</div>

</div>
<div class="Standard">
<a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Binary-Heaps"><span class="sans">Binary Heaps</span>↓</a> discusses the implementation of this data structure, which is quite interesting. After you have read <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>, you might want to take a look at it.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The need to squeeze out as much efficiency as we can has another effect. The Hiva Oa algorithm used arrays of locations to store routes, and copied them with the <div class="listing">
<pre class="listing">concat
</pre>
</div>
 method when it extended them. This time, we can not afford to copy arrays, since we will be exploring lots and lots of routes. Instead, we use a ‘chain’ of objects to store a route. Every object in the chain has some properties, such as a point on the map, and the length of the route so far, and it also has a property that points at the previous object in the chain. Something like this:
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/objectchain.png" alt="figure img/objectchain.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
Where the blue circles are the relevant objects, and the lines represent properties — the end points are the values of the property. Object <div class="listing">
<pre class="listing">A
</pre>
</div>
 is the start of a route here. Object <div class="listing">
<pre class="listing">B
</pre>
</div>
 is used to build a new route, which continues from <div class="listing">
<pre class="listing">A
</pre>
</div>
. It has a property, which we will call <div class="listing">
<pre class="listing">from
</pre>
</div>
, pointing at the route it is based on. When we need to reconstruct a route later, we can follow these properties to find all the points that the route passed. Note that object <div class="listing">
<pre class="listing">B
</pre>
</div>
 is part of two routes, one that ends in <div class="listing">
<pre class="listing">D
</pre>
</div>
 and one that ends in <div class="listing">
<pre class="listing">E
</pre>
</div>
. When there are a lot of routes, this can save us much storage space — every new route only needs one new object for itself, the rest is shared with other routes that started the same way.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 30</i></span></span><br><div class="PlainVisible">
Write a function <div class="listing">
<pre class="listing">estimatedDistance
</pre>
</div>
 that gives an optimistic estimate of the distance between two points. It does not have to look at the height data, but can assume a flat map. Remember that we are only travelling straight and diagonally, and that we are counting the diagonal distance between two squares as <div class="listing">
<pre class="listing">141
</pre>
</div>
.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">estimatedDistance = (pointA, pointB) -&gt;
  dx = Math.abs pointA.x - pointB.x
  dy = Math.abs pointA.y - pointB.y
  if dx &gt; dy
    (dx - dy) * 100 + dy * 141
  else
    (dy - dx) * 100 + dx * 141
​
show estimatedDistance point(3,3), point(9,6)
</pre>
</div>
<div class="Standard">
The strange formulae are used to decompose the path into a straight and a diagonal part. If you have a path like this…</div><div class="PlainVisible">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/diagonalpath.png" alt="figure img/diagonalpath.png" style="width: 50%; height: auto;">

</div>

</div>
<div class="Standard">
<div class="PlainVisible">
… the path is <div class="listing">
<pre class="listing">6
</pre>
</div>
 squares wide and <div class="listing">
<pre class="listing">3
</pre>
</div>
 high, so you get <div class="listing">
<pre class="listing">6 - 3 = 3
</pre>
</div>
 straight moves, and <div class="listing">
<pre class="listing">3
</pre>
</div>
 diagonal ones.
</div>
<div class="PlainVisible">
If you wrote a function that just computes the straight ‘Pythagorean’ distance between the points, that would also work. What we need is an optimistic estimate, and assuming you can go straight to the goal is certainly optimistic. However, the closer the estimate is to the real distance, the less useless paths our program has to try out.
</div>
</div>
</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 31</i></span></span><br><div class="PlainVisible">
We will use a binary heap for the open list. What would be a good data structure for the reached list? This one will be used to look up routes, given a pair of <div class="listing">
<pre class="listing">x
</pre>
</div>
, <div class="listing">
<pre class="listing">y
</pre>
</div>
 coordinates. Preferably in a way that is fast. Write three functions, <div class="listing">
<pre class="listing">makeReachedList
</pre>
</div>
, <div class="listing">
<pre class="listing">storeReached
</pre>
</div>
, and <div class="listing">
<pre class="listing">findReached
</pre>
</div>
. The first one creates your data structure, the second one, given a reached list, a point, and a route, stores a route in it, and the last one, given a reached list and point, retrieves a route or returns <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 to indicate that no route was found for that point.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="PlainVisible">
One reasonable idea would be to use an object with objects in it. One of the coordinates in the points, say <div class="listing">
<pre class="listing">x
</pre>
</div>
, is used as a property name for the outer object, and the other, <div class="listing">
<pre class="listing">y
</pre>
</div>
, for the inner object. This does require some bookkeeping to handle the fact that, sometimes, the inner object we are looking for is not there (yet).
</div>
<div class="listing">
<pre class="listing">makeReachedList = -&gt; {}
​
storeReached = (list, point, route) -&gt;
  inner = list[point.x]
  if inner is undefined
    inner = {}
    list[point.x] = inner
  inner[point.y] = route
​
findReached = (list, point) -&gt;
  inner = list[point.x]
  if inner is undefined
    undefined
  else
    inner[point.y]
</pre>
</div>
<div class="Standard">
Another possibility is to merge the <div class="listing">
<pre class="listing">x
</pre>
</div>
 and <div class="listing">
<pre class="listing">y
</pre>
</div>
 of the point into a single property name, and use that to store routes in a single object.</div><div class="listing">
<pre class="listing">pointID = (point) -&gt;
  point.x + ’-’ + point.y
​
makeReachedList = -&gt; {}
storeReached = (list, point, route) -&gt;
  list[pointID(point)] = route
findReached = (list, point) -&gt;
  list[pointID(point)]
</pre>
</div>

</div>

</div>

</span></span></span>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-encapsulation-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-encapsulation">↓</a>Defining a type of data structure by providing a set of functions to create and manipulate such structures is a useful technique. It makes it possible to ‘isolate’ the code that makes use of the structure from the details of the structure itself. Note that, no matter which of the above two implementations is used, code that needs a reached list works in exactly the same way. It does not care what kind of objects are used, as long as it gets the results it expected.
</div>
<div class="Standard">
This will be discussed in much more detail in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↓</a>, where we will learn to make object types like <div class="listing">
<pre class="listing">BinaryHeap
</pre>
</div>
, which are created using <div class="listing">
<pre class="listing">new
</pre>
</div>
 and have methods to manipulate them.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Here we finally have the actual path-finding function:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">findRoute = (from, to) -&gt;
 
  routeScore = (route) -&gt;
    if route.score is undefined
      route.score = route.length +
        estimatedDistance route.point, to
    route.score
​
  addOpenRoute = (route) -&gt;
    open.push route
    storeReached reached, route.point, route
​
  open = new BinaryHeap routeScore
  reached = makeReachedList()
  addOpenRoute point: from, length: 0
​
  while open.size() &gt; 0
    route = open.pop()
    if samePoint route.point, to
      return route
​
    forEach possibleDirections(route.point),
      (direction) -&gt;
        known = findReached reached, direction
        newLength = route.length +
          weightedDistance route.point, direction
        if not known or known.length &gt; newLength
          if known
            open.remove known
          addOpenRoute
            point:  direction,
            from:   route,
            length: newLength
  return null
</pre>
</div>

</div>
<div class="Standard">
First, it creates the data structures it needs, one open list and one reached list. <div class="listing">
<pre class="listing">routeScore
</pre>
</div>
 is the scoring function given to the binary heap. Note how it stores its result in the route object, to prevent having to re-calculate it multiple times.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">addOpenRoute
</pre>
</div>
 is a convenience function that adds a new route to both the open list and the reached list. It is immediately used to add the start of the route. Note that route objects always have the properties <div class="listing">
<pre class="listing">point
</pre>
</div>
, which holds the point at the end of the route, and <div class="listing">
<pre class="listing">length
</pre>
</div>
, which holds the current length of the route. Routes which are more than one square long also have a <div class="listing">
<pre class="listing">from
</pre>
</div>
 property, which points at their predecessors.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">while
</pre>
</div>
 loop, as was described in the algorithm, keeps taking the lowest-scoring route from the open list and checks whether this gets us to the goal point. If it does not, we must continue by expanding it. This is what the <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 takes care of. It looks up this new point in the reached list. If it is not found there, or the node found has a longer length that the new route, a new route object is created and added to the open list and reached list, and the existing route (if any) is removed from the open list.
</div>
<div class="Standard">
What if the route in <div class="listing">
<pre class="listing">known
</pre>
</div>
 is not on the open list? It has to be, because routes are only removed from the open list when they have been found to be the most optimal route to their endpoint. If we try to remove a value from a binary heap that is not on it, it will throw an exception, so if my reasoning is wrong, we will probably see an exception when running the function.
</div>
<div class="Standard">
When code gets complex enough to make you doubt certain things about it, it is a good idea to add some checks that raise exceptions when something goes wrong. That way, you know that there are no weird things happening ‘silently’, and when you break something, you immediately see what you broke.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Note that this algorithm does not use recursion, but still manages to explore all those branches. The open list more or less takes over the role that the function call stack played in the recursive solution to the Hiva Oa problem — it keeps track of the paths that still have to be explored. Every recursive algorithm can be rewritten in a non-recursive way by using a data structure to store the ‘things that must still be done’.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Well, let us try our path-finder:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">route = findRoute point(0, 0), point(19, 19)
</pre>
</div>

</div>
<div class="Standard">
If you ran all the code above, and did not introduce any errors, that call, though it might take an instant to run, should give us a route object. This object is rather hard to read. That can be helped by using the <div class="listing">
<pre class="listing">showRoute
</pre>
</div>
 function which will show a route as a list of coordinates.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">showRoute route
</pre>
</div>

</div>
<div class="Standard">
You can also pass multiple routes to <div class="listing">
<pre class="listing">showRoute
</pre>
</div>
, which can be useful when you are, for example, trying to plan a scenic route, which must include the beautiful viewpoint at <div class="listing">
<pre class="listing">11
</pre>
</div>
, <div class="listing">
<pre class="listing">17
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">showRoute findRoute(point( 0,  0), point(11, 17)),
          findRoute(point(11, 17), point(19, 19))
</pre>
</div>

</div>
<div class="Standard">
<div class="defskip"> </div>
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/scenic.png" alt="figure img/scenic.png" style="width: 70%; height: auto;">

</div>

</div>
<div class="Standard">
You can also display routes on a map with <div class="listing">
<pre class="listing">renderRoute
</pre>
</div>
. A web page with the map is served to your browser, then the route points are transferred via WebSockets to a snippet of CoffeeScript on the page that uses a canvas to draw the points on top of the map.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">renderRoute findRoute(point( 0,  0), point(11, 17)),
            findRoute(point(11, 17), point(19, 19))
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Variations on the theme of search<a class="IndexReference" name="entry-search-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-search">↓</a>ing an optimal route through a graph can be applied to many problems, many of which are not at all related to finding a physical path. For example, a program that needs to solve a puzzle of fitting a number of blocks into a limited space could do this by exploring the various ‘paths’ it gets by trying to put a certain block in a certain place. The paths that ends up with insufficient room for the last blocks are dead ends, and the path that manages to fit in all blocks is the solution.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-9"></a>Object-oriented Programming<a class="Label" name="chap:Object-orientation"> </a>
</h1>
<div class="Standard">
In the early nineties, a thing called object-oriented programming<a class="IndexReference" name="entry-object-oriented-programming-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-object-oriented-programming">↓</a> stirred up the software industry. Most of the ideas behind it were not really new at the time, but they had finally gained enough momentum to start rolling, to become fashionable. Books were being written, courses given, programming languages developed. All of a sudden, everybody was extolling the virtues of object-orientation, enthusiastically applying it to every problem, convincing themselves they had finally found the <i>right way to write programs</i>.
</div>
<div class="Standard">
These things happen a lot. When a process is hard and confusing, people are always on the lookout for a magic solution. When something looking like such a solution presents itself, they are prepared to become devoted followers. For many programmers — even today — object-orientation (or their view of it) is the gospel. When a program is not ‘truly object-oriented’, whatever that means, it is considered decidedly inferior.
</div>
<div class="Standard">
Few fads have managed to stay popular for as long as this one, though. Object-orientation’s longevity can largely be explained by the fact that the ideas at its core are very solid and useful. In this chapter, we will discuss these ideas, along with CoffeeScript’s (rather succinct) take on them. The above paragraphs are by no means meant to discredit these ideas. What I want to do is warn the reader against developing an unhealthy attachment to them.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
As the name suggests, object-oriented programming is related to objects. The central ideas are encapsulation, inheritance, and higher-order programming (polymorphism). So far, we have used objects as loose aggregations of values, adding and altering their properties whenever we saw fit. In an object-oriented approach, objects are viewed as little worlds of their own, and the outside world may touch them only through a limited and well-defined interface<a class="IndexReference" name="entry-interface-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-interface">↓</a>, a number of specific methods and properties. The ‘reached list’ we used at the end of <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Searching"><span class="sans">Searching</span>↑</a> is an example of this: We used only three functions, <div class="listing">
<pre class="listing">makeReachedList
</pre>
</div>
, <div class="listing">
<pre class="listing">storeReached
</pre>
</div>
, and <div class="listing">
<pre class="listing">findReached
</pre>
</div>
 to interact with it. These three functions form an interface for such objects.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">Date
</pre>
</div>
, <div class="listing">
<pre class="listing">Error
</pre>
</div>
, and <div class="listing">
<pre class="listing">BinaryHeap
</pre>
</div>
 objects we have seen also work like this. Instead of providing regular functions for working with the objects, they provide a way to create such objects, using the <div class="listing">
<pre class="listing">new
</pre>
</div>
 keyword, and a number of methods and properties that provide the rest of the interface.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
One way to give an object methods is to attach function values to it.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">rabbit = {}
rabbit.speak = (line) -&gt;
  show "The rabbit says ’#{line}’"
rabbit.speak "Well, now you’re asking me."
</pre>
</div>

</div>
<div class="Standard">
In most cases, the method will need to know <i>who</i> it should act on. For example, if there are different rabbits, the <div class="listing">
<pre class="listing">speak
</pre>
</div>
 method must indicate which rabbit is speaking. For this purpose, there is a special variable called <div class="listing">
<pre class="listing">this
</pre>
</div>
<a class="IndexReference" name="entry-this-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-this">↓</a>, which is always present when a function is called, and which points at the relevant object when the function is called as a method. A function is called as a method when it is looked up as a property, and immediately called, as in <div class="listing">
<pre class="listing">object.method()
</pre>
</div>
. Since it is very common to use <div class="listing">
<pre class="listing">this
</pre>
</div>
 inside an object, it can be abbreviated from <div class="listing">
<pre class="listing">this.property
</pre>
</div>
 or <div class="listing">
<pre class="listing">this.method()
</pre>
</div>
 to <div class="listing">
<pre class="listing">@property
</pre>
</div>
 or <div class="listing">
<pre class="listing">@method()
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">speak = (line) -&gt;
  show "The #{this.adjective} rabbit says ’#{line}’"
​
whiteRabbit = adjective: "white", speak: speak
fatRabbit = adjective: "fat", speak: speak
​
whiteRabbit.speak "Oh my ears and whiskers, " +
                  "how late it’s getting!"
fatRabbit.speak "I could sure use a carrot right now."
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
I can now clarify the mysterious first argument to the <div class="listing">
<pre class="listing">apply
</pre>
</div>
<a class="IndexReference" name="entry-apply-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-apply">↓</a> method, for which we always used <div class="listing">
<pre class="listing">null
</pre>
</div>
 in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>. This argument can be used to specify the object that the function must be applied to. For non-method functions, this is irrelevant, hence the <div class="listing">
<pre class="listing">null
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">speak.apply fatRabbit, [’Yum.’]
</pre>
</div>

</div>
<div class="Standard">
Functions also have a <div class="listing">
<pre class="listing">call
</pre>
</div>
<a class="IndexReference" name="entry-call-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-call">↓</a> method, which is similar to <div class="listing">
<pre class="listing">apply
</pre>
</div>
, but you can give the arguments for the function separately instead of as an array:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">speak.call fatRabbit, ’Burp.’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
It is common in object oriented terminology to refer to instances of something as an object. The <div class="listing">
<pre class="listing">whiteRabbit
</pre>
</div>
 and <div class="listing">
<pre class="listing">fatRabbit
</pre>
</div>
 can be seen as different instances of a more general <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 concept. In CoffeeScript such concepts are termed a <div class="listing">
<pre class="listing">class
</pre>
</div>
<a class="IndexReference" name="entry-class-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-class">↓</a>.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class Rabbit
  constructor: (@adjective) -&gt;
  speak: (line) -&gt;
    show "The #{@adjective} rabbit says ’#{line}’"
​
whiteRabbit = new Rabbit "white"
fatRabbit = new Rabbit "fat"
​
whiteRabbit.speak "Hurry!"
fatRabbit.speak "Tasty!"
</pre>
</div>

</div>
<div class="Standard">
It is a convention, among CoffeeScript programmers, to start the names of classes with a capital letter. This makes it easy to distinguish them from object instances and functions.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">new
</pre>
</div>
<a class="IndexReference" name="entry-new-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-new">↓</a> keyword provides a convenient way of creating new objects. When a function is called with the word <div class="listing">
<pre class="listing">new
</pre>
</div>
 in front of it, its <div class="listing">
<pre class="listing">this
</pre>
</div>
<a class="IndexReference" name="entry-this-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-this">↓</a> variable will point at a <i>new</i> object, which it will automatically return (unless it explicitly returns something else). Functions used to create new objects like this are called constructor<a class="IndexReference" name="entry-constructor-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-constructor">↓</a>s.
</div>
<div class="Standard">
The constructor for the <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 class is <div class="listing">
<pre class="listing">constructor: (@adjective) -&gt;
</pre>
</div>
. The <div class="listing">
<pre class="listing">@adjective
</pre>
</div>
 argument to the constructor does two things: It declares <div class="listing">
<pre class="listing">adjective
</pre>
</div>
 as a property on <div class="listing">
<pre class="listing">this
</pre>
</div>
 and it uses ‘pattern matching’ i.e. the same name to assign the argument named <div class="listing">
<pre class="listing">adjective
</pre>
</div>
 to a property on <div class="listing">
<pre class="listing">this
</pre>
</div>
 that is also named <div class="listing">
<pre class="listing">adjective
</pre>
</div>
. It could have been written in full form as <div class="listing">
<pre class="listing">constructor: (adjective) -&gt; this.adjective = adjective
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">killerRabbit = new Rabbit ’killer’
killerRabbit.speak ’GRAAAAAAAAAH!’
show killerRabbit
</pre>
</div>
<div class="Standard">
When <div class="listing">
<pre class="listing">new Rabbit
</pre>
</div>
 is called with the <div class="listing">
<pre class="listing">’killer’
</pre>
</div>
 argument, the argument is assigned to a property named <div class="listing">
<pre class="listing">adjective
</pre>
</div>
. So <div class="listing">
<pre class="listing">show killerRabbit
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">{adjective: ’killer’}
</pre>
</div>
.
</div>
</div>
<div class="Standard">
Why is the <div class="listing">
<pre class="listing">new
</pre>
</div>
 keyword even necessary? After all, we could have simply written this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">makeRabbit = (adjective) -&gt;
  adjective: adjective
  speak: (line) -&gt; show adjective + ’: ’ + line
blackRabbit = makeRabbit ’black’
</pre>
</div>

</div>
<div class="Standard">
But that is not entirely the same. <div class="listing">
<pre class="listing">new
</pre>
</div>
 does a few things behind the scenes. For one thing, our <div class="listing">
<pre class="listing">killerRabbit
</pre>
</div>
 has a property called <div class="listing">
<pre class="listing">constructor
</pre>
</div>
<a class="IndexReference" name="entry-constructor-2" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-constructor">↓</a>, which points at the <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 function that created it. <div class="listing">
<pre class="listing">blackRabbit
</pre>
</div>
 also has such a property, but it points at the <div class="listing">
<pre class="listing">Object
</pre>
</div>
<a class="IndexReference" name="entry-Object-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Object">↓</a> function. They even have <div class="listing">
<pre class="listing">name
</pre>
</div>
 properties so we can check them: <div class="listing">
<pre class="listing">show killerRabbit.constructor.name
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 and <div class="listing">
<pre class="listing">show blackRabbit.constructor.name
</pre>
</div>
 <span class="formula"> ⇒ </span> <div class="listing">
<pre class="listing">Object
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The objects that are created, <div class="listing">
<pre class="listing">whiteRabbit
</pre>
</div>
 and <div class="listing">
<pre class="listing">fatRabbit
</pre>
</div>
, are specific instances. The <div class="listing">
<pre class="listing">whiteRabbit
</pre>
</div>
 is not all kinds of white rabbits just a single one that happen to have the name whiteRabbit. If you want to create a class of say weight conscious rabbits then the <div class="listing">
<pre class="listing">extends
</pre>
</div>
<a class="IndexReference" name="entry-extends-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-extends">↓</a> keyword can help you accomplish that.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class WeightyRabbit extends Rabbit
  constructor: (adjective, @weight) -&gt;
    super adjective
  adjustedWeight: (relativeGravity) -&gt;
    (@weight * relativeGravity).toPrecision 2
​
tinyRabbit = new WeightyRabbit "tiny", 1.01
jumboRabbit = new WeightyRabbit "jumbo", 7.47
​
moonGravity = 1/6
jumboRabbit.speak "Carry me, I weigh 
#{jumboRabbit.adjustedWeight(moonGravity)} stones"
tinyRabbit.speak "He ain’t heavy, he is my brother"
</pre>
</div>

</div>
<div class="Standard">
The call <div class="listing">
<pre class="listing">super adjective
</pre>
</div>
 passes the argument on to the <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 constructor. A method in a derived class can with <div class="listing">
<pre class="listing">super
</pre>
</div>
<a class="IndexReference" name="entry-super-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-super">↓</a> call upon a method of the same name in its parent class.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Inheritance is useful because different types can share a single implementation of an algorithm. But it comes with a price-tag: the derived classes become tightly coupled to the parent class. Normally you make each part of a system as independent as possible, for example avoiding global variables and using arguments instead. That way you can read and understand each part in isolation and you can change them with little risk of breaking other parts of the system.
</div>
<div class="Standard">
Due to the tight coupling that inheritance introduces it can be difficult to change a parent class without inadvertently risk breaking derived classes. This is called the fragile base class<a class="IndexReference" name="entry-fragile-base-class-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-fragile-base-class">↓</a> problem. A class that has no child classes and is only used through its published methods and properties can normally be changed quite freely — as long as the published methods and properties stay the same. When a class derives from it, then the child class may depend on the internal behaviour of the parent and it becomes problematic to change the base class.
</div>
<div class="Standard">
To understand a derived class you will often have to understand the parent first. The implementation is distributed, instead of reading down through a function, you may have to look in different places where a class and its parent and their parent… implement each their part of the combined logic. Lets look at an example that matters — the balance on your bank account.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class Account
  constructor: -&gt; @balance = 0
  transfer: (amount) -&gt; @balance += amount
  getBalance: -&gt; @balance
  batchTransfer: (amtList) -&gt;
    for amount in amtList
      @transfer amount
​
yourAccount = new Account()
oldBalance = yourAccount.getBalance()
yourAccount.transfer salary = 1000
newBalance = yourAccount.getBalance()
show "Books balance:
 #{salary == newBalance - oldBalance}."
</pre>
</div>

</div>
<div class="Standard">
Hopefully this only shows the principle of how your bank has implemented its accounts. An account starts out with a zero balance, money can be credited (positive transfer) and debited (negative transfer), the balance can be shown and multiple transfers can be handled.
</div>
<div class="Standard">
Other parts of the system can balance the books by checking that transfers match the differences on the accounts. Those parts of the system were unfortunately not known to the developer of the <div class="listing">
<pre class="listing">AccountWithFee
</pre>
</div>
 class.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class AccountWithFee extends Account
  fee: 5
  transfer: (amount) -&gt;
    super amount - @fee
    # feeAccount.transfer @fee
​
yourAccount = new AccountWithFee()
oldBalance = yourAccount.getBalance()
yourAccount.transfer salary = 1000
newBalance = yourAccount.getBalance()
show "Books balance:
 #{salary == newBalance - oldBalance}."
</pre>
</div>

</div>
<div class="Standard">
The books no longer balance. The issue is that the <div class="listing">
<pre class="listing">AccountWithFee
</pre>
</div>
 class has violated what is called the substitution principle<a class="IndexReference" name="entry-substitution-principle-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-substitution-principle">↓</a>. It is a patch of the existing <div class="listing">
<pre class="listing">Account
</pre>
</div>
 class and it breaks programs that assume that all account classes behave in a certain way. In a system with thousands of classes such patches can cause severe problems. To avoid this kind of problem it is up to the developer to ensure that inherited classes can fully substitute their parent classes.
</div>
<div class="Standard">
To avoid excessive fraudulent transactions when a card is lost or stolen, the bank has implemented a system which checks that withdrawals do not exceed a daily limit. The <div class="listing">
<pre class="listing">LimitedAccount
</pre>
</div>
 class checks each <div class="listing">
<pre class="listing">transfer
</pre>
</div>
, reduces the <div class="listing">
<pre class="listing">@dailyLimit
</pre>
</div>
 and reports an error if it is exceeded.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class LimitedAccount extends Account
  constructor: -&gt; super; @resetLimit()
  resetLimit: -&gt; @dailyLimit = 50
  transfer: (amount) -&gt;
    if amount &lt; 0 and (@dailyLimit += amount) &lt; 0
      throw new Error "You maxed out!"
    else
      super amount
lacc = new LimitedAccount()
lacc.transfer 50
show "Start balance #{lacc.getBalance()}"
​
try lacc.batchTransfer [-1..-10]
catch error then show error.message
show "After batch balance #{lacc.getBalance()}"
</pre>
</div>

</div>
<div class="Standard">
Your bank is so successful that <div class="listing">
<pre class="listing">batchTransfer
</pre>
</div>
 has to be speeded up (a real version would involve database updates). The developer, that got the task of making <div class="listing">
<pre class="listing">batchTransfer
</pre>
</div>
 faster, had been on vacation when the <div class="listing">
<pre class="listing">LimitedAccount
</pre>
</div>
 class was implemented and did not see it among the thousands of other classes in the system.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class Account
  constructor: -&gt; @balance = 0
  transfer: (amount) -&gt; @balance += amount
  getBalance: -&gt; @balance
  batchTransfer: (amtList) -&gt;
    add = (a,b) -&gt; a+b
    sum = (list) -&gt; reduce list, add, 0
    @balance += sum amtList
​
class LimitedAccount extends Account
  constructor: -&gt; super; @resetLimit()
  resetLimit: -&gt; @dailyLimit = 50
  transfer: (amount) -&gt;
    if amount &lt; 0 and (@dailyLimit += amount) &lt; 0
      throw new Error "You maxed out!"
    else
      super amount
​
lacc = new LimitedAccount()
lacc.transfer 50
show "Starting with #{lacc.getBalance()}"
​
try lacc.batchTransfer [-1..-10]
catch error then show error.message
show "After batch balance #{lacc.getBalance()}"
</pre>
</div>

</div>
<div class="Standard">
Instead of the previous implementation that called <div class="listing">
<pre class="listing">transfer
</pre>
</div>
 each time, the whole batch is added together and the balance is directly updated. That made <div class="listing">
<pre class="listing">batchTransfer
</pre>
</div>
 much faster, but it also broke the <div class="listing">
<pre class="listing">LimitedAccount
</pre>
</div>
 class. It is an example of the fragile base class<a class="IndexReference" name="entry-fragile-base-class-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-fragile-base-class">↓</a> problem. In this limited example it is easy to spot the issue, in a large system it can cause considerable headache.
</div>
<div class="Standard">
Using inheritance in the right way requires careful and thoughtful programming. If your child classes are type compatible with their parent then you are adhering to the substitution principle. Usually using ownership is more appropriate, that is when a class has an instance of another class inside it and uses its public interface.
</div>
<div class="Standard">
It is a common convention in CoffeeScript to use an <div class="listing">
<pre class="listing">_
</pre>
</div>
 in front of methods that are to be considered private.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Where did the <div class="listing">
<pre class="listing">constructor
</pre>
</div>
 property come from? It is part of the prototype<a class="IndexReference" name="entry-prototype-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-prototype">↓</a> of a rabbit. Prototypes are a powerful, if somewhat confusing, part of the way CoffeeScript objects work. Every object is based on a prototype, which gives it a set of inherent properties. Simple objects are based on the most basic prototype, which is associated with the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 constructor. In fact, typing <div class="listing">
<pre class="listing">{}
</pre>
</div>
 is equivalent to typing <div class="listing">
<pre class="listing">new Object()
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">simpleObject = {}
show simpleObject.constructor
show simpleObject.toString
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">toString
</pre>
</div>
<a class="IndexReference" name="entry-toString-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-toString">↓</a> is a method that is part of the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 prototype. This means that all simple objects have a <div class="listing">
<pre class="listing">toString
</pre>
</div>
 method, which converts them to a string. Our rabbit objects are based on the prototype associated with the <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 constructor. You can use a constructor’s <div class="listing">
<pre class="listing">prototype
</pre>
</div>
 property to get access to, well, their prototype:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show Rabbit.prototype
show Rabbit.prototype.constructor.name
Rabbit.prototype.speak ’I am generic’ 
Rabbit::speak ’I am not initialized’
</pre>
</div>

</div>
<div class="Standard">
Instead of <div class="listing">
<pre class="listing">Rabbit.prototype.speak
</pre>
</div>
 you can write <div class="listing">
<pre class="listing">Rabbit::speak
</pre>
</div>
. Every function automatically gets a <div class="listing">
<pre class="listing">prototype
</pre>
</div>
 property, whose <div class="listing">
<pre class="listing">constructor
</pre>
</div>
 property points back at the function. Because the rabbit prototype is itself an object, it is based on the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 prototype, and shares its <div class="listing">
<pre class="listing">toString
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show killerRabbit.toString == simpleObject.toString
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Even though objects seem to share the properties of their prototype, this sharing is one-way. The properties of the prototype influence the object based on it, but the properties of this object never change the prototype.
</div>
<div class="Standard">
The precise rules are this: When looking up the value of a property, CoffeeScript first looks at the properties that the object <i>itself</i> has. If there is a property that has the name we are looking for, that is the value we get. If there is no such property, it continues searching the prototype of the object, and then the prototype of the prototype, and so on. If no property is found, the value <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 is given. On the other hand, when <i>setting</i> the value of a property, CoffeeScript never goes to the prototype, but always sets the property in the object itself.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Rabbit::teeth = ’small’
show killerRabbit.teeth
killerRabbit.teeth = ’long, sharp, and bloody’
show killerRabbit.teeth
show Rabbit::teeth
</pre>
</div>

</div>
<div class="Standard">
This does mean that the prototype can be be used at any time to add new properties and methods to all objects based on it. For example, it might become necessary for our rabbits to dance.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Rabbit::dance = -&gt;
  show "The #{@adjective} rabbit dances a jig."
killerRabbit.dance()
</pre>
</div>

</div>
<div class="Standard">
And, as you might have guessed, the prototypical rabbit is the perfect place for values that all rabbits have in common, such as the <div class="listing">
<pre class="listing">speak
</pre>
</div>
 method. Here is a new approach to the <div class="listing">
<pre class="listing">Rabbit
</pre>
</div>
 constructor:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Rabbit = (adjective) -&gt;
  @adjective = adjective
​
Rabbit::speak = (line) -&gt;
  show "The #{@adjective} rabbit says ’#{line}’"
​
hazelRabbit = new Rabbit "hazel"
hazelRabbit.speak "Good Frith!"
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The fact that all objects have a prototype and receive some properties from this prototype can be tricky. It means that using an object to store a set of things, such as the cats from <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a>, can go wrong. If, for example, we wondered whether there is a cat called <div class="listing">
<pre class="listing">’constructor’
</pre>
</div>
, we would have checked it like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">noCatsAtAll = {}
if "constructor" of noCatsAtAll
  show "Yes, there is a cat called ’constructor’."
</pre>
</div>

</div>
<div class="Standard">
This is problematic. A related problem is that it can often be practical to extend the prototypes of standard constructors such as <div class="listing">
<pre class="listing">Object
</pre>
</div>
 and <div class="listing">
<pre class="listing">Array
</pre>
</div>
 with new useful functions. For example, we could give all objects a method called <div class="listing">
<pre class="listing">allProperties
</pre>
</div>
, which returns an array with the names of the (non-hidden) properties that the object has:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Object::allProperties = -&gt;
  for property of this
    property
​
test = x: 10, y: 3
show test.allProperties()
</pre>
</div>

</div>
<div class="Standard">
And that immediately shows the problem. Now that the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 prototype has a property called <div class="listing">
<pre class="listing">allProperties
</pre>
</div>
, looping over the properties of any object, using <div class="listing">
<pre class="listing">for
</pre>
</div>
 and <div class="listing">
<pre class="listing">of
</pre>
</div>
<a class="IndexReference" name="entry-of-2" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-of">↓</a>, will also give us that shared property, which is generally not what we want. We are interested only in the properties that the object itself has.
</div>
<div class="Standard">
Fortunately, there is a way to find out whether a property belongs to the object itself or to one of its prototypes. Every object has a method called <div class="listing">
<pre class="listing">hasOwnProperty
</pre>
</div>
<a class="IndexReference" name="entry-hasOwnProperty-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-hasOwnProperty">↓</a>, which tells us whether the object has a property with a given name. When looping over the properties of an object CoffeeScript provides a keyword <div class="listing">
<pre class="listing">own
</pre>
</div>
 so we are saved from using a clumsy <div class="listing">
<pre class="listing">if
</pre>
</div>
 test on each property. Using <div class="listing">
<pre class="listing">own
</pre>
</div>
, we can write an <div class="listing">
<pre class="listing">ownProperties
</pre>
</div>
 method like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">Object::ownProperties = -&gt;
  for own property of this
    property
​
test = ’Fat Igor’: true, ’Fireball’: true
show test.ownProperties()
</pre>
</div>

</div>
<div class="Standard">
<a class="IndexReference" name="entry-forEachOf-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-forEachOf">↓</a>And of course, we can abstract that into a higher-order function. Note that the <div class="listing">
<pre class="listing">action
</pre>
</div>
 function is called with both the name of the property and the value it has in the object.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">forEachOf = (object, action) -&gt;
  for own property, value of object
    action property, value
​
chimera = head: "lion", body: "goat", tail: "snake"
forEachOf chimera, (name, value) -&gt;
  show "The #{name} of a #{value}."
</pre>
</div>

</div>
<div class="Standard">
But, what if we find a cat named <div class="listing">
<pre class="listing">hasOwnProperty
</pre>
</div>
? (You never know.) It will be stored in the object, and the next time we want to go over the collection of cats, calling <div class="listing">
<pre class="listing">object.hasOwnProperty
</pre>
</div>
 will fail, because that property no longer points at a function value. This can be solved by doing something ugly:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">forEachIn = (object, action) -&gt;
  for property of object
    if (Object::hasOwnProperty.call(object, property))
      action property, object[property]
​
test = name: "Mordecai", hasOwnProperty: "Uh-oh"
forEachIn test, (name, value) -&gt;
  show "Property #{name} = #{value}"
</pre>
</div>

</div>
<div class="Standard">
Here, instead of using the method found in the object itself, we get the method from the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 prototype, and then use <div class="listing">
<pre class="listing">call
</pre>
</div>
 to apply it to the right object. Unless someone actually messes with the <div class="listing">
<pre class="listing">Object.prototype
</pre>
</div>
 method (do not do that), this should work correctly.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for own property, value of test
  show "Property #{property} = #{value}"
</pre>
</div>

</div>
<div class="Standard">
Fortunately the <div class="listing">
<pre class="listing">own
</pre>
</div>
 keyword saves the day even in this situation, so it is the right thing to use.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">hasOwnProperty
</pre>
</div>
 can also be used in those situations where we have been using the <div class="listing">
<pre class="listing">of
</pre>
</div>
<a class="IndexReference" name="entry-of-3" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-of">↓</a> operator to see whether an object has a specific property. There is one more catch, however. We saw in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> that some properties, such as <div class="listing">
<pre class="listing">toString
</pre>
</div>
, are ‘hidden’, and do not show up when going over properties with <div class="listing">
<pre class="listing">for
</pre>
</div>
/<div class="listing">
<pre class="listing">of
</pre>
</div>
. It turns out that browsers in the Gecko family (Firefox, most importantly) give every object a hidden property named <div class="listing">
<pre class="listing">__proto__
</pre>
</div>
, which points to the prototype of that object. <div class="listing">
<pre class="listing">hasOwnProperty
</pre>
</div>
 will return <div class="listing">
<pre class="listing">true
</pre>
</div>
 for this one, even though the program did not explicitly add it. Having access to the prototype of an object can be very convenient, but making it a property like that was not a very good idea. Still, Firefox is a widely used browser, so when you write a program for the web you have to be careful with this.
</div>
<div class="Standard">
The advice here is <i>not</i> to name any of your own properties with double underscore since they then can clash with system specific details like <div class="listing">
<pre class="listing">__proto__
</pre>
</div>
. As mentioned before identifiers beginning with one underscore is fine and used to indicate something private to your implementation. There is a method <div class="listing">
<pre class="listing">propertyIsEnumerable
</pre>
</div>
<a class="IndexReference" name="entry-propertyIsEnumerable-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-propertyIsEnumerable">↓</a>, which returns <div class="listing">
<pre class="listing">false
</pre>
</div>
 for hidden properties, and which can be used to filter out strange things like <div class="listing">
<pre class="listing">__proto__
</pre>
</div>
. An expression such as this one can be used to reliably work around this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">obj = foo: ’bar’
​
# This test is needed to avoid hidden properties ...
show Object::hasOwnProperty.call(obj, ’foo’) and
     Object::propertyIsEnumerable.call(obj, ’foo’)
# ... because this returns true ...
show Object::hasOwnProperty.call(obj, ’__proto__’)
# ... this is required to get false.
show Object::hasOwnProperty.call(obj, ’__proto__’) and
     Object::propertyIsEnumerable.call(obj, ’__proto__’)
</pre>
</div>

</div>
<div class="Standard">
Nice and simple, no? This is one of the not-so-well-designed aspects of the system underlying CoffeeScript (recondite JavaScript). Objects play both the role of ‘values with methods’, for which prototypes work great, and ‘sets of properties’, for which prototypes only get in the way.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Writing the above kind of expression every time you need to check whether a property is present in an object is unworkable. We could put it into a function, but a better approach is to write a constructor and a prototype specifically for situations like this, where we want to approach an object as just a set of properties. Because you can use it to look things up by name, we will call it a <div class="listing">
<pre class="listing">Dictionary
</pre>
</div>
<a class="IndexReference" name="entry-Dictionary-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-Dictionary">↓</a>.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class Dictionary
  constructor: (@values = {}) -&gt;
​
  store: (name, value) -&gt;
    @values[name] = value
​
  lookup: (name) -&gt;
    @values[name]
​
  contains: (name) -&gt;
    Object::hasOwnProperty.call(@values, name) and
    Object::propertyIsEnumerable.call(@values, name)
​
  each: (action) -&gt;
    for own property, value of @values
      action property, value
​
colours = new Dictionary
  Grover: ’blue’
  Elmo:   ’orange’
  Bert:   ’yellow’
​
show colours.contains ’Grover’
colours.each (name, colour) -&gt;
  show name + ’ is ’ + colour
</pre>
</div>

</div>
<div class="Standard">
Now the whole mess related to approaching objects as plain sets of properties has been ‘encapsulated’ in a convenient interface: one constructor and four methods. Note that the <div class="listing">
<pre class="listing">values
</pre>
</div>
 property of a <div class="listing">
<pre class="listing">Dictionary
</pre>
</div>
 object is not part of this interface, it is an internal detail, and when you are using <div class="listing">
<pre class="listing">Dictionary
</pre>
</div>
 objects you do not need to directly use it.
</div>
<div class="Standard">
Whenever you write an interface, it is a good idea to add a comment with a quick sketch of what it does and how it should be used. This way, when someone, possibly yourself three months after you wrote it, wants to work with the interface, they can quickly see how to use it, and do not have to study the whole program.
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/sketch.png" alt="figure img/sketch.png" style="width: 80%; height: auto;">

</div>

</div>
<div class="Standard">
Using a piece of paper, a whiteboard or as here a pen and tablet can be effective to sketch your designs. Using a notation roughly similar to UML (Unified Modeling Language) can help in communicating your design to others. Usually you do not need a tool<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [V] </span><span class="HoverFoot"><span class="SupFootMarker"> [V] </span>A few integrated development environments automatically generate diagrams as you are writing your code, for example Visual Studio Ultimate, but it is neither cheap nor compatible with CoffeeScript.</span></span> — unless you really want to or work in a large administrative setting. You can find a quick reference to UML notation via web search. The most useful diagram is the interaction or sequence diagram. Use it to specify how objects talk to each other — especially in distributed systems. The class diagram shown above presents a static view of the system so it is mostly for initial designs.
</div>
<div class="Standard">
Most of the time, when you are designing an interface, you will soon find some limitations and problems in whatever you came up with, and change it. To prevent wasting your time, it is advisable to document your interfaces only <i>after</i> they have been used in a few real situations and proven themselves to be practical. — Of course, this might make it tempting to forget about documentation altogether. Personally, I treat writing documentation as a ‘finishing touch’ to add to a system. When it feels ready, it is time to write something about it, and to see if it sounds as good in English (or whatever language) as it does in CoffeeScript (or whatever programming language).
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The distinction between the external interface of an object and its internal details is important for two reasons. Firstly, having a small, clearly described interface makes an object easier to use. You only have to keep the interface in mind, and do not have to worry about the rest unless you are changing the object itself.
</div>
<div class="Standard">
Secondly, it often turns out to be necessary or practical to change something about the internal implementation of a class, to make it more efficient, for example, or to fix some problem. When outside code is accessing every single property and detail in the object, you can not change any of them without also updating a lot of other code. If outside code only uses a small interface, you can do what you want, as long as you do not change the interface.
</div>
<div class="Standard">
Some people go very far in this. They will, for example, never include properties in the interface of object, only methods — if their object type has a length, it will be accessible with the <div class="listing">
<pre class="listing">getLength
</pre>
</div>
 method, not the <div class="listing">
<pre class="listing">length
</pre>
</div>
 property. This way, if they ever want to change their object in such a way that it no longer has a <div class="listing">
<pre class="listing">length
</pre>
</div>
 property, for example because it now has some internal array whose length it must return, they can update the function without changing the interface.
</div>
<div class="Standard">
My own take is that in most cases this is not worth it. Adding a <div class="listing">
<pre class="listing">getLength
</pre>
</div>
 method which only contains <div class="listing">
<pre class="listing">return this.length
</pre>
</div>
 mostly just adds meaningless code, and, in most situations, I consider meaningless code a bigger problem than the risk of having to occasionally change the interface to my objects.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Adding new methods to existing prototypes can be very convenient. Especially the <div class="listing">
<pre class="listing">Array
</pre>
</div>
 and <div class="listing">
<pre class="listing">String
</pre>
</div>
 prototypes in CoffeeScript could use a few more basic methods. We could, for example, replace <div class="listing">
<pre class="listing">forEach
</pre>
</div>
 and <div class="listing">
<pre class="listing">map
</pre>
</div>
 with methods on arrays, and make the <div class="listing">
<pre class="listing">startsWith
</pre>
</div>
 function we wrote in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> a method on strings.
</div>
<div class="Standard">
However, if your code has to run as a library used by others or as a program on a web-page together with another program (either written by you or by someone else) which uses <div class="listing">
<pre class="listing">for
</pre>
</div>
/<div class="listing">
<pre class="listing">of
</pre>
</div>
 naively — the way we have been using it so far — then adding things to prototypes, especially the <div class="listing">
<pre class="listing">Object
</pre>
</div>
 and <div class="listing">
<pre class="listing">Array
</pre>
</div>
 prototype, will definitely break something, because these loops will suddenly start seeing those new properties. For this reason, some people prefer not to touch these prototypes at all. Of course, if you are careful, and you do not expect your code to have to coexist with badly-written code, adding methods to standard prototypes is a perfectly good technique.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-10"></a>Regular Expressions<a class="Label" name="chap:Regular-Expressions"> </a>
</h1>
<div class="Standard">
At various points in the previous chapters, we had to look for patterns in string values. In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a> we extracted date values from strings by writing out the precise positions at which the numbers that were part of the date could be found. Later, in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>, we saw some particularly ugly pieces of code for finding certain types of characters in a string, for example the characters that had to be escaped in <span class="versalitas"><span class="small">HTML</span></span><span class="default"> output.</span>
</div>
<div class="Standard">
<a class="IndexReference" name="entry-regular-expression-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-regular-expression">↓</a>Regular expressions are a language for describing patterns in strings. They form a small, separate language, which is embedded inside CoffeeScript (and in various other programming languages, in one way or another). It is not a very readable language — big regular expressions tend to be quite unreadable. To make them more readable CoffeeScript has extended regular expressions where you can generously add comments to the different parts. Examples of these are shown later. Still regular expressions are difficult to read, but they are a useful tool that can really simplify string-processing programs.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Just like strings get written between quotes, regular expression patterns get written between slashes (<div class="listing">
<pre class="listing">/
</pre>
</div>
<a class="IndexReference" name="entry-/-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-/">↓</a>). This means that slashes inside the expression have to be escaped.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">slash = /\//;
show ’AC/DC’.search slash
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">search
</pre>
</div>
<a class="IndexReference" name="entry-search-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-search">↓</a> method resembles <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
, but it searches for a regular expression instead of a string. Patterns specified by regular expressions can do a few things that strings can not do. For a start, they allow some of their elements to match more than a single character. In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>, when extracting mark-up from a document, we needed to find the first asterisk or opening brace in a string. That could be done like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">asteriskOrBrace = /[\{\*]/
story = ’We noticed the *giant sloth*, ’ +
        ’hanging from a giant branch.’;
show story.search asteriskOrBrace
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">[
</pre>
</div>
 and <div class="listing">
<pre class="listing">]
</pre>
</div>
 characters have a special meaning inside a regular expression. They can enclose a set of characters, and they mean ‘any of these characters’. Most non-alphanumeric characters have some special meaning inside a regular expression, so it is a good idea to always escape them with a backslash<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [W] </span><span class="HoverFoot"><span class="SupFootMarker"> [W] </span>In this case, the backslashes were not really necessary, because the characters occur between <div class="listing">
<pre class="listing">[
</pre>
</div>
 and <div class="listing">
<pre class="listing">]
</pre>
</div>
, but it is easier to just escape them anyway, so you will not have to think about it.</span></span> when you use them to refer to the actual characters.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There are a few shortcuts for sets of characters that are needed often. The dot (<div class="listing">
<pre class="listing">.
</pre>
</div>
) can be used to mean ‘any character that is not a newline’, an escaped ‘d’ (<div class="listing">
<pre class="listing">\d
</pre>
</div>
) means ‘any digit’, an escaped ‘w’ (<div class="listing">
<pre class="listing">\w
</pre>
</div>
) matches any alphanumeric character (including underscores, for some reason), and an escaped ‘s’ (<div class="listing">
<pre class="listing">\s
</pre>
</div>
) matches any white-space (tab, newline, space) character.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">digitSurroundedBySpace = /\s\d\s/
show ’1a 2 3d’.search digitSurroundedBySpace
</pre>
</div>

</div>
<div class="Standard">
The escaped ‘d’, ‘w’, and ‘s’ can be replaced by their capital letter to mean their opposite. For example, <div class="listing">
<pre class="listing">\S
</pre>
</div>
 matches any character that is <i>not</i> white-space. When using <div class="listing">
<pre class="listing">[
</pre>
</div>
 and <div class="listing">
<pre class="listing">]
</pre>
</div>
, a pattern can be inverted by starting with a <div class="listing">
<pre class="listing">^
</pre>
</div>
 character:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">notABC = /[^ABC]/
show ’ABCBACCBBADABC’.search notABC
</pre>
</div>

</div>
<div class="Standard">
As you can see, the way regular expressions use characters to express patterns makes them A) very short, and B) very hard to read.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 32</i></span></span><br><div class="PlainVisible">
Write a regular expression that matches a date in the format <div class="listing">
<pre class="listing">’XX/XX/XXXX’
</pre>
</div>
, where the <div class="listing">
<pre class="listing">X
</pre>
</div>
s are digits. Test it against the string <div class="listing">
<pre class="listing">’born 15/11/2003 (mother Spot): White Fang’
</pre>
</div>
.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">datePattern = /\d\d\/\d\d\/\d\d\d\d/
show ’born 15/11/2003 (mother Spot): White Fang’\
.search datePattern
</pre>
</div>
<div class="Standard">
The backslash after the string continues the line after the line break.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
Sometimes you need to make sure a pattern starts at the beginning of a string, or ends at its end. For this, the special characters <div class="listing">
<pre class="listing">^
</pre>
</div>
 and <div class="listing">
<pre class="listing">$
</pre>
</div>
 can be used. The first matches the start of the string, the second the end.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show /a+/.test ’blah’
show /^a+$/.test ’blah’
</pre>
</div>

</div>
<div class="Standard">
The first regular expression matches any string that contains an <div class="listing">
<pre class="listing">a
</pre>
</div>
 character, the second only those strings that consist entirely of <div class="listing">
<pre class="listing">a
</pre>
</div>
 characters.
</div>
<div class="Standard">
Note that regular expressions are objects, and have methods. Their <div class="listing">
<pre class="listing">test
</pre>
</div>
<a class="IndexReference" name="entry-test-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-test">↓</a> method returns a boolean indicating whether the given string matches the expression.
</div>
<div class="Standard">
The code <div class="listing">
<pre class="listing">\b
</pre>
</div>
 matches a ‘word boundary’, which can be punctuation, white-space, or the start or end of the string.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show /cat/.test ’concatenate’
show /\bcat\b/.test ’concatenate’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Parts of a pattern can be allowed to be repeated a number of times. Putting an asterisk (<div class="listing">
<pre class="listing">*
</pre>
</div>
) after an element allows it to be repeated any number of times, including zero. A plus (<div class="listing">
<pre class="listing">+
</pre>
</div>
) does the same, but requires the pattern to occur at least one time. A question mark (<div class="listing">
<pre class="listing">?
</pre>
</div>
) makes an element ‘optional’ — it can occur zero or one times.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">parenthesizedText = /\(.*\)/
show "Its (the sloth’s) claws were gigantic!"\
.search parenthesizedText
</pre>
</div>

</div>
<div class="Standard">
When necessary, braces can be used to be more precise about the amount of times an element may occur. A number between braces (<div class="listing">
<pre class="listing">{4}
</pre>
</div>
) gives the exact amount of times it must occur. Two numbers with a comma between them (<div class="listing">
<pre class="listing">{3,10}
</pre>
</div>
) indicate that the pattern must occur at least as often as the first number, and at most as often as the second one. Similarly, <div class="listing">
<pre class="listing">{2,}
</pre>
</div>
 means two or more occurrences, while <div class="listing">
<pre class="listing">{,4}
</pre>
</div>
 means four or less.
</div>
<div class="Standard">
To make big regular expressions more readable CoffeeScript has extended regular expressions. They are delimited by <div class="listing">
<pre class="listing">///
</pre>
</div>
<a class="IndexReference" name="entry-///-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-///">↓</a> and allow comments to be added to the different parts. They ignore formatting, so they can be split over several lines and placed in a column.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">datePattern = /\d{1,2}\/\d\d?\/\d{4}/
show ’born 15/11/2003 (mother Spot): White Fang’\
.search datePattern
​
datePattern = ///
  \d{1,2}   # day
  /         # separator
  \d\d?     # month
  /         # separator
  \d{4}     # year
///
show ’born 15/11/2003 (mother Spot): White Fang’\
.search datePattern
</pre>
</div>

</div>
<div class="Standard">
The pieces <div class="listing">
<pre class="listing">/\d{1,2}/
</pre>
</div>
 and <div class="listing">
<pre class="listing">/\d\d?/
</pre>
</div>
 both express ‘one or two digits’.
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 33</i></span></span><br><div class="PlainVisible">
Write a pattern that matches e-mail addresses. For simplicity, assume that the parts before and after the <div class="listing">
<pre class="listing">@
</pre>
</div>
 can contain only alphanumeric characters and the characters <div class="listing">
<pre class="listing">.
</pre>
</div>
 and <div class="listing">
<pre class="listing">-
</pre>
</div>
 (dot and dash), while the last part of the address, the country code or top level domain after the last dot, may only contain alphanumeric characters, and must be two or three characters long.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">mailAddress = /\b[\w\.-]+@[\w\.-]+\.\w{2,3}\b/
​
mailAddress = ///
  \b[\w\.-]+  # username
  @
  [\w\.-]+\   # provider
  .
  \w{2,3}\b   # domain
///
​
show mailAddress.test ’kenny@test.net’
show mailAddress.test ’I mailt kenny@tets.nets, ’ +
                      ’but it didn wrok!’
show mailAddress.test ’the_giant_sloth@gmail.com’
</pre>
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">\b
</pre>
</div>
s at the start and end of the pattern make sure that the second string does not match.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
Part of a regular expression can be grouped together with parentheses. This allows us to use <div class="listing">
<pre class="listing">*
</pre>
</div>
 and such on more than one character. For example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">cartoonCrying = /boo(hoo+)+/i
show "Then, he exclaimed ’Boohoooohoohooo’"\
.search cartoonCrying
</pre>
</div>

</div>
<div class="Standard">
Where did the <div class="listing">
<pre class="listing">i
</pre>
</div>
 at the end of that regular expression come from? After the closing slash, ‘options’ may be added to a regular expression. An <div class="listing">
<pre class="listing">i
</pre>
</div>
, here, means the expression is case-insensitive, which allows the lower-case B in the pattern to match the upper-case one in the string.
</div>
<div class="Standard">
A pipe character (<div class="listing">
<pre class="listing">|
</pre>
</div>
) is used to allow a pattern to make a choice between two elements. For example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">holyCow = /(sacred|holy) (cow|bovine|bull|taurus)/i
show holyCow.test ’Sacred bovine!’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Often, looking for a pattern is just a first step in extracting something from a string. In previous chapters, this extraction was done by calling a string’s <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
 and <div class="listing">
<pre class="listing">slice
</pre>
</div>
 methods a lot. Now that we are aware of the existence of regular expressions, we can use the <div class="listing">
<pre class="listing">match
</pre>
</div>
 method instead. When a string is matched against a regular expression, the result will be <div class="listing">
<pre class="listing">null
</pre>
</div>
 if the match failed, or an array of matched strings if it succeeded.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show ’No’.match /Yes/
show ’... yes’.match /yes/
show ’Giant Ape’.match /giant (\w+)/i
</pre>
</div>

</div>
<div class="Standard">
The first element in the returned array is always the part of the string that matched the pattern. As the last example shows, when there are parenthesized parts in the pattern, the parts they match are also added to the array. Often, this makes extracting pieces of a string very easy.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">quote = "My mind is a swirling miasma " +
        "(a poisonous fog thought to " +
        "cause illness) of titilating " +
        "thoughts and turgid ideas."
parenthesized = quote.match ///
  (\w+)    # Word
  \s*      # Whitespace
  \((.*)\) # Explanation
///
if parenthesized isnt null
  show "Word: #{parenthesized[1]} " +
       "Explanation: #{parenthesized[2]}"
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 34</i></span></span><br><div class="PlainVisible">
Re-write the function <div class="listing">
<pre class="listing">extractDate
</pre>
</div>
 that we wrote in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Data-Structures"><span class="sans">Data Structures</span>↑</a>. When given a string, this function looks for something that follows the date format we saw earlier. If it can find such a date, it puts the values into a <div class="listing">
<pre class="listing">Date
</pre>
</div>
 object. Otherwise, it throws an exception. Make it accept dates in which the day or month are written with only one digit.
</div>

</div>

</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">extractDate = (string) -&gt;
  found = string.match /(\d\d?)\/(\d\d?)\/(\d{4})/
  if found == null
    throw new Error "No date found in ’#{string}’."
  new Date Number(found[3]),
           Number(found[2]) - 1,
           Number(found[1])
show extractDate \
  "born 5/2/2007 (mother Noog): Long-ear Johnson"
</pre>
</div>
<div class="Standard">
This version is slightly longer than the previous one, but it has the advantage of actually checking what it is doing, and shouting out when it is given nonsensical input. This was a lot harder without regular expressions — it would have taken a lot of calls to <div class="listing">
<pre class="listing">indexOf
</pre>
</div>
 to find out whether the numbers had one or two digits, and whether the dashes were in the right places.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">replace
</pre>
</div>
<a class="IndexReference" name="entry-replace-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-replace">↓</a> method of string values, which we saw in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>, can be given a regular expression as its first argument.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show ’Borobudur’.replace /[ou]/g, ’a’
</pre>
</div>

</div>
<div class="Standard">
Notice the <div class="listing">
<pre class="listing">g
</pre>
</div>
 character after the regular expression. It stands for ‘global’, and means that every part of the string that matches the pattern should be replaced. When this <div class="listing">
<pre class="listing">g
</pre>
</div>
 is omitted, only the first <div class="listing">
<pre class="listing">’o’
</pre>
</div>
 would be replaced.
</div>
<div class="Standard">
Sometimes it is necessary to keep parts of the replaced strings. For example, we have a big string containing the names of people, one name per line, in the format “Lastname, Firstname”. We want to swap these names, and remove the comma, to get a simple “Firstname Lastname” format.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">names = ’’’Picasso, Pablo
Gauguin, Paul
Van Gogh, Vincent’’’
​
show names.replace /([\w ]+), ([\w ]+)/g, ’$2 $1’
​
show names.replace ///
  ([\w ]+)         # Lastname
  ,
  ([\w ]+)         # Firstname
///g, ’$2 $1’
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">$1
</pre>
</div>
 and <div class="listing">
<pre class="listing">$2
</pre>
</div>
 the replacement string refer to the parenthesized parts in the pattern. <div class="listing">
<pre class="listing">$1
</pre>
</div>
 is replaced by the text that matched against the first pair of parentheses, <div class="listing">
<pre class="listing">$2
</pre>
</div>
 by the second, and so on, up to <div class="listing">
<pre class="listing">$9
</pre>
</div>
.
</div>
<div class="Standard">
If you have more than 9 parentheses parts in your pattern, this will no longer work. But there is one more way to replace pieces of a string, which can also be useful in some other tricky situations. When the second argument given to the <div class="listing">
<pre class="listing">replace
</pre>
</div>
 method is a function value instead of a string, this function is called every time a match is found, and the matched text is replaced by whatever the function returns. The arguments given to the function are the matched elements, similar to the values found in the arrays returned by <div class="listing">
<pre class="listing">match
</pre>
</div>
: The first one is the whole match, and after that comes one argument for every parenthesized part of the pattern.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">eatOne = (match, amount, unit) -&gt;
  amount = Number(amount) - 1
  if amount == 1
    unit = unit.slice 0, unit.length - 1
  else if amount == 0
    unit = unit + ’s’
    amount = ’no’
  amount + ’ ’ + unit
​
stock = ’1 lemon, 2 cabbages, and 101 eggs’
stock = stock.replace /(\d+) (\w+)/g, eatOne
show stock
</pre>
</div>

</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exercise 35</i></span></span><br><div class="PlainVisible">
That last trick can be used to make the HTML-escaper from <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a> more efficient. You may remember that it looked like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">escapeHTML = (text) -&gt;
  replacements = [[/&amp;/g, ’&amp;amp;’]
                  [/"/g, ’&amp;quot;’]
                  [/&lt;/g, ’&amp;lt;’]
                  [/&gt;/g, ’&amp;gt;’]]
  forEach replacements, (replace) -&gt;
    text = text.replace replace[0], replace[1]
  text
show escapeHTML ’&lt; " &amp; " &gt;’
</pre>
</div>
</div>
<div class="Standard">
Write a new function <div class="listing">
<pre class="listing">escapeHTML
</pre>
</div>
, which does the same thing, but only calls <div class="listing">
<pre class="listing">replace
</pre>
</div>
 once.
</div>
</div>
</div>
<div class="Standard">
<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Solution] </span><span class="HoverFoot"><span class="branch">
<div class="Standard">
<div class="SolutionFramed" style="width: 100%;">
<span class="sans"><span class="large"><i>Solution</i></span></span><br><div class="listing">
<pre class="listing">escapeHTML = (text) -&gt;
  replacements =
    "&lt;":  "&amp;lt;"
    "&gt;":  "&amp;gt;"
    "&amp;":  "&amp;amp;"
    "\"": "&amp;quot;"
  text.replace /[&lt;&gt;&amp;"]/g, (character) -&gt;
    replacements[character]
​
show escapeHTML "The ’pre-formatted’ tag " +
                "is written \"&lt;pre&gt;\"."
</pre>
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">replacements
</pre>
</div>
 object is a quick way to associate each character with its escaped version. Using it like this is safe (i.e. no <div class="listing">
<pre class="listing">Dictionary
</pre>
</div>
 object is needed), because the only properties that will be used are those matched by the <div class="listing">
<pre class="listing">/[&lt;&gt;&amp;"]/
</pre>
</div>
 expression.
</div>
</div>
</div>

</span></span></span>

</div>
<div class="Standard">
There are cases where the pattern you need to match against is not known while you are writing the code. Say we are writing a (very simple-minded) obscenity filter for a message board. We only want to allow messages that do not contain obscene words. The administrator of the board can specify a list of words that he or she considers unacceptable.
</div>
<div class="Standard">
The most efficient way to check a piece of text for a set of words is to use a regular expression. If we have our word list as an array, we can build the regular expression like this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">badWords = [’ape’, ’monkey’, ’simian’,
            ’gorilla’, ’evolution’]
pattern = new RegExp badWords.join(’|’), ’i’
isAcceptable = (text) -&gt;
  !pattern.test text
​
show isAcceptable ’Mmmm, grapes.’
show isAcceptable ’No more of that monkeybusiness, now.’
</pre>
</div>

</div>
<div class="Standard">
We could add <div class="listing">
<pre class="listing">\b
</pre>
</div>
 patterns around the words, so that the thing about grapes would not be classified as unacceptable. That would also make the second one acceptable, though, which is probably not correct. Obscenity filters are hard to get right (and usually way too annoying to be a good idea).
</div>
<div class="Standard">
The first argument to the <div class="listing">
<pre class="listing">RegExp
</pre>
</div>
 constructor is a string containing the pattern, the second argument can be used to add case-insensitivity or globalness. When building a string to hold the pattern, you have to be careful with backslashes. Because, normally, backslashes are removed when a string is interpreted, any backslashes that must end up in the regular expression itself have to be escaped:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">digits = new RegExp ’\\d+’
show digits.test ’101’
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
The most important thing to know about regular expressions is that they exist, and can greatly enhance the power of your string-mangling code. They are so cryptic that you will probably have to look up the details on them the first ten times you want to make use of them. Persevere, and you will soon be off-handedly writing expressions that look like occult gibberish.
</div>
<div class="Standard">
When your tasks become too complex for regular expressions then have a look at how CoffeeScript is implemented. It uses <a class="URL" href="http://github.com/zaach/jison">Jison</a>, a parser generator. With it you define a grammar for the language you want your program to be able to read i.e. parse. Jison then generates a module that can read data in that format. You integrate the module in your program and can then perform appropriate actions when different parts of the data is read. It is an advanced tool, that begins where regular expressions leave off.
</div>
<h1 class="Chapter">
<a class="toc" name="toc-Chapter-11"></a>Modularity<a class="Label" name="chap:Modularity"> </a>
</h1>
<div class="Standard">
This chapter deals with the process of organising programs. In small programs, organisation rarely becomes a problem. As a program grows, however, it can reach a size where its structure and interpretation become hard to keep track of. Easily enough, such a program starts to look like a bowl of spaghetti, an amorphous mass in which everything seems to be connected to everything else.
</div>
<div class="Standard">
In top down design you look at the overall structure of your application and divide it into smaller parts. There are many ways to do this, one way is to distinguish between technical and application specific areas. For example instead of inserting statements that write application activity in files in various places, the technical part — writing in a file, checking for errors and handling daily log roll-overs — can be placed in a logging utility as a technical service.
</div>
<div class="Standard">
A useful technique is to use a layered approach, where lower layers do not know of higher layers. For example when communicating between processes, lower level protocols can be encapsulated in a layer and when data arrives — instead of a lower layer directly calling a function to handle the data in a higher layer — the lower layer raises an event<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [X] </span><span class="HoverFoot"><span class="SupFootMarker"> [X] </span>The system underlying standard CoffeeScript has an EventEmitter to help you do this. Search for event in the documentation for the runtime system you use to learn more.</span></span> that an interested higher layer can be listening to. It is analogue to what we saw in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Error-Handling"><span class="sans">Error Handling</span>↑</a> where a failing function does not have any knowledge of who or how an exception will be handled.
</div>
<div class="Standard">
When structuring a program in CoffeeScript, we do two things. We separate it into smaller parts, called module<a class="IndexReference" name="entry-module-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-module">↓</a>s, each of which has a specific role, and we specify the relations between these parts.
</div>
<div class="Standard">
In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Searching"><span class="sans">Searching</span>↑</a>, while finding routes, we made use of a number of functions described in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>. The chapter also defined some concepts that had nothing in particular to do with route planning, such as <div class="listing">
<pre class="listing">flatten
</pre>
</div>
, <div class="listing">
<pre class="listing">partial
</pre>
</div>
 and the <div class="listing">
<pre class="listing">BinaryHeap
</pre>
</div>
 type. <div class="listing">
<pre class="listing">BinaryHeap
</pre>
</div>
 was treated as a black box, we only had to know how to use it, we did not have to know how it internally works. That kind of encapsulation is the essence of modularity and of <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Object-orientation"><span class="sans">Object Orientation</span>↑</a>.
</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">flatten
</pre>
</div>
 function was reused from the Underscore library. We needed the <div class="listing">
<pre class="listing">partial
</pre>
</div>
 function in a few places and haphazardly just added it to the environment where we needed it. It would have been easy to simply add <div class="listing">
<pre class="listing">partial
</pre>
</div>
 to the Underscore library, but that would mean that we had to add it every time a new version of Underscore is released.
</div>
<div class="Standard">
We could create our own module instead and place the missing parts there, then we would have to refer to two libraries whenever we are using fundamental functions. Or we could create a module with our functions that include Underscore and use the functions from it to build our own. Our module would then depend on Underscore. When a module depend<a class="IndexReference" name="entry-depend-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-depend">↓</a>s on another module, it uses functions or variables from that module, and will only work when the module is loaded.
</div>
<div class="Standard">
It is a good idea to make sure dependencies never form a circle. Not only do circular dependencies create a practical problem (if module <div class="listing">
<pre class="listing">A
</pre>
</div>
 and <div class="listing">
<pre class="listing">B
</pre>
</div>
 depend on each other, which one should be loaded first?), it also makes the relation between the modules less straightforward, and can result in a modularised version of the spaghetti I mentioned earlier.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Most modern programming languages have some kind of module system built in. In CoffeeScript it sort of depends… In the standard CoffeeScript environment we have a module system based on CommonJS <div class="listing">
<pre class="listing">require
</pre>
</div>
. When using CoffeeScript in other environments, such as on a page in a web browser, then we do not have <div class="listing">
<pre class="listing">require
</pre>
</div>
 and must rely on system specific services or once again invent something ourselves<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Y] </span><span class="HoverFoot"><span class="SupFootMarker"> [Y] </span>Projects such as <a class="URL" href="http://substack.net/posts/24ab8c/browserify-browser-side-require-for-your-node-js">browserify</a> is aiming at bringing <div class="listing">
<pre class="listing">require
</pre>
</div>
 to the browser.</span></span>.
</div>
<div class="Standard">
The most obvious way to start is to put every module in a different file. This makes it clear which code belongs to which module. In this chapter we will return to the <i>Seed of Life</i> example you saw in the <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Foreword">Preface↑</a> and make a server controlled, animated version of it. For this purpose I have extracted the mathematical calculations behind the drawing and placed them in a file, <div class="listing">
<pre class="listing">’10-MathFix.coffee’
</pre>
</div>
. It contains a <div class="listing">
<pre class="listing">CircularPosition
</pre>
</div>
 class we can use to get positions about a <span class="formula"><span class="fraction"><sup class="numerator">1</sup>⁄<sub class="denominator">6</sub></span></span> apart on a unit circle and a fix for a floating point rounding error. It also uses the prelude and has a small print utility at the end. It is not a module yet, we will stepwise refine it so it can be used in both a server and a browser environment.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">require "./prelude"
​
Pi2 = Math.PI*2
# Create an array with angles on the unit circle.
angles = (angle for angle in [0...Pi2] by 1/3*Math.PI)
# Remove the last element if 2*PI were included
# due to floating point rounding on additions.
epsilon = 1e-14
lastAngle = angles[angles.length - 1]
# Use an interval to test floating point value
if Pi2 - epsilon &lt; lastAngle &lt; Pi2 + epsilon
  angles.length = angles.length - 1
​
# Encapsulation of a pair of (x, y) coordinates
class Point
  constructor: (@x, @y) -&gt;
  toString: -&gt; "{x:#{@x.toPrecision 4}," +
               " y:#{@y.toPrecision 4}}"
​
# Math class that returns points on the unit
# circle, offset by step if given non-zero.
class CircularPosition
  constructor: (@_step = 0) -&gt; @_count = 0
  nextPoint: -&gt;
    index = @_count % angles.length 
    angle = angles[index] + @_step * @_count++
    new Point Math.cos(angle), Math.sin(angle)
​
circ = new CircularPosition 0.01
for i in [0...6]
  show "#{i}: #{circ.nextPoint()}"
</pre>
</div>

</div>
<div class="Standard">
The first thing is to remove the print utility at the end<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [Z] </span><span class="HoverFoot"><span class="SupFootMarker"> [Z] </span>How to use a separate test module is shown in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Binary-Heaps"><span class="sans">Binary Heaps</span>↓</a>.</span></span>. The next is the <div class="listing">
<pre class="listing">require ’./prelude’
</pre>
</div>
, while the prelude has served us well in the course of this book, it is not intended for modules. The prelude includes a variety of definitions so we have been free to focus on each aspect of CoffeeScript without distraction. However it pulls these definitions into a shared namespace either directly or via the <div class="listing">
<pre class="listing">globalize
</pre>
</div>
 function. This namespace is shared between all modules that a program consists of and since the purpose of a module is for us to be able to reuse it in various projects, a module should not ‘pollute’ this scarce, shared resource. In other words, you can use the prelude, when you are experimenting with a new algorithm, but do not use it when you create a reusable module.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When much code is loaded into an environment, it will use many top-level variable names. Once there is more code than you can really keep track of, it becomes very easy to accidentally use a name that was already used for something else. This will break the code that used the original value. The proliferation of top-level variables is called name-space pollution<a class="IndexReference" name="entry-name-space-pollution-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-name-space-pollution">↓</a>, and it has been a rather severe problem in JavaScript — the language will not warn you when you redefine an existing variable.
</div>
<div class="Standard">
CoffeeScript greatly reduces this problem by automatically encapsulating modules. You only have to avoid directly using top-level variables. In particular modules should not use top-level variables for values that are not part of their external interface.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
In CoffeeScript, ‘top-level’ variables all live together in a single place. In browsers, this place is an object that can be found under the name <div class="listing">
<pre class="listing">window
</pre>
</div>
. The name is somewhat odd, <div class="listing">
<pre class="listing">environment
</pre>
</div>
 or <div class="listing">
<pre class="listing">top
</pre>
</div>
 would have made more sense, but since browsers associate an environment with a window or a ‘frame’, someone decided that <div class="listing">
<pre class="listing">window
</pre>
</div>
 was a logical name. In the standard CoffeeScript environment it is called <div class="listing">
<pre class="listing">global
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">show global.process.argv[0]
show global.console.log == console.log
show global.global.global.global.global.console
</pre>
</div>

</div>
<div class="Standard">
As the third line shows, the name <div class="listing">
<pre class="listing">global
</pre>
</div>
 is merely a property of this environment object, pointing at itself.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Not being able to define any internal functions and variables at all in your modules is, of course, not very practical. Fortunately, there is a trick to get around this. We could write all the code for the module inside a function, and then add the variables that are part of the module’s interface to the top-level object. Because they were created in the same parent function, all the functions of the module can see each other, but code outside of the module can not. The wrapping in a function is done by CoffeeScript automatically. In the server environment, instead of assigning directly to the top-level environment our module will export its definitions. In the browser we have to assign to the top-level <div class="listing">
<pre class="listing">window
</pre>
</div>
, which when a module is loaded by a browser is the same as <div class="listing">
<pre class="listing">this
</pre>
</div>
. All we have to do is append this one line to our math module:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">(exports ? this).CircularPosition = CircularPosition
</pre>
</div>

</div>
<div class="Standard">
If <div class="listing">
<pre class="listing">exports
</pre>
</div>
<a class="IndexReference" name="entry-exports-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-exports">↓</a> is defined then <div class="listing">
<pre class="listing">CircularPosition
</pre>
</div>
 is added to it otherwise it is added to the top-level environment object. This change has been done in <div class="listing">
<pre class="listing">’10-Circular.coffee’
</pre>
</div>
 and the module is now usable from another module. The other definitions such as the <div class="listing">
<pre class="listing">Point
</pre>
</div>
 class are not visible to other modules. Objects of <div class="listing">
<pre class="listing">Point
</pre>
</div>
 type are of course visible as they are returned by <div class="listing">
<pre class="listing">nextPoint
</pre>
</div>
. You can use this modular information hiding when creating classes, if you want some definitions to be more private than simply naming them with an <div class="listing">
<pre class="listing">’_’
</pre>
</div>
 in front. We can verify this in an ad-hoc test, this one is called <div class="listing">
<pre class="listing">’10-CircularTest.coffee’
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">cp = require "./10-Circular"
show = console.log
​
circ = new cp.CircularPosition 0.01
for i in [0...6]
  show "#{i}: #{circ.nextPoint()}"
​
try
  show "Instantiating a new Point:"
  p = new cp.Point 0, 0
  show "Created a Point"
catch e then show e.message
​
show "CircularPosition namespace:"
show cp
</pre>
</div>

</div>
<div class="Standard">
The show function was defined in the prelude, so we no longer have access to it. In the underlying environment there is a function <div class="listing">
<pre class="listing">console.log
</pre>
</div>
 that can be used for output. Instead of using <div class="listing">
<pre class="listing">console.log
</pre>
</div>
 directly, defining <div class="listing">
<pre class="listing">show
</pre>
</div>
 as an alias for it makes it easy to copy such code into another environment, the browser were <div class="listing">
<pre class="listing">console.log
</pre>
</div>
 does not exist. When we have many <div class="listing">
<pre class="listing">show
</pre>
</div>
 calls, we only have to change in one place to redirect them to <div class="listing">
<pre class="listing">alert
</pre>
</div>
 or debug output.
</div>
<div class="Standard">
The process that we have been through — identifying a rounding error, extracting the implementation into a separate module where it is fixed — is called refactoring and it is an essential part of developing applications. Looking through code and finding places where it can be improved in functionality or in clarity results in a better overall system.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Designing an interface for a module or an object type is one of the subtler aspects of programming. On the one hand, you do not want to expose too many details. They will only get in the way when using the module. On the other hand, you do not want to be <i>too</i> simple and general, because that might make it impossible to use the module in complex or specialised situations.
</div>
<div class="Standard">
Sometimes the solution is to provide two interfaces, a detailed ‘low-level’ one for complicated things, and a simple ‘high-level’ one for straightforward situations. The second one can usually be built very easily using the tools provided by the first one.
</div>
<div class="Standard">
In other cases, you just have to find the right idea around which to base your interface. The best way to learn the value of good interface design is, unfortunately, to use bad interfaces. Once you get fed up with them, you will figure out a way to improve them, and learn a lot in the process. Try not to assume that a lousy interface is ‘just the way it is’. Fix it, or wrap it in a new interface that is better.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Just like an object type, a module has an interface. In collection-of-functions modules such as Underscore, the interface usually consists of all the functions that are defined in the module. In other cases, the interface of the module is only a small part of the functions defined inside it.
</div>
<div class="Standard">
For example, our manuscript-to-<span class="versalitas"><span class="small">HTML</span></span><span class="default"> system from <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a> only needs an interface of a single function, <div class="listing">
<pre class="listing">renderFile
</pre>
</div>
. The sub-system for building <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> would be a separate module. For modules which only define a single type of object, such as <div class="listing">
<pre class="listing">Dictionary
</pre>
</div>
, the object’s interface is the same as the module’s interface.</span>
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There are cases where a module will export so many variables that it is a bad idea to put them all into the top-level environment. In cases like this, you can do what the standard <div class="listing">
<pre class="listing">Math
</pre>
</div>
 object does, and represent the module as a single object whose properties are the functions and values it exports. For example…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">HTML =
  tag: (name, content, properties) -&gt;
    name: name
    properties: properties
    content: content
  link: (target, text) -&gt;
    HTML.tag ’a’, [text], {href: target}
  # ... many more HTML-producing functions ...
</pre>
</div>

</div>
<div class="Standard">
When you need the content of such a module so often that it becomes cumbersome to constantly type <div class="listing">
<pre class="listing">HTML
</pre>
</div>
, you can always move it into the top-level environment using <div class="listing">
<pre class="listing">globalize
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># As defined in the prelude
globalize = (ns, target = global) -&gt;
  target[name] = ns[name] for name of ns
​
globalize HTML
show link ’http://citeseerx.ist.psu.edu/viewdoc/’ +
  ’download?doi=10.1.1.102.244&amp;rep=rep1&amp;type=pdf’,
  ’What Every Computer Scientist Should Know ’ +
  ’About Floating-Point Arithmetic’
</pre>
</div>

</div>
<div class="Standard">
You can even combine the function and object approaches, by putting the internal variables of the module inside a function, and having this function return an object containing its external interface.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
When adding methods to standard prototypes, such as those of <div class="listing">
<pre class="listing">Array
</pre>
</div>
 and <div class="listing">
<pre class="listing">Object
</pre>
</div>
 a similar problem to name-space pollution occurs. If two modules decide to add a <div class="listing">
<pre class="listing">map
</pre>
</div>
 method to <div class="listing">
<pre class="listing">Array.prototype
</pre>
</div>
, you might have a problem. If these two versions of <div class="listing">
<pre class="listing">map
</pre>
</div>
 have the precise same effect, things will continue to work, but only by sheer luck.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There are functions which require a lot of arguments. Sometimes this means they are just badly designed, and can easily be remedied by splitting them into a few more modest functions. But in other cases, there is no way around it. Typically, some of these arguments have a sensible ‘default’ value. We could, for example, write yet another extended version of <div class="listing">
<pre class="listing">range
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">range = (start, end, stepSize, length) -&gt;
  if stepSize == undefined
    stepSize = 1
  if end == undefined
    end = start + stepSize * (length - 1)
  result = []
  while start &lt;= end
    result.push start
    start += stepSize
  result
show range 0, undefined, 4, 5
</pre>
</div>

</div>
<div class="Standard">
It can get hard to remember which argument goes where, not to mention the annoyance of having to pass <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 as a second argument when a <div class="listing">
<pre class="listing">length
</pre>
</div>
 argument is used. We can make passing arguments to this unfriendly function more comprehensive by wrapping them in an object.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">defaultTo = (object, values) -&gt;
  for name, value of values
    if not object.hasOwnProperty name
      object[name] = value
​
range = (args) -&gt;
  defaultTo args, {start: 0, stepSize: 1}
  if args.end == undefined
    args.end = args.start +
               args.stepSize * (args.length - 1)
  result = [];
  while args.start &lt;= args.end
    result.push args.start
    args.start += args.stepSize
  result
show range {stepSize: 4, length: 5}
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">defaultTo
</pre>
</div>
 function is useful for adding default values to an object. It copies the properties of its second argument into its first argument, skipping those that already have a value.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
For the <i>Seed of Life</i> from the <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Foreword">Preface↑</a>, to use the <div class="listing">
<pre class="listing">’10-Circular.coffee’
</pre>
</div>
 module in the web application, we have a few things to do. First we can replace the first line with <div class="listing">
<pre class="listing">kup = require ’./prelude/coffeekup’
</pre>
</div>
. The source code assigned to <div class="listing">
<pre class="listing">webpage
</pre>
</div>
 has a similar structure as the <span class="versalitas"><span class="small">HTML</span></span><span class="default"> we saw in <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Functional-Programming"><span class="sans">Functional Programming</span>↑</a>, but instead of being object attributes or text, it is CoffeeScript function calls.</span>
</div>
<div class="Standard">
It is like we have <span class="versalitas"><span class="small">HTML</span></span><span class="default"> embedded as a language extension in CoffeeScript. The correspondence between <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> and Coffeekup is practically 1:1, so when you know which <span class="versalitas"></span></span><span class="small">HTML</span><span class="default"> tag you want to use it is straightforward to write it in Coffeekup. You can find more information on the <a class="URL" href="http://coffeekup.org/">CoffeeKup website</a> or even better take the time to read the source code, it is only a few hundred lines of CoffeeScript and quite readable. There are examples in its standard distribution and <a class="URL" href="https://github.com/mark-hahn/coffeekup-intro/raw/master/coffeekup-intro-pandoc/coffeekup-intro.pdf">A Beginner's Introduction to CoffeeKup by Mark Hahn</a>.</span>
</div>
<div class="Standard">
In <span class="versalitas"><span class="small">HTML5</span></span><span class="default"> there is a <div class="listing">
<pre class="listing">canvas
</pre>
</div>
 tag with which you can create a drawing area. Then you can draw with vector graphics commands on the area. The commands are documented by W3C in <a class="URL" href="http://www.w3.org/TR/2dcontext/">HTML Canvas 2D Context</a>. If you are already familiar with vector graphics then the <a class="URL" href="http://www.nihilogic.dk/labs/canvas_sheet/HTML5_Canvas_Cheat_Sheet.pdf">HTML5 Canvas Cheat Sheet</a> may be all you need to create your own drawings. When you choose the technologies that you base your application on, then look for vendor independent, standardized technologies first. They tend to have a long lifespan, so you learn something you can bring with you from task to task. An alternative to the W3C <div class="listing">
<pre class="listing">canvas
</pre>
</div>
 is Adobe Flash.</span>
</div>
<div class="Standard">
<a class="IndexReference" name="entry-script-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-script">↓</a>Browsers load JavaScript files when they find a <div class="listing">
<pre class="listing">&lt;script&gt;
</pre>
</div>
 tag with an <div class="listing">
<pre class="listing">src
</pre>
</div>
 attribute in the <span class="versalitas"><span class="small">HTML</span></span><span class="default"> of a web page. The extension <div class="listing">
<pre class="listing">.js
</pre>
</div>
 is usually used for files containing JavaScript code. We could let the <div class="listing">
<pre class="listing">coffee
</pre>
</div>
 command line compiler produce JavaScript files for us. But then we have two files for every module and someone is bound to forget to compile a file someday, which could lead to strange behaviour and some difficult to find bugs. So instead let’s keep our CoffeeScript files and have the server compile them on the fly. That means we let the web page request a CoffeeScript file, but we will send the browser the corresponding JavaScript.</span>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">script src: ’./10-Circular.coffee’
</pre>
</div>

</div>
<div class="Standard">
Adding a <div class="listing">
<pre class="listing">type: ’text/coffeescript’
</pre>
</div>
 attribute would tell the client to expect and compile CoffeeScript code (if the CoffeeScript compiler was loaded in the client). While that may sound like a good idea, it has some problems. The biggest one is that the code is only available after the code under the <div class="listing">
<pre class="listing">coffeescript
</pre>
</div>
 function has run. And that function is were we want to use the class from the imported module. So forget about that possibility and compile on the server instead.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">circ = new CircularPosition()
for i in [0...6]
  pt = circ.nextPoint()
  circle ctx, x+100*pt.x, y+100*pt.y
</pre>
</div>
<div class="Standard">
Replacing the loop that used <span class="formula"><i>π</i></span> and trigonometric functions with the one above is the last step for the client side. It is only a few visible changes but we got rid of the rounding error, that fix would have bloated the client with irrelevant details. Here is the client from <div class="listing">
<pre class="listing">’10-SeedLife.coffee’
</pre>
</div>
:
</div>
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">kup = require ’./prelude/coffeekup’
​
# Client-side web page with canvas
webpage = kup.render -&gt; 
  doctype 5
  html -&gt;
    head -&gt;
      meta charset: ’utf-8’
      title ’My drawing | My awesome website’
      style ’’’
        body {font-family: sans-serif}
        header, nav, section, footer {display: block}
      ’’’
      # DO NOT USE: type: ’text/coffeescript’
      script src: ’./10-Circular.coffee’
​
      coffeescript -&gt;
        draw = (ctx, x, y) -&gt;
          circle = (ctx, x, y) -&gt;
            ctx.beginPath()
            ctx.arc x, y, 100, 0, 2*Math.PI, false
            ctx.stroke()
          ctx.strokeStyle = ’rgba(255,40,20,0.7)’
          circle ctx, x, y
          circ = new CircularPosition()
          for i in [0...6]
            pt = circ.nextPoint()
            circle ctx, x+100*pt.x, y+100*pt.y
        window.onload = -&gt;
          canvas = document.getElementById ’drawCanvas’
          context = canvas.getContext ’2d’
          draw context, 300, 200
    body -&gt;
      header -&gt; h1 ’Seed of Life’
      canvas id: ’drawCanvas’, width: 600, height: 400
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
It is possible not use a <div class="listing">
<pre class="listing">script
</pre>
</div>
 tag, but to fetch the content of a file directly, and then use the <div class="listing">
<pre class="listing">eval
</pre>
</div>
 function to execute it. This makes script loading instantaneous, and thus easier to deal with. <div class="listing">
<pre class="listing">eval
</pre>
</div>
<a class="IndexReference" name="entry-eval-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-eval">↓</a>, short for ‘evaluate’, is an interesting function. You give it a string value, and it will execute the content of the string as code. The global function will however only accept JavaScript, to get a usable CoffeeScript <div class="listing">
<pre class="listing">eval
</pre>
</div>
 function you need to refer to the <div class="listing">
<pre class="listing">’coffee-script’
</pre>
</div>
 library.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">eval ’function IamJavaScript() {’ +
     ’  console.log(\"Repeat after me:’ +
     ’ Give me more {();};.\");};’ +
     ’ IamJavaScript();’
​
cs = (require ’coffee-script’).CoffeeScript
cs.eval ’show ((a, b) -&gt; a + b) 3, 4’
</pre>
</div>

</div>
<div class="Standard">
You can imagine that <div class="listing">
<pre class="listing">eval
</pre>
</div>
 can be used to do some interesting things. Code can build new code, and run it. In most cases, however, problems that can be solved with creative uses of <div class="listing">
<pre class="listing">eval
</pre>
</div>
 can also be solved with creative uses of anonymous functions, and the latter is less likely to cause strange problems and security nightmares. When <div class="listing">
<pre class="listing">eval
</pre>
</div>
 is called inside a function, all new variables will become local to that function.
</div>
<div class="Standard">
Notice the <div class="listing">
<pre class="listing">require
</pre>
</div>
 statement — we are not interested in creating instances of the <div class="listing">
<pre class="listing">CoffeeScript
</pre>
</div>
 class, only in calling its static <div class="listing">
<pre class="listing">eval
</pre>
</div>
 method — so that line helps us avoid writing: <div class="listing">
<pre class="listing">cs.CoffeeScript.eval
</pre>
</div>
 …
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A web server functions by responding to web browser (client) requests. The minimal implementation given in <i>Seed of Life</i> create a server that takes a function as an argument. Every time a request comes in, the function is called. Such a function is called an event handler or sometimes a callback. This function prints a message and creates a response by writing a header, describing the content of the response, and adding the web page as the response body. The server is started by giving it a port number to listen to. The server then goes to sleep, waiting for a client to request something of it. You can do that by typing <div class="listing">
<pre class="listing">http://localhost:3389/
</pre>
</div>
 in your web browser<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [A] </span><span class="HoverFoot"><span class="SupFootMarker"> [A] </span>Depending on your operating system you can also use numerical IP addresses. <div class="listing">
<pre class="listing">127.0.0.1
</pre>
</div>
 conventionally address your local machine. In a <div class="listing">
<pre class="listing">hosts
</pre>
</div>
 file you can map names into IP addresses, its location depend on your operating system.</span></span>. To stop the server press <div class="listing">
<pre class="listing">CTRL-C
</pre>
</div>
. It’s similar to this:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Server-side HTTP server
http = require "http"
server = http.createServer (req, res) -&gt;
  show "#{req.client.remoteAddress} " +
       "#{req.method} #{req.url}"
  res.writeHead 200, "Content-Type": "text/html"
  res.write webpage
  res.end()
server.listen 3389
show "Server running at"
show server.address()
</pre>
</div>

</div>
<div class="Standard">
That is a bit too minimal for our <i>Seed of Life</i> application because we have to send either the web page or our module depending on what the client will be asking for. We could replace our code with a web server framework but that is not very instructive, it only shows you that something can be done, not how it works internally.
</div>
<div class="Standard">
Instead lets expand the server with the minimum of what is required to get it to work. You can reverse engineer the client / server communication by adding a <div class="listing">
<pre class="listing">show req
</pre>
</div>
 to the minimal server. Using the new web page we can see that three items are requested by the client: <div class="listing">
<pre class="listing">’/’
</pre>
</div>
 the web page, <div class="listing">
<pre class="listing">’/10-Circular.coffee’
</pre>
</div>
 the code module, and <div class="listing">
<pre class="listing">’/favicon.ico’
</pre>
</div>
 that we can ignore. That is enough information to add some if statements to it.
</div>
<div class="Standard">
For the module request we have to read the file, compile it with CoffeeScript (using the same module as <div class="listing">
<pre class="listing">eval
</pre>
</div>
) and return the compiled code, that the browser can understand, in the response. When a request is made for anything else then a simple response is ‘not found’, that’s a <div class="listing">
<pre class="listing">404
</pre>
</div>
 in <span class="versalitas"><span class="small">HTTP</span></span><span class="default">.</span>
</div>
<div class="Standard">
If you looked in the prelude how it was reading a file, then that is <i>not</i> the way to read a file in a server. The prelude uses a synchronous function, that means that everything stops until the file has been read. In the world of servers hard disks are slow, and one request should not stop other requests. Using <div class="listing">
<pre class="listing">readFile
</pre>
</div>
 solves this because its last argument is for a function that will only be run when the file has been read — the server can then process other requests in the meantime.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Server-side HTTP server
show = console.log
http = require "http"
fs = require "fs"
cs = require("coffee-script").CoffeeScript
​
server = http.createServer (req, res) -&gt;
  show "#{req.client.remoteAddress} " +
       "#{req.method} #{req.url}"
  if req.method is "GET"
    if req.url is "/"
      res.writeHead 200, "Content-Type": "text/html"
      res.write webpage
      res.end()
      return
    else if req.url is "/10-Circular.coffee"
      fs.readFile ".#{req.url}", "utf8", (err, data) -&gt;
        if err then throw err
        compiledContent = cs.compile data
        res.writeHead 200,
          "Content-Type": "application/javascript"
        res.write compiledContent
        res.end()
      return
  res.writeHead 404, "Content-Type": "text/html"
  res.write "404 Not found"
  res.end()
server.listen 3389
show "Server running at"
show server.address()
</pre>
</div>

</div>
<div class="Standard">
I think you can see that this code practically begs to be abstracted and modularized. Instead of an <div class="listing">
<pre class="listing">if
</pre>
</div>
 chain, we could have a function with an object as argument where each attribute is a request and each value a function to handle the request. Then there is error handling, if the file is not found then the server throws an error and stops. The purpose of <div class="listing">
<pre class="listing">’10-SeedLife.coffee’
</pre>
</div>
 is to show how you can use a module on a web page, so refactoring and beautifying the server is up to you<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [B] </span><span class="HoverFoot"><span class="SupFootMarker"> [B] </span>If you want to understand how to write your own <span class="versalitas"><span class="footnotesize">HTTP</span></span><span class="default"> server then Manuel Kiessling has a <a class="URL" href="http://www.nodebeginner.org/">tutorial</a> that you can easily translate into your own CoffeeScript web server.</span></span></span>.
</div>
<div class="Standard">
Building a program as a set of nice, small modules often means the program will use a lot of different files. When programming for the web, having lots of small code files on a page tend to make the page slower to load. This does not have to be a problem though. You can write and test your program as a number of small files, and put them all into a single big file when ‘publishing’ the program to the web. The CoffeeScript compiler has a join feature for this.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A module or group of modules that can be useful in more than one program is usually called a library<a class="IndexReference" name="entry-library-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-library">↓</a>. For many programming languages, there is a huge set of quality libraries available. This means programmers do not have to start from scratch all the time, which can make them a lot more productive.
</div>
<div class="Standard">
For CoffeeScript, unfortunately, the number of available libraries is not very large. But you can use JavaScript libraries as a stopgap. Underscore is an example of a good library with its ‘basic’ tools, things like <div class="listing">
<pre class="listing">map
</pre>
</div>
 and <div class="listing">
<pre class="listing">clone
</pre>
</div>
. Other languages tend to provide such obviously useful things as built-in standard features, but with CoffeeScript you will have to either build a collection of them for yourself or use a library.
</div>
<div class="Standard">
Using a library is recommended: It is less work, and the code in a library has usually been tested more thoroughly than the things you write yourself. Some things to check when selecting a library is functionality, adequate documentation, and readable source code — and that the library is small enough that you can understand and fix bugs in it — if need be on your own.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Beyond the concept of modules and programs is the world of distributed programming where processes running on different machines collaborate on solving a task or interact with each other in near real time. One protocol that enables distributed programming is <a class="URL" href="http://dev.w3.org/html5/websockets/">WebSockets</a>.
</div>
<div class="Standard">
A WebSocket is a bi-directional, full-duplex communications channel over a TCP socket. Possibly the same socket that a web server is using. With bi-directional, full-duplex support a server and its clients can send messages back and forth concurrently. It opens the door to many kinds of web applications that would have been difficult to implement over http.
</div>
<div class="Standard">
Most of the latest web browsers have support for WebSockets. Some have it disabled by default because of potential security issues in the draft protocol, the prelude shows how to enable WebSocket support in Firefox and Opera. It is enabled in Chrome and Safari. To see if your web browser works with WebSockets you can run <div class="listing">
<pre class="listing">’10-TestWebSocket.coffee’
</pre>
</div>
.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
To connect a client to a WebSocket server, you create a <div class="listing">
<pre class="listing">WebSocket
</pre>
</div>
 object with a server as its endpoint. Note the <div class="listing">
<pre class="listing">ws
</pre>
</div>
 protocol instead of <div class="listing">
<pre class="listing">http
</pre>
</div>
:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">websocket = new WebSocket ’ws://localhost:8080/’
</pre>
</div>

</div>
<div class="Standard">
You can attach functions to a <div class="listing">
<pre class="listing">WebSocket
</pre>
</div>
 object, so your code can react when certain events occur. There are four of them: <div class="listing">
<pre class="listing">onopen
</pre>
</div>
, <div class="listing">
<pre class="listing">onclose
</pre>
</div>
, <div class="listing">
<pre class="listing">onmessage
</pre>
</div>
, and <div class="listing">
<pre class="listing">onerror
</pre>
</div>
. Sending a message to the server is done with <div class="listing">
<pre class="listing">send
</pre>
</div>
. For example:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">websocket.onopen = (evt) -&gt;
  writeToScreen ’CONNECTED’
  websocket.send ’WebSocket works!’
</pre>
</div>

</div>
<div class="Standard">
That is how simple it is with a client on a web page. In CoffeeScript’s server-side environment there is not yet support for WebSockets, but that is easily fixed with the <tt>ws</tt> library from Jacek Becela. It is less than 200 lines when translated into CoffeeScript. It is present in the prelude or you can use it directly from <div class="listing">
<pre class="listing">prelude/ws.coffee
</pre>
</div>
.
</div>
<div class="Standard">
To create a server you pass a function to its <div class="listing">
<pre class="listing">createServer
</pre>
</div>
 method and get a <div class="listing">
<pre class="listing">websocket
</pre>
</div>
 object as an argument where you can attach methods to listen for events. To send a message to a client, call its <div class="listing">
<pre class="listing">write
</pre>
</div>
 method with a string. Here is an abbreviated use of it:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">wsHandler = (websocket) -&gt;
  websocket.on ’connect’, (resource) -&gt;
    show ’connect: ’ + resource
    # ...
  websocket.on ’data’, (data) -&gt;
    show data                    # process data
    websocket.write ’Cowabunga!’ # respond
  # ...
​
wsServer = ws.createServer wsHandler
wsServer.listen 8080
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
So without further ado here follows an animated version of <i>Seed of Life</i>… Find it in <div class="listing">
<pre class="listing">’10-WebSocketLife.coffee’
</pre>
</div>
 and change it any way you like.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">kup = require ’./prelude/coffeekup’
​
# Web page with canvas and client-side WebSocket
webpage = kup.render -&gt; 
  doctype 5
  html -&gt;
    head -&gt;
      meta charset: ’utf-8’
      title ’My animation | My awesome website’
      style ’’’
        body {font-family: sans-serif}
        header, nav, section, footer {display: block}
      ’’’
      coffeescript -&gt;
        show = (msg) -&gt; console.log msg
        color = ’rgba(255,40,20,0.7)’
        circle = (ctx, x, y) -&gt;
          ctx.strokeStyle = color
          ctx.beginPath()
          ctx.arc x, y, 100, 0, 2*Math.PI, false
          ctx.stroke()
​
        addElement = (ni, num, text) -&gt;
          newdiv = document.createElement ’div’
          newdiv.setAttribute ’id’, ’div’ + num
          newdiv.innerHTML = text
          ni.appendChild newdiv
​
        wsUri = ’ws://localhost:8080/’
        websocket = undefined
        num = 0
        socketClient = (buffer, ctx, x, y) -&gt;
          websocket = new WebSocket wsUri
          websocket.onopen = (evt) -&gt;
            show ’Connected’
          websocket.onclose = (evt) -&gt;
            show ’Closed’
          websocket.onerror = (evt) -&gt;
            show ’Error: ’ + evt.data
          websocket.onmessage = (evt) -&gt;
            #show evt.data
            addElement buffer, num++, evt.data
            pt = JSON.parse evt.data
            if pt.color? then color = pt.color
            circle ctx, x+100*pt.x, y+100*pt.y
​
        window.onload = -&gt;
          canvas = document.getElementById ’drawCanvas’
          context = canvas.getContext ’2d’
          buffer = document.getElementById ’message’
          socketClient buffer, context, 300, 200
​
        window.sendMessage = -&gt;
          msg = document.getElementById(’entryfield’).value
          websocket.send msg
​
    body -&gt;
      header -&gt; h1 ’Seed of Life’
      input id:’entryfield’, value:’rgba(40,200,25,0.7)’
      button type: ’button’, onclick: ’sendMessage()’
        ’Change Color’
      br
      canvas id: ’drawCanvas’, width: 600, height: 400
      div id: ’message’
​
# Server-side WebSocket server
ws = require ’./prelude/ws’
cp = require ’./10-Circular’
wsHandler = (websocket) -&gt;
  websocket.on ’connect’, (resource) -&gt;
    show ’connect: ’ + resource
    # close connection after 10s
    setTimeout websocket.end, 10 * 1000
​
  websocket.on ’data’, (data) -&gt;
    show data # process data
    blue = ’rgba(40,20,255,0.7)’
    websocket.write JSON.stringify
      color: if data is ’’ then blue else data
​
  websocket.on ’close’, -&gt;
    show ’closing’
    process.exit 0 # Exit server completely
​
  circ = new cp.CircularPosition 0.01
  annoy = setInterval (-&gt;
    websocket.write JSON.stringify circ.nextPoint()), 20
​
wsServer = ws.createServer wsHandler
wsServer.listen 8080
​
# Launch test server and client UI
require ’./prelude’
viewServer webpage
​
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Through the examples, exercises and explanations you have a foundation for your own projects: a collaborative web application, a multi-user game, a library with an aesthetically pleasing implementation, …
</div>
<div class="Standard">
First choose what your project is going to be about, then look to <a class="URL" href="https://github.com/languages/CoffeeScript">github</a> for supporting code and libraries. A couple of interesting ones for web applications are <a class="URL" href="https://github.com/mauricemach/zappa">Zappa</a> and <a class="URL" href="https://github.com/socketstream/socketstream">SocketStream</a>.
</div>
<div class="Standard">
If you would like a broader foundation in computer science then read: <a class="URL" href="http://cisnet.mit.edu/4i7o9/5cjhf/toc">Concepts, Techniques, and Models of Computer Programming</a> by Peter van Roy and Seif Haridi. Not a word of CoffeeScript, but plenty of insight.
</div>
<div class="Standard">
<div class="bigskip"> </div>
</div>
<blockquote class="Quote">
<i>Dimidium facti qui coepit habet: sapere aude, incipe</i><br>
<i>He who has begun has half done. Dare to be wise; begin!</i>
</blockquote>
<div class="Dictum">
<span class="sans"><span class="footnotesize">Quintus Horatius Flaccus</span></span>
</div>
<h1 class="Part">
<a class="toc" name="toc-Part-IV">Part IV.</a> Appendix
</h1>
<h1 class="Chapter">
<a class="toc" name="toc-Appendix-A"></a>Language extras<a class="Label" name="chap:Language-extras"> </a>
</h1>
<div class="Standard">
Most of the CoffeeScript language has been introduced in <span class="sans">Smooth CoffeeScript.</span> This appendix illustrates some extra language constructs and idioms that may come in handy.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
There is a statement called <div class="listing">
<pre class="listing">switch
</pre>
</div>
<a class="IndexReference" name="entry-switch-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-switch">↓</a> which can be used to choose which code to execute based on some value. Alternatives include a chain of <div class="listing">
<pre class="listing">if
</pre>
</div>
 statements or an associative data structure.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">weatherAdvice = (weather) -&gt;
  show ’When it is ’ + weather
  switch weather
    when ’sunny’
      show ’Dress lightly.’
      show ’Go outside.’
    when ’cloudy’
      show ’Go outside.’
    when ’tornado’, ’hurricane’
      show ’Seek shelter’
    else
      show ’Unknown weather type: ’ + weather
weatherAdvice ’sunny’
weatherAdvice ’cloudy’
weatherAdvice ’tornado’
weatherAdvice ’hailstorm’
</pre>
</div>

</div>
<div class="Standard">
Inside the block opened by <div class="listing">
<pre class="listing">switch
</pre>
</div>
, you can write a number of <div class="listing">
<pre class="listing">when
</pre>
</div>
 labels. The program will jump to the label that corresponds to the value that <div class="listing">
<pre class="listing">switch
</pre>
</div>
 was given or to <div class="listing">
<pre class="listing">else
</pre>
</div>
 if no matching value is found. Then it executes statements in the following block until it reaches the next <div class="listing">
<pre class="listing">when
</pre>
</div>
 or <div class="listing">
<pre class="listing">else
</pre>
</div>
 statement. Unlike some other languages there is no fall-through between <div class="listing">
<pre class="listing">when
</pre>
</div>
 cases and no <div class="listing">
<pre class="listing">break
</pre>
</div>
 statement is therefore needed. You can have a comma-separated lists after a <div class="listing">
<pre class="listing">when
</pre>
</div>
, any of the values is then used to find a match.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Closely related to <div class="listing">
<pre class="listing">break
</pre>
</div>
, there is <div class="listing">
<pre class="listing">continue
</pre>
</div>
<a class="IndexReference" name="entry-continue-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-continue">↓</a>. They can be used in the same places. While <div class="listing">
<pre class="listing">break
</pre>
</div>
 jumps <i>out</i> of a loop and causes the program to proceed after the loop, <div class="listing">
<pre class="listing">continue
</pre>
</div>
 jumps to the next iteration of the loop.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for i in [20...30]
  if i % 3 != 0
    continue
  show i + ’ is divisible by three.’
</pre>
</div>

</div>
<div class="Standard">
A similar effect can usually be produced using just <div class="listing">
<pre class="listing">if
</pre>
</div>
, but there are cases where <div class="listing">
<pre class="listing">continue
</pre>
</div>
 looks nicer.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Pattern matching has been touched upon, a few more examples can clarify the scope of it. You can assign an object to an anonymous object with matching attribute names.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class Point
  constructor: (@x, @y) -&gt;
pt = new Point 3, 4
​
{x, y} = pt
show "x is #{x} and y is #{y}"
</pre>
</div>

</div>
<div class="Standard">
Attribute names can be inferred from an anonymous object.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">firstName = "Alan"
lastName = "Turing"
​
name = {firstName, lastName}
show name
</pre>
</div>

</div>
<div class="Standard">
A function can have an anonymous object as argument and extract the attributes as variables.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">decorate = ({firstName, lastName}) -&gt;
  show "Distinguished #{firstName} " +
       "of the #{lastName} family."
decorate name
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Unicode can be used in identifiers. Letter forms that are very similar to characters in the western alphabets should be avoided. It can be difficult in internationally shared projects due to different keyboard layouts, but useful in teaching math or in a local language.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">pi = π = Math.PI
sphereSurfaceArea = (r) -&gt; 4 * π * r * r
radius = 1
show ’4 * π * r * r when r = ’ + radius
show sphereSurfaceArea radius
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Qualifying a <div class="listing">
<pre class="listing">for
</pre>
</div>
 statement with a <div class="listing">
<pre class="listing">when
</pre>
</div>
 clause can be used to filter array or object elements on a logical condition. Great for one-liners.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">evens = (n) -&gt; i for i in [0..n] when i % 2 is 0
show evens 6
​
steppenwolf = 
  title:   ’Tonight at the Magic Theater’
  warning: ’For Madmen only’
  caveat:  ’Price of Admittance: Your Mind.’
  caution: ’Not for Everybody.’
​
stipulations = (text for key, text of steppenwolf \
  when key in [’warning’, ’caveat’])
show stipulations
show ultimatum for ultimatum in stipulations \
  when ultimatum.match /Price/
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Destructuring assignment can be used to swap or reassign variables. It is also handy for extracting values or returning multiple values from a function.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">tautounlogical = "the reason is because I say so"
splitStringAt = (str, n) -&gt;
  [str.substring(0,n), str.substring(n)]
[pre, post] = splitStringAt tautounlogical, 14
[pre, post] = [post, pre] # swap
show "#{pre} #{post}"
</pre>
</div>

</div>
<div class="Standard">
<div class="listing">
<pre class="listing">[re,mi,fa,sol,la,ti] = [1..6]
[dal,ra...,mim] = [ti,re,fa,sol,la,mi]
show "#{dal}, #{ra} and #{mim}"
​
[key, word] = if re &gt; ti then [mi, fa] else [fa, mi]
show "#{key} and #{word}"
</pre>
</div>

</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A function can be bound to the <div class="listing">
<pre class="listing">this
</pre>
</div>
 value that is in effect when it is defined. This can be needed when you are using event handlers or callback based libraries e.g. jQuery. Instead of <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
 use <div class="listing">
<pre class="listing">=&gt;
</pre>
</div>
 to bind <div class="listing">
<pre class="listing">this
</pre>
</div>
.
</div>
<div class="Standard">
In the following example the <div class="listing">
<pre class="listing">a.display
</pre>
</div>
 would show <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 when called in the <div class="listing">
<pre class="listing">Container
</pre>
</div>
 if <div class="listing">
<pre class="listing">display
</pre>
</div>
 was defined with <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>
.
<div class="Standard">
<div class="listing">
<pre class="listing">class Widget
  id: ’I am a widget’
  display: =&gt; show @id
​
class Container
  id: ’I am a container’
  callback: (f) -&gt;
    show @id
    f()
​
a = new Widget
a.display()
b = new Container
b.callback a.display
</pre>
</div>
</div>
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
With the <div class="listing">
<pre class="listing">do
</pre>
</div>
 statement you can call a named or an anonymous function:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">n = 3
f = -&gt; show "Say: ’Yes!’"
do f
(do -&gt; show "Yes!") while n-- &gt; 0
</pre>
</div>

</div>
<div class="Standard">
Which is reminiscent of the syntax for a function that takes a function as its parameter.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">echoEchoEcho = (msg) -&gt; msg() + msg() + msg()
show echoEchoEcho -&gt; "No"
</pre>
</div>

</div>
<div class="Standard">
The <div class="listing">
<pre class="listing">do
</pre>
</div>
 statement captures the environment, so it is available inside its block. The <div class="listing">
<pre class="listing">setTimeout
</pre>
</div>
 function calls the innermost function after the loop has finished. Without capture the <div class="listing">
<pre class="listing">i
</pre>
</div>
 variable is <div class="listing">
<pre class="listing">4
</pre>
</div>
.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">for i in [1..3]
  do (i) -&gt;
    setTimeout (-&gt; show ’With do: ’ + i), 0
for i in [1..3]
  setTimeout (-&gt; show ’Without: ’ + i), 0
</pre>
</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Appendix-B"></a>Binary Heaps<a class="Label" name="chap:Binary-Heaps"> </a>
</h1>
<div class="Standard">
In <a class="Reference" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#chap:Searching"><span class="sans">Searching</span>↑</a>, the binary heap<a class="IndexReference" name="entry-binary-heap-1" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-binary-heap">↓</a> was introduced as a method to store a collection of objects in such a way that the smallest element can be quickly found. As promised, this appendix will explain the details behind this data structure.
</div>
<div class="Standard">
Consider again the problem we needed to solve. The A* algorithm created large amounts of small objects, and had to keep these in an ‘open list’. It was also constantly removing the smallest element from this list. The simplest approach would be to just keep all the objects in an array, and search for the smallest one when we need it. But, unless we have a <i>lot</i> of time, this will not do. Finding the smallest element in an unsorted array requires going over the whole array, and checking each element.
</div>
<div class="Standard">
The next solution would be, of course, to sort our array. CoffeeScript arrays have a wonderful <div class="listing">
<pre class="listing">sort
</pre>
</div>
<a class="IndexReference" name="entry-sort-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-sort">↓</a> method, which can be used to do the heavy work. Unfortunately, re-sorting a whole array every time an element is removed is more work than searching for a minimum value in an unsorted array. Some tricks can be used, such as, instead of re-sorting the whole array, just making sure new values are inserted in the right place so that the array, which was sorted before, stays sorted. This is coming closer to the approach a binary heap uses already, but inserting a value in the middle of an array requires moving all the elements after it one place up, which is still just too slow.
</div>
<div class="Standard">
Another approach is to not use an array at all, but to store the values in a set of interconnected objects. A simple form of this is to have every object hold one value and two (or less) links to other objects. There is one root object, holding the smallest value, which is used to access all the other objects. Links always point to objects holding greater values, so the whole structure looks something like this:
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/tree.png" alt="figure img/tree.png" style="width: 90%; height: auto;">

</div>

</div>
<div class="Standard">
Such structures are usually called tree<a class="IndexReference" name="entry-tree-0" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#index-tree">↓</a>s, because of the way they branch. Now, when you need the smallest element, you just take off the top element and rearrange the tree so that one of the top element’s children — the one with the lowest value — becomes the new top. When inserting new elements, you ‘descend’ the tree until you find an element less than the new element, and insert it there. This takes a lot less searching than a sorted array does, but it has the disadvantage of creating a lot of objects, which also slows things down.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
A binary heap, then, does make use of a sorted array, but it is only partially sorted, much like the tree above. Instead of objects, the positions in the array are used to form a tree, as this picture tries to show:
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/heap.png" alt="figure img/heap.png" style="width: 40%; height: auto;">

</div>

</div>
<div class="Standard">
Array element <div class="listing">
<pre class="listing">1
</pre>
</div>
 is the root of the tree, array element <div class="listing">
<pre class="listing">2
</pre>
</div>
 and <div class="listing">
<pre class="listing">3
</pre>
</div>
 are its children, and in general array element <div class="listing">
<pre class="listing">X
</pre>
</div>
 has children <div class="listing">
<pre class="listing">X * 2
</pre>
</div>
 and <div class="listing">
<pre class="listing">X * 2 + 1
</pre>
</div>
. You can see why this structure is called a ‘heap’. Note that this array starts at <div class="listing">
<pre class="listing">1
</pre>
</div>
, while CoffeeScript arrays start at <div class="listing">
<pre class="listing">0
</pre>
</div>
. The heap will always keep the smallest element in position <div class="listing">
<pre class="listing">1
</pre>
</div>
, and make sure that for every element in the array at position <div class="listing">
<pre class="listing">X
</pre>
</div>
, the element at <div class="listing">
<pre class="listing">X / 2
</pre>
</div>
 (round down) is smaller.
</div>
<div class="Standard">
Finding the smallest element is now a matter of taking the element at position <div class="listing">
<pre class="listing">1
</pre>
</div>
. But when this element is removed, the heap must make sure that there are no holes left in the array. To do this, it takes the last element in the array and moves it to the start, and then compares it to its child elements at position <div class="listing">
<pre class="listing">2
</pre>
</div>
 and <div class="listing">
<pre class="listing">3
</pre>
</div>
. It is likely to be greater, so it is exchanged with one of them, and the process of comparing it with its children is repeated for the new position, and so on, until it comes to a position where its children are greater, or a position where it has no children.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">[2, 3, 5, 4, 8, 7, 6]
# Take out 2, move 6 to the front.
[6, 3, 5, 4, 8, 7]
# 6 is greater than its first child 3, so swap them.
[3, 6, 5, 4, 8, 7]
# Now 6 has children 4 and 8 (position 4 and 5).
# It is greater than 4, so we swap again.
[3, 4, 5, 6, 8, 7]
# 6 is in position 4, and has no more children.
# The heap is in order again.
</pre>
</div>

</div>
<div class="Standard">
Similarly, when an element has to be added to the heap, it is put at the end of the array and allowed to ‘bubble’ up by repeatedly exchanging it with its parent, until we find a parent that is less than the new node.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">[3, 4, 5, 6, 8, 7]
# Element 2 gets added again, it starts at the back.
[3, 4, 5, 6, 8, 7, 2]
# 2 is in position 7, its parent is at 3, which
# is a 5. 5 is greater than 2, so we swap.
[3, 4, 2, 6, 8, 7, 5]
# The parent of position 3 is position 1.
# Again, we swap.
[2, 4, 3, 6, 8, 7, 5]
# The element can not go further than position 1,
# so we are done.
</pre>
</div>

</div>
<div class="Standard">
Note how adding or inserting an element does not require it to be compared with every element in the array. In fact, because the jumps between parents and children get bigger as the array gets bigger, this advantage is especially large when we have a lot of elements<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [C] </span><span class="HoverFoot"><span class="SupFootMarker"> [C] </span>The amount of comparisons and swaps that are needed — in the worst case — can be approached by taking the logarithm (base 2) of the amount of elements in the heap.</span></span>.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Here is the full code of a binary heap implementation. Two things to note are that, instead of directly comparing the elements put into the heap, a function (<div class="listing">
<pre class="listing">scoreFunction
</pre>
</div>
) is first applied to them, so that it becomes possible to store objects that can not be directly compared. The default is the identity function.
</div>
<div class="Standard">
Also, because CoffeeScript arrays start at <div class="listing">
<pre class="listing">0
</pre>
</div>
, and the parent/child calculations use a system that starts at <div class="listing">
<pre class="listing">1
</pre>
</div>
, there are a few strange calculations to compensate.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">class BinaryHeap
​
  # Public
  #--------
  constructor: (@scoreFunction = (x) -&gt; x) -&gt;
    @content = []
​
  push: (element) -&gt;
    # Add the new element to the end of the array.
    @content.push element
    # Allow it to bubble up.
    @_bubbleUp @content.length - 1
  
  pop: -&gt;
    # Store the first element so we can return it later.
    result = @content[0]
    # Get the element at the end of the array.
    end = @content.pop()
    # If there are any elements left, put the end
    # element at the start, and let it sink down.
    if @content.length &gt; 0
      @content[0] = end
      @_sinkDown 0
    result

  size: -&gt; @content.length
​
  remove: (node) -&gt;
    len = @content.length
    # To remove a value, we must search through the
    # array to find it.
    for i in [0...len]
      if @content[i] == node
        # When it is found, the process seen in ’pop’
        # is repeated to fill up the hole.
        end = @content.pop()
        if i != len - 1
          @content[i] = end
          if @scoreFunction(end) &lt; @scoreFunction(node)
            @_bubbleUp i
          else
            @_sinkDown i
        return
    throw new Error ’Node not found.’
​
  # Private
  #---------
  _bubbleUp: (n) -&gt;
    # Fetch the element that has to be moved.
    element = @content[n]
    # When at 0, an element can not go up any further.
    while n &gt; 0
      # Compute the parent element index, and fetch it.
      parentN = Math.floor((n + 1) / 2) - 1
      parent = @content[parentN]
      # Swap the elements if the parent is greater.
      if @scoreFunction(element) &lt; @scoreFunction(parent)
        @content[parentN] = element
        @content[n] = parent
        # Update ’n’ to continue at the new position.
        n = parentN
      # Found a parent that is less,
      # no need to move it further.
      else
        break
    return

  _sinkDown: (n) -&gt;
    # Look up the target element and its score.
    length = @content.length
    element = @content[n]
    elemScore = @scoreFunction element
    loop
      # Compute the indices of the child elements.
      child2N = (n + 1) * 2
      child1N = child2N - 1
      # This is used to store the new position of
      # the element, if any.
      swap = null
      # If the first child exists (is inside the array)...
      if child1N &lt; length
        # Look it up and compute its score.
        child1 = @content[child1N]
        child1Score = this.scoreFunction child1
        # If the score is less than our elements,
        # we need to swap.
        if child1Score &lt; elemScore
          swap = child1N
      # Do the same checks for the other child.
      if child2N &lt; length
        child2 = @content[child2N]
        child2Score = @scoreFunction child2
        compScore = if swap == null
            elemScore
          else
            child1Score
        if child2Score &lt; compScore
          swap = child2N
      # If the element needs to be moved,
      # swap it, and continue.
      if swap != null
        @content[n] = @content[swap]
        @content[swap] = element
        n = swap
      # Otherwise, we are done.
      else
        break
    return
​
(exports ? this).BinaryHeap = BinaryHeap
</pre>
</div>

</div>

<div class="Standard">
And some test cases…
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">sortByValue = (obj) -&gt; sortBy obj, (n) -&gt; n
buildHeap = (c, a) -&gt;
    heap = new BinaryHeap
    heap.push number for number in a
    c.note heap
​
declare ’heap is created empty’, [],
  (c) -&gt; c.assert (new BinaryHeap).size() == 0
​
declare ’heap pop is undefined when empty’, [],
  (c) -&gt; c.assert isUndefined (new BinaryHeap).pop()
​
declare ’heap contains number of inserted elements’,
  [arbArray(arbInt)], (c, a) -&gt;
    c.assert buildHeap(c, a).size() == a.length
​
declare ’heap contains inserted elements’,
  [arbArray(arbInt)], (c, a) -&gt;
    heap = buildHeap c, a
    c.assert isEqual sortByValue(a), \
      sortByValue(heap.content)
​
declare ’heap pops elements in sorted order’,
  [arbArray(arbInt)], (c, a) -&gt;
    heap = buildHeap c, a
    for n in sortByValue a then c.assert n == heap.pop()
    c.assert heap.size() == 0
​
declare ’heap does not remove non-existent elements’,
  [arbArray(arbInt), arbInt],
  expectException (c, a, b) -&gt;
    if b in a then c.guard false
    heap = buildHeap c, a
    heap.remove b
​
declare ’heap removes existing elements’,
  [arbArray(arbInt), arbInt], (c, a, b) -&gt;
    if not (b in a) then c.guard false
    aSort = sortByValue without a, b
    count = a.length - aSort.length
    heap = buildHeap c, a
    heap.remove b for i in [0...count]
    for n in aSort then c.assert n == heap.pop()
    c.assert heap.size() == 0
</pre>
</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Appendix-C"></a>Performance<a class="Label" name="chap:Performance"> </a>
</h1>
<div class="Standard">
To give an idea of the relative performance of CoffeeScript for problem solving and number crunching we can compare it with CPython. First a small test of operations on a million floating point numbers.
</div>
<div class="Standard">
<div class="Frameless" style="width: 49%;">
<div class="listing">
<pre class="listing"># CoffeeScript
show = console.log
​
start = new Date()
​
N = 1000000
a = Array(N)
for i in [0...N]
  a[i] = Math.random()
​
s = 0
for v in a
  s += v
​
t = 0
for v in a
  t += v*v
t = Math.sqrt t
​
duration = new Date() - start
show "N: #{N} in #{duration*0.001} s"
show "Result: #{s} and #{t}"
</pre>
</div>

</div>
<div class="Standard">
<p></p>
</div>
<span class="hfill"> </span><div class="Frameless" style="width: 49%;">
<div class="listing">
<pre class="listing"># CPython
import time
import random
import math
​
start = time.clock()
N = 1000000
a = [random.random()
  for i in range(N)]
​
s = 0
for v in a:
  s += v
​
t = 0
for v in a:
  t += v*v
t = math.sqrt(t)
​
duration = time.clock() - start
print ’N:’, N, ’in’, duration, ’s’
print ’Result:’, s, ’and’, t
</pre>
</div>

</div>

</div>
<div class="Standard">
<div class="defskip"> </div>
</div>
<div class="Standard">
The source code and the results are quite similar. On my machine the time for CoffeeScript is about 0.41s and around 1.03s for CPython. You can try it yourself with <div class="listing">
<pre class="listing">coffee A3-Microbench.coffee
</pre>
</div>
 and if you have CPython installed <div class="listing">
<pre class="listing">python A3-Microtest.py
</pre>
</div>
. C++ is 10<span class="formula"><span class="scriptstyle"> × </span></span> to 30<span class="formula"><span class="scriptstyle"> × </span></span> faster.
</div>
<div class="Standard">
<div class="center">
<span class="formula">○•○</span>
</div>

</div>
<div class="Standard">
Below you can find implementations<span class="FootOuter"><span class="SupFootMarker" onclick="void(0)"> [D] </span><span class="HoverFoot"><span class="SupFootMarker"> [D] </span>Background information on <a class="URL" href="http://en.wikipedia.org/wiki/Eight_queens_puzzle">8 queens puzzle</a>, <a class="URL" href="http://code.activestate.com/recipes/190465-generator-for-permutations-combinations-selections/">implementation</a> and <a class="URL" href="http://aminsblog.wordpress.com/2011/05/29/n-queen-problem-python-2-6-5-vs-pypy-1-5-0/">performance</a>.</span></span> for the classic 8 queens problem. The objective is to place eight queens on a chessboard without any of the queens occupying the same row, column or diagonal. The two implementations use the same algorithm and produce the same results. Timing for CPython 0.27s and for CoffeeScript 0.06s.
</div>
<div class="Standard">
<div class="Frameless" style="width: 49%;">
<div class="listing">
<pre class="listing"># CoffeeScript encoding: utf-8
​
start = new Date()
show = console.log
​
# Create variations to try
permute = (L) -&gt;
  n = L.length
  return ([elem] for elem in L) if n is 1
  [a, L] = [ [L[0]], L.slice 1 ]
  result = []
  for p in permute L
    for i in [0...n]
      result.push p[...i].concat a, p[i...]
  result
​
# Check a variation
test = (p, n) -&gt;
  for i in [0...n - 1]
    for j in [i + 1...n]
      d = p[i] - p[j]
      return true if j - i == d or i - j == d
  false
​
# N queens solver
nQueen = (n) -&gt;
  result = []
  for p in permute [0...n]
    result.push p unless test p, n
  result
​
# Repeat a string a number of times
rep = (s, n) -&gt; (s for [0...n]).join ’’
​
# Display a board with a solution
printBoard = (solution) -&gt;
  board = "\n"
  end = solution.length
  for pos, row in solution
    board += "#{end - row} #{rep ’ - ’, pos} " +
             "* #{rep ’ - ’, end - pos - 1}\n"
  # Using radix 18 hack!
  board += ’   ’ + (n.toString 18 \
    for n in [10...18]).join(’  ’).toUpperCase()
  board + "\n"
​
​
# Find all solutions
solve = (n) -&gt;
  for solution, count in nQueen n
    show "Solution #{count+1}:"
    show printBoard solution
  count
​
solve 8 # Normal chessboard size
​
show "Timing: #{(new Date() - start)*0.001}s"
</pre>
</div>
<div class="Standard">
<p></p>
</div>
</div>
<span class="hfill"> </span><div class="Frameless" style="width: 49%;">
<div class="listing">
<pre class="listing"># CPython encoding: utf-8
import time
t=time.clock()
​
def permute(L):
    "Create variations to try"
    n = len(L)
    if n == 1:
        for elem in L:
            yield [elem]
    else:
        a = [L.pop(0)]
        for p in permute(L):
            for i in range(n):
                yield p[:i] + a + p[i:]
​
def test(p, n):
    "Check a variation"
    for i in range(n - 1):
        for j in range(i + 1, n):
            d = p[i] - p[j]
            if j - i == d or i - j == d:
                return True
    return False
​
def n_queen(n):
    "N queens solver"
    for p in permute(range(n)):
        if not test(p, n): yield p
​
# Start columns from A
base_char = ord(’A’)
​
def print_board(solution):
    "Display a board with a solution"
    board = []
    end = len(solution)
    for row, pos in enumerate(solution):
        board += ["\n%s %s * %s" % ((end - row),
          (’ - ’ * pos),
          (’ - ’ * (end - pos - 1)))]
    # Using character set hack!
    board += ’\n   ’ + \
      ’  ’.join([chr(base_char+i)
        for i in range(0, end)])
    return ’’.join(board) + ’\n’
​
def solve(n):
    "Find all solutions"
    for count, solution in enumerate(n_queen(n)):
        print "Solution %d:" % count
        print print_board(solution)
    return count
​
solve(8) # Normal chessboard size
​
print "Timing: ", time.clock()-t, "s"
</pre>
</div>

</div>

</div>
<div class="align-center">
<span class="sans"><span class="hspace" style="width: 3.5em;"></span>Solution 1<span class="hspace" style="width: 3.5em;"></span> ➞ <span class="hspace" style="width: 3.5em;"></span>Solution 92<span class="hspace" style="width: 3.2em;"></span></span>
</div>
<div class="Standard">
<div class="center">
<img class="embedded" src="./Smooth CoffeeScript_files/queens.png" alt="figure img/queens.png" style="width: 70%; height: auto;">

</div>

</div>
<h1 class="Chapter">
<a class="toc" name="toc-Appendix-D"></a>Command Line Utility<a class="Label" name="chap:CommandLine"> </a>
</h1>
<div class="Standard">
The utility used to remove solutions from source files is shown here. Partly as an example of a command line program, partly to make this book and its accompanying source code self-containing.
</div>
<div class="Standard">
The program uses the asynchronous file system functions in the same manner as server programs. The synchronous functions are more conventional, but less illustrative.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">fs = require "fs"
show = console.log
​
String::contains = (pattern) -&gt;
  ///#{pattern}///.test this
​
leadingWhitespace = (str) -&gt;
  (str.match /(\s*)\w/)[1] ? ""
​
errorWrapper = (action) -&gt;
  (err, args...) -&gt;
    if err then throw err
    action args...
​
ifFileExists = (filename, action) -&gt;
  fs.stat filename, errorWrapper (stat) -&gt;
    if stat.isFile() then action()
​
getFileAsLines = (filename, action) -&gt;
  ifFileExists filename, -&gt;
    fs.readFile filename, "utf8",
      errorWrapper (content) -&gt;
        action content.split "\n"
​
saveFile = (filename, content) -&gt;
  fs.writeFile filename, content,
    errorWrapper -&gt; show "Saved #{filename}"
​
stripSolutions = (lines) -&gt;
  out = ""
  inSolution = false
  concat = (str) -&gt; out += str + "\n"
  for line in lines
    if line.contains "’— Exercise \\d+ —’"
      inSolution = true
      concat line
      indent = leadingWhitespace line
      concat "#{indent}process.exit()" +
        " # Replace this line with your solution"
    else if inSolution
      if line.contains "’— End of Exercise —’"
        concat line
        inSolution = false
      # else ignore line in solution
    else
      concat line
  # Remove trailing newline
  out[...out.length-1]
​
stripFile = (fromName, toName) -&gt;
  if fromName?
    getFileAsLines fromName, (lines) -&gt;
      saveFile toName, stripSolutions lines
  else
    show "Expected a file name " +
         "to strip for solutions"

copyFile = (fromName, toName) -&gt;
  if fromName?
    ifFileExists fromName, -&gt;
      fs.readFile fromName, "utf8",
        errorWrapper (content) -&gt;
          saveFile toName, content,
  else
    show "Expected a file name to copy"
​
toDir = "../src-no-solutions"
fs.mkdir toDir, 0777, (err) -&gt;
  if err
    throw err unless err.code is ’EEXIST’
    show "Reusing"
  else
    show "Created"
​
fromDir = process.argv[2]
if fromDir?
  fs.readdir fromDir, errorWrapper (files) -&gt;
    for filename in files
      if filename.contains "\\w\\w-\\w+.coffee"
        stripFile filename, "#{toDir}/#{filename}"
      else
        copyFile filename, "#{toDir}/#{filename}"
else
  show "Expected a directory with " +
       "solutions to strip"
</pre>
</div>

</div>
<h1 class="Part">
<a class="toc" name="toc-Part-V">Part V.</a> Reference and Index
</h1>
<h1 class="Chapter">
<a class="toc" name="toc-Appendix-E"></a>Reference<a class="Label" name="chap:Indices"> </a>
</h1>
<h2 class="Section-">
<a class="toc" name="toc-Section--1"></a>Language Reference
</h2>
<div class="Standard">
Also available as a two page <a class="URL" href="http://autotelicum.github.com/Smooth-CoffeeScript/CoffeeScript%20Quick%20Ref.pdf">Quick Reference</a> in pdf format.
</div>
<div class="Standard">
Refer to <a class="URL" href="http://coffeescript.org/">coffeescript.org</a> for further reference material and examples.
</div>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--1"></a>General
</h3>
<ul>
<li>
Whitespace is significant
</li>
<li>
Ending a line will terminate expressions - no need to use semicolons
</li>
<li>
Semicolons can be used to fit multiple expressions onto a single line
</li>
<li>
Use indentation instead of curly braces <div class="listing">
<pre class="listing">{ }
</pre>
</div>
 to surround blocks of code in functions, <div class="listing">
<pre class="listing">if
</pre>
</div>
 statements, <div class="listing">
<pre class="listing">switch
</pre>
</div>
, and <div class="listing">
<pre class="listing">try/catch
</pre>
</div>

</li>
<li>
Comments starts with <div class="listing">
<pre class="listing">#
</pre>
</div>
 and run to the end of the line
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--2"></a>Embedded JavaScript
</h3>
<ul>
<li>
Use backquotes <div class="listing">
<pre class="listing">``
</pre>
</div>
 to embed JavaScript code within CoffeeScript
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--3"></a>Functions
</h3>
<ul>
<li>
Functions are defined by an optional list of parameters in parentheses, an arrow, and an optional function body. The empty function looks like: <div class="listing">
<pre class="listing">-&gt;
</pre>
</div>

</li>
<li>
Mostly no need to use parentheses to invoke a function if it is passed arguments. The implicit call wraps forward to the end of the line or block expression.
</li>
<li>
Functions may have default values for arguments. Override the default value by passing a non-null argument.
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--4"></a>Objects and arrays
</h3>
<ul>
<li>
Objects and arrays are similar to JavaScript
</li>
<li>
When each property is listed on its own line, the commas are optional
</li>
<li>
Objects may be created using indentation instead of explicit braces, similar to YAML
</li>
<li>
Reserved words, like <div class="listing">
<pre class="listing">class
</pre>
</div>
, can be used as properties of an object without quoting them as strings
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--5"></a>Lexical Scoping and Variable Safety
</h3>
<ul>
<li>
Variables are declared implicitly when used (no <div class="listing">
<pre class="listing">var
</pre>
</div>
 keyword).
</li>
<li>
The compiler ensures that variables are declared within lexical scope. An outer variable is not redeclared within an inner function when it is in scope
</li>
<li>
Using an inner variable can not shadow an outer variable, only refer to it. So avoid reusing the name of an external variable in a deeply nested function
</li>
<li>
CoffeeScript output is wrapped in an anonymous function, making it difficult to accidentally pollute the global namespace
</li>
<li>
To create top-level variables for other scripts, attach them as properties on <div class="listing">
<pre class="listing">window
</pre>
</div>
, or to <div class="listing">
<pre class="listing">exports
</pre>
</div>
 in CommonJS. Use: <div class="listing">
<pre class="listing">exports ? this
</pre>
</div>

</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--6"></a>If, Else, Unless, and Conditional Assignment
</h3>
<ul>
<li>
<div class="listing">
<pre class="listing">if/else
</pre>
</div>
 can be written without parentheses and curly braces
</li>
<li>
Multi-line conditionals are delimited by indentation
</li>
<li>
<div class="listing">
<pre class="listing">if
</pre>
</div>
 and <div class="listing">
<pre class="listing">unless
</pre>
</div>
 can be used in postfix form i.e. at the end of the statement
</li>
<li>
<div class="listing">
<pre class="listing">if
</pre>
</div>
 statements can be used as expressions. No need for <div class="listing">
<pre class="listing">?:
</pre>
</div>

</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--7"></a>Splats
</h3>
<ul>
<li>
Splats <div class="listing">
<pre class="listing">...
</pre>
</div>
 can be used instead of the variable number of <div class="listing">
<pre class="listing">arguments
</pre>
</div>
 object and are available for both function definition and invocation
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--8"></a>Loops and Comprehensions
</h3>
<ul>
<li>
Comprehensions <div class="listing">
<pre class="listing">for ... in
</pre>
</div>
 work over arrays, objects, and ranges
</li>
<li>
Comprehensions replace for loops, with optional guard clauses and the value of the current array index: <div class="listing">
<pre class="listing">for value, index in array
</pre>
</div>

</li>
<li>
Array comprehensions are expressions, and can be returned and assigned
</li>
<li>
Comprehensions may replace <div class="listing">
<pre class="listing">each/forEach
</pre>
</div>
, <div class="listing">
<pre class="listing">map
</pre>
</div>
 or <div class="listing">
<pre class="listing">select/filter
</pre>
</div>

</li>
<li>
Use a range when the start and end of a loop is known (integer steps)
</li>
<li>
Use <div class="listing">
<pre class="listing">by
</pre>
</div>
 to step in fixed-size increments
</li>
<li>
When assigning the value of a comprehension to a variable, CoffeeScript collects the result of each iteration into an array
</li>
<li>
Return <div class="listing">
<pre class="listing">null
</pre>
</div>
, <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 or <div class="listing">
<pre class="listing">true
</pre>
</div>
 if a loop is only for side-effects
</li>
<li>
To iterate over the key and value properties in an object, use <div class="listing">
<pre class="listing">of
</pre>
</div>

</li>
<li>
Use: <div class="listing">
<pre class="listing">for own key, value of object
</pre>
</div>
 to iterate over the keys that are directly defined on an object
</li>
<li>
The only low-level loop is the <div class="listing">
<pre class="listing">while
</pre>
</div>
 loop. It can be used as an expression, returning an array containing the result of each iteration through the loop
</li>
<li>
<div class="listing">
<pre class="listing">until
</pre>
</div>
 is equivalent to <div class="listing">
<pre class="listing">while not
</pre>
</div>

</li>
<li>
<div class="listing">
<pre class="listing">loop
</pre>
</div>
 is equivalent to <div class="listing">
<pre class="listing">while true
</pre>
</div>

</li>
<li>
The <div class="listing">
<pre class="listing">do
</pre>
</div>
 keyword inserts a closure wrapper, forwards any arguments and invokes a passed function
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--9"></a>Array Slicing and Splicing with Ranges
</h3>
<ul>
<li>
Ranges can be used to extract slices of arrays
</li>
<li>
With two dots <div class="listing">
<pre class="listing">[3..6]
</pre>
</div>
, the range is inclusive (3, 4, 5, 6)
</li>
<li>
With three dots <div class="listing">
<pre class="listing">[3...6]
</pre>
</div>
, the range excludes the end (3, 4, 5)
</li>
<li>
The same syntax can be used with assignment to replace a segment of an array with new values, splicing it
</li>
<li>
Strings are immutable and can not be spliced
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--10"></a>Everything is an Expression
</h3>
<ul>
<li>
Functions return their final value
</li>
<li>
The return value is fetched from each branch of execution
</li>
<li>
Return early from a function body by using an explicit <div class="listing">
<pre class="listing">return
</pre>
</div>

</li>
<li>
Variable declarations are at the top of the scope, so assignment can be used within expressions, even for variables that have not been seen before
</li>
<li>
Statements, when used as part of an expression, are converted into expressions with a closure wrapper. This allows assignment of the result of a comprehension to a variable
</li>
<li>
The following are not expressions: <div class="listing">
<pre class="listing">break
</pre>
</div>
, <div class="listing">
<pre class="listing">continue
</pre>
</div>
, and <div class="listing">
<pre class="listing">return
</pre>
</div>

</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--11"></a>Operators and Aliases
</h3>
<ul>
<li>
CoffeeScript compiles <div class="listing">
<pre class="listing">==
</pre>
</div>
 into <div class="listing">
<pre class="listing">===
</pre>
</div>
, and <div class="listing">
<pre class="listing">!=
</pre>
</div>
 into <div class="listing">
<pre class="listing">!==
</pre>
</div>
. There is no equivalent to the JavaScript <div class="listing">
<pre class="listing">==
</pre>
</div>
 operator
</li>
<li>
The alias <div class="listing">
<pre class="listing">is
</pre>
</div>
 is equivalent to <div class="listing">
<pre class="listing">===
</pre>
</div>
, and <div class="listing">
<pre class="listing">isnt
</pre>
</div>
 corresponds to <div class="listing">
<pre class="listing">!==
</pre>
</div>

</li>
<li>
<div class="listing">
<pre class="listing">not
</pre>
</div>
 is an alias for <div class="listing">
<pre class="listing">!
</pre>
</div>

</li>
<li>
Logical operator aliases: <div class="listing">
<pre class="listing">and
</pre>
</div>
 is <div class="listing">
<pre class="listing">&amp;&amp;
</pre>
</div>
, <div class="listing">
<pre class="listing">or
</pre>
</div>
 is <div class="listing">
<pre class="listing">||
</pre>
</div>

</li>
<li>
In <div class="listing">
<pre class="listing">while
</pre>
</div>
, <div class="listing">
<pre class="listing">if/else
</pre>
</div>
 and <div class="listing">
<pre class="listing">switch/when
</pre>
</div>
 statements the <div class="listing">
<pre class="listing">then
</pre>
</div>
 keyword can be used to keep the body on the same line
</li>
<li>
Alias for boolean <div class="listing">
<pre class="listing">true
</pre>
</div>
 is <div class="listing">
<pre class="listing">on
</pre>
</div>
 and <div class="listing">
<pre class="listing">yes
</pre>
</div>
 (as in YAML)
</li>
<li>
Alias for boolean <div class="listing">
<pre class="listing">false
</pre>
</div>
 is <div class="listing">
<pre class="listing">off
</pre>
</div>
 and <div class="listing">
<pre class="listing">no
</pre>
</div>

</li>
<li>
For single-line statements, <div class="listing">
<pre class="listing">unless
</pre>
</div>
 can be used as the inverse of <div class="listing">
<pre class="listing">if
</pre>
</div>

</li>
<li>
Use <div class="listing">
<pre class="listing">@property
</pre>
</div>
 instead of <div class="listing">
<pre class="listing">this.property
</pre>
</div>

</li>
<li>
Use <div class="listing">
<pre class="listing">in
</pre>
</div>
 to test for array presence
</li>
<li>
Use <div class="listing">
<pre class="listing">of
</pre>
</div>
 to test for object-key presence
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--12"></a>Existential Operator
</h3>
<ul>
<li>
Use the existential operator <div class="listing">
<pre class="listing">?
</pre>
</div>
 to check if a variable exists
</li>
<li>
<div class="listing">
<pre class="listing">?
</pre>
</div>
 returns <div class="listing">
<pre class="listing">true
</pre>
</div>
 unless a variable is <div class="listing">
<pre class="listing">null
</pre>
</div>
 or <div class="listing">
<pre class="listing">undefined
</pre>
</div>

</li>
<li>
Use <div class="listing">
<pre class="listing">?=
</pre>
</div>
 for safer conditional assignment than <div class="listing">
<pre class="listing">||=
</pre>
</div>
 when handling numbers or strings
</li>
<li>
The accessor variant of the existential operator <div class="listing">
<pre class="listing">?.
</pre>
</div>
 can be used to soak up null references in a chain of properties
</li>
<li>
Use <div class="listing">
<pre class="listing">?.
</pre>
</div>
 instead of the dot accessor <div class="listing">
<pre class="listing">.
</pre>
</div>
 in cases where the base value may be <div class="listing">
<pre class="listing">null
</pre>
</div>
 or <div class="listing">
<pre class="listing">undefined
</pre>
</div>
. If all of the properties exist then the expected result is returned, if the chain is broken, then <div class="listing">
<pre class="listing">undefined
</pre>
</div>
 is returned instead
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--13"></a>Classes, Inheritance, and Super
</h3>
<ul>
<li>
Object orientation as in most other object oriented languages
</li>
<li>
The <div class="listing">
<pre class="listing">class
</pre>
</div>
 structure allows to name the class, set the superclass with <div class="listing">
<pre class="listing">extends
</pre>
</div>
, assign prototypal properties, and define a <div class="listing">
<pre class="listing">constructor
</pre>
</div>
, in a single assignable expression
</li>
<li>
Constructor functions are named as the <div class="listing">
<pre class="listing">class
</pre>
</div>
 name, to support reflection
</li>
<li>
Lower level operators: The <div class="listing">
<pre class="listing">extends
</pre>
</div>
 operator helps with proper prototype setup. <div class="listing">
<pre class="listing">::
</pre>
</div>
 gives access to an object’s prototype. <div class="listing">
<pre class="listing">super()
</pre>
</div>
 calls the immediate ancestor’s method of the same name
</li>
<li>
A class definition is a block of executable code, which may be used for meta programming.
</li>
<li>
In the context of a class definition, <div class="listing">
<pre class="listing">this
</pre>
</div>
 is the class object itself (the <div class="listing">
<pre class="listing">constructor
</pre>
</div>
 function), so static properties can be assigned by using <div class="listing">
<pre class="listing">@property: value
</pre>
</div>
, and functions defined in parent classes can be called with: <div class="listing">
<pre class="listing">@inheritedMethodName()
</pre>
</div>

</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--14"></a>Destructuring Assignment
</h3>
<ul>
<li>
To make extracting values from complex arrays and objects convenient, CoffeeScript implements destructuring assignment
</li>
<li>
When assigning an array or object literal to a value, CoffeeScript breaks up and matches both sides against each other, assigning the values on the right to the variables on the left
</li>
<li>
The simplest case is parallel assignment <div class="listing">
<pre class="listing">[a,b] = [b,a]
</pre>
</div>

</li>
<li>
It can be used with functions that return multiple values
</li>
<li>
It can be used with any depth of array and object nesting to get deeply nested properties and can be combined with splats
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--15"></a>Function binding
</h3>
<ul>
<li>
The fat arrow <div class="listing">
<pre class="listing">=&gt;
</pre>
</div>
 can be used to define a function and bind it to the current value of <div class="listing">
<pre class="listing">this
</pre>
</div>

</li>
<li>
This is helpful when using callback-based libraries, for creating iterator functions to pass to <div class="listing">
<pre class="listing">each
</pre>
</div>
 or event-handler functions to use with <div class="listing">
<pre class="listing">bind
</pre>
</div>

</li>
<li>
Functions created with <div class="listing">
<pre class="listing">=&gt;
</pre>
</div>
 are able to access properties of the <div class="listing">
<pre class="listing">this
</pre>
</div>
 where they are defined
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--16"></a>Switch/When/Else
</h3>
<ul>
<li>
The <div class="listing">
<pre class="listing">switch
</pre>
</div>
 statement do not need a <div class="listing">
<pre class="listing">break
</pre>
</div>
 after every case
</li>
<li>
A <div class="listing">
<pre class="listing">switch
</pre>
</div>
 is a returnable, assignable expression
</li>
<li>
The format is: <div class="listing">
<pre class="listing">switch
</pre>
</div>
 condition, <div class="listing">
<pre class="listing">when
</pre>
</div>
 clauses, <div class="listing">
<pre class="listing">else
</pre>
</div>
 the default case
</li>
<li>
Multiple values, comma separated, can be given for each <div class="listing">
<pre class="listing">when
</pre>
</div>
 clause. If any of the values match, the clause runs
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--17"></a>Try/Catch/Finally
</h3>
<ul>
<li>
<div class="listing">
<pre class="listing">try/catch
</pre>
</div>
 statements are as in JavaScript (although they are expressions)
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--18"></a>String Interpolation, Heredocs, and Block Comments
</h3>
<ul>
<li>
Single-quoted strings are literal. Use backslash for escape characters
</li>
<li>
Double-quoted strings allow for interpolated values, using <div class="listing">
<pre class="listing">#{ ... }
</pre>
</div>

</li>
<li>
Multiline strings are allowed
</li>
<li>
A heredoc <div class="listing">
<pre class="listing">’’’
</pre>
</div>
 can be used for formatted or indentation-sensitive text (or to avoid escaping quotes and apostrophes)
</li>
<li>
The indentation level that begins a heredoc is maintained throughout, so the text can be aligned with the body of the code
</li>
<li>
Double-quoted heredocs <div class="listing">
<pre class="listing">"""
</pre>
</div>
 allow for interpolation
</li>
<li>
Block comments <div class="listing">
<pre class="listing">###
</pre>
</div>
 are similar to heredocs, and are preserved in the generated code
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--19"></a>Chained Comparisons
</h3>
<ul>
<li>
Use a chained comparison <div class="listing">
<pre class="listing">minimum &lt; value &lt; maximum
</pre>
</div>
 to test if a value falls within a range
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--20"></a>Extended Regular Expressions
</h3>
<ul>
<li>
Extended regular expressions “heregexes” are delimited by <div class="listing">
<pre class="listing">///
</pre>
</div>
 and are similar to heredocs and block comments
</li>
<li>
Extended regular expressions ignore internal whitespace and can contain comments
</li>

</ul>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--21"></a>Reserved Words<a class="Label" name="sub:Reserved-Words"> </a>
</h3>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Keywords</i></span></span><br><div class="listing">
<pre class="listing">break             by                catch
class             continue          debugger
delete            do                else
extends           false             finally
for               if                in
instanceof        loop              new
null              of                return
super             switch            then
this              throw             true
try               typeof            undefined
unless            until             when
while
</pre>
</div>
</div>
<div class="Standard">
</div>
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Aliases</i></span></span><br><div class="listing">
<pre class="listing">and  :  &amp;&amp;        or   :  ||        not  :  !
is   :  ==        isnt :  !=
yes  :  true      no   :  false
on   :  true      off  :  false
</pre>
</div>

</div>

</div>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--22"></a>Underscore<a class="Label" name="sub:Underscore"> </a>
</h3>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Functions</i></span></span><br><div class="listing">
<pre class="listing">all               any               bind
bindAll           breakLoop         clone
compact           compose           contains
defer             delay             detect
each              every             extend
filter            first             flatten
foldl             foldr             forEach
functions         head              identity
include           indexOf           inject
intersect         invoke            isArguments
isArray           isBoolean         isDate
isElement         isEmpty           isEqual
isFunction        isNull            isNumber
isRegExp          isString          isUndefined
keys              last              lastIndexOf
map               max               memoize
methods           min               mixin
noConflict        pluck             range
reduce            reduceRight       reject
rest              select            size
some              sortBy            sortedIndex
tail              tap               template
templateSettings  times             toArray
uniq              uniqueId          values
without           wrap              zip
</pre>
</div>
<div class="Standard">
General call convention: <div class="listing">
<pre class="listing">functional obj, iterator, context
</pre>
</div>
.<div class="PlainVisible">
Refer to <div class="listing">
<pre class="listing">src/prelude/underscore.coffee
</pre>
</div>
 for the annotated source.
</div>
</div>
</div>

</div>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--23"></a><p><br>
</p>
qc.js<a class="Label" name="sub:qc.js"> </a>
</h3>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Exported Definitions</i></span></span><br>
<dl>
<div class="Labeling">
<span class="footnotesize"><dt>arbChoose</dt><dd>Generator that chooses uniformly among the given generators.</dd></span>
</div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> generators…</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>arbConst</dt><dd>Generator that always returns one of the given constant values.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> values…</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>arbBool</dt><dd>Boolean value generator with 50:50 chance of true or false.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbNull</dt><dd>Null generator that always generates ’null’.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbWholeNum</dt><dd>Integer value generator for values ≥ 0. Supports shrinking.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbInt</dt><dd>Integer value generator. Supports shrinking.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbFloatUnit</dt><dd>Generator for a floating point value in between 0.0 and 1.0. Supports shrinking.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbRange</dt><dd>Integer range value generator.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> minimum value</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> maximum value</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>arbNullOr</dt><dd>Chooses null with 10% probability and the given generator with 90%. Supports shrinking.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> another generator</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>arrShrinkOne</dt><dd>Array shrinking strategy that builds new Arrays by removing one element from a given array.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbArray</dt><dd>Array generator. Generates an array of arbitrary length with the given generator.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> generator that creates the resulting array values.</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> an optional shrinking strategy. Default is ‘arrShrinkOne’.</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>arbDate</dt><dd>Date value generator. Always generates a new Date object by calling ‘new Date()’.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbMod</dt><dd>Basis generator for arbChar and arbString.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbChar</dt><dd>Character value generator for any character with character code in range 32-255.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbString</dt><dd>String value generator. All characters in the generated String are in range 32-255. Supports shrinking.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbUndef</dt><dd>Generator that always generates ’undefined’.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>arbUndefOr</dt><dd>Chooses undefined with 10% probability and the given generator with 90%. Supports shrinking.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> another generator</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>expectException</dt><dd>Property test function modifier. Using this modifier, it is assumed that the testing function will throw an exception and if not the property will fail.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>failOnException</dt><dd>Property test function modifier. Instead of finishing testing when an unexpected exception is thrown, the offending property is marked as failure and <tt>qc</tt> will continue.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Case</dt><dd>Test case class generated every time a property is tested. An instance of Case is always passed as first argument to a property’s testing function so it can control the test case’s properties.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Case::assert</dt><dd>Tests and notifies <tt>qc</tt> if a property fails or not.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> pass false, if the property failed, true otherwise</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Case::guard</dt><dd>Used to test if the input is good for testing the property.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> pass false to mark the property as invalid for the given input.</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Case::classify</dt><dd>Adds a tag to a test run.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> if true then the tag is added to the case, else not.</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> tag value to add</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Case::collect</dt><dd>Collect builds a histogram of all collected values for all runs of the property.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> value to collect</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Case::noteArg</dt><dd>Adds the given value to the test case for reporting in case of failure.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> value to add</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Case::note</dt><dd>Same as Case::noteArg but returning its argument so it can be used inline. Defined in prelude.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Case::noteVerbose</dt><dd>Same as Case::note but also logs the noted args. Defined in prelude.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>declare</dt><dd>Builds and registers a new property.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> the property’s name</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> array of generators with a length equal to the arity of the body function. The entry at position i will drive the i-th argument of the body function.</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> body function that test the property</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">return</span> a new registered property object of type Prop.</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>testPure</dt><dd>Helper to declare a named test property for a pure function. Defined in prelude.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> function to test</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> array of generators matching argument types</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> a descriptive name</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> property function which is passed the test-case, the arguments and the result of calling the function being tested. Must return true if the property test succeeded, false otherwise.</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>Prop</dt><dd>Creates a new property with a given array of argument generators and a testing function. For each generator a value is generated, so for testing a 2-ary function the array must contain 2 generators.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Prop::run</dt><dd>Tests the property.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> configuration of type Config to test property with</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">return</span> depending on test result a Pass, Fail or Invalid object</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>allProps</dt><dd>Internal array of all declared/registered properties
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>resetProps</dt><dd>Deletes all declared properties.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>runAllProps</dt><dd>Tests all registered properties.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> configuration of type Config to test the properties with</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> listener of a subclass of ConsoleListener</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>test</dt><dd>Test all known properties with a NodeListener and a configuration of 100 pass and 1000 invalid tests. Defined in prelude.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Invalid</dt><dd>Report class for invalid tested properties.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Pass</dt><dd>Report class for successful tested properties.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Fail</dt><dd>Report class for failed tested properties.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Stats</dt><dd>Statistics class for counting number of pass/invalid runs, building histograms and other statistics for reporting on a property and its test results.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Config</dt><dd>Testing Configuration.
</dd></span></div>
<ul>
<li class="nested">
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> maximum passes per property</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> maximum invalid tests per property</span>
</div>
<div class="Labeling">
<span class="footnotesize"><span class="noun">parameter</span> maximum number of shrinking steps per property</span>
</div>

</li>

</ul>
<div class="Labeling">
<span class="footnotesize"><dt>ConsoleListener</dt><dd>Abstract class for building ‘console’ based listeners.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>NodeListener</dt><dd>Listener with node compatible output in colors. Defined in prelude.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>FBCListener</dt><dd>Listener for sending property results to FireBug’s console
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>RhinoListener</dt><dd>Listener for Rhino, sending property results to stdout.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Distribution</dt><dd>Probability distributions
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>genvalue</dt><dd>Draws a new value from a generator. A generator is either a function accepting a seed argument or an object with a method ’arb’ accepting a seed argument.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>genshrinked</dt><dd>Uses the generator specific shrinking method to shrink a value that the generator created earlier. If the generator is a function or has no method named ’shrink’ or is an objects with a ’shrink’ method set to null, then no shrinking will be performed. If a shrinking method is defined, then it is called with the original seed and the value the generator created. The shrinking method must return an array of ‘shrinked’ values or null, undefined, or an empty array if no ‘shrinked’ values could be created.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>justSize</dt><dd>Passes the size ‘seed’ argument used to drive generators directly to the property test function.
</dd></span></div>
<div class="Labeling">
<span class="footnotesize"><dt>Utilities</dt><dd>A group of utilities that can be used to build generators: frequency, choose, randWhole, randInt, randRange, randFloatUnit
</dd></span></div>
</dl>
</div>

</div>
<h3 class="Subsection-">
<a class="toc" name="toc-Subsection--24"></a><p><br>
</p>
Additional Words
</h3>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>Prelude definitions</i></span></span><br><div class="listing">
<pre class="listing">show              globalize
confirm           prompt            getServerURL
viewURL           viewServer        stopServer
fileExists        readTextFile      readBinaryFile
_                 kup               qc
</pre>
</div>
<div class="Standard">
Refer to <div class="listing">
<pre class="listing">src/prelude/prelude.coffee
</pre>
</div>
 for the annotated source.
</div>
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>CoffeeScript environment</i></span></span><br><div class="listing">
<pre class="listing">Buffer            clearInterval     clearTimeout
console           global            GLOBAL
process           root              setInterval
setTimeout
</pre>
</div>
</div>
<div class="Standard">
View the interactive environment with: <span class="formula"> →∣</span> / ‘Tab’.
</div>
</div>
<div class="Standard">
<div class="Framed" style="width: 100%;">
<span class="sans"><span class="large"><i>JavaScript future words</i></span></span><br><div class="listing">
<pre class="listing">abstract    boolean     byte        case
char        const       default     double
enum        export      final       float
function    goto        implements  import
int         interface   let         long
native      package     private     protected
public      short       static      synchronized
throws      transient   var         void
volatile    with        yield
</pre>
</div>
</div>
</div>

</div>
<div class="Standard">
<a class="Label" name="Index"> </a>
</div>
<a class="toc" name="Index"></a><h1 class="index">Index</h1><p class="printindex">
<a class="printindex" name="index-%"></a>%: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-%-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-&amp;&amp;"></a>&amp;&amp;: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-&&-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-()"></a>(): <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-()-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-()-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-*="></a>*=: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-*=-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-++"></a>++: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-++-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-+="></a>+=: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-+=-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index--"></a>-: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry---0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index--&gt;"></a>-&gt;: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-->-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index--"></a>--: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry---0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index--="></a>-=: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry--=-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-/"></a>/: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-/-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-///"></a>///: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-///-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-/="></a>/=: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-/=-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-="></a>=: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-=-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-=="></a>==: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-==-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-==-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-?"></a>?: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-?-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-?."></a>?.: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-?.-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-A*"></a>A*: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-A*-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Boolean"></a>Boolean: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Boolean-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Date"></a>Date: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Date-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Dictionary"></a>Dictionary: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Dictionary-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Error"></a>Error: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Error-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-HTML"></a>HTML: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-HTML-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math"></a>Math: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.ceil"></a>Math.ceil: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.ceil-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.floor"></a>Math.floor: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.floor-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.max"></a>Math.max: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.max-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.max-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.pow"></a>Math.pow: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.pow-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.random"></a>Math.random: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.random-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Math.round"></a>Math.round: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Math.round-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-NaN"></a>NaN: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-NaN-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Number"></a>Number: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Number-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Object"></a>Object: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Object-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-String"></a>String: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-String-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-Unicode"></a>Unicode: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-Unicode-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-XML"></a>XML: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-XML-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-[]"></a>[]: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-[]-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-[]-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-abstraction"></a>abstraction: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-abstraction-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-anonymous-function"></a>anonymous function: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-anonymous-function-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-any"></a>any: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-any-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-apply"></a>apply: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-apply-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-apply-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-applying"></a>applying: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-applying-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-applying-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-argument"></a>argument: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-argument-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-argument-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-arguments"></a>arguments: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-arguments-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-array"></a>array: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-array-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-attribute"></a>attribute: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-attribute-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-backquotes"></a>backquotes: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-backquotes-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-binary-heap"></a>binary heap: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-binary-heap-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-binary-heap-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-binary-operator"></a>binary operator: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-binary-operator-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-block"></a>block: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-block-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-body"></a>body: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-body-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-body-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-boolean"></a>boolean: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-boolean-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-break"></a>break: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-break-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-call"></a>call: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-call-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-capitalisation"></a>capitalisation: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-capitalisation-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-catch"></a>catch: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-catch-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-catch-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-chained-comparison"></a>chained comparison: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-chained-comparison-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-charAt"></a>charAt: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-charAt-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-class"></a>class: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-class-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-class-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-closure"></a>closure: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-closure-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-comment"></a>comment: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-comment-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-compose"></a>compose: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-compose-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-concat"></a>concat: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-concat-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-concat-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-confirm"></a>confirm: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-confirm-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-constructor"></a>constructor: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-constructor-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-constructor-1">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-constructor-2">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-continue"></a>continue: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-continue-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-control-flow"></a>control flow: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-control-flow-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-corner-case"></a>corner case: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-corner-case-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-delete"></a>delete: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-delete-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-depend"></a>depend: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-depend-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-domain-specific-language"></a>domain-specific language: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-domain-specific-language-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-efficiency"></a>efficiency: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-efficiency-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-elegance"></a>elegance: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-elegance-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-else"></a>else: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-else-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-embedded-JavaScript"></a>embedded JavaScript: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-embedded-JavaScript-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-encapsulation"></a>encapsulation: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-encapsulation-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-environment"></a>environment: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-environment-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-eval"></a>eval: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-eval-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-every"></a>every: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-every-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-exception"></a>exception: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-exception-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-exception-handling"></a>exception handling: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-exception-handling-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-existential-accessor"></a>existential accessor: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-existential-accessor-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-existential-operator"></a>existential operator: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-existential-operator-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-exports"></a>exports: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-exports-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-expression"></a>expression: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-expression-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-extends"></a>extends: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-extends-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-filter"></a>filter: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-filter-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-finally"></a>finally: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-finally-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-for"></a>for: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-for-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-forEachOf"></a>forEachOf: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-forEachOf-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-fragile-base-class"></a>fragile base class: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-fragile-base-class-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-fragile-base-class-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-function"></a>function: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-function-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-function-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-function-composition"></a>function composition: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-function-composition-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-functional-programming"></a>functional programming: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-functional-programming-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-generate-and-test"></a>generate and test: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-generate-and-test-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-getProperty"></a>getProperty: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-getProperty-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-getTimezoneOffset"></a>getTimezoneOffset: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-getTimezoneOffset-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-graph"></a>graph: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-graph-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-hasOwnProperty"></a>hasOwnProperty: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-hasOwnProperty-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-heredocs"></a>heredocs: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-heredocs-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-hidden-properties"></a>hidden properties: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-hidden-properties-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-higher-order-function"></a>higher-order function: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-higher-order-function-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-if"></a>if: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-if-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-indentation"></a>indentation: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-indentation-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-indentation-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-indexOf"></a>indexOf: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-indexOf-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-interface"></a>interface: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-interface-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-invoking"></a>invoking: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-invoking-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-isNaN"></a>isNaN: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-isNaN-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-join"></a>join: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-join-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-keyword"></a>keyword: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-keyword-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-length"></a>length: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-length-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-length-1">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-length-2">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-library"></a>library: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-library-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-local-environment"></a>local environment: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-local-environment-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-loop"></a>loop: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-loop-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-loop-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-map"></a>map: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-map-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-method"></a>method: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-method-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-module"></a>module: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-module-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-modulo"></a>modulo: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-modulo-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-mutability"></a>mutability: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-mutability-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-name-space-pollution"></a>name-space pollution: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-name-space-pollution-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-new"></a>new: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-new-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-new-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-newline"></a>newline: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-newline-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-null"></a>null: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-null-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-number"></a>number: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-number-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-object"></a>object: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-object-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-object-oriented-programming"></a>object-oriented programming: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-object-oriented-programming-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-of"></a>of: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-of-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-of-1">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-of-2">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-of-3">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-parameter"></a>parameter: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-parameter-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-partial-application"></a>partial application: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-partial-application-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-pop"></a>pop: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-pop-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-precedence"></a>precedence: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-precedence-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-prompt"></a>prompt: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-prompt-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-properties"></a>properties: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-properties-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-propertyIsEnumerable"></a>propertyIsEnumerable: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-propertyIsEnumerable-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-prototype"></a>prototype: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-prototype-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-pure-function"></a>pure function: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-pure-function-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-push"></a>push: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-push-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-push-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-raise"></a>raise: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-raise-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-range"></a>range: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-range-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-read-only-properties"></a>read-only properties: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-read-only-properties-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-recursion"></a>recursion: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-recursion-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-recursion-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-reduce"></a>reduce: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-reduce-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-reference"></a>reference: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-reference-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-regular-expression"></a>regular expression: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-regular-expression-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-replace"></a>replace: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-replace-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-reserved-words"></a>reserved words: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-reserved-words-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-return"></a>return: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-return-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-return-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-script"></a>script: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-script-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-search"></a>search: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-search-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-search-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-semicolon"></a>semicolon: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-semicolon-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-set"></a>set: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-set-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-shadow"></a>shadow: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-shadow-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-show"></a>show: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-show-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-show-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-side-effect"></a>side effect: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-side-effect-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-slice"></a>slice: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-slice-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-sort"></a>sort: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-sort-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-split"></a>split: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-split-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-stack"></a>stack: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-stack-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-stack-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-statement"></a>statement: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-statement-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-string"></a>string: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-string-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-substitution-principle"></a>substitution principle: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-substitution-principle-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-super"></a>super: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-super-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-switch"></a>switch: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-switch-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-tag"></a>tag: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-tag-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-test"></a>test: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-test-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-testing"></a>testing: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-testing-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-this"></a>this: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-this-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-this-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-throw"></a>throw: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-throw-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-throw-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-timezone"></a>timezone: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-timezone-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-toLowerCase"></a>toLowerCase: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-toLowerCase-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-toString"></a>toString: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-toString-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-toString-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-toUpperCase"></a>toUpperCase: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-toUpperCase-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-top-level-environment"></a>top-level environment: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-top-level-environment-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-tree"></a>tree: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-tree-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-try"></a>try: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-try-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-type-conversion"></a>type conversion: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-type-conversion-0">↑</a>, <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-type-conversion-1">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-unary-operator"></a>unary operator: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-unary-operator-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-undefined"></a>undefined: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-undefined-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-unless"></a>unless: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-unless-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-until"></a>until: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-until-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-unwinding-the-stack"></a>unwinding the stack: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-unwinding-the-stack-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-value"></a>value: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-value-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-variable"></a>variable: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-variable-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-watched-properties"></a>watched properties: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-watched-properties-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-while"></a>while: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-while-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index-{}"></a>{}: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-{}-0">↑</a>
</p>
<p class="printindex">
<a class="printindex" name="index---"></a>||: <a class="IndexArrow" href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry----0">↑</a>
</p>

<hr class="footer">

</div>


</body></html>
